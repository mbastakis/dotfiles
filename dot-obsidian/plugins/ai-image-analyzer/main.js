/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var kA=Object.create;var Wo=Object.defineProperty;var NA=Object.getOwnPropertyDescriptor;var MA=Object.getOwnPropertyNames;var DA=Object.getPrototypeOf,OA=Object.prototype.hasOwnProperty;var Um=n=>{throw TypeError(n)};var UA=(n,e,t)=>e in n?Wo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Je=(n,e)=>()=>(n&&(e=n(n=0)),e);var K=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),pc=(n,e)=>{for(var t in e)Wo(n,t,{get:e[t],enumerable:!0})},Fm=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of MA(e))!OA.call(n,i)&&i!==t&&Wo(n,i,{get:()=>e[i],enumerable:!(r=NA(e,i))||r.enumerable});return n};var Le=(n,e,t)=>(t=n!=null?kA(DA(n)):{},Fm(e||!n||!n.__esModule?Wo(t,"default",{value:n,enumerable:!0}):t,n)),FA=n=>Fm(Wo({},"__esModule",{value:!0}),n);var x=(n,e,t)=>UA(n,typeof e!="symbol"?e+"":e,t),mc=(n,e,t)=>e.has(n)||Um("Cannot "+t);var D=(n,e,t)=>(mc(n,e,"read from private field"),t?t.call(n):e.get(n)),se=(n,e,t)=>e.has(n)?Um("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ce=(n,e,t,r)=>(mc(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),re=(n,e,t)=>(mc(n,e,"access private method"),t);var Di=(n,e,t,r)=>({set _(i){ce(n,e,i,t)},get _(){return D(n,e,r)}});var Bm=K((PF,gc)=>{"use strict";var BA=Object.prototype.hasOwnProperty,ct="~";function zo(){}Object.create&&(zo.prototype=Object.create(null),new zo().__proto__||(ct=!1));function GA(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function qm(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new GA(t,r||n,i),s=ct?ct+e:e;return n._events[s]?n._events[s].fn?n._events[s]=[n._events[s],o]:n._events[s].push(o):(n._events[s]=o,n._eventsCount++),n}function va(n,e){--n._eventsCount===0?n._events=new zo:delete n._events[e]}function tt(){this._events=new zo,this._eventsCount=0}tt.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)BA.call(t,r)&&e.push(ct?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};tt.prototype.listeners=function(e){var t=ct?ct+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s};tt.prototype.listenerCount=function(e){var t=ct?ct+e:e,r=this._events[t];return r?r.fn?1:r.length:0};tt.prototype.emit=function(e,t,r,i,o,s){var l=ct?ct+e:e;if(!this._events[l])return!1;var f=this._events[l],d=arguments.length,h,m;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),d){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,r),!0;case 4:return f.fn.call(f.context,t,r,i),!0;case 5:return f.fn.call(f.context,t,r,i,o),!0;case 6:return f.fn.call(f.context,t,r,i,o,s),!0}for(m=1,h=new Array(d-1);m<d;m++)h[m-1]=arguments[m];f.fn.apply(f.context,h)}else{var g=f.length,E;for(m=0;m<g;m++)switch(f[m].once&&this.removeListener(e,f[m].fn,void 0,!0),d){case 1:f[m].fn.call(f[m].context);break;case 2:f[m].fn.call(f[m].context,t);break;case 3:f[m].fn.call(f[m].context,t,r);break;case 4:f[m].fn.call(f[m].context,t,r,i);break;default:if(!h)for(E=1,h=new Array(d-1);E<d;E++)h[E-1]=arguments[E];f[m].fn.apply(f[m].context,h)}}return!0};tt.prototype.on=function(e,t,r){return qm(this,e,t,r,!1)};tt.prototype.once=function(e,t,r){return qm(this,e,t,r,!0)};tt.prototype.removeListener=function(e,t,r,i){var o=ct?ct+e:e;if(!this._events[o])return this;if(!t)return va(this,o),this;var s=this._events[o];if(s.fn)s.fn===t&&(!i||s.once)&&(!r||s.context===r)&&va(this,o);else{for(var l=0,f=[],d=s.length;l<d;l++)(s[l].fn!==t||i&&!s[l].once||r&&s[l].context!==r)&&f.push(s[l]);f.length?this._events[o]=f.length===1?f[0]:f:va(this,o)}return this};tt.prototype.removeAllListeners=function(e){var t;return e?(t=ct?ct+e:e,this._events[t]&&va(this,t)):(this._events=new zo,this._eventsCount=0),this};tt.prototype.off=tt.prototype.removeListener;tt.prototype.addListener=tt.prototype.on;tt.prefixed=ct;tt.EventEmitter=tt;typeof gc!="undefined"&&(gc.exports=tt)});var Rc=K((Ra,Zm)=>{(function(n,e){typeof Ra=="object"&&typeof Zm!="undefined"?e(Ra):typeof define=="function"&&define.amd?define(["exports"],e):e(n.WHATWGFetch={})})(Ra,(function(n){"use strict";var e=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof global!="undefined"&&global||{},t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&(function(){try{return new Blob,!0}catch(T){return!1}})(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function r(T){return T&&DataView.prototype.isPrototypeOf(T)}if(t.arrayBuffer)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(T){return T&&i.indexOf(Object.prototype.toString.call(T))>-1};function s(T){if(typeof T!="string"&&(T=String(T)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(T)||T==="")throw new TypeError('Invalid character in header field name: "'+T+'"');return T.toLowerCase()}function l(T){return typeof T!="string"&&(T=String(T)),T}function f(T){var L={next:function(){var X=T.shift();return{done:X===void 0,value:X}}};return t.iterable&&(L[Symbol.iterator]=function(){return L}),L}function d(T){this.map={},T instanceof d?T.forEach(function(L,X){this.append(X,L)},this):Array.isArray(T)?T.forEach(function(L){if(L.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+L.length);this.append(L[0],L[1])},this):T&&Object.getOwnPropertyNames(T).forEach(function(L){this.append(L,T[L])},this)}d.prototype.append=function(T,L){T=s(T),L=l(L);var X=this.map[T];this.map[T]=X?X+", "+L:L},d.prototype.delete=function(T){delete this.map[s(T)]},d.prototype.get=function(T){return T=s(T),this.has(T)?this.map[T]:null},d.prototype.has=function(T){return this.map.hasOwnProperty(s(T))},d.prototype.set=function(T,L){this.map[s(T)]=l(L)},d.prototype.forEach=function(T,L){for(var X in this.map)this.map.hasOwnProperty(X)&&T.call(L,this.map[X],X,this)},d.prototype.keys=function(){var T=[];return this.forEach(function(L,X){T.push(X)}),f(T)},d.prototype.values=function(){var T=[];return this.forEach(function(L){T.push(L)}),f(T)},d.prototype.entries=function(){var T=[];return this.forEach(function(L,X){T.push([X,L])}),f(T)},t.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);function h(T){if(!T._noBody){if(T.bodyUsed)return Promise.reject(new TypeError("Already read"));T.bodyUsed=!0}}function m(T){return new Promise(function(L,X){T.onload=function(){L(T.result)},T.onerror=function(){X(T.error)}})}function g(T){var L=new FileReader,X=m(L);return L.readAsArrayBuffer(T),X}function E(T){var L=new FileReader,X=m(L),Q=/charset=([A-Za-z0-9_-]+)/.exec(T.type),ie=Q?Q[1]:"utf-8";return L.readAsText(T,ie),X}function w(T){for(var L=new Uint8Array(T),X=new Array(L.length),Q=0;Q<L.length;Q++)X[Q]=String.fromCharCode(L[Q]);return X.join("")}function C(T){if(T.slice)return T.slice(0);var L=new Uint8Array(T.byteLength);return L.set(new Uint8Array(T)),L.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(T){this.bodyUsed=this.bodyUsed,this._bodyInit=T,T?typeof T=="string"?this._bodyText=T:t.blob&&Blob.prototype.isPrototypeOf(T)?this._bodyBlob=T:t.formData&&FormData.prototype.isPrototypeOf(T)?this._bodyFormData=T:t.searchParams&&URLSearchParams.prototype.isPrototypeOf(T)?this._bodyText=T.toString():t.arrayBuffer&&t.blob&&r(T)?(this._bodyArrayBuffer=C(T.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):t.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(T)||o(T))?this._bodyArrayBuffer=C(T):this._bodyText=T=Object.prototype.toString.call(T):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof T=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(T)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var T=h(this);if(T)return T;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var T=h(this);return T||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(t.blob)return this.blob().then(g);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var T=h(this);if(T)return T;if(this._bodyBlob)return E(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(w(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(W)}),this.json=function(){return this.text().then(JSON.parse)},this}var P=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function z(T){var L=T.toUpperCase();return P.indexOf(L)>-1?L:T}function $(T,L){if(!(this instanceof $))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');L=L||{};var X=L.body;if(T instanceof $){if(T.bodyUsed)throw new TypeError("Already read");this.url=T.url,this.credentials=T.credentials,L.headers||(this.headers=new d(T.headers)),this.method=T.method,this.mode=T.mode,this.signal=T.signal,!X&&T._bodyInit!=null&&(X=T._bodyInit,T.bodyUsed=!0)}else this.url=String(T);if(this.credentials=L.credentials||this.credentials||"same-origin",(L.headers||!this.headers)&&(this.headers=new d(L.headers)),this.method=z(L.method||this.method||"GET"),this.mode=L.mode||this.mode||null,this.signal=L.signal||this.signal||(function(){if("AbortController"in e){var ne=new AbortController;return ne.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&X)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(X),(this.method==="GET"||this.method==="HEAD")&&(L.cache==="no-store"||L.cache==="no-cache")){var Q=/([?&])_=[^&]*/;if(Q.test(this.url))this.url=this.url.replace(Q,"$1_="+new Date().getTime());else{var ie=/\?/;this.url+=(ie.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}$.prototype.clone=function(){return new $(this,{body:this._bodyInit})};function W(T){var L=new FormData;return T.trim().split("&").forEach(function(X){if(X){var Q=X.split("="),ie=Q.shift().replace(/\+/g," "),ne=Q.join("=").replace(/\+/g," ");L.append(decodeURIComponent(ie),decodeURIComponent(ne))}}),L}function H(T){var L=new d,X=T.replace(/\r?\n[\t ]+/g," ");return X.split("\r").map(function(Q){return Q.indexOf(`
`)===0?Q.substr(1,Q.length):Q}).forEach(function(Q){var ie=Q.split(":"),ne=ie.shift().trim();if(ne){var we=ie.join(":").trim();try{L.append(ne,we)}catch(_e){console.warn("Response "+_e.message)}}}),L}R.call($.prototype);function G(T,L){if(!(this instanceof G))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(L||(L={}),this.type="default",this.status=L.status===void 0?200:L.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=L.statusText===void 0?"":""+L.statusText,this.headers=new d(L.headers),this.url=L.url||"",this._initBody(T)}R.call(G.prototype),G.prototype.clone=function(){return new G(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},G.error=function(){var T=new G(null,{status:200,statusText:""});return T.ok=!1,T.status=0,T.type="error",T};var Y=[301,302,303,307,308];G.redirect=function(T,L){if(Y.indexOf(L)===-1)throw new RangeError("Invalid status code");return new G(null,{status:L,headers:{location:T}})},n.DOMException=e.DOMException;try{new n.DOMException}catch(T){n.DOMException=function(L,X){this.message=L,this.name=X;var Q=Error(L);this.stack=Q.stack},n.DOMException.prototype=Object.create(Error.prototype),n.DOMException.prototype.constructor=n.DOMException}function j(T,L){return new Promise(function(X,Q){var ie=new $(T,L);if(ie.signal&&ie.signal.aborted)return Q(new n.DOMException("Aborted","AbortError"));var ne=new XMLHttpRequest;function we(){ne.abort()}ne.onload=function(){var Ae={statusText:ne.statusText,headers:H(ne.getAllResponseHeaders()||"")};ie.url.indexOf("file://")===0&&(ne.status<200||ne.status>599)?Ae.status=200:Ae.status=ne.status,Ae.url="responseURL"in ne?ne.responseURL:Ae.headers.get("X-Request-URL");var Fe="response"in ne?ne.response:ne.responseText;setTimeout(function(){X(new G(Fe,Ae))},0)},ne.onerror=function(){setTimeout(function(){Q(new TypeError("Network request failed"))},0)},ne.ontimeout=function(){setTimeout(function(){Q(new TypeError("Network request timed out"))},0)},ne.onabort=function(){setTimeout(function(){Q(new n.DOMException("Aborted","AbortError"))},0)};function _e(Ae){try{return Ae===""&&e.location.href?e.location.href:Ae}catch(Fe){return Ae}}if(ne.open(ie.method,_e(ie.url),!0),ie.credentials==="include"?ne.withCredentials=!0:ie.credentials==="omit"&&(ne.withCredentials=!1),"responseType"in ne&&(t.blob?ne.responseType="blob":t.arrayBuffer&&(ne.responseType="arraybuffer")),L&&typeof L.headers=="object"&&!(L.headers instanceof d||e.Headers&&L.headers instanceof e.Headers)){var Re=[];Object.getOwnPropertyNames(L.headers).forEach(function(Ae){Re.push(s(Ae)),ne.setRequestHeader(Ae,l(L.headers[Ae]))}),ie.headers.forEach(function(Ae,Fe){Re.indexOf(Fe)===-1&&ne.setRequestHeader(Fe,Ae)})}else ie.headers.forEach(function(Ae,Fe){ne.setRequestHeader(Fe,Ae)});ie.signal&&(ie.signal.addEventListener("abort",we),ne.onreadystatechange=function(){ne.readyState===4&&ie.signal.removeEventListener("abort",we)}),ne.send(typeof ie._bodyInit=="undefined"?null:ie._bodyInit)})}j.polyfill=!0,e.fetch||(e.fetch=j,e.Headers=d,e.Request=$,e.Response=G),n.Headers=d,n.Request=$,n.Response=G,n.fetch=j,Object.defineProperty(n,"__esModule",{value:!0})}))});var Fc=K((lL,fg)=>{"use strict";var ka=Object.prototype.hasOwnProperty,cg=Object.prototype.toString,ig=Object.defineProperty,og=Object.getOwnPropertyDescriptor,sg=function(e){return typeof Array.isArray=="function"?Array.isArray(e):cg.call(e)==="[object Array]"},ag=function(e){if(!e||cg.call(e)!=="[object Object]")return!1;var t=ka.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&ka.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var i;for(i in e);return typeof i=="undefined"||ka.call(e,i)},lg=function(e,t){ig&&t.name==="__proto__"?ig(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},ug=function(e,t){if(t==="__proto__")if(ka.call(e,t)){if(og)return og(e,t).value}else return;return e[t]};fg.exports=function n(){var e,t,r,i,o,s,l=arguments[0],f=1,d=arguments.length,h=!1;for(typeof l=="boolean"&&(h=l,l=arguments[1]||{},f=2),(l==null||typeof l!="object"&&typeof l!="function")&&(l={});f<d;++f)if(e=arguments[f],e!=null)for(t in e)r=ug(l,t),i=ug(e,t),l!==i&&(h&&i&&(ag(i)||(o=sg(i)))?(o?(o=!1,s=r&&sg(r)?r:[]):s=r&&ag(r)?r:{},lg(l,{name:t,newValue:n(h,s,i)})):typeof i!="undefined"&&lg(l,{name:t,newValue:i}));return l}});var dg=K((uL,jA)=>{jA.exports={name:"gaxios",version:"7.1.3",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:{type:"git",directory:"packages/gaxios",url:"https://github.com/googleapis/google-cloud-node-core.git"},keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","stream-browserify":"^3.0.0",tmp:"0.2.5","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2",rimraf:"^5.0.1"},homepage:"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"}});var pg=K((cL,hg)=>{"use strict";var e0=dg();hg.exports={pkg:e0}});var Bc=K(Vt=>{"use strict";var yg=Vt&&Vt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.GaxiosError=Vt.GAXIOS_ERROR_SYMBOL=void 0;Vt.defaultErrorRedactor=_g;var mg=yg(Fc()),t0=yg(pg()),Lc=t0.default.pkg;Vt.GAXIOS_ERROR_SYMBOL=Symbol.for(`${Lc.name}-gaxios-error`);var gg,qc=class n extends Error{constructor(t,r,i,o){var s,l;super(t,{cause:o});x(this,"config");x(this,"response");x(this,"code");x(this,"status");x(this,"error");x(this,gg,Lc.version);if(this.config=r,this.response=i,this.error=o instanceof Error?o:void 0,this.config=(0,mg.default)(!0,{},r),this.response&&(this.response.config=(0,mg.default)(!0,{},this.response.config)),this.response){try{this.response.data=n0(this.config.responseType,(s=this.response)!=null&&s.bodyUsed?(l=this.response)==null?void 0:l.data:void 0)}catch(f){}this.status=this.response.status}o instanceof DOMException?this.code=o.name:o&&typeof o=="object"&&"code"in o&&(typeof o.code=="string"||typeof o.code=="number")&&(this.code=o.code)}static[(gg=Vt.GAXIOS_ERROR_SYMBOL,Symbol.hasInstance)](t){return t&&typeof t=="object"&&Vt.GAXIOS_ERROR_SYMBOL in t&&t[Vt.GAXIOS_ERROR_SYMBOL]===Lc.version?!0:Function.prototype[Symbol.hasInstance].call(n,t)}static extractAPIErrorFromResponse(t,r="The request failed"){let i=r;if(typeof t.data=="string"&&(i=t.data),t.data&&typeof t.data=="object"&&"error"in t.data&&t.data.error&&!t.ok){if(typeof t.data.error=="string")return{message:t.data.error,code:t.status,status:t.statusText};if(typeof t.data.error=="object"){i="message"in t.data.error&&typeof t.data.error.message=="string"?t.data.error.message:i;let o="status"in t.data.error&&typeof t.data.error.status=="string"?t.data.error.status:t.statusText,s="code"in t.data.error&&typeof t.data.error.code=="number"?t.data.error.code:t.status;if("errors"in t.data.error&&Array.isArray(t.data.error.errors)){let l=[];for(let f of t.data.error.errors)typeof f=="object"&&"message"in f&&typeof f.message=="string"&&l.push(f.message);return Object.assign({message:l.join(`
`)||i,code:s,status:o},t.data.error)}return Object.assign({message:i,code:s,status:o},t.data.error)}}return{message:i,code:t.status,status:t.statusText}}};Vt.GaxiosError=qc;function n0(n,e){switch(n){case"stream":return e;case"json":return JSON.parse(JSON.stringify(e));case"arraybuffer":return JSON.parse(Buffer.from(e).toString("utf8"));case"blob":return JSON.parse(e.text());default:return e}}function _g(n){let e="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function t(o){o&&o.forEach((s,l)=>{(/^authentication$/i.test(l)||/^authorization$/i.test(l)||/secret/i.test(l))&&o.set(l,e)})}function r(o,s){if(typeof o=="object"&&o!==null&&typeof o[s]=="string"){let l=o[s];(/grant_type=/i.test(l)||/assertion=/i.test(l)||/secret/i.test(l))&&(o[s]=e)}}function i(o){!o||typeof o!="object"||(o instanceof FormData||o instanceof URLSearchParams||"forEach"in o&&"set"in o?o.forEach((s,l)=>{(["grant_type","assertion"].includes(l)||/secret/.test(l))&&o.set(l,e)}):("grant_type"in o&&(o.grant_type=e),"assertion"in o&&(o.assertion=e),"client_secret"in o&&(o.client_secret=e)))}return n.config&&(t(n.config.headers),r(n.config,"data"),i(n.config.data),r(n.config,"body"),i(n.config.body),n.config.url.searchParams.has("token")&&n.config.url.searchParams.set("token",e),n.config.url.searchParams.has("client_secret")&&n.config.url.searchParams.set("client_secret",e)),n.response&&(_g({config:n.response.config}),t(n.response.headers),n.response.bodyUsed&&(r(n.response,"data"),i(n.response.data))),n}});var Sg=K(Gc=>{"use strict";Object.defineProperty(Gc,"__esModule",{value:!0});Gc.getRetryConfig=r0;async function r0(n){let e=Eg(n);if(!n||!n.config||!e&&!n.config.retry)return{shouldRetry:!1};e=e||{},e.currentRetryAttempt=e.currentRetryAttempt||0,e.retry=e.retry===void 0||e.retry===null?3:e.retry,e.httpMethodsToRetry=e.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],e.noResponseRetries=e.noResponseRetries===void 0||e.noResponseRetries===null?2:e.noResponseRetries,e.retryDelayMultiplier=e.retryDelayMultiplier?e.retryDelayMultiplier:2,e.timeOfFirstRequest=e.timeOfFirstRequest?e.timeOfFirstRequest:Date.now(),e.totalTimeout=e.totalTimeout?e.totalTimeout:Number.MAX_SAFE_INTEGER,e.maxRetryDelay=e.maxRetryDelay?e.maxRetryDelay:Number.MAX_SAFE_INTEGER;let t=[[100,199],[408,408],[429,429],[500,599]];if(e.statusCodesToRetry=e.statusCodesToRetry||t,n.config.retryConfig=e,!await(e.shouldRetry||i0)(n))return{shouldRetry:!1,config:n.config};let i=o0(e);n.config.retryConfig.currentRetryAttempt+=1;let o=e.retryBackoff?e.retryBackoff(n,i):new Promise(s=>{setTimeout(s,i)});return e.onRetryAttempt&&await e.onRetryAttempt(n),await o,{shouldRetry:!0,config:n.config}}function i0(n){var t,r;let e=Eg(n);if((t=n.config.signal)!=null&&t.aborted&&n.code!=="TimeoutError"||n.code==="AbortError"||!e||e.retry===0||!n.response&&(e.currentRetryAttempt||0)>=e.noResponseRetries||!e.httpMethodsToRetry||!e.httpMethodsToRetry.includes(((r=n.config.method)==null?void 0:r.toUpperCase())||"GET"))return!1;if(n.response&&n.response.status){let i=!1;for(let[o,s]of e.statusCodesToRetry){let l=n.response.status;if(l>=o&&l<=s){i=!0;break}}if(!i)return!1}return e.currentRetryAttempt=e.currentRetryAttempt||0,!(e.currentRetryAttempt>=e.retry)}function Eg(n){if(n&&n.config&&n.config.retryConfig)return n.config.retryConfig}function o0(n){var i;let t=(n.currentRetryAttempt?0:(i=n.retryDelay)!=null?i:100)+(Math.pow(n.retryDelayMultiplier,n.currentRetryAttempt)-1)/2*1e3,r=n.totalTimeout-(Date.now()-n.timeOfFirstRequest);return Math.min(t,r,n.maxRetryDelay)}});var Vc=K(Na=>{"use strict";Object.defineProperty(Na,"__esModule",{value:!0});Na.GaxiosInterceptorManager=void 0;var Hc=class extends Set{};Na.GaxiosInterceptorManager=Hc});var vg=K((mL,Tg)=>{var Hi=1e3,Vi=Hi*60,$i=Vi*60,Wr=$i*24,s0=Wr*7,a0=Wr*365.25;Tg.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return l0(n);if(t==="number"&&isFinite(n))return e.long?c0(n):u0(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function l0(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*a0;case"weeks":case"week":case"w":return t*s0;case"days":case"day":case"d":return t*Wr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*$i;case"minutes":case"minute":case"mins":case"min":case"m":return t*Vi;case"seconds":case"second":case"secs":case"sec":case"s":return t*Hi;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function u0(n){var e=Math.abs(n);return e>=Wr?Math.round(n/Wr)+"d":e>=$i?Math.round(n/$i)+"h":e>=Vi?Math.round(n/Vi)+"m":e>=Hi?Math.round(n/Hi)+"s":n+"ms"}function c0(n){var e=Math.abs(n);return e>=Wr?Ma(n,e,Wr,"day"):e>=$i?Ma(n,e,$i,"hour"):e>=Vi?Ma(n,e,Vi,"minute"):e>=Hi?Ma(n,e,Hi,"second"):n+" ms"}function Ma(n,e,t,r){var i=e>=t*1.5;return Math.round(n/t)+" "+r+(i?"s":"")}});var $c=K((gL,wg)=>{function f0(n){t.debug=t,t.default=t,t.coerce=f,t.disable=s,t.enable=i,t.enabled=l,t.humanize=vg(),t.destroy=d,Object.keys(n).forEach(h=>{t[h]=n[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let m=0;for(let g=0;g<h.length;g++)m=(m<<5)-m+h.charCodeAt(g),m|=0;return t.colors[Math.abs(m)%t.colors.length]}t.selectColor=e;function t(h){let m,g=null,E,w;function C(...R){if(!C.enabled)return;let P=C,z=Number(new Date),$=z-(m||z);P.diff=$,P.prev=m,P.curr=z,m=z,R[0]=t.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let W=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,(G,Y)=>{if(G==="%%")return"%";W++;let j=t.formatters[Y];if(typeof j=="function"){let T=R[W];G=j.call(P,T),R.splice(W,1),W--}return G}),t.formatArgs.call(P,R),(P.log||t.log).apply(P,R)}return C.namespace=h,C.useColors=t.useColors(),C.color=t.selectColor(h),C.extend=r,C.destroy=t.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(E!==t.namespaces&&(E=t.namespaces,w=t.enabled(h)),w),set:R=>{g=R}}),typeof t.init=="function"&&t.init(C),C}function r(h,m){let g=t(this.namespace+(typeof m=="undefined"?":":m)+h);return g.log=this.log,g}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let m=(typeof h=="string"?h:"").trim().replace(" ",",").split(",").filter(Boolean);for(let g of m)g[0]==="-"?t.skips.push(g.slice(1)):t.names.push(g)}function o(h,m){let g=0,E=0,w=-1,C=0;for(;g<h.length;)if(E<m.length&&(m[E]===h[g]||m[E]==="*"))m[E]==="*"?(w=E,C=g,E++):(g++,E++);else if(w!==-1)E=w+1,C++,g=C;else return!1;for(;E<m.length&&m[E]==="*";)E++;return E===m.length}function s(){let h=[...t.names,...t.skips.map(m=>"-"+m)].join(",");return t.enable(""),h}function l(h){for(let m of t.skips)if(o(h,m))return!1;for(let m of t.names)if(o(h,m))return!0;return!1}function f(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}wg.exports=f0});var Cg=K((At,Da)=>{At.formatArgs=h0;At.save=p0;At.load=m0;At.useColors=d0;At.storage=g0();At.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();At.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function d0(){if(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function h0(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+Da.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}At.log=console.debug||console.log||(()=>{});function p0(n){try{n?At.storage.setItem("debug",n):At.storage.removeItem("debug")}catch(e){}}function m0(){let n;try{n=At.storage.getItem("debug")}catch(e){}return!n&&typeof process!="undefined"&&"env"in process&&(n=process.env.DEBUG),n}function g0(){try{return localStorage}catch(n){}}Da.exports=$c()(At);var{formatters:y0}=Da.exports;y0.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var bg=K((yL,Ag)=>{"use strict";Ag.exports=(n,e=process.argv)=>{let t=n.startsWith("-")?"":n.length===1?"-":"--",r=e.indexOf(t+n),i=e.indexOf("--");return r!==-1&&(i===-1||r<i)}});var Pg=K((_L,Ig)=>{"use strict";var _0=require("os"),Rg=require("tty"),$t=bg(),{env:Ye}=process,Er;$t("no-color")||$t("no-colors")||$t("color=false")||$t("color=never")?Er=0:($t("color")||$t("colors")||$t("color=true")||$t("color=always"))&&(Er=1);"FORCE_COLOR"in Ye&&(Ye.FORCE_COLOR==="true"?Er=1:Ye.FORCE_COLOR==="false"?Er=0:Er=Ye.FORCE_COLOR.length===0?1:Math.min(parseInt(Ye.FORCE_COLOR,10),3));function Wc(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function zc(n,e){if(Er===0)return 0;if($t("color=16m")||$t("color=full")||$t("color=truecolor"))return 3;if($t("color=256"))return 2;if(n&&!e&&Er===void 0)return 0;let t=Er||0;if(Ye.TERM==="dumb")return t;if(process.platform==="win32"){let r=_0.release().split(".");return Number(r[0])>=10&&Number(r[2])>=10586?Number(r[2])>=14931?3:2:1}if("CI"in Ye)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(r=>r in Ye)||Ye.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in Ye)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ye.TEAMCITY_VERSION)?1:0;if(Ye.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Ye){let r=parseInt((Ye.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ye.TERM_PROGRAM){case"iTerm.app":return r>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ye.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Ye.TERM)||"COLORTERM"in Ye?1:t}function E0(n){let e=zc(n,n&&n.isTTY);return Wc(e)}Ig.exports={supportsColor:E0,stdout:Wc(zc(!0,Rg.isatty(1))),stderr:Wc(zc(!0,Rg.isatty(2)))}});var kg=K((Ke,Ua)=>{var S0=require("tty"),Oa=require("util");Ke.init=R0;Ke.log=C0;Ke.formatArgs=v0;Ke.save=A0;Ke.load=b0;Ke.useColors=T0;Ke.destroy=Oa.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Ke.colors=[6,2,3,4,5,1];try{let n=Pg();n&&(n.stderr||n).level>=2&&(Ke.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(n){}Ke.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function T0(){return"colors"in Ke.inspectOpts?!!Ke.inspectOpts.colors:S0.isatty(process.stderr.fd)}function v0(n){let{namespace:e,useColors:t}=this;if(t){let r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o=`  ${i};1m${e} \x1B[0m`;n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+Ua.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=w0()+e+" "+n[0]}function w0(){return Ke.inspectOpts.hideDate?"":new Date().toISOString()+" "}function C0(...n){return process.stderr.write(Oa.formatWithOptions(Ke.inspectOpts,...n)+`
`)}function A0(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function b0(){return process.env.DEBUG}function R0(n){n.inspectOpts={};let e=Object.keys(Ke.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=Ke.inspectOpts[e[t]]}Ua.exports=$c()(Ke);var{formatters:xg}=Ua.exports;xg.o=function(n){return this.inspectOpts.colors=this.useColors,Oa.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};xg.O=function(n){return this.inspectOpts.colors=this.useColors,Oa.inspect(n,this.inspectOpts)}});var Yc=K((EL,Jc)=>{typeof process=="undefined"||process.type==="renderer"||process.browser===!0||process.__nwjs?Jc.exports=Cg():Jc.exports=kg()});var Dg=K(St=>{"use strict";var I0=St&&St.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),P0=St&&St.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),Ng=St&&St.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&I0(e,n,t);return P0(e,n),e};Object.defineProperty(St,"__esModule",{value:!0});St.req=St.json=St.toBuffer=void 0;var x0=Ng(require("http")),k0=Ng(require("https"));async function Mg(n){let e=0,t=[];for await(let r of n)e+=r.length,t.push(r);return Buffer.concat(t,e)}St.toBuffer=Mg;async function N0(n){let t=(await Mg(n)).toString("utf8");try{return JSON.parse(t)}catch(r){let i=r;throw i.message+=` (input: ${t})`,i}}St.json=N0;function M0(n,e={}){let r=((typeof n=="string"?n:n.href).startsWith("https:")?k0:x0).request(n,e),i=new Promise((o,s)=>{r.once("response",o).once("error",s).end()});return r.then=i.then.bind(i),r}St.req=M0});var Lg=K(bt=>{"use strict";var Ug=bt&&bt.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),D0=bt&&bt.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),Fg=bt&&bt.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Ug(e,n,t);return D0(e,n),e},O0=bt&&bt.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Ug(e,n,t)};Object.defineProperty(bt,"__esModule",{value:!0});bt.Agent=void 0;var U0=Fg(require("net")),Og=Fg(require("http")),F0=require("https");O0(Dg(),bt);var An=Symbol("AgentBaseInternalState"),Kc=class extends Og.Agent{constructor(e){super(e),this[An]={}}isSecureEndpoint(e){if(e){if(typeof e.secureEndpoint=="boolean")return e.secureEndpoint;if(typeof e.protocol=="string")return e.protocol==="https:"}let{stack:t}=new Error;return typeof t!="string"?!1:t.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}incrementSockets(e){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[e]||(this.sockets[e]=[]);let t=new U0.Socket({writable:!1});return this.sockets[e].push(t),this.totalSocketCount++,t}decrementSockets(e,t){if(!this.sockets[e]||t===null)return;let r=this.sockets[e],i=r.indexOf(t);i!==-1&&(r.splice(i,1),this.totalSocketCount--,r.length===0&&delete this.sockets[e])}getName(e){return this.isSecureEndpoint(e)?F0.Agent.prototype.getName.call(this,e):super.getName(e)}createSocket(e,t,r){let i={...t,secureEndpoint:this.isSecureEndpoint(t)},o=this.getName(i),s=this.incrementSockets(o);Promise.resolve().then(()=>this.connect(e,i)).then(l=>{if(this.decrementSockets(o,s),l instanceof Og.Agent)try{return l.addRequest(e,i)}catch(f){return r(f)}this[An].currentSocket=l,super.createSocket(e,t,r)},l=>{this.decrementSockets(o,s),r(l)})}createConnection(){let e=this[An].currentSocket;if(this[An].currentSocket=void 0,!e)throw new Error("No socket was returned in the `connect()` function");return e}get defaultPort(){var e;return(e=this[An].defaultPort)!=null?e:this.protocol==="https:"?443:80}set defaultPort(e){this[An]&&(this[An].defaultPort=e)}get protocol(){var e;return(e=this[An].protocol)!=null?e:this.isSecureEndpoint()?"https:":"http:"}set protocol(e){this[An]&&(this[An].protocol=e)}};bt.Agent=Kc});var qg=K(Wi=>{"use strict";var L0=Wi&&Wi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.parseProxyResponse=void 0;var q0=L0(Yc()),Fa=(0,q0.default)("https-proxy-agent:parse-proxy-response");function B0(n){return new Promise((e,t)=>{let r=0,i=[];function o(){let h=n.read();h?d(h):n.once("readable",o)}function s(){n.removeListener("end",l),n.removeListener("error",f),n.removeListener("readable",o)}function l(){s(),Fa("onend"),t(new Error("Proxy connection ended before receiving CONNECT response"))}function f(h){s(),Fa("onerror %o",h),t(h)}function d(h){i.push(h),r+=h.length;let m=Buffer.concat(i,r),g=m.indexOf(`\r
\r
`);if(g===-1){Fa("have not received end of HTTP headers yet..."),o();return}let E=m.slice(0,g).toString("ascii").split(`\r
`),w=E.shift();if(!w)return n.destroy(),t(new Error("No header received from proxy CONNECT response"));let C=w.split(" "),R=+C[1],P=C.slice(2).join(" "),z={};for(let $ of E){if(!$)continue;let W=$.indexOf(":");if(W===-1)return n.destroy(),t(new Error(`Invalid header from proxy CONNECT response: "${$}"`));let H=$.slice(0,W).toLowerCase(),G=$.slice(W+1).trimStart(),Y=z[H];typeof Y=="string"?z[H]=[Y,G]:Array.isArray(Y)?Y.push(G):z[H]=G}Fa("got proxy server response: %o %o",w,z),s(),e({connect:{statusCode:R,statusText:P,headers:z},buffered:m})}n.on("error",f),n.on("end",l),o()})}Wi.parseProxyResponse=B0});var Wg=K(Wt=>{"use strict";var G0=Wt&&Wt.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),H0=Wt&&Wt.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),Vg=Wt&&Wt.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&G0(e,n,t);return H0(e,n),e},$g=Wt&&Wt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.HttpsProxyAgent=void 0;var La=Vg(require("net")),Bg=Vg(require("tls")),V0=$g(require("assert")),$0=$g(Yc()),W0=Lg(),z0=require("url"),J0=qg(),es=(0,$0.default)("https-proxy-agent"),Gg=n=>n.servername===void 0&&n.host&&!La.isIP(n.host)?{...n,servername:n.host}:n,qa=class extends W0.Agent{constructor(e,t){var o;super(t),this.options={path:void 0},this.proxy=typeof e=="string"?new z0.URL(e):e,this.proxyHeaders=(o=t==null?void 0:t.headers)!=null?o:{},es("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...t?Hg(t,"headers"):null,host:r,port:i}}async connect(e,t){let{proxy:r}=this;if(!t.host)throw new TypeError('No "host" provided');let i;r.protocol==="https:"?(es("Creating `tls.Socket`: %o",this.connectOpts),i=Bg.connect(Gg(this.connectOpts))):(es("Creating `net.Socket`: %o",this.connectOpts),i=La.connect(this.connectOpts));let o=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},s=La.isIPv6(t.host)?`[${t.host}]`:t.host,l=`CONNECT ${s}:${t.port} HTTP/1.1\r
`;if(r.username||r.password){let g=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;o["Proxy-Authorization"]=`Basic ${Buffer.from(g).toString("base64")}`}o.Host=`${s}:${t.port}`,o["Proxy-Connection"]||(o["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let g of Object.keys(o))l+=`${g}: ${o[g]}\r
`;let f=(0,J0.parseProxyResponse)(i);i.write(`${l}\r
`);let{connect:d,buffered:h}=await f;if(e.emit("proxyConnect",d),this.emit("proxyConnect",d,e),d.statusCode===200)return e.once("socket",Y0),t.secureEndpoint?(es("Upgrading socket connection to TLS"),Bg.connect({...Hg(Gg(t),"host","path","port"),socket:i})):i;i.destroy();let m=new La.Socket({writable:!1});return m.readable=!0,e.once("socket",g=>{es("Replaying proxy buffer for failed request"),(0,V0.default)(g.listenerCount("data")>0),g.push(h),g.push(null)}),m}};qa.protocols=["http","https"];Wt.HttpsProxyAgent=qa;function Y0(n){n.resume()}function Hg(n,...e){let t={},r;for(r in n)e.includes(r)||(t[r]=n[r]);return t}});function K0(n){if(!/^data:/i.test(n))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');n=n.replace(/\r?\n/g,"");let e=n.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=n.substring(5,e).split(";"),r="",i=!1,o=t[0]||"text/plain",s=o;for(let h=1;h<t.length;h++)t[h]==="base64"?i=!0:t[h]&&(s+=`;${t[h]}`,t[h].indexOf("charset=")===0&&(r=t[h].substring(8)));!t[0]&&!r.length&&(s+=";charset=US-ASCII",r="US-ASCII");let l=i?"base64":"ascii",f=unescape(n.substring(e+1)),d=Buffer.from(f,l);return d.type=o,d.typeFull=s,d.charset=r,d}var zg,Jg=Je(()=>{zg=K0});var Kg=K((Ba,Yg)=>{(function(n,e){typeof Ba=="object"&&typeof Yg!="undefined"?e(Ba):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis!="undefined"?globalThis:n||self,e(n.WebStreamsPolyfill={}))})(Ba,(function(n){"use strict";function e(){}function t(u){return typeof u=="object"&&u!==null||typeof u=="function"}let r=e;function i(u,p){try{Object.defineProperty(u,"name",{value:p,configurable:!0})}catch(y){}}let o=Promise,s=Promise.prototype.then,l=Promise.reject.bind(o);function f(u){return new o(u)}function d(u){return f(p=>p(u))}function h(u){return l(u)}function m(u,p,y){return s.call(u,p,y)}function g(u,p,y){m(m(u,p,y),void 0,r)}function E(u,p){g(u,p)}function w(u,p){g(u,void 0,p)}function C(u,p,y){return m(u,p,y)}function R(u){m(u,void 0,r)}let P=u=>{if(typeof queueMicrotask=="function")P=queueMicrotask;else{let p=d(void 0);P=y=>m(p,y)}return P(u)};function z(u,p,y){if(typeof u!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(u,p,y)}function $(u,p,y){try{return d(z(u,p,y))}catch(S){return h(S)}}let W=16384;class H{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(p){let y=this._back,S=y;y._elements.length===W-1&&(S={_elements:[],_next:void 0}),y._elements.push(p),S!==y&&(this._back=S,y._next=S),++this._size}shift(){let p=this._front,y=p,S=this._cursor,b=S+1,q=p._elements,V=q[S];return b===W&&(y=p._next,b=0),--this._size,this._cursor=b,p!==y&&(this._front=y),q[S]=void 0,V}forEach(p){let y=this._cursor,S=this._front,b=S._elements;for(;(y!==b.length||S._next!==void 0)&&!(y===b.length&&(S=S._next,b=S._elements,y=0,b.length===0));)p(b[y]),++y}peek(){let p=this._front,y=this._cursor;return p._elements[y]}}let G=Symbol("[[AbortSteps]]"),Y=Symbol("[[ErrorSteps]]"),j=Symbol("[[CancelSteps]]"),T=Symbol("[[PullSteps]]"),L=Symbol("[[ReleaseSteps]]");function X(u,p){u._ownerReadableStream=p,p._reader=u,p._state==="readable"?we(u):p._state==="closed"?Re(u):_e(u,p._storedError)}function Q(u,p){let y=u._ownerReadableStream;return rn(y,p)}function ie(u){let p=u._ownerReadableStream;p._state==="readable"?Ae(u,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Fe(u,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),p._readableStreamController[L](),p._reader=void 0,u._ownerReadableStream=void 0}function ne(u){return new TypeError("Cannot "+u+" a stream using a released reader")}function we(u){u._closedPromise=f((p,y)=>{u._closedPromise_resolve=p,u._closedPromise_reject=y})}function _e(u,p){we(u),Ae(u,p)}function Re(u){we(u),Ei(u)}function Ae(u,p){u._closedPromise_reject!==void 0&&(R(u._closedPromise),u._closedPromise_reject(p),u._closedPromise_resolve=void 0,u._closedPromise_reject=void 0)}function Fe(u,p){_e(u,p)}function Ei(u){u._closedPromise_resolve!==void 0&&(u._closedPromise_resolve(void 0),u._closedPromise_resolve=void 0,u._closedPromise_reject=void 0)}let Sn=Number.isFinite||function(u){return typeof u=="number"&&isFinite(u)},Oo=Math.trunc||function(u){return u<0?Math.ceil(u):Math.floor(u)};function Z(u){return typeof u=="object"||typeof u=="function"}function yt(u,p){if(u!==void 0&&!Z(u))throw new TypeError(`${p} is not an object.`)}function at(u,p){if(typeof u!="function")throw new TypeError(`${p} is not a function.`)}function Uo(u){return typeof u=="object"&&u!==null||typeof u=="function"}function lt(u,p){if(!Uo(u))throw new TypeError(`${p} is not an object.`)}function $e(u,p,y){if(u===void 0)throw new TypeError(`Parameter ${p} is required in '${y}'.`)}function _(u,p,y){if(u===void 0)throw new TypeError(`${p} is required in '${y}'.`)}function v(u){return Number(u)}function A(u){return u===0?0:u}function U(u){return A(Oo(u))}function k(u,p){let S=Number.MAX_SAFE_INTEGER,b=Number(u);if(b=A(b),!Sn(b))throw new TypeError(`${p} is not a finite number`);if(b=U(b),b<0||b>S)throw new TypeError(`${p} is outside the accepted range of 0 to ${S}, inclusive`);return!Sn(b)||b===0?0:b}function M(u,p){if(!hr(u))throw new TypeError(`${p} is not a ReadableStream.`)}function B(u){return new J(u)}function I(u,p){u._reader._readRequests.push(p)}function N(u,p,y){let b=u._reader._readRequests.shift();y?b._closeSteps():b._chunkSteps(p)}function F(u){return u._reader._readRequests.length}function O(u){let p=u._reader;return!(p===void 0||!oe(p))}class J{constructor(p){if($e(p,1,"ReadableStreamDefaultReader"),M(p,"First parameter"),pr(p))throw new TypeError("This stream has already been locked for exclusive reading by another reader");X(this,p),this._readRequests=new H}get closed(){return oe(this)?this._closedPromise:h(Oe("closed"))}cancel(p=void 0){return oe(this)?this._ownerReadableStream===void 0?h(ne("cancel")):Q(this,p):h(Oe("cancel"))}read(){if(!oe(this))return h(Oe("read"));if(this._ownerReadableStream===void 0)return h(ne("read from"));let p,y,S=f((q,V)=>{p=q,y=V});return le(this,{_chunkSteps:q=>p({value:q,done:!1}),_closeSteps:()=>p({value:void 0,done:!0}),_errorSteps:q=>y(q)}),S}releaseLock(){if(!oe(this))throw Oe("releaseLock");this._ownerReadableStream!==void 0&&ve(this)}}Object.defineProperties(J.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(J.prototype.cancel,"cancel"),i(J.prototype.read,"read"),i(J.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(J.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function oe(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_readRequests")?!1:u instanceof J}function le(u,p){let y=u._ownerReadableStream;y._disturbed=!0,y._state==="closed"?p._closeSteps():y._state==="errored"?p._errorSteps(y._storedError):y._readableStreamController[T](p)}function ve(u){ie(u);let p=new TypeError("Reader was released");Me(u,p)}function Me(u,p){let y=u._readRequests;u._readRequests=new H,y.forEach(S=>{S._errorSteps(p)})}function Oe(u){return new TypeError(`ReadableStreamDefaultReader.prototype.${u} can only be used on a ReadableStreamDefaultReader`)}let Te=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class be{constructor(p,y){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=p,this._preventCancel=y}next(){let p=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?C(this._ongoingPromise,p,p):p(),this._ongoingPromise}return(p){let y=()=>this._returnSteps(p);return this._ongoingPromise?C(this._ongoingPromise,y,y):y()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let p=this._reader,y,S,b=f((V,te)=>{y=V,S=te});return le(p,{_chunkSteps:V=>{this._ongoingPromise=void 0,P(()=>y({value:V,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,ie(p),y({value:void 0,done:!0})},_errorSteps:V=>{this._ongoingPromise=void 0,this._isFinished=!0,ie(p),S(V)}}),b}_returnSteps(p){if(this._isFinished)return Promise.resolve({value:p,done:!0});this._isFinished=!0;let y=this._reader;if(!this._preventCancel){let S=Q(y,p);return ie(y),C(S,()=>({value:p,done:!0}))}return ie(y),d({value:p,done:!0})}}let We={next(){return Ti(this)?this._asyncIteratorImpl.next():h(vi("next"))},return(u){return Ti(this)?this._asyncIteratorImpl.return(u):h(vi("return"))}};Object.setPrototypeOf(We,Te);function Si(u,p){let y=B(u),S=new be(y,p),b=Object.create(We);return b._asyncIteratorImpl=S,b}function Ti(u){if(!t(u)||!Object.prototype.hasOwnProperty.call(u,"_asyncIteratorImpl"))return!1;try{return u._asyncIteratorImpl instanceof be}catch(p){return!1}}function vi(u){return new TypeError(`ReadableStreamAsyncIterator.${u} can only be used on a ReadableSteamAsyncIterator`)}let wt=Number.isNaN||function(u){return u!==u};var Bn,je,ze;function Ie(u){return u.slice()}function Dp(u,p,y,S,b){new Uint8Array(u).set(new Uint8Array(y,S,b),p)}let Gn=u=>(typeof u.transfer=="function"?Gn=p=>p.transfer():typeof structuredClone=="function"?Gn=p=>structuredClone(p,{transfer:[p]}):Gn=p=>p,Gn(u)),ur=u=>(typeof u.detached=="boolean"?ur=p=>p.detached:ur=p=>p.byteLength===0,ur(u));function Op(u,p,y){if(u.slice)return u.slice(p,y);let S=y-p,b=new ArrayBuffer(S);return Dp(b,0,u,p,S),b}function Ks(u,p){let y=u[p];if(y!=null){if(typeof y!="function")throw new TypeError(`${String(p)} is not a function`);return y}}function Xw(u){let p={[Symbol.iterator]:()=>u.iterator},y=(async function*(){return yield*p})(),S=y.next;return{iterator:y,nextMethod:S,done:!1}}let Gu=(ze=(Bn=Symbol.asyncIterator)!==null&&Bn!==void 0?Bn:(je=Symbol.for)===null||je===void 0?void 0:je.call(Symbol,"Symbol.asyncIterator"))!==null&&ze!==void 0?ze:"@@asyncIterator";function Up(u,p="sync",y){if(y===void 0)if(p==="async"){if(y=Ks(u,Gu),y===void 0){let q=Ks(u,Symbol.iterator),V=Up(u,"sync",q);return Xw(V)}}else y=Ks(u,Symbol.iterator);if(y===void 0)throw new TypeError("The object is not iterable");let S=z(y,u,[]);if(!t(S))throw new TypeError("The iterator method must return an object");let b=S.next;return{iterator:S,nextMethod:b,done:!1}}function Qw(u){let p=z(u.nextMethod,u.iterator,[]);if(!t(p))throw new TypeError("The iterator.next() method must return an object");return p}function Zw(u){return!!u.done}function jw(u){return u.value}function eC(u){return!(typeof u!="number"||wt(u)||u<0)}function Fp(u){let p=Op(u.buffer,u.byteOffset,u.byteOffset+u.byteLength);return new Uint8Array(p)}function Hu(u){let p=u._queue.shift();return u._queueTotalSize-=p.size,u._queueTotalSize<0&&(u._queueTotalSize=0),p.value}function Vu(u,p,y){if(!eC(y)||y===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");u._queue.push({value:p,size:y}),u._queueTotalSize+=y}function tC(u){return u._queue.peek().value}function cr(u){u._queue=new H,u._queueTotalSize=0}function Lp(u){return u===DataView}function nC(u){return Lp(u.constructor)}function rC(u){return Lp(u)?1:u.BYTES_PER_ELEMENT}class Dr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!$u(this))throw Ku("view");return this._view}respond(p){if(!$u(this))throw Ku("respond");if($e(p,1,"respond"),p=k(p,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ur(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");js(this._associatedReadableByteStreamController,p)}respondWithNewView(p){if(!$u(this))throw Ku("respondWithNewView");if($e(p,1,"respondWithNewView"),!ArrayBuffer.isView(p))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ur(p.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");ea(this._associatedReadableByteStreamController,p)}}Object.defineProperties(Dr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),i(Dr.prototype.respond,"respond"),i(Dr.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Dr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Hn{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Or(this))throw Lo("byobRequest");return Yu(this)}get desiredSize(){if(!Or(this))throw Lo("desiredSize");return Yp(this)}close(){if(!Or(this))throw Lo("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let p=this._controlledReadableByteStream._state;if(p!=="readable")throw new TypeError(`The stream (in ${p} state) is not in the readable state and cannot be closed`);Fo(this)}enqueue(p){if(!Or(this))throw Lo("enqueue");if($e(p,1,"enqueue"),!ArrayBuffer.isView(p))throw new TypeError("chunk must be an array buffer view");if(p.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(p.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let y=this._controlledReadableByteStream._state;if(y!=="readable")throw new TypeError(`The stream (in ${y} state) is not in the readable state and cannot be enqueued to`);Zs(this,p)}error(p=void 0){if(!Or(this))throw Lo("error");qt(this,p)}[j](p){qp(this),cr(this);let y=this._cancelAlgorithm(p);return Qs(this),y}[T](p){let y=this._controlledReadableByteStream;if(this._queueTotalSize>0){Jp(this,p);return}let S=this._autoAllocateChunkSize;if(S!==void 0){let b;try{b=new ArrayBuffer(S)}catch(V){p._errorSteps(V);return}let q={buffer:b,bufferByteLength:S,byteOffset:0,byteLength:S,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(q)}I(y,p),Ur(this)}[L](){if(this._pendingPullIntos.length>0){let p=this._pendingPullIntos.peek();p.readerType="none",this._pendingPullIntos=new H,this._pendingPullIntos.push(p)}}}Object.defineProperties(Hn.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),i(Hn.prototype.close,"close"),i(Hn.prototype.enqueue,"enqueue"),i(Hn.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Hn.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Or(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_controlledReadableByteStream")?!1:u instanceof Hn}function $u(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_associatedReadableByteStreamController")?!1:u instanceof Dr}function Ur(u){if(!lC(u))return;if(u._pulling){u._pullAgain=!0;return}u._pulling=!0;let y=u._pullAlgorithm();g(y,()=>(u._pulling=!1,u._pullAgain&&(u._pullAgain=!1,Ur(u)),null),S=>(qt(u,S),null))}function qp(u){zu(u),u._pendingPullIntos=new H}function Wu(u,p){let y=!1;u._state==="closed"&&(y=!0);let S=Bp(p);p.readerType==="default"?N(u,S,y):pC(u,S,y)}function Bp(u){let p=u.bytesFilled,y=u.elementSize;return new u.viewConstructor(u.buffer,u.byteOffset,p/y)}function Xs(u,p,y,S){u._queue.push({buffer:p,byteOffset:y,byteLength:S}),u._queueTotalSize+=S}function Gp(u,p,y,S){let b;try{b=Op(p,y,y+S)}catch(q){throw qt(u,q),q}Xs(u,b,0,S)}function Hp(u,p){p.bytesFilled>0&&Gp(u,p.buffer,p.byteOffset,p.bytesFilled),wi(u)}function Vp(u,p){let y=Math.min(u._queueTotalSize,p.byteLength-p.bytesFilled),S=p.bytesFilled+y,b=y,q=!1,V=S%p.elementSize,te=S-V;te>=p.minimumFill&&(b=te-p.bytesFilled,q=!0);let ge=u._queue;for(;b>0;){let de=ge.peek(),ye=Math.min(b,de.byteLength),Ee=p.byteOffset+p.bytesFilled;Dp(p.buffer,Ee,de.buffer,de.byteOffset,ye),de.byteLength===ye?ge.shift():(de.byteOffset+=ye,de.byteLength-=ye),u._queueTotalSize-=ye,$p(u,ye,p),b-=ye}return q}function $p(u,p,y){y.bytesFilled+=p}function Wp(u){u._queueTotalSize===0&&u._closeRequested?(Qs(u),$o(u._controlledReadableByteStream)):Ur(u)}function zu(u){u._byobRequest!==null&&(u._byobRequest._associatedReadableByteStreamController=void 0,u._byobRequest._view=null,u._byobRequest=null)}function Ju(u){for(;u._pendingPullIntos.length>0;){if(u._queueTotalSize===0)return;let p=u._pendingPullIntos.peek();Vp(u,p)&&(wi(u),Wu(u._controlledReadableByteStream,p))}}function iC(u){let p=u._controlledReadableByteStream._reader;for(;p._readRequests.length>0;){if(u._queueTotalSize===0)return;let y=p._readRequests.shift();Jp(u,y)}}function oC(u,p,y,S){let b=u._controlledReadableByteStream,q=p.constructor,V=rC(q),{byteOffset:te,byteLength:ge}=p,de=y*V,ye;try{ye=Gn(p.buffer)}catch(xe){S._errorSteps(xe);return}let Ee={buffer:ye,bufferByteLength:ye.byteLength,byteOffset:te,byteLength:ge,bytesFilled:0,minimumFill:de,elementSize:V,viewConstructor:q,readerType:"byob"};if(u._pendingPullIntos.length>0){u._pendingPullIntos.push(Ee),Qp(b,S);return}if(b._state==="closed"){let xe=new q(Ee.buffer,Ee.byteOffset,0);S._closeSteps(xe);return}if(u._queueTotalSize>0){if(Vp(u,Ee)){let xe=Bp(Ee);Wp(u),S._chunkSteps(xe);return}if(u._closeRequested){let xe=new TypeError("Insufficient bytes to fill elements in the given buffer");qt(u,xe),S._errorSteps(xe);return}}u._pendingPullIntos.push(Ee),Qp(b,S),Ur(u)}function sC(u,p){p.readerType==="none"&&wi(u);let y=u._controlledReadableByteStream;if(Xu(y))for(;Zp(y)>0;){let S=wi(u);Wu(y,S)}}function aC(u,p,y){if($p(u,p,y),y.readerType==="none"){Hp(u,y),Ju(u);return}if(y.bytesFilled<y.minimumFill)return;wi(u);let S=y.bytesFilled%y.elementSize;if(S>0){let b=y.byteOffset+y.bytesFilled;Gp(u,y.buffer,b-S,S)}y.bytesFilled-=S,Wu(u._controlledReadableByteStream,y),Ju(u)}function zp(u,p){let y=u._pendingPullIntos.peek();zu(u),u._controlledReadableByteStream._state==="closed"?sC(u,y):aC(u,p,y),Ur(u)}function wi(u){return u._pendingPullIntos.shift()}function lC(u){let p=u._controlledReadableByteStream;return p._state!=="readable"||u._closeRequested||!u._started?!1:!!(O(p)&&F(p)>0||Xu(p)&&Zp(p)>0||Yp(u)>0)}function Qs(u){u._pullAlgorithm=void 0,u._cancelAlgorithm=void 0}function Fo(u){let p=u._controlledReadableByteStream;if(!(u._closeRequested||p._state!=="readable")){if(u._queueTotalSize>0){u._closeRequested=!0;return}if(u._pendingPullIntos.length>0){let y=u._pendingPullIntos.peek();if(y.bytesFilled%y.elementSize!==0){let S=new TypeError("Insufficient bytes to fill elements in the given buffer");throw qt(u,S),S}}Qs(u),$o(p)}}function Zs(u,p){let y=u._controlledReadableByteStream;if(u._closeRequested||y._state!=="readable")return;let{buffer:S,byteOffset:b,byteLength:q}=p;if(ur(S))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let V=Gn(S);if(u._pendingPullIntos.length>0){let te=u._pendingPullIntos.peek();if(ur(te.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");zu(u),te.buffer=Gn(te.buffer),te.readerType==="none"&&Hp(u,te)}if(O(y))if(iC(u),F(y)===0)Xs(u,V,b,q);else{u._pendingPullIntos.length>0&&wi(u);let te=new Uint8Array(V,b,q);N(y,te,!1)}else Xu(y)?(Xs(u,V,b,q),Ju(u)):Xs(u,V,b,q);Ur(u)}function qt(u,p){let y=u._controlledReadableByteStream;y._state==="readable"&&(qp(u),cr(u),Qs(u),vm(y,p))}function Jp(u,p){let y=u._queue.shift();u._queueTotalSize-=y.byteLength,Wp(u);let S=new Uint8Array(y.buffer,y.byteOffset,y.byteLength);p._chunkSteps(S)}function Yu(u){if(u._byobRequest===null&&u._pendingPullIntos.length>0){let p=u._pendingPullIntos.peek(),y=new Uint8Array(p.buffer,p.byteOffset+p.bytesFilled,p.byteLength-p.bytesFilled),S=Object.create(Dr.prototype);cC(S,u,y),u._byobRequest=S}return u._byobRequest}function Yp(u){let p=u._controlledReadableByteStream._state;return p==="errored"?null:p==="closed"?0:u._strategyHWM-u._queueTotalSize}function js(u,p){let y=u._pendingPullIntos.peek();if(u._controlledReadableByteStream._state==="closed"){if(p!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(p===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(y.bytesFilled+p>y.byteLength)throw new RangeError("bytesWritten out of range")}y.buffer=Gn(y.buffer),zp(u,p)}function ea(u,p){let y=u._pendingPullIntos.peek();if(u._controlledReadableByteStream._state==="closed"){if(p.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(p.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(y.byteOffset+y.bytesFilled!==p.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(y.bufferByteLength!==p.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(y.bytesFilled+p.byteLength>y.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let b=p.byteLength;y.buffer=Gn(p.buffer),zp(u,b)}function Kp(u,p,y,S,b,q,V){p._controlledReadableByteStream=u,p._pullAgain=!1,p._pulling=!1,p._byobRequest=null,p._queue=p._queueTotalSize=void 0,cr(p),p._closeRequested=!1,p._started=!1,p._strategyHWM=q,p._pullAlgorithm=S,p._cancelAlgorithm=b,p._autoAllocateChunkSize=V,p._pendingPullIntos=new H,u._readableStreamController=p;let te=y();g(d(te),()=>(p._started=!0,Ur(p),null),ge=>(qt(p,ge),null))}function uC(u,p,y){let S=Object.create(Hn.prototype),b,q,V;p.start!==void 0?b=()=>p.start(S):b=()=>{},p.pull!==void 0?q=()=>p.pull(S):q=()=>d(void 0),p.cancel!==void 0?V=ge=>p.cancel(ge):V=()=>d(void 0);let te=p.autoAllocateChunkSize;if(te===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Kp(u,S,b,q,V,y,te)}function cC(u,p,y){u._associatedReadableByteStreamController=p,u._view=y}function Ku(u){return new TypeError(`ReadableStreamBYOBRequest.prototype.${u} can only be used on a ReadableStreamBYOBRequest`)}function Lo(u){return new TypeError(`ReadableByteStreamController.prototype.${u} can only be used on a ReadableByteStreamController`)}function fC(u,p){yt(u,p);let y=u==null?void 0:u.mode;return{mode:y===void 0?void 0:dC(y,`${p} has member 'mode' that`)}}function dC(u,p){if(u=`${u}`,u!=="byob")throw new TypeError(`${p} '${u}' is not a valid enumeration value for ReadableStreamReaderMode`);return u}function hC(u,p){var y;yt(u,p);let S=(y=u==null?void 0:u.min)!==null&&y!==void 0?y:1;return{min:k(S,`${p} has member 'min' that`)}}function Xp(u){return new fr(u)}function Qp(u,p){u._reader._readIntoRequests.push(p)}function pC(u,p,y){let b=u._reader._readIntoRequests.shift();y?b._closeSteps(p):b._chunkSteps(p)}function Zp(u){return u._reader._readIntoRequests.length}function Xu(u){let p=u._reader;return!(p===void 0||!Fr(p))}class fr{constructor(p){if($e(p,1,"ReadableStreamBYOBReader"),M(p,"First parameter"),pr(p))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Or(p._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");X(this,p),this._readIntoRequests=new H}get closed(){return Fr(this)?this._closedPromise:h(ta("closed"))}cancel(p=void 0){return Fr(this)?this._ownerReadableStream===void 0?h(ne("cancel")):Q(this,p):h(ta("cancel"))}read(p,y={}){if(!Fr(this))return h(ta("read"));if(!ArrayBuffer.isView(p))return h(new TypeError("view must be an array buffer view"));if(p.byteLength===0)return h(new TypeError("view must have non-zero byteLength"));if(p.buffer.byteLength===0)return h(new TypeError("view's buffer must have non-zero byteLength"));if(ur(p.buffer))return h(new TypeError("view's buffer has been detached"));let S;try{S=hC(y,"options")}catch(de){return h(de)}let b=S.min;if(b===0)return h(new TypeError("options.min must be greater than 0"));if(nC(p)){if(b>p.byteLength)return h(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(b>p.length)return h(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return h(ne("read from"));let q,V,te=f((de,ye)=>{q=de,V=ye});return jp(this,p,b,{_chunkSteps:de=>q({value:de,done:!1}),_closeSteps:de=>q({value:de,done:!0}),_errorSteps:de=>V(de)}),te}releaseLock(){if(!Fr(this))throw ta("releaseLock");this._ownerReadableStream!==void 0&&mC(this)}}Object.defineProperties(fr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(fr.prototype.cancel,"cancel"),i(fr.prototype.read,"read"),i(fr.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(fr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Fr(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_readIntoRequests")?!1:u instanceof fr}function jp(u,p,y,S){let b=u._ownerReadableStream;b._disturbed=!0,b._state==="errored"?S._errorSteps(b._storedError):oC(b._readableStreamController,p,y,S)}function mC(u){ie(u);let p=new TypeError("Reader was released");em(u,p)}function em(u,p){let y=u._readIntoRequests;u._readIntoRequests=new H,y.forEach(S=>{S._errorSteps(p)})}function ta(u){return new TypeError(`ReadableStreamBYOBReader.prototype.${u} can only be used on a ReadableStreamBYOBReader`)}function qo(u,p){let{highWaterMark:y}=u;if(y===void 0)return p;if(wt(y)||y<0)throw new RangeError("Invalid highWaterMark");return y}function na(u){let{size:p}=u;return p||(()=>1)}function ra(u,p){yt(u,p);let y=u==null?void 0:u.highWaterMark,S=u==null?void 0:u.size;return{highWaterMark:y===void 0?void 0:v(y),size:S===void 0?void 0:gC(S,`${p} has member 'size' that`)}}function gC(u,p){return at(u,p),y=>v(u(y))}function yC(u,p){yt(u,p);let y=u==null?void 0:u.abort,S=u==null?void 0:u.close,b=u==null?void 0:u.start,q=u==null?void 0:u.type,V=u==null?void 0:u.write;return{abort:y===void 0?void 0:_C(y,u,`${p} has member 'abort' that`),close:S===void 0?void 0:EC(S,u,`${p} has member 'close' that`),start:b===void 0?void 0:SC(b,u,`${p} has member 'start' that`),write:V===void 0?void 0:TC(V,u,`${p} has member 'write' that`),type:q}}function _C(u,p,y){return at(u,y),S=>$(u,p,[S])}function EC(u,p,y){return at(u,y),()=>$(u,p,[])}function SC(u,p,y){return at(u,y),S=>z(u,p,[S])}function TC(u,p,y){return at(u,y),(S,b)=>$(u,p,[S,b])}function tm(u,p){if(!Ci(u))throw new TypeError(`${p} is not a WritableStream.`)}function vC(u){if(typeof u!="object"||u===null)return!1;try{return typeof u.aborted=="boolean"}catch(p){return!1}}let wC=typeof AbortController=="function";function CC(){if(wC)return new AbortController}class dr{constructor(p={},y={}){p===void 0?p=null:lt(p,"First parameter");let S=ra(y,"Second parameter"),b=yC(p,"First parameter");if(rm(this),b.type!==void 0)throw new RangeError("Invalid type is specified");let V=na(S),te=qo(S,1);LC(this,b,te,V)}get locked(){if(!Ci(this))throw la("locked");return Ai(this)}abort(p=void 0){return Ci(this)?Ai(this)?h(new TypeError("Cannot abort a stream that already has a writer")):ia(this,p):h(la("abort"))}close(){return Ci(this)?Ai(this)?h(new TypeError("Cannot close a stream that already has a writer")):Tn(this)?h(new TypeError("Cannot close an already-closing stream")):im(this):h(la("close"))}getWriter(){if(!Ci(this))throw la("getWriter");return nm(this)}}Object.defineProperties(dr.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),i(dr.prototype.abort,"abort"),i(dr.prototype.close,"close"),i(dr.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(dr.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function nm(u){return new Vn(u)}function AC(u,p,y,S,b=1,q=()=>1){let V=Object.create(dr.prototype);rm(V);let te=Object.create(bi.prototype);return cm(V,te,u,p,y,S,b,q),V}function rm(u){u._state="writable",u._storedError=void 0,u._writer=void 0,u._writableStreamController=void 0,u._writeRequests=new H,u._inFlightWriteRequest=void 0,u._closeRequest=void 0,u._inFlightCloseRequest=void 0,u._pendingAbortRequest=void 0,u._backpressure=!1}function Ci(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_writableStreamController")?!1:u instanceof dr}function Ai(u){return u._writer!==void 0}function ia(u,p){var y;if(u._state==="closed"||u._state==="errored")return d(void 0);u._writableStreamController._abortReason=p,(y=u._writableStreamController._abortController)===null||y===void 0||y.abort(p);let S=u._state;if(S==="closed"||S==="errored")return d(void 0);if(u._pendingAbortRequest!==void 0)return u._pendingAbortRequest._promise;let b=!1;S==="erroring"&&(b=!0,p=void 0);let q=f((V,te)=>{u._pendingAbortRequest={_promise:void 0,_resolve:V,_reject:te,_reason:p,_wasAlreadyErroring:b}});return u._pendingAbortRequest._promise=q,b||Zu(u,p),q}function im(u){let p=u._state;if(p==="closed"||p==="errored")return h(new TypeError(`The stream (in ${p} state) is not in the writable state and cannot be closed`));let y=f((b,q)=>{let V={_resolve:b,_reject:q};u._closeRequest=V}),S=u._writer;return S!==void 0&&u._backpressure&&p==="writable"&&sc(S),qC(u._writableStreamController),y}function bC(u){return f((y,S)=>{let b={_resolve:y,_reject:S};u._writeRequests.push(b)})}function Qu(u,p){if(u._state==="writable"){Zu(u,p);return}ju(u)}function Zu(u,p){let y=u._writableStreamController;u._state="erroring",u._storedError=p;let S=u._writer;S!==void 0&&sm(S,p),!kC(u)&&y._started&&ju(u)}function ju(u){u._state="errored",u._writableStreamController[Y]();let p=u._storedError;if(u._writeRequests.forEach(b=>{b._reject(p)}),u._writeRequests=new H,u._pendingAbortRequest===void 0){oa(u);return}let y=u._pendingAbortRequest;if(u._pendingAbortRequest=void 0,y._wasAlreadyErroring){y._reject(p),oa(u);return}let S=u._writableStreamController[G](y._reason);g(S,()=>(y._resolve(),oa(u),null),b=>(y._reject(b),oa(u),null))}function RC(u){u._inFlightWriteRequest._resolve(void 0),u._inFlightWriteRequest=void 0}function IC(u,p){u._inFlightWriteRequest._reject(p),u._inFlightWriteRequest=void 0,Qu(u,p)}function PC(u){u._inFlightCloseRequest._resolve(void 0),u._inFlightCloseRequest=void 0,u._state==="erroring"&&(u._storedError=void 0,u._pendingAbortRequest!==void 0&&(u._pendingAbortRequest._resolve(),u._pendingAbortRequest=void 0)),u._state="closed";let y=u._writer;y!==void 0&&pm(y)}function xC(u,p){u._inFlightCloseRequest._reject(p),u._inFlightCloseRequest=void 0,u._pendingAbortRequest!==void 0&&(u._pendingAbortRequest._reject(p),u._pendingAbortRequest=void 0),Qu(u,p)}function Tn(u){return!(u._closeRequest===void 0&&u._inFlightCloseRequest===void 0)}function kC(u){return!(u._inFlightWriteRequest===void 0&&u._inFlightCloseRequest===void 0)}function NC(u){u._inFlightCloseRequest=u._closeRequest,u._closeRequest=void 0}function MC(u){u._inFlightWriteRequest=u._writeRequests.shift()}function oa(u){u._closeRequest!==void 0&&(u._closeRequest._reject(u._storedError),u._closeRequest=void 0);let p=u._writer;p!==void 0&&ic(p,u._storedError)}function ec(u,p){let y=u._writer;y!==void 0&&p!==u._backpressure&&(p?zC(y):sc(y)),u._backpressure=p}class Vn{constructor(p){if($e(p,1,"WritableStreamDefaultWriter"),tm(p,"First parameter"),Ai(p))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=p,p._writer=this;let y=p._state;if(y==="writable")!Tn(p)&&p._backpressure?ca(this):mm(this),ua(this);else if(y==="erroring")oc(this,p._storedError),ua(this);else if(y==="closed")mm(this),$C(this);else{let S=p._storedError;oc(this,S),hm(this,S)}}get closed(){return Lr(this)?this._closedPromise:h(qr("closed"))}get desiredSize(){if(!Lr(this))throw qr("desiredSize");if(this._ownerWritableStream===void 0)throw Go("desiredSize");return FC(this)}get ready(){return Lr(this)?this._readyPromise:h(qr("ready"))}abort(p=void 0){return Lr(this)?this._ownerWritableStream===void 0?h(Go("abort")):DC(this,p):h(qr("abort"))}close(){if(!Lr(this))return h(qr("close"));let p=this._ownerWritableStream;return p===void 0?h(Go("close")):Tn(p)?h(new TypeError("Cannot close an already-closing stream")):om(this)}releaseLock(){if(!Lr(this))throw qr("releaseLock");this._ownerWritableStream!==void 0&&am(this)}write(p=void 0){return Lr(this)?this._ownerWritableStream===void 0?h(Go("write to")):lm(this,p):h(qr("write"))}}Object.defineProperties(Vn.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),i(Vn.prototype.abort,"abort"),i(Vn.prototype.close,"close"),i(Vn.prototype.releaseLock,"releaseLock"),i(Vn.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Vn.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Lr(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_ownerWritableStream")?!1:u instanceof Vn}function DC(u,p){let y=u._ownerWritableStream;return ia(y,p)}function om(u){let p=u._ownerWritableStream;return im(p)}function OC(u){let p=u._ownerWritableStream,y=p._state;return Tn(p)||y==="closed"?d(void 0):y==="errored"?h(p._storedError):om(u)}function UC(u,p){u._closedPromiseState==="pending"?ic(u,p):WC(u,p)}function sm(u,p){u._readyPromiseState==="pending"?gm(u,p):JC(u,p)}function FC(u){let p=u._ownerWritableStream,y=p._state;return y==="errored"||y==="erroring"?null:y==="closed"?0:fm(p._writableStreamController)}function am(u){let p=u._ownerWritableStream,y=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");sm(u,y),UC(u,y),p._writer=void 0,u._ownerWritableStream=void 0}function lm(u,p){let y=u._ownerWritableStream,S=y._writableStreamController,b=BC(S,p);if(y!==u._ownerWritableStream)return h(Go("write to"));let q=y._state;if(q==="errored")return h(y._storedError);if(Tn(y)||q==="closed")return h(new TypeError("The stream is closing or closed and cannot be written to"));if(q==="erroring")return h(y._storedError);let V=bC(y);return GC(S,p,b),V}let um={};class bi{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!tc(this))throw rc("abortReason");return this._abortReason}get signal(){if(!tc(this))throw rc("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(p=void 0){if(!tc(this))throw rc("error");this._controlledWritableStream._state==="writable"&&dm(this,p)}[G](p){let y=this._abortAlgorithm(p);return sa(this),y}[Y](){cr(this)}}Object.defineProperties(bi.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(bi.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function tc(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_controlledWritableStream")?!1:u instanceof bi}function cm(u,p,y,S,b,q,V,te){p._controlledWritableStream=u,u._writableStreamController=p,p._queue=void 0,p._queueTotalSize=void 0,cr(p),p._abortReason=void 0,p._abortController=CC(),p._started=!1,p._strategySizeAlgorithm=te,p._strategyHWM=V,p._writeAlgorithm=S,p._closeAlgorithm=b,p._abortAlgorithm=q;let ge=nc(p);ec(u,ge);let de=y(),ye=d(de);g(ye,()=>(p._started=!0,aa(p),null),Ee=>(p._started=!0,Qu(u,Ee),null))}function LC(u,p,y,S){let b=Object.create(bi.prototype),q,V,te,ge;p.start!==void 0?q=()=>p.start(b):q=()=>{},p.write!==void 0?V=de=>p.write(de,b):V=()=>d(void 0),p.close!==void 0?te=()=>p.close():te=()=>d(void 0),p.abort!==void 0?ge=de=>p.abort(de):ge=()=>d(void 0),cm(u,b,q,V,te,ge,y,S)}function sa(u){u._writeAlgorithm=void 0,u._closeAlgorithm=void 0,u._abortAlgorithm=void 0,u._strategySizeAlgorithm=void 0}function qC(u){Vu(u,um,0),aa(u)}function BC(u,p){try{return u._strategySizeAlgorithm(p)}catch(y){return Bo(u,y),1}}function fm(u){return u._strategyHWM-u._queueTotalSize}function GC(u,p,y){try{Vu(u,p,y)}catch(b){Bo(u,b);return}let S=u._controlledWritableStream;if(!Tn(S)&&S._state==="writable"){let b=nc(u);ec(S,b)}aa(u)}function aa(u){let p=u._controlledWritableStream;if(!u._started||p._inFlightWriteRequest!==void 0)return;if(p._state==="erroring"){ju(p);return}if(u._queue.length===0)return;let S=tC(u);S===um?HC(u):VC(u,S)}function Bo(u,p){u._controlledWritableStream._state==="writable"&&dm(u,p)}function HC(u){let p=u._controlledWritableStream;NC(p),Hu(u);let y=u._closeAlgorithm();sa(u),g(y,()=>(PC(p),null),S=>(xC(p,S),null))}function VC(u,p){let y=u._controlledWritableStream;MC(y);let S=u._writeAlgorithm(p);g(S,()=>{RC(y);let b=y._state;if(Hu(u),!Tn(y)&&b==="writable"){let q=nc(u);ec(y,q)}return aa(u),null},b=>(y._state==="writable"&&sa(u),IC(y,b),null))}function nc(u){return fm(u)<=0}function dm(u,p){let y=u._controlledWritableStream;sa(u),Zu(y,p)}function la(u){return new TypeError(`WritableStream.prototype.${u} can only be used on a WritableStream`)}function rc(u){return new TypeError(`WritableStreamDefaultController.prototype.${u} can only be used on a WritableStreamDefaultController`)}function qr(u){return new TypeError(`WritableStreamDefaultWriter.prototype.${u} can only be used on a WritableStreamDefaultWriter`)}function Go(u){return new TypeError("Cannot "+u+" a stream using a released writer")}function ua(u){u._closedPromise=f((p,y)=>{u._closedPromise_resolve=p,u._closedPromise_reject=y,u._closedPromiseState="pending"})}function hm(u,p){ua(u),ic(u,p)}function $C(u){ua(u),pm(u)}function ic(u,p){u._closedPromise_reject!==void 0&&(R(u._closedPromise),u._closedPromise_reject(p),u._closedPromise_resolve=void 0,u._closedPromise_reject=void 0,u._closedPromiseState="rejected")}function WC(u,p){hm(u,p)}function pm(u){u._closedPromise_resolve!==void 0&&(u._closedPromise_resolve(void 0),u._closedPromise_resolve=void 0,u._closedPromise_reject=void 0,u._closedPromiseState="resolved")}function ca(u){u._readyPromise=f((p,y)=>{u._readyPromise_resolve=p,u._readyPromise_reject=y}),u._readyPromiseState="pending"}function oc(u,p){ca(u),gm(u,p)}function mm(u){ca(u),sc(u)}function gm(u,p){u._readyPromise_reject!==void 0&&(R(u._readyPromise),u._readyPromise_reject(p),u._readyPromise_resolve=void 0,u._readyPromise_reject=void 0,u._readyPromiseState="rejected")}function zC(u){ca(u)}function JC(u,p){oc(u,p)}function sc(u){u._readyPromise_resolve!==void 0&&(u._readyPromise_resolve(void 0),u._readyPromise_resolve=void 0,u._readyPromise_reject=void 0,u._readyPromiseState="fulfilled")}function YC(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof global!="undefined")return global}let ac=YC();function KC(u){if(!(typeof u=="function"||typeof u=="object")||u.name!=="DOMException")return!1;try{return new u,!0}catch(p){return!1}}function XC(){let u=ac==null?void 0:ac.DOMException;return KC(u)?u:void 0}function QC(){let u=function(y,S){this.message=y||"",this.name=S||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return i(u,"DOMException"),u.prototype=Object.create(Error.prototype),Object.defineProperty(u.prototype,"constructor",{value:u,writable:!0,configurable:!0}),u}let ZC=XC()||QC();function ym(u,p,y,S,b,q){let V=B(u),te=nm(p);u._disturbed=!0;let ge=!1,de=d(void 0);return f((ye,Ee)=>{let xe;if(q!==void 0){if(xe=()=>{let pe=q.reason!==void 0?q.reason:new ZC("Aborted","AbortError"),Se=[];S||Se.push(()=>p._state==="writable"?ia(p,pe):d(void 0)),b||Se.push(()=>u._state==="readable"?rn(u,pe):d(void 0)),_t(()=>Promise.all(Se.map(ke=>ke())),!0,pe)},q.aborted){xe();return}q.addEventListener("abort",xe)}function on(){return f((pe,Se)=>{function ke(Ct){Ct?pe():m(xi(),ke,Se)}ke(!1)})}function xi(){return ge?d(!0):m(te._readyPromise,()=>f((pe,Se)=>{le(V,{_chunkSteps:ke=>{de=m(lm(te,ke),void 0,e),pe(!1)},_closeSteps:()=>pe(!0),_errorSteps:Se})}))}if(Wn(u,V._closedPromise,pe=>(S?Bt(!0,pe):_t(()=>ia(p,pe),!0,pe),null)),Wn(p,te._closedPromise,pe=>(b?Bt(!0,pe):_t(()=>rn(u,pe),!0,pe),null)),ut(u,V._closedPromise,()=>(y?Bt():_t(()=>OC(te)),null)),Tn(p)||p._state==="closed"){let pe=new TypeError("the destination writable stream closed before all data could be piped to it");b?Bt(!0,pe):_t(()=>rn(u,pe),!0,pe)}R(on());function gr(){let pe=de;return m(de,()=>pe!==de?gr():void 0)}function Wn(pe,Se,ke){pe._state==="errored"?ke(pe._storedError):w(Se,ke)}function ut(pe,Se,ke){pe._state==="closed"?ke():E(Se,ke)}function _t(pe,Se,ke){if(ge)return;ge=!0,p._state==="writable"&&!Tn(p)?E(gr(),Ct):Ct();function Ct(){return g(pe(),()=>zn(Se,ke),ki=>zn(!0,ki)),null}}function Bt(pe,Se){ge||(ge=!0,p._state==="writable"&&!Tn(p)?E(gr(),()=>zn(pe,Se)):zn(pe,Se))}function zn(pe,Se){return am(te),ie(V),q!==void 0&&q.removeEventListener("abort",xe),pe?Ee(Se):ye(void 0),null}})}class $n{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!fa(this))throw ha("desiredSize");return lc(this)}close(){if(!fa(this))throw ha("close");if(!Ii(this))throw new TypeError("The stream is not in a state that permits close");Br(this)}enqueue(p=void 0){if(!fa(this))throw ha("enqueue");if(!Ii(this))throw new TypeError("The stream is not in a state that permits enqueue");return Ri(this,p)}error(p=void 0){if(!fa(this))throw ha("error");nn(this,p)}[j](p){cr(this);let y=this._cancelAlgorithm(p);return da(this),y}[T](p){let y=this._controlledReadableStream;if(this._queue.length>0){let S=Hu(this);this._closeRequested&&this._queue.length===0?(da(this),$o(y)):Ho(this),p._chunkSteps(S)}else I(y,p),Ho(this)}[L](){}}Object.defineProperties($n.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),i($n.prototype.close,"close"),i($n.prototype.enqueue,"enqueue"),i($n.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty($n.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function fa(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_controlledReadableStream")?!1:u instanceof $n}function Ho(u){if(!_m(u))return;if(u._pulling){u._pullAgain=!0;return}u._pulling=!0;let y=u._pullAlgorithm();g(y,()=>(u._pulling=!1,u._pullAgain&&(u._pullAgain=!1,Ho(u)),null),S=>(nn(u,S),null))}function _m(u){let p=u._controlledReadableStream;return!Ii(u)||!u._started?!1:!!(pr(p)&&F(p)>0||lc(u)>0)}function da(u){u._pullAlgorithm=void 0,u._cancelAlgorithm=void 0,u._strategySizeAlgorithm=void 0}function Br(u){if(!Ii(u))return;let p=u._controlledReadableStream;u._closeRequested=!0,u._queue.length===0&&(da(u),$o(p))}function Ri(u,p){if(!Ii(u))return;let y=u._controlledReadableStream;if(pr(y)&&F(y)>0)N(y,p,!1);else{let S;try{S=u._strategySizeAlgorithm(p)}catch(b){throw nn(u,b),b}try{Vu(u,p,S)}catch(b){throw nn(u,b),b}}Ho(u)}function nn(u,p){let y=u._controlledReadableStream;y._state==="readable"&&(cr(u),da(u),vm(y,p))}function lc(u){let p=u._controlledReadableStream._state;return p==="errored"?null:p==="closed"?0:u._strategyHWM-u._queueTotalSize}function jC(u){return!_m(u)}function Ii(u){let p=u._controlledReadableStream._state;return!u._closeRequested&&p==="readable"}function Em(u,p,y,S,b,q,V){p._controlledReadableStream=u,p._queue=void 0,p._queueTotalSize=void 0,cr(p),p._started=!1,p._closeRequested=!1,p._pullAgain=!1,p._pulling=!1,p._strategySizeAlgorithm=V,p._strategyHWM=q,p._pullAlgorithm=S,p._cancelAlgorithm=b,u._readableStreamController=p;let te=y();g(d(te),()=>(p._started=!0,Ho(p),null),ge=>(nn(p,ge),null))}function eA(u,p,y,S){let b=Object.create($n.prototype),q,V,te;p.start!==void 0?q=()=>p.start(b):q=()=>{},p.pull!==void 0?V=()=>p.pull(b):V=()=>d(void 0),p.cancel!==void 0?te=ge=>p.cancel(ge):te=()=>d(void 0),Em(u,b,q,V,te,y,S)}function ha(u){return new TypeError(`ReadableStreamDefaultController.prototype.${u} can only be used on a ReadableStreamDefaultController`)}function tA(u,p){return Or(u._readableStreamController)?rA(u):nA(u)}function nA(u,p){let y=B(u),S=!1,b=!1,q=!1,V=!1,te,ge,de,ye,Ee,xe=f(ut=>{Ee=ut});function on(){return S?(b=!0,d(void 0)):(S=!0,le(y,{_chunkSteps:_t=>{P(()=>{b=!1;let Bt=_t,zn=_t;q||Ri(de._readableStreamController,Bt),V||Ri(ye._readableStreamController,zn),S=!1,b&&on()})},_closeSteps:()=>{S=!1,q||Br(de._readableStreamController),V||Br(ye._readableStreamController),(!q||!V)&&Ee(void 0)},_errorSteps:()=>{S=!1}}),d(void 0))}function xi(ut){if(q=!0,te=ut,V){let _t=Ie([te,ge]),Bt=rn(u,_t);Ee(Bt)}return xe}function gr(ut){if(V=!0,ge=ut,q){let _t=Ie([te,ge]),Bt=rn(u,_t);Ee(Bt)}return xe}function Wn(){}return de=Vo(Wn,on,xi),ye=Vo(Wn,on,gr),w(y._closedPromise,ut=>(nn(de._readableStreamController,ut),nn(ye._readableStreamController,ut),(!q||!V)&&Ee(void 0),null)),[de,ye]}function rA(u){let p=B(u),y=!1,S=!1,b=!1,q=!1,V=!1,te,ge,de,ye,Ee,xe=f(pe=>{Ee=pe});function on(pe){w(pe._closedPromise,Se=>(pe!==p||(qt(de._readableStreamController,Se),qt(ye._readableStreamController,Se),(!q||!V)&&Ee(void 0)),null))}function xi(){Fr(p)&&(ie(p),p=B(u),on(p)),le(p,{_chunkSteps:Se=>{P(()=>{S=!1,b=!1;let ke=Se,Ct=Se;if(!q&&!V)try{Ct=Fp(Se)}catch(ki){qt(de._readableStreamController,ki),qt(ye._readableStreamController,ki),Ee(rn(u,ki));return}q||Zs(de._readableStreamController,ke),V||Zs(ye._readableStreamController,Ct),y=!1,S?Wn():b&&ut()})},_closeSteps:()=>{y=!1,q||Fo(de._readableStreamController),V||Fo(ye._readableStreamController),de._readableStreamController._pendingPullIntos.length>0&&js(de._readableStreamController,0),ye._readableStreamController._pendingPullIntos.length>0&&js(ye._readableStreamController,0),(!q||!V)&&Ee(void 0)},_errorSteps:()=>{y=!1}})}function gr(pe,Se){oe(p)&&(ie(p),p=Xp(u),on(p));let ke=Se?ye:de,Ct=Se?de:ye;jp(p,pe,1,{_chunkSteps:Ni=>{P(()=>{S=!1,b=!1;let Mi=Se?V:q;if(Se?q:V)Mi||ea(ke._readableStreamController,Ni);else{let Om;try{Om=Fp(Ni)}catch(hc){qt(ke._readableStreamController,hc),qt(Ct._readableStreamController,hc),Ee(rn(u,hc));return}Mi||ea(ke._readableStreamController,Ni),Zs(Ct._readableStreamController,Om)}y=!1,S?Wn():b&&ut()})},_closeSteps:Ni=>{y=!1;let Mi=Se?V:q,Ta=Se?q:V;Mi||Fo(ke._readableStreamController),Ta||Fo(Ct._readableStreamController),Ni!==void 0&&(Mi||ea(ke._readableStreamController,Ni),!Ta&&Ct._readableStreamController._pendingPullIntos.length>0&&js(Ct._readableStreamController,0)),(!Mi||!Ta)&&Ee(void 0)},_errorSteps:()=>{y=!1}})}function Wn(){if(y)return S=!0,d(void 0);y=!0;let pe=Yu(de._readableStreamController);return pe===null?xi():gr(pe._view,!1),d(void 0)}function ut(){if(y)return b=!0,d(void 0);y=!0;let pe=Yu(ye._readableStreamController);return pe===null?xi():gr(pe._view,!0),d(void 0)}function _t(pe){if(q=!0,te=pe,V){let Se=Ie([te,ge]),ke=rn(u,Se);Ee(ke)}return xe}function Bt(pe){if(V=!0,ge=pe,q){let Se=Ie([te,ge]),ke=rn(u,Se);Ee(ke)}return xe}function zn(){}return de=Tm(zn,Wn,_t),ye=Tm(zn,ut,Bt),on(p),[de,ye]}function iA(u){return t(u)&&typeof u.getReader!="undefined"}function oA(u){return iA(u)?aA(u.getReader()):sA(u)}function sA(u){let p,y=Up(u,"async"),S=e;function b(){let V;try{V=Qw(y)}catch(ge){return h(ge)}let te=d(V);return C(te,ge=>{if(!t(ge))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(Zw(ge))Br(p._readableStreamController);else{let ye=jw(ge);Ri(p._readableStreamController,ye)}})}function q(V){let te=y.iterator,ge;try{ge=Ks(te,"return")}catch(Ee){return h(Ee)}if(ge===void 0)return d(void 0);let de;try{de=z(ge,te,[V])}catch(Ee){return h(Ee)}let ye=d(de);return C(ye,Ee=>{if(!t(Ee))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return p=Vo(S,b,q,0),p}function aA(u){let p,y=e;function S(){let q;try{q=u.read()}catch(V){return h(V)}return C(q,V=>{if(!t(V))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(V.done)Br(p._readableStreamController);else{let te=V.value;Ri(p._readableStreamController,te)}})}function b(q){try{return d(u.cancel(q))}catch(V){return h(V)}}return p=Vo(y,S,b,0),p}function lA(u,p){yt(u,p);let y=u,S=y==null?void 0:y.autoAllocateChunkSize,b=y==null?void 0:y.cancel,q=y==null?void 0:y.pull,V=y==null?void 0:y.start,te=y==null?void 0:y.type;return{autoAllocateChunkSize:S===void 0?void 0:k(S,`${p} has member 'autoAllocateChunkSize' that`),cancel:b===void 0?void 0:uA(b,y,`${p} has member 'cancel' that`),pull:q===void 0?void 0:cA(q,y,`${p} has member 'pull' that`),start:V===void 0?void 0:fA(V,y,`${p} has member 'start' that`),type:te===void 0?void 0:dA(te,`${p} has member 'type' that`)}}function uA(u,p,y){return at(u,y),S=>$(u,p,[S])}function cA(u,p,y){return at(u,y),S=>$(u,p,[S])}function fA(u,p,y){return at(u,y),S=>z(u,p,[S])}function dA(u,p){if(u=`${u}`,u!=="bytes")throw new TypeError(`${p} '${u}' is not a valid enumeration value for ReadableStreamType`);return u}function hA(u,p){return yt(u,p),{preventCancel:!!(u==null?void 0:u.preventCancel)}}function Sm(u,p){yt(u,p);let y=u==null?void 0:u.preventAbort,S=u==null?void 0:u.preventCancel,b=u==null?void 0:u.preventClose,q=u==null?void 0:u.signal;return q!==void 0&&pA(q,`${p} has member 'signal' that`),{preventAbort:!!y,preventCancel:!!S,preventClose:!!b,signal:q}}function pA(u,p){if(!vC(u))throw new TypeError(`${p} is not an AbortSignal.`)}function mA(u,p){yt(u,p);let y=u==null?void 0:u.readable;_(y,"readable","ReadableWritablePair"),M(y,`${p} has member 'readable' that`);let S=u==null?void 0:u.writable;return _(S,"writable","ReadableWritablePair"),tm(S,`${p} has member 'writable' that`),{readable:y,writable:S}}class et{constructor(p={},y={}){p===void 0?p=null:lt(p,"First parameter");let S=ra(y,"Second parameter"),b=lA(p,"First parameter");if(uc(this),b.type==="bytes"){if(S.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let q=qo(S,0);uC(this,b,q)}else{let q=na(S),V=qo(S,1);eA(this,b,V,q)}}get locked(){if(!hr(this))throw Gr("locked");return pr(this)}cancel(p=void 0){return hr(this)?pr(this)?h(new TypeError("Cannot cancel a stream that already has a reader")):rn(this,p):h(Gr("cancel"))}getReader(p=void 0){if(!hr(this))throw Gr("getReader");return fC(p,"First parameter").mode===void 0?B(this):Xp(this)}pipeThrough(p,y={}){if(!hr(this))throw Gr("pipeThrough");$e(p,1,"pipeThrough");let S=mA(p,"First parameter"),b=Sm(y,"Second parameter");if(pr(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Ai(S.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let q=ym(this,S.writable,b.preventClose,b.preventAbort,b.preventCancel,b.signal);return R(q),S.readable}pipeTo(p,y={}){if(!hr(this))return h(Gr("pipeTo"));if(p===void 0)return h("Parameter 1 is required in 'pipeTo'.");if(!Ci(p))return h(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let S;try{S=Sm(y,"Second parameter")}catch(b){return h(b)}return pr(this)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Ai(p)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):ym(this,p,S.preventClose,S.preventAbort,S.preventCancel,S.signal)}tee(){if(!hr(this))throw Gr("tee");let p=tA(this);return Ie(p)}values(p=void 0){if(!hr(this))throw Gr("values");let y=hA(p,"First parameter");return Si(this,y.preventCancel)}[Gu](p){return this.values(p)}static from(p){return oA(p)}}Object.defineProperties(et,{from:{enumerable:!0}}),Object.defineProperties(et.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),i(et.from,"from"),i(et.prototype.cancel,"cancel"),i(et.prototype.getReader,"getReader"),i(et.prototype.pipeThrough,"pipeThrough"),i(et.prototype.pipeTo,"pipeTo"),i(et.prototype.tee,"tee"),i(et.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(et.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(et.prototype,Gu,{value:et.prototype.values,writable:!0,configurable:!0});function Vo(u,p,y,S=1,b=()=>1){let q=Object.create(et.prototype);uc(q);let V=Object.create($n.prototype);return Em(q,V,u,p,y,S,b),q}function Tm(u,p,y){let S=Object.create(et.prototype);uc(S);let b=Object.create(Hn.prototype);return Kp(S,b,u,p,y,0,void 0),S}function uc(u){u._state="readable",u._reader=void 0,u._storedError=void 0,u._disturbed=!1}function hr(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_readableStreamController")?!1:u instanceof et}function pr(u){return u._reader!==void 0}function rn(u,p){if(u._disturbed=!0,u._state==="closed")return d(void 0);if(u._state==="errored")return h(u._storedError);$o(u);let y=u._reader;if(y!==void 0&&Fr(y)){let b=y._readIntoRequests;y._readIntoRequests=new H,b.forEach(q=>{q._closeSteps(void 0)})}let S=u._readableStreamController[j](p);return C(S,e)}function $o(u){u._state="closed";let p=u._reader;if(p!==void 0&&(Ei(p),oe(p))){let y=p._readRequests;p._readRequests=new H,y.forEach(S=>{S._closeSteps()})}}function vm(u,p){u._state="errored",u._storedError=p;let y=u._reader;y!==void 0&&(Ae(y,p),oe(y)?Me(y,p):em(y,p))}function Gr(u){return new TypeError(`ReadableStream.prototype.${u} can only be used on a ReadableStream`)}function wm(u,p){yt(u,p);let y=u==null?void 0:u.highWaterMark;return _(y,"highWaterMark","QueuingStrategyInit"),{highWaterMark:v(y)}}let Cm=u=>u.byteLength;i(Cm,"size");class pa{constructor(p){$e(p,1,"ByteLengthQueuingStrategy"),p=wm(p,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=p.highWaterMark}get highWaterMark(){if(!bm(this))throw Am("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!bm(this))throw Am("size");return Cm}}Object.defineProperties(pa.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(pa.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Am(u){return new TypeError(`ByteLengthQueuingStrategy.prototype.${u} can only be used on a ByteLengthQueuingStrategy`)}function bm(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_byteLengthQueuingStrategyHighWaterMark")?!1:u instanceof pa}let Rm=()=>1;i(Rm,"size");class ma{constructor(p){$e(p,1,"CountQueuingStrategy"),p=wm(p,"First parameter"),this._countQueuingStrategyHighWaterMark=p.highWaterMark}get highWaterMark(){if(!Pm(this))throw Im("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Pm(this))throw Im("size");return Rm}}Object.defineProperties(ma.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ma.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Im(u){return new TypeError(`CountQueuingStrategy.prototype.${u} can only be used on a CountQueuingStrategy`)}function Pm(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_countQueuingStrategyHighWaterMark")?!1:u instanceof ma}function gA(u,p){yt(u,p);let y=u==null?void 0:u.cancel,S=u==null?void 0:u.flush,b=u==null?void 0:u.readableType,q=u==null?void 0:u.start,V=u==null?void 0:u.transform,te=u==null?void 0:u.writableType;return{cancel:y===void 0?void 0:SA(y,u,`${p} has member 'cancel' that`),flush:S===void 0?void 0:yA(S,u,`${p} has member 'flush' that`),readableType:b,start:q===void 0?void 0:_A(q,u,`${p} has member 'start' that`),transform:V===void 0?void 0:EA(V,u,`${p} has member 'transform' that`),writableType:te}}function yA(u,p,y){return at(u,y),S=>$(u,p,[S])}function _A(u,p,y){return at(u,y),S=>z(u,p,[S])}function EA(u,p,y){return at(u,y),(S,b)=>$(u,p,[S,b])}function SA(u,p,y){return at(u,y),S=>$(u,p,[S])}class ga{constructor(p={},y={},S={}){p===void 0&&(p=null);let b=ra(y,"Second parameter"),q=ra(S,"Third parameter"),V=gA(p,"First parameter");if(V.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(V.writableType!==void 0)throw new RangeError("Invalid writableType specified");let te=qo(q,0),ge=na(q),de=qo(b,1),ye=na(b),Ee,xe=f(on=>{Ee=on});TA(this,xe,de,ye,te,ge),wA(this,V),V.start!==void 0?Ee(V.start(this._transformStreamController)):Ee(void 0)}get readable(){if(!xm(this))throw Dm("readable");return this._readable}get writable(){if(!xm(this))throw Dm("writable");return this._writable}}Object.defineProperties(ga.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ga.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function TA(u,p,y,S,b,q){function V(){return p}function te(xe){return bA(u,xe)}function ge(xe){return RA(u,xe)}function de(){return IA(u)}u._writable=AC(V,te,de,ge,y,S);function ye(){return PA(u)}function Ee(xe){return xA(u,xe)}u._readable=Vo(V,ye,Ee,b,q),u._backpressure=void 0,u._backpressureChangePromise=void 0,u._backpressureChangePromise_resolve=void 0,ya(u,!0),u._transformStreamController=void 0}function xm(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_transformStreamController")?!1:u instanceof ga}function km(u,p){nn(u._readable._readableStreamController,p),cc(u,p)}function cc(u,p){Ea(u._transformStreamController),Bo(u._writable._writableStreamController,p),fc(u)}function fc(u){u._backpressure&&ya(u,!1)}function ya(u,p){u._backpressureChangePromise!==void 0&&u._backpressureChangePromise_resolve(),u._backpressureChangePromise=f(y=>{u._backpressureChangePromise_resolve=y}),u._backpressure=p}class mr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!_a(this))throw Sa("desiredSize");let p=this._controlledTransformStream._readable._readableStreamController;return lc(p)}enqueue(p=void 0){if(!_a(this))throw Sa("enqueue");Nm(this,p)}error(p=void 0){if(!_a(this))throw Sa("error");CA(this,p)}terminate(){if(!_a(this))throw Sa("terminate");AA(this)}}Object.defineProperties(mr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),i(mr.prototype.enqueue,"enqueue"),i(mr.prototype.error,"error"),i(mr.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(mr.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function _a(u){return!t(u)||!Object.prototype.hasOwnProperty.call(u,"_controlledTransformStream")?!1:u instanceof mr}function vA(u,p,y,S,b){p._controlledTransformStream=u,u._transformStreamController=p,p._transformAlgorithm=y,p._flushAlgorithm=S,p._cancelAlgorithm=b,p._finishPromise=void 0,p._finishPromise_resolve=void 0,p._finishPromise_reject=void 0}function wA(u,p){let y=Object.create(mr.prototype),S,b,q;p.transform!==void 0?S=V=>p.transform(V,y):S=V=>{try{return Nm(y,V),d(void 0)}catch(te){return h(te)}},p.flush!==void 0?b=()=>p.flush(y):b=()=>d(void 0),p.cancel!==void 0?q=V=>p.cancel(V):q=()=>d(void 0),vA(u,y,S,b,q)}function Ea(u){u._transformAlgorithm=void 0,u._flushAlgorithm=void 0,u._cancelAlgorithm=void 0}function Nm(u,p){let y=u._controlledTransformStream,S=y._readable._readableStreamController;if(!Ii(S))throw new TypeError("Readable side is not in a state that permits enqueue");try{Ri(S,p)}catch(q){throw cc(y,q),y._readable._storedError}jC(S)!==y._backpressure&&ya(y,!0)}function CA(u,p){km(u._controlledTransformStream,p)}function Mm(u,p){let y=u._transformAlgorithm(p);return C(y,void 0,S=>{throw km(u._controlledTransformStream,S),S})}function AA(u){let p=u._controlledTransformStream,y=p._readable._readableStreamController;Br(y);let S=new TypeError("TransformStream terminated");cc(p,S)}function bA(u,p){let y=u._transformStreamController;if(u._backpressure){let S=u._backpressureChangePromise;return C(S,()=>{let b=u._writable;if(b._state==="erroring")throw b._storedError;return Mm(y,p)})}return Mm(y,p)}function RA(u,p){let y=u._transformStreamController;if(y._finishPromise!==void 0)return y._finishPromise;let S=u._readable;y._finishPromise=f((q,V)=>{y._finishPromise_resolve=q,y._finishPromise_reject=V});let b=y._cancelAlgorithm(p);return Ea(y),g(b,()=>(S._state==="errored"?Pi(y,S._storedError):(nn(S._readableStreamController,p),dc(y)),null),q=>(nn(S._readableStreamController,q),Pi(y,q),null)),y._finishPromise}function IA(u){let p=u._transformStreamController;if(p._finishPromise!==void 0)return p._finishPromise;let y=u._readable;p._finishPromise=f((b,q)=>{p._finishPromise_resolve=b,p._finishPromise_reject=q});let S=p._flushAlgorithm();return Ea(p),g(S,()=>(y._state==="errored"?Pi(p,y._storedError):(Br(y._readableStreamController),dc(p)),null),b=>(nn(y._readableStreamController,b),Pi(p,b),null)),p._finishPromise}function PA(u){return ya(u,!1),u._backpressureChangePromise}function xA(u,p){let y=u._transformStreamController;if(y._finishPromise!==void 0)return y._finishPromise;let S=u._writable;y._finishPromise=f((q,V)=>{y._finishPromise_resolve=q,y._finishPromise_reject=V});let b=y._cancelAlgorithm(p);return Ea(y),g(b,()=>(S._state==="errored"?Pi(y,S._storedError):(Bo(S._writableStreamController,p),fc(u),dc(y)),null),q=>(Bo(S._writableStreamController,q),fc(u),Pi(y,q),null)),y._finishPromise}function Sa(u){return new TypeError(`TransformStreamDefaultController.prototype.${u} can only be used on a TransformStreamDefaultController`)}function dc(u){u._finishPromise_resolve!==void 0&&(u._finishPromise_resolve(),u._finishPromise_resolve=void 0,u._finishPromise_reject=void 0)}function Pi(u,p){u._finishPromise_reject!==void 0&&(R(u._finishPromise),u._finishPromise_reject(p),u._finishPromise_resolve=void 0,u._finishPromise_reject=void 0)}function Dm(u){return new TypeError(`TransformStream.prototype.${u} can only be used on a TransformStream`)}n.ByteLengthQueuingStrategy=pa,n.CountQueuingStrategy=ma,n.ReadableByteStreamController=Hn,n.ReadableStream=et,n.ReadableStreamBYOBReader=fr,n.ReadableStreamBYOBRequest=Dr,n.ReadableStreamDefaultController=$n,n.ReadableStreamDefaultReader=J,n.TransformStream=ga,n.TransformStreamDefaultController=mr,n.WritableStream=dr,n.WritableStreamDefaultController=bi,n.WritableStreamDefaultWriter=Vn}))});var Xg=K(()=>{if(!globalThis.ReadableStream)try{let n=require("node:process"),{emitWarning:e}=n;try{n.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),n.emitWarning=e}catch(t){throw n.emitWarning=e,t}}catch(n){Object.assign(globalThis,Kg())}try{let{Blob:n}=require("buffer");n&&!n.prototype.stream&&(n.prototype.stream=function(t){let r=0,i=this;return new ReadableStream({type:"bytes",async pull(o){let l=await i.slice(r,Math.min(i.size,r+65536)).arrayBuffer();r+=l.byteLength,o.enqueue(new Uint8Array(l)),r===i.size&&o.close()}})})}catch(n){}});async function*Xc(n,e=!0){for(let t of n)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let r=t.byteOffset,i=t.byteOffset+t.byteLength;for(;r!==i;){let o=Math.min(i-r,Qg),s=t.buffer.slice(r,r+o);r+=s.byteLength,yield new Uint8Array(s)}}else yield t;else{let r=0,i=t;for(;r!==i.size;){let s=await i.slice(r,Math.min(i.size,r+Qg)).arrayBuffer();r+=s.byteLength,yield new Uint8Array(s)}}}var RL,Qg,Kn,ts,zi,Ga,zr,Zg,X0,ln,ns=Je(()=>{RL=Le(Xg(),1);Qg=65536;Zg=(zr=class{constructor(e=[],t={}){se(this,Kn,[]);se(this,ts,"");se(this,zi,0);se(this,Ga,"transparent");if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof t!="object"&&typeof t!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");t===null&&(t={});let r=new TextEncoder;for(let o of e){let s;ArrayBuffer.isView(o)?s=new Uint8Array(o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength)):o instanceof ArrayBuffer?s=new Uint8Array(o.slice(0)):o instanceof zr?s=o:s=r.encode(`${o}`),ce(this,zi,D(this,zi)+(ArrayBuffer.isView(s)?s.byteLength:s.size)),D(this,Kn).push(s)}ce(this,Ga,`${t.endings===void 0?"transparent":t.endings}`);let i=t.type===void 0?"":String(t.type);ce(this,ts,/^[\x20-\x7E]*$/.test(i)?i:"")}get size(){return D(this,zi)}get type(){return D(this,ts)}async text(){let e=new TextDecoder,t="";for await(let r of Xc(D(this,Kn),!1))t+=e.decode(r,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let r of Xc(D(this,Kn),!1))e.set(r,t),t+=r.length;return e.buffer}stream(){let e=Xc(D(this,Kn),!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){let r=await e.next();r.done?t.close():t.enqueue(r.value)},async cancel(){await e.return()}})}slice(e=0,t=this.size,r=""){let{size:i}=this,o=e<0?Math.max(i+e,0):Math.min(e,i),s=t<0?Math.max(i+t,0):Math.min(t,i),l=Math.max(s-o,0),f=D(this,Kn),d=[],h=0;for(let g of f){if(h>=l)break;let E=ArrayBuffer.isView(g)?g.byteLength:g.size;if(o&&E<=o)o-=E,s-=E;else{let w;ArrayBuffer.isView(g)?(w=g.subarray(o,Math.min(E,s)),h+=w.byteLength):(w=g.slice(o,Math.min(E,s)),h+=w.size),s-=E,d.push(w),o=0}}let m=new zr([],{type:String(r).toLowerCase()});return ce(m,zi,l),ce(m,Kn,d),m}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}},Kn=new WeakMap,ts=new WeakMap,zi=new WeakMap,Ga=new WeakMap,zr);Object.defineProperties(Zg.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});X0=Zg,ln=X0});var rs,is,jg,Q0,Z0,Sr,Qc=Je(()=>{ns();Q0=(jg=class extends ln{constructor(t,r,i={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(t,i);se(this,rs,0);se(this,is,"");i===null&&(i={});let o=i.lastModified===void 0?Date.now():Number(i.lastModified);Number.isNaN(o)||ce(this,rs,o),ce(this,is,String(r))}get name(){return D(this,is)}get lastModified(){return D(this,rs)}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](t){return!!t&&t instanceof ln&&/^(File)$/.test(t[Symbol.toStringTag])}},rs=new WeakMap,is=new WeakMap,jg),Z0=Q0,Sr=Z0});function ry(n,e=ln){var t=`${ey()}${ey()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),r=[],i=`--${t}\r
Content-Disposition: form-data; name="`;return n.forEach((o,s)=>typeof o=="string"?r.push(i+Zc(s)+`"\r
\r
${o.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):r.push(i+Zc(s)+`"; filename="${Zc(o.name,1)}"\r
Content-Type: ${o.type||"application/octet-stream"}\r
\r
`,o,`\r
`)),r.push(`--${t}--`),new e(r,{type:"multipart/form-data; boundary="+t})}var os,j0,eb,ey,tb,ty,Zc,Jr,zt,ny,Tr,Ha=Je(()=>{ns();Qc();({toStringTag:os,iterator:j0,hasInstance:eb}=Symbol),ey=Math.random,tb="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),ty=(n,e,t)=>(n+="",/^(Blob|File)$/.test(e&&e[os])?[(t=t!==void 0?t+"":e[os]=="File"?e.name:"blob",n),e.name!==t||e[os]=="blob"?new Sr([e],t,e):e]:[n,e+""]),Zc=(n,e)=>(e?n:n.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),Jr=(n,e,t)=>{if(e.length<t)throw new TypeError(`Failed to execute '${n}' on 'FormData': ${t} arguments required, but only ${e.length} present.`)},Tr=(ny=class{constructor(...e){se(this,zt,[]);if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[os](){return"FormData"}[j0](){return this.entries()}static[eb](e){return e&&typeof e=="object"&&e[os]==="FormData"&&!tb.some(t=>typeof e[t]!="function")}append(...e){Jr("append",arguments,2),D(this,zt).push(ty(...e))}delete(e){Jr("delete",arguments,1),e+="",ce(this,zt,D(this,zt).filter(([t])=>t!==e))}get(e){Jr("get",arguments,1),e+="";for(var t=D(this,zt),r=t.length,i=0;i<r;i++)if(t[i][0]===e)return t[i][1];return null}getAll(e,t){return Jr("getAll",arguments,1),t=[],e+="",D(this,zt).forEach(r=>r[0]===e&&t.push(r[1])),t}has(e){return Jr("has",arguments,1),e+="",D(this,zt).some(t=>t[0]===e)}forEach(e,t){Jr("forEach",arguments,1);for(var[r,i]of this)e.call(t,i,r,this)}set(...e){Jr("set",arguments,2);var t=[],r=!0;e=ty(...e),D(this,zt).forEach(i=>{i[0]===e[0]?r&&(r=!t.push(e)):t.push(i)}),r&&t.push(e),ce(this,zt,t)}*entries(){yield*D(this,zt)}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}},zt=new WeakMap,ny)});var Xn,Va=Je(()=>{Xn=class extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}});var ht,jc=Je(()=>{Va();ht=class extends Xn{constructor(e,t,r){super(e,t),r&&(this.code=this.errno=r.code,this.erroredSysCall=r.syscall)}}});var $a,ef,ss,iy,oy,sy,Wa=Je(()=>{$a=Symbol.toStringTag,ef=n=>typeof n=="object"&&typeof n.append=="function"&&typeof n.delete=="function"&&typeof n.get=="function"&&typeof n.getAll=="function"&&typeof n.has=="function"&&typeof n.set=="function"&&typeof n.sort=="function"&&n[$a]==="URLSearchParams",ss=n=>n&&typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&typeof n.constructor=="function"&&/^(Blob|File)$/.test(n[$a]),iy=n=>typeof n=="object"&&(n[$a]==="AbortSignal"||n[$a]==="EventTarget"),oy=(n,e)=>{let t=new URL(e).hostname,r=new URL(n).hostname;return t===r||t.endsWith(`.${r}`)},sy=(n,e)=>{let t=new URL(e).protocol,r=new URL(n).protocol;return t===r}});var ly=K((VL,ay)=>{if(!globalThis.DOMException)try{let{MessageChannel:n}=require("worker_threads"),e=new n().port1,t=new ArrayBuffer;e.postMessage(t,[t,t])}catch(n){n.constructor.name==="DOMException"&&(globalThis.DOMException=n.constructor)}ay.exports=globalThis.DOMException});var Xr,uy,cy,tf,fy,dy,hy,py,my,gy,Yr,Kr,nf,za,rf=Je(()=>{Xr=require("node:fs"),uy=require("node:path"),cy=Le(ly(),1);Qc();ns();({stat:tf}=Xr.promises),fy=(n,e)=>my((0,Xr.statSync)(n),n,e),dy=(n,e)=>tf(n).then(t=>my(t,n,e)),hy=(n,e)=>tf(n).then(t=>gy(t,n,e)),py=(n,e)=>gy((0,Xr.statSync)(n),n,e),my=(n,e,t="")=>new ln([new za({path:e,size:n.size,lastModified:n.mtimeMs,start:0})],{type:t}),gy=(n,e,t="")=>new Sr([new za({path:e,size:n.size,lastModified:n.mtimeMs,start:0})],(0,uy.basename)(e),{type:t,lastModified:n.mtimeMs}),nf=class nf{constructor(e){se(this,Yr);se(this,Kr);ce(this,Yr,e.path),ce(this,Kr,e.start),this.size=e.size,this.lastModified=e.lastModified}slice(e,t){return new nf({path:D(this,Yr),lastModified:this.lastModified,size:t-e,start:D(this,Kr)+e})}async*stream(){let{mtimeMs:e}=await tf(D(this,Yr));if(e>this.lastModified)throw new cy.default("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,Xr.createReadStream)(D(this,Yr),{start:D(this,Kr),end:D(this,Kr)+this.size-1})}get[Symbol.toStringTag](){return"Blob"}};Yr=new WeakMap,Kr=new WeakMap;za=nf});var _y={};pc(_y,{toFormData:()=>lb});function ab(n){let e=n.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let t=e[2]||e[3]||"",r=t.slice(t.lastIndexOf("\\")+1);return r=r.replace(/%22/g,'"'),r=r.replace(/&#(\d{4});/g,(i,o)=>String.fromCharCode(o)),r}async function lb(n,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let t=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!t)throw new TypeError("no or bad content-type header, no multipart boundary");let r=new of(t[1]||t[2]),i,o,s,l,f,d,h=[],m=new Tr,g=P=>{s+=R.decode(P,{stream:!0})},E=P=>{h.push(P)},w=()=>{let P=new Sr(h,d,{type:f});m.append(l,P)},C=()=>{m.append(l,s)},R=new TextDecoder("utf-8");R.decode(),r.onPartBegin=function(){r.onPartData=g,r.onPartEnd=C,i="",o="",s="",l="",f="",d=null,h.length=0},r.onHeaderField=function(P){i+=R.decode(P,{stream:!0})},r.onHeaderValue=function(P){o+=R.decode(P,{stream:!0})},r.onHeaderEnd=function(){if(o+=R.decode(),i=i.toLowerCase(),i==="content-disposition"){let P=o.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);P&&(l=P[2]||P[3]||""),d=ab(o),d&&(r.onPartData=E,r.onPartEnd=w)}else i==="content-type"&&(f=o);o="",i=""};for await(let P of n)r.write(P);return r.end(),m}var bn,Ne,yy,vr,Ja,Ya,nb,as,rb,ib,ob,sb,Qr,of,Ey=Je(()=>{rf();Ha();bn=0,Ne={START_BOUNDARY:bn++,HEADER_FIELD_START:bn++,HEADER_FIELD:bn++,HEADER_VALUE_START:bn++,HEADER_VALUE:bn++,HEADER_VALUE_ALMOST_DONE:bn++,HEADERS_ALMOST_DONE:bn++,PART_DATA_START:bn++,PART_DATA:bn++,END:bn++},yy=1,vr={PART_BOUNDARY:yy,LAST_BOUNDARY:yy*=2},Ja=10,Ya=13,nb=32,as=45,rb=58,ib=97,ob=122,sb=n=>n|32,Qr=()=>{},of=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=Qr,this.onHeaderField=Qr,this.onHeadersEnd=Qr,this.onHeaderValue=Qr,this.onPartBegin=Qr,this.onPartData=Qr,this.onPartEnd=Qr,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r),this.boundaryChars[t[r]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=Ne.START_BOUNDARY}write(e){let t=0,r=e.length,i=this.index,{lookbehind:o,boundary:s,boundaryChars:l,index:f,state:d,flags:h}=this,m=this.boundary.length,g=m-1,E=e.length,w,C,R=W=>{this[W+"Mark"]=t},P=W=>{delete this[W+"Mark"]},z=(W,H,G,Y)=>{(H===void 0||H!==G)&&this[W](Y&&Y.subarray(H,G))},$=(W,H)=>{let G=W+"Mark";G in this&&(H?(z(W,this[G],t,e),delete this[G]):(z(W,this[G],e.length,e),this[G]=0))};for(t=0;t<r;t++)switch(w=e[t],d){case Ne.START_BOUNDARY:if(f===s.length-2){if(w===as)h|=vr.LAST_BOUNDARY;else if(w!==Ya)return;f++;break}else if(f-1===s.length-2){if(h&vr.LAST_BOUNDARY&&w===as)d=Ne.END,h=0;else if(!(h&vr.LAST_BOUNDARY)&&w===Ja)f=0,z("onPartBegin"),d=Ne.HEADER_FIELD_START;else return;break}w!==s[f+2]&&(f=-2),w===s[f+2]&&f++;break;case Ne.HEADER_FIELD_START:d=Ne.HEADER_FIELD,R("onHeaderField"),f=0;case Ne.HEADER_FIELD:if(w===Ya){P("onHeaderField"),d=Ne.HEADERS_ALMOST_DONE;break}if(f++,w===as)break;if(w===rb){if(f===1)return;$("onHeaderField",!0),d=Ne.HEADER_VALUE_START;break}if(C=sb(w),C<ib||C>ob)return;break;case Ne.HEADER_VALUE_START:if(w===nb)break;R("onHeaderValue"),d=Ne.HEADER_VALUE;case Ne.HEADER_VALUE:w===Ya&&($("onHeaderValue",!0),z("onHeaderEnd"),d=Ne.HEADER_VALUE_ALMOST_DONE);break;case Ne.HEADER_VALUE_ALMOST_DONE:if(w!==Ja)return;d=Ne.HEADER_FIELD_START;break;case Ne.HEADERS_ALMOST_DONE:if(w!==Ja)return;z("onHeadersEnd"),d=Ne.PART_DATA_START;break;case Ne.PART_DATA_START:d=Ne.PART_DATA,R("onPartData");case Ne.PART_DATA:if(i=f,f===0){for(t+=g;t<E&&!(e[t]in l);)t+=m;t-=g,w=e[t]}if(f<s.length)s[f]===w?(f===0&&$("onPartData",!0),f++):f=0;else if(f===s.length)f++,w===Ya?h|=vr.PART_BOUNDARY:w===as?h|=vr.LAST_BOUNDARY:f=0;else if(f-1===s.length)if(h&vr.PART_BOUNDARY){if(f=0,w===Ja){h&=~vr.PART_BOUNDARY,z("onPartEnd"),z("onPartBegin"),d=Ne.HEADER_FIELD_START;break}}else h&vr.LAST_BOUNDARY&&w===as?(z("onPartEnd"),d=Ne.END,h=0):f=0;if(f>0)o[f-1]=w;else if(i>0){let W=new Uint8Array(o.buffer,o.byteOffset,o.byteLength);z("onPartData",0,i,W),i=0,R("onPartData"),t--}break;case Ne.END:break;default:throw new Error(`Unexpected state entered: ${d}`)}$("onHeaderField"),$("onHeaderValue"),$("onPartData"),this.index=f,this.state=d,this.flags=h}end(){if(this.state===Ne.HEADER_FIELD_START&&this.index===0||this.state===Ne.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==Ne.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});async function sf(n){if(n[Tt].disturbed)throw new TypeError(`body used already for: ${n.url}`);if(n[Tt].disturbed=!0,n[Tt].error)throw n[Tt].error;let{body:e}=n;if(e===null)return Rt.Buffer.alloc(0);if(!(e instanceof Jt.default))return Rt.Buffer.alloc(0);let t=[],r=0;try{for await(let i of e){if(n.size>0&&r+i.length>n.size){let o=new ht(`content size at ${n.url} over limit: ${n.size}`,"max-size");throw e.destroy(o),o}r+=i.length,t.push(i)}}catch(i){throw i instanceof Xn?i:new ht(`Invalid response body while trying to fetch ${n.url}: ${i.message}`,"system",i)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(i=>typeof i=="string")?Rt.Buffer.from(t.join("")):Rt.Buffer.concat(t,r)}catch(i){throw new ht(`Could not create Buffer from response body for ${n.url}: ${i.message}`,"system",i)}else throw new ht(`Premature close of server response while trying to fetch ${n.url}`)}var Jt,Qn,Rt,ub,Tt,Rn,Ji,cb,Ka,Sy,Ty,Xa=Je(()=>{Jt=Le(require("node:stream"),1),Qn=require("node:util"),Rt=require("node:buffer");ns();Ha();jc();Va();Wa();ub=(0,Qn.promisify)(Jt.default.pipeline),Tt=Symbol("Body internals"),Rn=class{constructor(e,{size:t=0}={}){let r=null;e===null?e=null:ef(e)?e=Rt.Buffer.from(e.toString()):ss(e)||Rt.Buffer.isBuffer(e)||(Qn.types.isAnyArrayBuffer(e)?e=Rt.Buffer.from(e):ArrayBuffer.isView(e)?e=Rt.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Jt.default||(e instanceof Tr?(e=ry(e),r=e.type.split("=")[1]):e=Rt.Buffer.from(String(e))));let i=e;Rt.Buffer.isBuffer(e)?i=Jt.default.Readable.from(e):ss(e)&&(i=Jt.default.Readable.from(e.stream())),this[Tt]={body:e,stream:i,boundary:r,disturbed:!1,error:null},this.size=t,e instanceof Jt.default&&e.on("error",o=>{let s=o instanceof Xn?o:new ht(`Invalid response body while trying to fetch ${this.url}: ${o.message}`,"system",o);this[Tt].error=s})}get body(){return this[Tt].stream}get bodyUsed(){return this[Tt].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:r}=await sf(this);return e.slice(t,t+r)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let r=new Tr,i=new URLSearchParams(await this.text());for(let[o,s]of i)r.append(o,s);return r}let{toFormData:t}=await Promise.resolve().then(()=>(Ey(),_y));return t(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[Tt].body&&this[Tt].body.type||"",t=await this.arrayBuffer();return new ln([t],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await sf(this);return new TextDecoder().decode(e)}buffer(){return sf(this)}};Rn.prototype.buffer=(0,Qn.deprecate)(Rn.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(Rn.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,Qn.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});Ji=(n,e)=>{let t,r,{body:i}=n[Tt];if(n.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof Jt.default&&typeof i.getBoundary!="function"&&(t=new Jt.PassThrough({highWaterMark:e}),r=new Jt.PassThrough({highWaterMark:e}),i.pipe(t),i.pipe(r),n[Tt].stream=t,i=r),i},cb=(0,Qn.deprecate)(n=>n.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Ka=(n,e)=>n===null?null:typeof n=="string"?"text/plain;charset=UTF-8":ef(n)?"application/x-www-form-urlencoded;charset=UTF-8":ss(n)?n.type||null:Rt.Buffer.isBuffer(n)||Qn.types.isAnyArrayBuffer(n)||ArrayBuffer.isView(n)?null:n instanceof Tr?`multipart/form-data; boundary=${e[Tt].boundary}`:n&&typeof n.getBoundary=="function"?`multipart/form-data;boundary=${cb(n)}`:n instanceof Jt.default?null:"text/plain;charset=UTF-8",Sy=n=>{let{body:e}=n[Tt];return e===null?0:ss(e)?e.size:Rt.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},Ty=async(n,{body:e})=>{e===null?n.end():await ub(e,n)}});function vy(n=[]){return new vt(n.reduce((e,t,r,i)=>(r%2===0&&e.push(i.slice(r,r+2)),e),[]).filter(([e,t])=>{try{return Qa(e),lf(e,String(t)),!0}catch(r){return!1}}))}var af,ls,Qa,lf,vt,Za=Je(()=>{af=require("node:util"),ls=Le(require("node:http"),1),Qa=typeof ls.default.validateHeaderName=="function"?ls.default.validateHeaderName:n=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(n)){let e=new TypeError(`Header name must be a valid HTTP token [${n}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},lf=typeof ls.default.validateHeaderValue=="function"?ls.default.validateHeaderValue:(n,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${n}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},vt=class n extends URLSearchParams{constructor(e){let t=[];if(e instanceof n){let r=e.raw();for(let[i,o]of Object.entries(r))t.push(...o.map(s=>[i,s]))}else if(e!=null)if(typeof e=="object"&&!af.types.isBoxedPrimitive(e)){let r=e[Symbol.iterator];if(r==null)t.push(...Object.entries(e));else{if(typeof r!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(i=>{if(typeof i!="object"||af.types.isBoxedPrimitive(i))throw new TypeError("Each header pair must be an iterable object");return[...i]}).map(i=>{if(i.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...i]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return t=t.length>0?t.map(([r,i])=>(Qa(r),lf(r,String(i)),[String(r).toLowerCase(),String(i)])):void 0,super(t),new Proxy(this,{get(r,i,o){switch(i){case"append":case"set":return(s,l)=>(Qa(s),lf(s,String(l)),URLSearchParams.prototype[i].call(r,String(s).toLowerCase(),String(l)));case"delete":case"has":case"getAll":return s=>(Qa(s),URLSearchParams.prototype[i].call(r,String(s).toLowerCase()));case"keys":return()=>(r.sort(),new Set(URLSearchParams.prototype.keys.call(r)).keys());default:return Reflect.get(r,i,o)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let r=t.join(", ");return/^content-encoding$/i.test(e)&&(r=r.toLowerCase()),r}forEach(e,t=void 0){for(let r of this.keys())Reflect.apply(e,t,[this.get(r),r,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let r=this.getAll(t);return t==="host"?e[t]=r[0]:e[t]=r.length>1?r:r[0],e},{})}};Object.defineProperties(vt.prototype,["get","entries","forEach","values"].reduce((n,e)=>(n[e]={enumerable:!0},n),{}))});var fb,us,uf=Je(()=>{fb=new Set([301,302,303,307,308]),us=n=>fb.has(n)});var un,It,wy=Je(()=>{Za();Xa();uf();un=Symbol("Response internals"),It=class n extends Rn{constructor(e=null,t={}){super(e,t);let r=t.status!=null?t.status:200,i=new vt(t.headers);if(e!==null&&!i.has("Content-Type")){let o=Ka(e,this);o&&i.append("Content-Type",o)}this[un]={type:"default",url:t.url,status:r,statusText:t.statusText||"",headers:i,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[un].type}get url(){return this[un].url||""}get status(){return this[un].status}get ok(){return this[un].status>=200&&this[un].status<300}get redirected(){return this[un].counter>0}get statusText(){return this[un].statusText}get headers(){return this[un].headers}get highWaterMark(){return this[un].highWaterMark}clone(){return new n(Ji(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!us(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new n(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new n(null,{status:0,statusText:""});return e[un].type="error",e}static json(e=void 0,t={}){let r=JSON.stringify(e);if(r===void 0)throw new TypeError("data is not JSON serializable");let i=new vt(t&&t.headers);return i.has("content-type")||i.set("content-type","application/json"),new n(r,{...t,headers:i})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(It.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}})});var Cy,Ay=Je(()=>{Cy=n=>{if(n.search)return n.search;let e=n.href.length-1,t=n.hash||(n.href[e]==="#"?"#":"");return n.href[e-t.length]==="?"?"?":""}});function by(n,e=!1){return n==null||(n=new URL(n),/^(about|blob|data):$/.test(n.protocol))?"no-referrer":(n.username="",n.password="",n.hash="",e&&(n.pathname="",n.search=""),n)}function xy(n){if(!Iy.has(n))throw new TypeError(`Invalid referrerPolicy: ${n}`);return n}function db(n){if(/^(http|ws)s:$/.test(n.protocol))return!0;let e=n.host.replace(/(^\[)|(]$)/g,""),t=(0,Ry.isIP)(e);return t===4&&/^127\./.test(e)||t===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:n.host==="localhost"||n.host.endsWith(".localhost")?!1:n.protocol==="file:"}function Yi(n){return/^about:(blank|srcdoc)$/.test(n)||n.protocol==="data:"||/^(blob|filesystem):$/.test(n.protocol)?!0:db(n)}function ky(n,{referrerURLCallback:e,referrerOriginCallback:t}={}){if(n.referrer==="no-referrer"||n.referrerPolicy==="")return null;let r=n.referrerPolicy;if(n.referrer==="about:client")return"no-referrer";let i=n.referrer,o=by(i),s=by(i,!0);o.toString().length>4096&&(o=s),e&&(o=e(o)),t&&(s=t(s));let l=new URL(n.url);switch(r){case"no-referrer":return"no-referrer";case"origin":return s;case"unsafe-url":return o;case"strict-origin":return Yi(o)&&!Yi(l)?"no-referrer":s.toString();case"strict-origin-when-cross-origin":return o.origin===l.origin?o:Yi(o)&&!Yi(l)?"no-referrer":s;case"same-origin":return o.origin===l.origin?o:"no-referrer";case"origin-when-cross-origin":return o.origin===l.origin?o:s;case"no-referrer-when-downgrade":return Yi(o)&&!Yi(l)?"no-referrer":o;default:throw new TypeError(`Invalid referrerPolicy: ${r}`)}}function Ny(n){let e=(n.get("referrer-policy")||"").split(/[,\s]+/),t="";for(let r of e)r&&Iy.has(r)&&(t=r);return t}var Ry,Iy,Py,cf=Je(()=>{Ry=require("node:net");Iy=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),Py="strict-origin-when-cross-origin"});var My,Dy,Xe,cs,hb,wr,Oy,Uy=Je(()=>{My=require("node:url"),Dy=require("node:util");Za();Xa();Wa();Ay();cf();Xe=Symbol("Request internals"),cs=n=>typeof n=="object"&&typeof n[Xe]=="object",hb=(0,Dy.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),wr=class n extends Rn{constructor(e,t={}){let r;if(cs(e)?r=new URL(e.url):(r=new URL(e),e={}),r.username!==""||r.password!=="")throw new TypeError(`${r} is an url with embedded credentials.`);let i=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(i)&&(i=i.toUpperCase()),!cs(t)&&"data"in t&&hb(),(t.body!=null||cs(e)&&e.body!==null)&&(i==="GET"||i==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let o=t.body?t.body:cs(e)&&e.body!==null?Ji(e):null;super(o,{size:t.size||e.size||0});let s=new vt(t.headers||e.headers||{});if(o!==null&&!s.has("Content-Type")){let d=Ka(o,this);d&&s.set("Content-Type",d)}let l=cs(e)?e.signal:null;if("signal"in t&&(l=t.signal),l!=null&&!iy(l))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let f=t.referrer==null?e.referrer:t.referrer;if(f==="")f="no-referrer";else if(f){let d=new URL(f);f=/^about:(\/\/)?client$/.test(d)?"client":d}else f=void 0;this[Xe]={method:i,redirect:t.redirect||e.redirect||"follow",headers:s,parsedURL:r,signal:l,referrer:f},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[Xe].method}get url(){return(0,My.format)(this[Xe].parsedURL)}get headers(){return this[Xe].headers}get redirect(){return this[Xe].redirect}get signal(){return this[Xe].signal}get referrer(){if(this[Xe].referrer==="no-referrer")return"";if(this[Xe].referrer==="client")return"about:client";if(this[Xe].referrer)return this[Xe].referrer.toString()}get referrerPolicy(){return this[Xe].referrerPolicy}set referrerPolicy(e){this[Xe].referrerPolicy=xy(e)}clone(){return new n(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(wr.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});Oy=n=>{let{parsedURL:e}=n[Xe],t=new vt(n[Xe].headers);t.has("Accept")||t.set("Accept","*/*");let r=null;if(n.body===null&&/^(post|put)$/i.test(n.method)&&(r="0"),n.body!==null){let l=Sy(n);typeof l=="number"&&!Number.isNaN(l)&&(r=String(l))}r&&t.set("Content-Length",r),n.referrerPolicy===""&&(n.referrerPolicy=Py),n.referrer&&n.referrer!=="no-referrer"?n[Xe].referrer=ky(n):n[Xe].referrer="no-referrer",n[Xe].referrer instanceof URL&&t.set("Referer",n.referrer),t.has("User-Agent")||t.set("User-Agent","node-fetch"),n.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip, deflate, br");let{agent:i}=n;typeof i=="function"&&(i=i(e));let o=Cy(e),s={path:e.pathname+o,method:n.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:n.insecureHTTPParser,agent:i};return{parsedURL:e,options:s}}});var fs,Fy=Je(()=>{Va();fs=class extends Xn{constructor(e,t="aborted"){super(e,t)}}});var By={};pc(By,{AbortError:()=>fs,Blob:()=>ln,FetchError:()=>ht,File:()=>Sr,FormData:()=>Tr,Headers:()=>vt,Request:()=>wr,Response:()=>It,blobFrom:()=>dy,blobFromSync:()=>fy,default:()=>ff,fileFrom:()=>hy,fileFromSync:()=>py,isRedirect:()=>us});async function ff(n,e){return new Promise((t,r)=>{let i=new wr(n,e),{parsedURL:o,options:s}=Oy(i);if(!pb.has(o.protocol))throw new TypeError(`node-fetch cannot load ${n}. URL scheme "${o.protocol.replace(/:$/,"")}" is not supported.`);if(o.protocol==="data:"){let w=zg(i.url),C=new It(w,{headers:{"Content-Type":w.typeFull}});t(C);return}let l=(o.protocol==="https:"?qy.default:Ly.default).request,{signal:f}=i,d=null,h=()=>{let w=new fs("The operation was aborted.");r(w),i.body&&i.body instanceof Pt.default.Readable&&i.body.destroy(w),!(!d||!d.body)&&d.body.emit("error",w)};if(f&&f.aborted){h();return}let m=()=>{h(),E()},g=l(o.toString(),s);f&&f.addEventListener("abort",m);let E=()=>{g.abort(),f&&f.removeEventListener("abort",m)};g.on("error",w=>{r(new ht(`request to ${i.url} failed, reason: ${w.message}`,"system",w)),E()}),mb(g,w=>{d&&d.body&&d.body.destroy(w)}),process.version<"v14"&&g.on("socket",w=>{let C;w.prependListener("end",()=>{C=w._eventsCount}),w.prependListener("close",R=>{if(d&&C<w._eventsCount&&!R){let P=new Error("Premature close");P.code="ERR_STREAM_PREMATURE_CLOSE",d.body.emit("error",P)}})}),g.on("response",w=>{g.setTimeout(0);let C=vy(w.rawHeaders);if(us(w.statusCode)){let W=C.get("Location"),H=null;try{H=W===null?null:new URL(W,i.url)}catch(G){if(i.redirect!=="manual"){r(new ht(`uri requested responds with an invalid redirect URL: ${W}`,"invalid-redirect")),E();return}}switch(i.redirect){case"error":r(new ht(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),E();return;case"manual":break;case"follow":{if(H===null)break;if(i.counter>=i.follow){r(new ht(`maximum redirect reached at: ${i.url}`,"max-redirect")),E();return}let G={headers:new vt(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:Ji(i),signal:i.signal,size:i.size,referrer:i.referrer,referrerPolicy:i.referrerPolicy};if(!oy(i.url,H)||!sy(i.url,H))for(let j of["authorization","www-authenticate","cookie","cookie2"])G.headers.delete(j);if(w.statusCode!==303&&i.body&&e.body instanceof Pt.default.Readable){r(new ht("Cannot follow redirect with body being a readable stream","unsupported-redirect")),E();return}(w.statusCode===303||(w.statusCode===301||w.statusCode===302)&&i.method==="POST")&&(G.method="GET",G.body=void 0,G.headers.delete("content-length"));let Y=Ny(C);Y&&(G.referrerPolicy=Y),t(ff(new wr(H,G))),E();return}default:return r(new TypeError(`Redirect option '${i.redirect}' is not a valid value of RequestRedirect`))}}f&&w.once("end",()=>{f.removeEventListener("abort",m)});let R=(0,Pt.pipeline)(w,new Pt.PassThrough,W=>{W&&r(W)});process.version<"v12.10"&&w.on("aborted",m);let P={url:i.url,status:w.statusCode,statusText:w.statusMessage,headers:C,size:i.size,counter:i.counter,highWaterMark:i.highWaterMark},z=C.get("Content-Encoding");if(!i.compress||i.method==="HEAD"||z===null||w.statusCode===204||w.statusCode===304){d=new It(R,P),t(d);return}let $={flush:Zr.default.Z_SYNC_FLUSH,finishFlush:Zr.default.Z_SYNC_FLUSH};if(z==="gzip"||z==="x-gzip"){R=(0,Pt.pipeline)(R,Zr.default.createGunzip($),W=>{W&&r(W)}),d=new It(R,P),t(d);return}if(z==="deflate"||z==="x-deflate"){let W=(0,Pt.pipeline)(w,new Pt.PassThrough,H=>{H&&r(H)});W.once("data",H=>{(H[0]&15)===8?R=(0,Pt.pipeline)(R,Zr.default.createInflate(),G=>{G&&r(G)}):R=(0,Pt.pipeline)(R,Zr.default.createInflateRaw(),G=>{G&&r(G)}),d=new It(R,P),t(d)}),W.once("end",()=>{d||(d=new It(R,P),t(d))});return}if(z==="br"){R=(0,Pt.pipeline)(R,Zr.default.createBrotliDecompress(),W=>{W&&r(W)}),d=new It(R,P),t(d);return}d=new It(R,P),t(d)}),Ty(g,i).catch(r)})}function mb(n,e){let t=ds.Buffer.from(`0\r
\r
`),r=!1,i=!1,o;n.on("response",s=>{let{headers:l}=s;r=l["transfer-encoding"]==="chunked"&&!l["content-length"]}),n.on("socket",s=>{let l=()=>{if(r&&!i){let d=new Error("Premature close");d.code="ERR_STREAM_PREMATURE_CLOSE",e(d)}},f=d=>{i=ds.Buffer.compare(d.slice(-5),t)===0,!i&&o&&(i=ds.Buffer.compare(o.slice(-3),t.slice(0,3))===0&&ds.Buffer.compare(d.slice(-2),t.slice(3))===0),o=d};s.prependListener("close",l),s.on("data",f),n.on("close",()=>{s.removeListener("close",l),s.removeListener("data",f)})})}var Ly,qy,Zr,Pt,ds,pb,Gy=Je(()=>{Ly=Le(require("node:http"),1),qy=Le(require("node:https"),1),Zr=Le(require("node:zlib"),1),Pt=Le(require("node:stream"),1),ds=require("node:buffer");Jg();Xa();wy();Za();Uy();jc();Fy();uf();Ha();Wa();cf();rf();pb=new Set(["data:","http:","https:"])});var Xy=K(Xi=>{"use strict";var gb=Xi&&Xi.__importDefault||function(n){return n&&n.__esModule?n:{default:n}},Ki;Object.defineProperty(Xi,"__esModule",{value:!0});Xi.Gaxios=void 0;var yb=gb(Fc()),_b=require("https"),jr=Bc(),Eb=Sg(),Hy=require("stream"),Vy=Vc(),Sb=async()=>{var n;return((n=globalThis.crypto)==null?void 0:n.randomUUID())||(await import("crypto")).randomUUID()},Tb=204,xt,$y,Wy,zy,Jy,df,hs,ps,Qi,Yy,Ky,ei=class{constructor(e){se(this,xt);x(this,"agentCache",new Map);x(this,"defaults");x(this,"interceptors");this.defaults=e||{},this.interceptors={request:new Vy.GaxiosInterceptorManager,response:new Vy.GaxiosInterceptorManager}}fetch(...e){let t=e[0],r=e[1],i,o=new Headers;return typeof t=="string"?i=new URL(t):t instanceof URL?i=t:t&&t.url&&(i=new URL(t.url)),t&&typeof t=="object"&&"headers"in t&&Ki.mergeHeaders(o,t.headers),r&&Ki.mergeHeaders(o,new Headers(r.headers)),typeof t=="object"&&!(t instanceof URL)?this.request({...r,...t,headers:o,url:i}):this.request({...r,headers:o,url:i})}async request(e={}){let t=await re(this,xt,Jy).call(this,e);return t=await re(this,xt,Wy).call(this,t),re(this,xt,zy).call(this,this._request(t))}async _defaultAdapter(e){var s,l;let t=e.fetchImplementation||this.defaults.fetchImplementation||await re(s=Ki,Qi,Ky).call(s),r={...e};delete r.data;let i=await t(e.url,r),o=await this.getResponseData(e,i);return(l=Object.getOwnPropertyDescriptor(i,"data"))!=null&&l.configurable||Object.defineProperties(i,{data:{configurable:!0,writable:!0,enumerable:!0,value:o}}),Object.assign(i,{config:e,data:o})}async _request(e){var t;try{let r;if(e.adapter?r=await e.adapter(e,this._defaultAdapter.bind(this)):r=await this._defaultAdapter(e),!e.validateStatus(r.status)){if(e.responseType==="stream"){let o=[];for await(let s of r.data)o.push(s);r.data=o.toString()}let i=jr.GaxiosError.extractAPIErrorFromResponse(r,`Request failed with status code ${r.status}`);throw new jr.GaxiosError(i==null?void 0:i.message,e,r,i)}return r}catch(r){let i;r instanceof jr.GaxiosError?i=r:r instanceof Error?i=new jr.GaxiosError(r.message,e,void 0,r):i=new jr.GaxiosError("Unexpected Gaxios Error",e,void 0,r);let{shouldRetry:o,config:s}=await(0,Eb.getRetryConfig)(i);if(o&&s)return i.config.retryConfig.currentRetryAttempt=s.retryConfig.currentRetryAttempt,e.retryConfig=(t=i.config)==null?void 0:t.retryConfig,re(this,xt,df).call(this,e),this._request(e);throw e.errorRedactor&&e.errorRedactor(i),i}}async getResponseData(e,t){var r;if(t.status===Tb)return"";if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(((r=t.headers)==null?void 0:r.get("content-length"))||""))throw new jr.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":{let i=await t.text();try{return JSON.parse(i)}catch(o){return i}}case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(t===null)return e.text();if(t=t.toLowerCase(),t.includes("application/json")){let r=await e.text();try{r=JSON.parse(r)}catch(i){}return r}else return t.match(/^text\//)?e.text():e.blob()}async*getMultipartRequest(e,t){let r=`--${t}--`;for(let i of e){let o=i.headers.get("Content-Type")||"application/octet-stream";yield`--${t}\r
Content-Type: ${o}\r
\r
`,typeof i.content=="string"?yield i.content:yield*i.content,yield`\r
`}yield r}static mergeHeaders(e,...t){e=e instanceof Headers?e:new Headers(e);for(let r of t)(r instanceof Headers?r:new Headers(r)).forEach((o,s)=>{s==="set-cookie"?e.append(s,o):e.set(s,o)});return e}};xt=new WeakSet,$y=function(e,t=[]){var s,l;let r=new URL(e),i=[...t],o=((l=(s=process.env.NO_PROXY)!=null?s:process.env.no_proxy)==null?void 0:l.split(","))||[];for(let f of o)i.push(f.trim());for(let f of i)if(f instanceof RegExp){if(f.test(r.toString()))return!1}else if(f instanceof URL){if(f.origin===r.origin)return!1}else if(f.startsWith("*.")||f.startsWith(".")){let d=f.replace(/^\*\./,".");if(r.hostname.endsWith(d))return!1}else if(f===r.origin||f===r.hostname||f===r.href)return!1;return!0},Wy=async function(e){let t=Promise.resolve(e);for(let r of this.interceptors.request.values())r&&(t=t.then(r.resolved,r.rejected));return t},zy=async function(e){let t=Promise.resolve(e);for(let r of this.interceptors.response.values())r&&(t=t.then(r.resolved,r.rejected));return t},Jy=async function(e){var s,l,f,d,h,m,g,E;let t=new Headers(this.defaults.headers);Ki.mergeHeaders(t,e.headers);let r=(0,yb.default)(!0,{},this.defaults,e);if(!r.url)throw new Error("URL is required.");if(r.baseURL&&(r.url=new URL(r.url,r.baseURL)),r.url=new URL(r.url),r.params)if(r.paramsSerializer){let w=r.paramsSerializer(r.params);w.startsWith("?")&&(w=w.slice(1));let C=r.url.toString().includes("?")?"&":"?";r.url=r.url+C+w}else{let w=r.url instanceof URL?r.url:new URL(r.url);for(let[C,R]of new URLSearchParams(r.params))w.searchParams.append(C,R);r.url=w}typeof e.maxContentLength=="number"&&(r.size=e.maxContentLength),typeof e.maxRedirects=="number"&&(r.follow=e.maxRedirects);let i=typeof r.data=="string"||r.data instanceof ArrayBuffer||r.data instanceof Blob||globalThis.File&&r.data instanceof File||r.data instanceof FormData||r.data instanceof Hy.Readable||r.data instanceof ReadableStream||r.data instanceof String||r.data instanceof URLSearchParams||ArrayBuffer.isView(r.data)||["Blob","File","FormData"].includes(((l=(s=r.data)==null?void 0:s.constructor)==null?void 0:l.name)||"");if((f=r.multipart)!=null&&f.length){let w=await Sb();t.set("content-type",`multipart/related; boundary=${w}`),r.body=Hy.Readable.from(this.getMultipartRequest(r.multipart,w))}else i?r.body=r.data:typeof r.data=="object"?t.get("Content-Type")==="application/x-www-form-urlencoded"?r.body=r.paramsSerializer?r.paramsSerializer(r.data):new URLSearchParams(r.data):(t.has("content-type")||t.set("content-type","application/json"),r.body=JSON.stringify(r.data)):r.data&&(r.body=r.data);r.validateStatus=r.validateStatus||this.validateStatus,r.responseType=r.responseType||"unknown",!t.has("accept")&&r.responseType==="json"&&t.set("accept","application/json");let o=r.proxy||((d=process==null?void 0:process.env)==null?void 0:d.HTTPS_PROXY)||((h=process==null?void 0:process.env)==null?void 0:h.https_proxy)||((m=process==null?void 0:process.env)==null?void 0:m.HTTP_PROXY)||((g=process==null?void 0:process.env)==null?void 0:g.http_proxy);if(!r.agent)if(o&&re(this,xt,$y).call(this,r.url,r.noProxy)){let w=await re(E=Ki,Qi,Yy).call(E);this.agentCache.has(o)?r.agent=this.agentCache.get(o):(r.agent=new w(o,{cert:r.cert,key:r.key}),this.agentCache.set(o,r.agent))}else r.cert&&r.key&&(this.agentCache.has(r.key)?r.agent=this.agentCache.get(r.key):(r.agent=new _b.Agent({cert:r.cert,key:r.key}),this.agentCache.set(r.key,r.agent)));return typeof r.errorRedactor!="function"&&r.errorRedactor!==!1&&(r.errorRedactor=jr.defaultErrorRedactor),r.body&&!("duplex"in r)&&(r.duplex="half"),re(this,xt,df).call(this,r),Object.assign(r,{headers:t,url:r.url instanceof URL?r.url:new URL(r.url)})},df=function(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}},hs=new WeakMap,ps=new WeakMap,Qi=new WeakSet,Yy=async function(){return D(this,hs)||ce(this,hs,(await Promise.resolve().then(()=>Le(Wg()))).HttpsProxyAgent),D(this,hs)},Ky=async function(){let e=typeof window!="undefined"&&!!window;return D(this,ps)||ce(this,ps,e?window.fetch:(await Promise.resolve().then(()=>(Gy(),By))).default),D(this,ps)},se(ei,Qi),se(ei,hs),se(ei,ps);Xi.Gaxios=ei;Ki=ei});var Ze=K(pt=>{"use strict";var vb=pt&&pt.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),wb=pt&&pt.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&vb(e,n,t)};Object.defineProperty(pt,"__esModule",{value:!0});pt.instance=pt.Gaxios=pt.GaxiosError=void 0;pt.request=Ab;var Qy=Xy();Object.defineProperty(pt,"Gaxios",{enumerable:!0,get:function(){return Qy.Gaxios}});var Cb=Bc();Object.defineProperty(pt,"GaxiosError",{enumerable:!0,get:function(){return Cb.GaxiosError}});wb(Vc(),pt);pt.instance=new Qy.Gaxios;async function Ab(n){return pt.instance.request(n)}});var hf=K((Zy,ja)=>{(function(n){"use strict";var e,t=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,i=Math.floor,o="[BigNumber Error] ",s=o+"Number primitive has more than 15 significant digits: ",l=1e14,f=14,d=9007199254740991,h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],m=1e7,g=1e9;function E(H){var G,Y,j,T=Z.prototype={constructor:Z,toString:null,valueOf:null},L=new Z(1),X=20,Q=4,ie=-7,ne=21,we=-1e7,_e=1e7,Re=!1,Ae=1,Fe=0,Ei={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Sn="0123456789abcdefghijklmnopqrstuvwxyz",Oo=!0;function Z(_,v){var A,U,k,M,B,I,N,F,O=this;if(!(O instanceof Z))return new Z(_,v);if(v==null){if(_&&_._isBigNumber===!0){O.s=_.s,!_.c||_.e>_e?O.c=O.e=null:_.e<we?O.c=[O.e=0]:(O.e=_.e,O.c=_.c.slice());return}if((I=typeof _=="number")&&_*0==0){if(O.s=1/_<0?(_=-_,-1):1,_===~~_){for(M=0,B=_;B>=10;B/=10,M++);M>_e?O.c=O.e=null:(O.e=M,O.c=[_]);return}F=String(_)}else{if(!t.test(F=String(_)))return j(O,F,I);O.s=F.charCodeAt(0)==45?(F=F.slice(1),-1):1}(M=F.indexOf("."))>-1&&(F=F.replace(".","")),(B=F.search(/e/i))>0?(M<0&&(M=B),M+=+F.slice(B+1),F=F.substring(0,B)):M<0&&(M=F.length)}else{if(P(v,2,Sn.length,"Base"),v==10&&Oo)return O=new Z(_),lt(O,X+O.e+1,Q);if(F=String(_),I=typeof _=="number"){if(_*0!=0)return j(O,F,I,v);if(O.s=1/_<0?(F=F.slice(1),-1):1,Z.DEBUG&&F.replace(/^0\.0*|\./,"").length>15)throw Error(s+_)}else O.s=F.charCodeAt(0)===45?(F=F.slice(1),-1):1;for(A=Sn.slice(0,v),M=B=0,N=F.length;B<N;B++)if(A.indexOf(U=F.charAt(B))<0){if(U=="."){if(B>M){M=N;continue}}else if(!k&&(F==F.toUpperCase()&&(F=F.toLowerCase())||F==F.toLowerCase()&&(F=F.toUpperCase()))){k=!0,B=-1,M=0;continue}return j(O,String(_),I,v)}I=!1,F=Y(F,v,10,O.s),(M=F.indexOf("."))>-1?F=F.replace(".",""):M=F.length}for(B=0;F.charCodeAt(B)===48;B++);for(N=F.length;F.charCodeAt(--N)===48;);if(F=F.slice(B,++N)){if(N-=B,I&&Z.DEBUG&&N>15&&(_>d||_!==i(_)))throw Error(s+O.s*_);if((M=M-B-1)>_e)O.c=O.e=null;else if(M<we)O.c=[O.e=0];else{if(O.e=M,O.c=[],B=(M+1)%f,M<0&&(B+=f),B<N){for(B&&O.c.push(+F.slice(0,B)),N-=f;B<N;)O.c.push(+F.slice(B,B+=f));B=f-(F=F.slice(B)).length}else B-=N;for(;B--;F+="0");O.c.push(+F)}}else O.c=[O.e=0]}Z.clone=E,Z.ROUND_UP=0,Z.ROUND_DOWN=1,Z.ROUND_CEIL=2,Z.ROUND_FLOOR=3,Z.ROUND_HALF_UP=4,Z.ROUND_HALF_DOWN=5,Z.ROUND_HALF_EVEN=6,Z.ROUND_HALF_CEIL=7,Z.ROUND_HALF_FLOOR=8,Z.EUCLID=9,Z.config=Z.set=function(_){var v,A;if(_!=null)if(typeof _=="object"){if(_.hasOwnProperty(v="DECIMAL_PLACES")&&(A=_[v],P(A,0,g,v),X=A),_.hasOwnProperty(v="ROUNDING_MODE")&&(A=_[v],P(A,0,8,v),Q=A),_.hasOwnProperty(v="EXPONENTIAL_AT")&&(A=_[v],A&&A.pop?(P(A[0],-g,0,v),P(A[1],0,g,v),ie=A[0],ne=A[1]):(P(A,-g,g,v),ie=-(ne=A<0?-A:A))),_.hasOwnProperty(v="RANGE"))if(A=_[v],A&&A.pop)P(A[0],-g,-1,v),P(A[1],1,g,v),we=A[0],_e=A[1];else if(P(A,-g,g,v),A)we=-(_e=A<0?-A:A);else throw Error(o+v+" cannot be zero: "+A);if(_.hasOwnProperty(v="CRYPTO"))if(A=_[v],A===!!A)if(A)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Re=A;else throw Re=!A,Error(o+"crypto unavailable");else Re=A;else throw Error(o+v+" not true or false: "+A);if(_.hasOwnProperty(v="MODULO_MODE")&&(A=_[v],P(A,0,9,v),Ae=A),_.hasOwnProperty(v="POW_PRECISION")&&(A=_[v],P(A,0,g,v),Fe=A),_.hasOwnProperty(v="FORMAT"))if(A=_[v],typeof A=="object")Ei=A;else throw Error(o+v+" not an object: "+A);if(_.hasOwnProperty(v="ALPHABET"))if(A=_[v],typeof A=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(A))Oo=A.slice(0,10)=="0123456789",Sn=A;else throw Error(o+v+" invalid: "+A)}else throw Error(o+"Object expected: "+_);return{DECIMAL_PLACES:X,ROUNDING_MODE:Q,EXPONENTIAL_AT:[ie,ne],RANGE:[we,_e],CRYPTO:Re,MODULO_MODE:Ae,POW_PRECISION:Fe,FORMAT:Ei,ALPHABET:Sn}},Z.isBigNumber=function(_){if(!_||_._isBigNumber!==!0)return!1;if(!Z.DEBUG)return!0;var v,A,U=_.c,k=_.e,M=_.s;e:if({}.toString.call(U)=="[object Array]"){if((M===1||M===-1)&&k>=-g&&k<=g&&k===i(k)){if(U[0]===0){if(k===0&&U.length===1)return!0;break e}if(v=(k+1)%f,v<1&&(v+=f),String(U[0]).length==v){for(v=0;v<U.length;v++)if(A=U[v],A<0||A>=l||A!==i(A))break e;if(A!==0)return!0}}}else if(U===null&&k===null&&(M===null||M===1||M===-1))return!0;throw Error(o+"Invalid BigNumber: "+_)},Z.maximum=Z.max=function(){return at(arguments,-1)},Z.minimum=Z.min=function(){return at(arguments,1)},Z.random=(function(){var _=9007199254740992,v=Math.random()*_&2097151?function(){return i(Math.random()*_)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(A){var U,k,M,B,I,N=0,F=[],O=new Z(L);if(A==null?A=X:P(A,0,g),B=r(A/f),Re)if(crypto.getRandomValues){for(U=crypto.getRandomValues(new Uint32Array(B*=2));N<B;)I=U[N]*131072+(U[N+1]>>>11),I>=9e15?(k=crypto.getRandomValues(new Uint32Array(2)),U[N]=k[0],U[N+1]=k[1]):(F.push(I%1e14),N+=2);N=B/2}else if(crypto.randomBytes){for(U=crypto.randomBytes(B*=7);N<B;)I=(U[N]&31)*281474976710656+U[N+1]*1099511627776+U[N+2]*4294967296+U[N+3]*16777216+(U[N+4]<<16)+(U[N+5]<<8)+U[N+6],I>=9e15?crypto.randomBytes(7).copy(U,N):(F.push(I%1e14),N+=7);N=B/7}else throw Re=!1,Error(o+"crypto unavailable");if(!Re)for(;N<B;)I=v(),I<9e15&&(F[N++]=I%1e14);for(B=F[--N],A%=f,B&&A&&(I=h[f-A],F[N]=i(B/I)*I);F[N]===0;F.pop(),N--);if(N<0)F=[M=0];else{for(M=-1;F[0]===0;F.splice(0,1),M-=f);for(N=1,I=F[0];I>=10;I/=10,N++);N<f&&(M-=f-N)}return O.e=M,O.c=F,O}})(),Z.sum=function(){for(var _=1,v=arguments,A=new Z(v[0]);_<v.length;)A=A.plus(v[_++]);return A},Y=(function(){var _="0123456789";function v(A,U,k,M){for(var B,I=[0],N,F=0,O=A.length;F<O;){for(N=I.length;N--;I[N]*=U);for(I[0]+=M.indexOf(A.charAt(F++)),B=0;B<I.length;B++)I[B]>k-1&&(I[B+1]==null&&(I[B+1]=0),I[B+1]+=I[B]/k|0,I[B]%=k)}return I.reverse()}return function(A,U,k,M,B){var I,N,F,O,J,oe,le,ve,Me=A.indexOf("."),Oe=X,Te=Q;for(Me>=0&&(O=Fe,Fe=0,A=A.replace(".",""),ve=new Z(U),oe=ve.pow(A.length-Me),Fe=O,ve.c=v(W(C(oe.c),oe.e,"0"),10,k,_),ve.e=ve.c.length),le=v(A,U,k,B?(I=Sn,_):(I=_,Sn)),F=O=le.length;le[--O]==0;le.pop());if(!le[0])return I.charAt(0);if(Me<0?--F:(oe.c=le,oe.e=F,oe.s=M,oe=G(oe,ve,Oe,Te,k),le=oe.c,J=oe.r,F=oe.e),N=F+Oe+1,Me=le[N],O=k/2,J=J||N<0||le[N+1]!=null,J=Te<4?(Me!=null||J)&&(Te==0||Te==(oe.s<0?3:2)):Me>O||Me==O&&(Te==4||J||Te==6&&le[N-1]&1||Te==(oe.s<0?8:7)),N<1||!le[0])A=J?W(I.charAt(1),-Oe,I.charAt(0)):I.charAt(0);else{if(le.length=N,J)for(--k;++le[--N]>k;)le[N]=0,N||(++F,le=[1].concat(le));for(O=le.length;!le[--O];);for(Me=0,A="";Me<=O;A+=I.charAt(le[Me++]));A=W(A,F,I.charAt(0))}return A}})(),G=(function(){function _(U,k,M){var B,I,N,F,O=0,J=U.length,oe=k%m,le=k/m|0;for(U=U.slice();J--;)N=U[J]%m,F=U[J]/m|0,B=le*N+F*oe,I=oe*N+B%m*m+O,O=(I/M|0)+(B/m|0)+le*F,U[J]=I%M;return O&&(U=[O].concat(U)),U}function v(U,k,M,B){var I,N;if(M!=B)N=M>B?1:-1;else for(I=N=0;I<M;I++)if(U[I]!=k[I]){N=U[I]>k[I]?1:-1;break}return N}function A(U,k,M,B){for(var I=0;M--;)U[M]-=I,I=U[M]<k[M]?1:0,U[M]=I*B+U[M]-k[M];for(;!U[0]&&U.length>1;U.splice(0,1));}return function(U,k,M,B,I){var N,F,O,J,oe,le,ve,Me,Oe,Te,be,We,Si,Ti,vi,wt,Bn,je=U.s==k.s?1:-1,ze=U.c,Ie=k.c;if(!ze||!ze[0]||!Ie||!Ie[0])return new Z(!U.s||!k.s||(ze?Ie&&ze[0]==Ie[0]:!Ie)?NaN:ze&&ze[0]==0||!Ie?je*0:je/0);for(Me=new Z(je),Oe=Me.c=[],F=U.e-k.e,je=M+F+1,I||(I=l,F=w(U.e/f)-w(k.e/f),je=je/f|0),O=0;Ie[O]==(ze[O]||0);O++);if(Ie[O]>(ze[O]||0)&&F--,je<0)Oe.push(1),J=!0;else{for(Ti=ze.length,wt=Ie.length,O=0,je+=2,oe=i(I/(Ie[0]+1)),oe>1&&(Ie=_(Ie,oe,I),ze=_(ze,oe,I),wt=Ie.length,Ti=ze.length),Si=wt,Te=ze.slice(0,wt),be=Te.length;be<wt;Te[be++]=0);Bn=Ie.slice(),Bn=[0].concat(Bn),vi=Ie[0],Ie[1]>=I/2&&vi++;do{if(oe=0,N=v(Ie,Te,wt,be),N<0){if(We=Te[0],wt!=be&&(We=We*I+(Te[1]||0)),oe=i(We/vi),oe>1)for(oe>=I&&(oe=I-1),le=_(Ie,oe,I),ve=le.length,be=Te.length;v(le,Te,ve,be)==1;)oe--,A(le,wt<ve?Bn:Ie,ve,I),ve=le.length,N=1;else oe==0&&(N=oe=1),le=Ie.slice(),ve=le.length;if(ve<be&&(le=[0].concat(le)),A(Te,le,be,I),be=Te.length,N==-1)for(;v(Ie,Te,wt,be)<1;)oe++,A(Te,wt<be?Bn:Ie,be,I),be=Te.length}else N===0&&(oe++,Te=[0]);Oe[O++]=oe,Te[0]?Te[be++]=ze[Si]||0:(Te=[ze[Si]],be=1)}while((Si++<Ti||Te[0]!=null)&&je--);J=Te[0]!=null,Oe[0]||Oe.splice(0,1)}if(I==l){for(O=1,je=Oe[0];je>=10;je/=10,O++);lt(Me,M+(Me.e=O+F*f-1)+1,B,J)}else Me.e=F,Me.r=+J;return Me}})();function yt(_,v,A,U){var k,M,B,I,N;if(A==null?A=Q:P(A,0,8),!_.c)return _.toString();if(k=_.c[0],B=_.e,v==null)N=C(_.c),N=U==1||U==2&&(B<=ie||B>=ne)?$(N,B):W(N,B,"0");else if(_=lt(new Z(_),v,A),M=_.e,N=C(_.c),I=N.length,U==1||U==2&&(v<=M||M<=ie)){for(;I<v;N+="0",I++);N=$(N,M)}else if(v-=B+(U===2&&M>B),N=W(N,M,"0"),M+1>I){if(--v>0)for(N+=".";v--;N+="0");}else if(v+=M-I,v>0)for(M+1==I&&(N+=".");v--;N+="0");return _.s<0&&k?"-"+N:N}function at(_,v){for(var A,U,k=1,M=new Z(_[0]);k<_.length;k++)U=new Z(_[k]),(!U.s||(A=R(M,U))===v||A===0&&M.s===v)&&(M=U);return M}function Uo(_,v,A){for(var U=1,k=v.length;!v[--k];v.pop());for(k=v[0];k>=10;k/=10,U++);return(A=U+A*f-1)>_e?_.c=_.e=null:A<we?_.c=[_.e=0]:(_.e=A,_.c=v),_}j=(function(){var _=/^(-?)0([xbo])(?=\w[\w.]*$)/i,v=/^([^.]+)\.$/,A=/^\.([^.]+)$/,U=/^-?(Infinity|NaN)$/,k=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(M,B,I,N){var F,O=I?B:B.replace(k,"");if(U.test(O))M.s=isNaN(O)?null:O<0?-1:1;else{if(!I&&(O=O.replace(_,function(J,oe,le){return F=(le=le.toLowerCase())=="x"?16:le=="b"?2:8,!N||N==F?oe:J}),N&&(F=N,O=O.replace(v,"$1").replace(A,"0.$1")),B!=O))return new Z(O,F);if(Z.DEBUG)throw Error(o+"Not a"+(N?" base "+N:"")+" number: "+B);M.s=null}M.c=M.e=null}})();function lt(_,v,A,U){var k,M,B,I,N,F,O,J=_.c,oe=h;if(J){e:{for(k=1,I=J[0];I>=10;I/=10,k++);if(M=v-k,M<0)M+=f,B=v,N=J[F=0],O=i(N/oe[k-B-1]%10);else if(F=r((M+1)/f),F>=J.length)if(U){for(;J.length<=F;J.push(0));N=O=0,k=1,M%=f,B=M-f+1}else break e;else{for(N=I=J[F],k=1;I>=10;I/=10,k++);M%=f,B=M-f+k,O=B<0?0:i(N/oe[k-B-1]%10)}if(U=U||v<0||J[F+1]!=null||(B<0?N:N%oe[k-B-1]),U=A<4?(O||U)&&(A==0||A==(_.s<0?3:2)):O>5||O==5&&(A==4||U||A==6&&(M>0?B>0?N/oe[k-B]:0:J[F-1])%10&1||A==(_.s<0?8:7)),v<1||!J[0])return J.length=0,U?(v-=_.e+1,J[0]=oe[(f-v%f)%f],_.e=-v||0):J[0]=_.e=0,_;if(M==0?(J.length=F,I=1,F--):(J.length=F+1,I=oe[f-M],J[F]=B>0?i(N/oe[k-B]%oe[B])*I:0),U)for(;;)if(F==0){for(M=1,B=J[0];B>=10;B/=10,M++);for(B=J[0]+=I,I=1;B>=10;B/=10,I++);M!=I&&(_.e++,J[0]==l&&(J[0]=1));break}else{if(J[F]+=I,J[F]!=l)break;J[F--]=0,I=1}for(M=J.length;J[--M]===0;J.pop());}_.e>_e?_.c=_.e=null:_.e<we&&(_.c=[_.e=0])}return _}function $e(_){var v,A=_.e;return A===null?_.toString():(v=C(_.c),v=A<=ie||A>=ne?$(v,A):W(v,A,"0"),_.s<0?"-"+v:v)}return T.absoluteValue=T.abs=function(){var _=new Z(this);return _.s<0&&(_.s=1),_},T.comparedTo=function(_,v){return R(this,new Z(_,v))},T.decimalPlaces=T.dp=function(_,v){var A,U,k,M=this;if(_!=null)return P(_,0,g),v==null?v=Q:P(v,0,8),lt(new Z(M),_+M.e+1,v);if(!(A=M.c))return null;if(U=((k=A.length-1)-w(this.e/f))*f,k=A[k])for(;k%10==0;k/=10,U--);return U<0&&(U=0),U},T.dividedBy=T.div=function(_,v){return G(this,new Z(_,v),X,Q)},T.dividedToIntegerBy=T.idiv=function(_,v){return G(this,new Z(_,v),0,1)},T.exponentiatedBy=T.pow=function(_,v){var A,U,k,M,B,I,N,F,O,J=this;if(_=new Z(_),_.c&&!_.isInteger())throw Error(o+"Exponent not an integer: "+$e(_));if(v!=null&&(v=new Z(v)),I=_.e>14,!J.c||!J.c[0]||J.c[0]==1&&!J.e&&J.c.length==1||!_.c||!_.c[0])return O=new Z(Math.pow(+$e(J),I?_.s*(2-z(_)):+$e(_))),v?O.mod(v):O;if(N=_.s<0,v){if(v.c?!v.c[0]:!v.s)return new Z(NaN);U=!N&&J.isInteger()&&v.isInteger(),U&&(J=J.mod(v))}else{if(_.e>9&&(J.e>0||J.e<-1||(J.e==0?J.c[0]>1||I&&J.c[1]>=24e7:J.c[0]<8e13||I&&J.c[0]<=9999975e7)))return M=J.s<0&&z(_)?-0:0,J.e>-1&&(M=1/M),new Z(N?1/M:M);Fe&&(M=r(Fe/f+2))}for(I?(A=new Z(.5),N&&(_.s=1),F=z(_)):(k=Math.abs(+$e(_)),F=k%2),O=new Z(L);;){if(F){if(O=O.times(J),!O.c)break;M?O.c.length>M&&(O.c.length=M):U&&(O=O.mod(v))}if(k){if(k=i(k/2),k===0)break;F=k%2}else if(_=_.times(A),lt(_,_.e+1,1),_.e>14)F=z(_);else{if(k=+$e(_),k===0)break;F=k%2}J=J.times(J),M?J.c&&J.c.length>M&&(J.c.length=M):U&&(J=J.mod(v))}return U?O:(N&&(O=L.div(O)),v?O.mod(v):M?lt(O,Fe,Q,B):O)},T.integerValue=function(_){var v=new Z(this);return _==null?_=Q:P(_,0,8),lt(v,v.e+1,_)},T.isEqualTo=T.eq=function(_,v){return R(this,new Z(_,v))===0},T.isFinite=function(){return!!this.c},T.isGreaterThan=T.gt=function(_,v){return R(this,new Z(_,v))>0},T.isGreaterThanOrEqualTo=T.gte=function(_,v){return(v=R(this,new Z(_,v)))===1||v===0},T.isInteger=function(){return!!this.c&&w(this.e/f)>this.c.length-2},T.isLessThan=T.lt=function(_,v){return R(this,new Z(_,v))<0},T.isLessThanOrEqualTo=T.lte=function(_,v){return(v=R(this,new Z(_,v)))===-1||v===0},T.isNaN=function(){return!this.s},T.isNegative=function(){return this.s<0},T.isPositive=function(){return this.s>0},T.isZero=function(){return!!this.c&&this.c[0]==0},T.minus=function(_,v){var A,U,k,M,B=this,I=B.s;if(_=new Z(_,v),v=_.s,!I||!v)return new Z(NaN);if(I!=v)return _.s=-v,B.plus(_);var N=B.e/f,F=_.e/f,O=B.c,J=_.c;if(!N||!F){if(!O||!J)return O?(_.s=-v,_):new Z(J?B:NaN);if(!O[0]||!J[0])return J[0]?(_.s=-v,_):new Z(O[0]?B:Q==3?-0:0)}if(N=w(N),F=w(F),O=O.slice(),I=N-F){for((M=I<0)?(I=-I,k=O):(F=N,k=J),k.reverse(),v=I;v--;k.push(0));k.reverse()}else for(U=(M=(I=O.length)<(v=J.length))?I:v,I=v=0;v<U;v++)if(O[v]!=J[v]){M=O[v]<J[v];break}if(M&&(k=O,O=J,J=k,_.s=-_.s),v=(U=J.length)-(A=O.length),v>0)for(;v--;O[A++]=0);for(v=l-1;U>I;){if(O[--U]<J[U]){for(A=U;A&&!O[--A];O[A]=v);--O[A],O[U]+=l}O[U]-=J[U]}for(;O[0]==0;O.splice(0,1),--F);return O[0]?Uo(_,O,F):(_.s=Q==3?-1:1,_.c=[_.e=0],_)},T.modulo=T.mod=function(_,v){var A,U,k=this;return _=new Z(_,v),!k.c||!_.s||_.c&&!_.c[0]?new Z(NaN):!_.c||k.c&&!k.c[0]?new Z(k):(Ae==9?(U=_.s,_.s=1,A=G(k,_,0,3),_.s=U,A.s*=U):A=G(k,_,0,Ae),_=k.minus(A.times(_)),!_.c[0]&&Ae==1&&(_.s=k.s),_)},T.multipliedBy=T.times=function(_,v){var A,U,k,M,B,I,N,F,O,J,oe,le,ve,Me,Oe,Te=this,be=Te.c,We=(_=new Z(_,v)).c;if(!be||!We||!be[0]||!We[0])return!Te.s||!_.s||be&&!be[0]&&!We||We&&!We[0]&&!be?_.c=_.e=_.s=null:(_.s*=Te.s,!be||!We?_.c=_.e=null:(_.c=[0],_.e=0)),_;for(U=w(Te.e/f)+w(_.e/f),_.s*=Te.s,N=be.length,J=We.length,N<J&&(ve=be,be=We,We=ve,k=N,N=J,J=k),k=N+J,ve=[];k--;ve.push(0));for(Me=l,Oe=m,k=J;--k>=0;){for(A=0,oe=We[k]%Oe,le=We[k]/Oe|0,B=N,M=k+B;M>k;)F=be[--B]%Oe,O=be[B]/Oe|0,I=le*F+O*oe,F=oe*F+I%Oe*Oe+ve[M]+A,A=(F/Me|0)+(I/Oe|0)+le*O,ve[M--]=F%Me;ve[M]=A}return A?++U:ve.splice(0,1),Uo(_,ve,U)},T.negated=function(){var _=new Z(this);return _.s=-_.s||null,_},T.plus=function(_,v){var A,U=this,k=U.s;if(_=new Z(_,v),v=_.s,!k||!v)return new Z(NaN);if(k!=v)return _.s=-v,U.minus(_);var M=U.e/f,B=_.e/f,I=U.c,N=_.c;if(!M||!B){if(!I||!N)return new Z(k/0);if(!I[0]||!N[0])return N[0]?_:new Z(I[0]?U:k*0)}if(M=w(M),B=w(B),I=I.slice(),k=M-B){for(k>0?(B=M,A=N):(k=-k,A=I),A.reverse();k--;A.push(0));A.reverse()}for(k=I.length,v=N.length,k-v<0&&(A=N,N=I,I=A,v=k),k=0;v;)k=(I[--v]=I[v]+N[v]+k)/l|0,I[v]=l===I[v]?0:I[v]%l;return k&&(I=[k].concat(I),++B),Uo(_,I,B)},T.precision=T.sd=function(_,v){var A,U,k,M=this;if(_!=null&&_!==!!_)return P(_,1,g),v==null?v=Q:P(v,0,8),lt(new Z(M),_,v);if(!(A=M.c))return null;if(k=A.length-1,U=k*f+1,k=A[k]){for(;k%10==0;k/=10,U--);for(k=A[0];k>=10;k/=10,U++);}return _&&M.e+1>U&&(U=M.e+1),U},T.shiftedBy=function(_){return P(_,-d,d),this.times("1e"+_)},T.squareRoot=T.sqrt=function(){var _,v,A,U,k,M=this,B=M.c,I=M.s,N=M.e,F=X+4,O=new Z("0.5");if(I!==1||!B||!B[0])return new Z(!I||I<0&&(!B||B[0])?NaN:B?M:1/0);if(I=Math.sqrt(+$e(M)),I==0||I==1/0?(v=C(B),(v.length+N)%2==0&&(v+="0"),I=Math.sqrt(+v),N=w((N+1)/2)-(N<0||N%2),I==1/0?v="5e"+N:(v=I.toExponential(),v=v.slice(0,v.indexOf("e")+1)+N),A=new Z(v)):A=new Z(I+""),A.c[0]){for(N=A.e,I=N+F,I<3&&(I=0);;)if(k=A,A=O.times(k.plus(G(M,k,F,1))),C(k.c).slice(0,I)===(v=C(A.c)).slice(0,I))if(A.e<N&&--I,v=v.slice(I-3,I+1),v=="9999"||!U&&v=="4999"){if(!U&&(lt(k,k.e+X+2,0),k.times(k).eq(M))){A=k;break}F+=4,I+=4,U=1}else{(!+v||!+v.slice(1)&&v.charAt(0)=="5")&&(lt(A,A.e+X+2,1),_=!A.times(A).eq(M));break}}return lt(A,A.e+X+1,Q,_)},T.toExponential=function(_,v){return _!=null&&(P(_,0,g),_++),yt(this,_,v,1)},T.toFixed=function(_,v){return _!=null&&(P(_,0,g),_=_+this.e+1),yt(this,_,v)},T.toFormat=function(_,v,A){var U,k=this;if(A==null)_!=null&&v&&typeof v=="object"?(A=v,v=null):_&&typeof _=="object"?(A=_,_=v=null):A=Ei;else if(typeof A!="object")throw Error(o+"Argument not an object: "+A);if(U=k.toFixed(_,v),k.c){var M,B=U.split("."),I=+A.groupSize,N=+A.secondaryGroupSize,F=A.groupSeparator||"",O=B[0],J=B[1],oe=k.s<0,le=oe?O.slice(1):O,ve=le.length;if(N&&(M=I,I=N,N=M,ve-=M),I>0&&ve>0){for(M=ve%I||I,O=le.substr(0,M);M<ve;M+=I)O+=F+le.substr(M,I);N>0&&(O+=F+le.slice(M)),oe&&(O="-"+O)}U=J?O+(A.decimalSeparator||"")+((N=+A.fractionGroupSize)?J.replace(new RegExp("\\d{"+N+"}\\B","g"),"$&"+(A.fractionGroupSeparator||"")):J):O}return(A.prefix||"")+U+(A.suffix||"")},T.toFraction=function(_){var v,A,U,k,M,B,I,N,F,O,J,oe,le=this,ve=le.c;if(_!=null&&(I=new Z(_),!I.isInteger()&&(I.c||I.s!==1)||I.lt(L)))throw Error(o+"Argument "+(I.isInteger()?"out of range: ":"not an integer: ")+$e(I));if(!ve)return new Z(le);for(v=new Z(L),F=A=new Z(L),U=N=new Z(L),oe=C(ve),M=v.e=oe.length-le.e-1,v.c[0]=h[(B=M%f)<0?f+B:B],_=!_||I.comparedTo(v)>0?M>0?v:F:I,B=_e,_e=1/0,I=new Z(oe),N.c[0]=0;O=G(I,v,0,1),k=A.plus(O.times(U)),k.comparedTo(_)!=1;)A=U,U=k,F=N.plus(O.times(k=F)),N=k,v=I.minus(O.times(k=v)),I=k;return k=G(_.minus(A),U,0,1),N=N.plus(k.times(F)),A=A.plus(k.times(U)),N.s=F.s=le.s,M=M*2,J=G(F,U,M,Q).minus(le).abs().comparedTo(G(N,A,M,Q).minus(le).abs())<1?[F,U]:[N,A],_e=B,J},T.toNumber=function(){return+$e(this)},T.toPrecision=function(_,v){return _!=null&&P(_,1,g),yt(this,_,v,2)},T.toString=function(_){var v,A=this,U=A.s,k=A.e;return k===null?U?(v="Infinity",U<0&&(v="-"+v)):v="NaN":(_==null?v=k<=ie||k>=ne?$(C(A.c),k):W(C(A.c),k,"0"):_===10&&Oo?(A=lt(new Z(A),X+k+1,Q),v=W(C(A.c),A.e,"0")):(P(_,2,Sn.length,"Base"),v=Y(W(C(A.c),k,"0"),10,_,U,!0)),U<0&&A.c[0]&&(v="-"+v)),v},T.valueOf=T.toJSON=function(){return $e(this)},T._isBigNumber=!0,H!=null&&Z.set(H),Z}function w(H){var G=H|0;return H>0||H===G?G:G-1}function C(H){for(var G,Y,j=1,T=H.length,L=H[0]+"";j<T;){for(G=H[j++]+"",Y=f-G.length;Y--;G="0"+G);L+=G}for(T=L.length;L.charCodeAt(--T)===48;);return L.slice(0,T+1||1)}function R(H,G){var Y,j,T=H.c,L=G.c,X=H.s,Q=G.s,ie=H.e,ne=G.e;if(!X||!Q)return null;if(Y=T&&!T[0],j=L&&!L[0],Y||j)return Y?j?0:-Q:X;if(X!=Q)return X;if(Y=X<0,j=ie==ne,!T||!L)return j?0:!T^Y?1:-1;if(!j)return ie>ne^Y?1:-1;for(Q=(ie=T.length)<(ne=L.length)?ie:ne,X=0;X<Q;X++)if(T[X]!=L[X])return T[X]>L[X]^Y?1:-1;return ie==ne?0:ie>ne^Y?1:-1}function P(H,G,Y,j){if(H<G||H>Y||H!==i(H))throw Error(o+(j||"Argument")+(typeof H=="number"?H<G||H>Y?" out of range: ":" not an integer: ":" not a primitive number: ")+String(H))}function z(H){var G=H.c.length-1;return w(H.e/f)==G&&H.c[G]%2!=0}function $(H,G){return(H.length>1?H.charAt(0)+"."+H.slice(1):H)+(G<0?"e":"e+")+G}function W(H,G,Y){var j,T;if(G<0){for(T=Y+".";++G;T+=Y);H=T+H}else if(j=H.length,++G>j){for(T=Y,G-=j;--G;T+=Y);H+=T}else G<j&&(H=H.slice(0,G)+"."+H.slice(G));return H}e=E(),e.default=e.BigNumber=e,typeof define=="function"&&define.amd?define(function(){return e}):typeof ja!="undefined"&&ja.exports?ja.exports=e:(n||(n=typeof self!="undefined"&&self?self:window),n.BigNumber=e)})(Zy)});var n_=K((M1,t_)=>{var jy=hf(),e_=t_.exports;(function(){"use strict";function n(d){return d<10?"0"+d:d}var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r,i,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},s;function l(d){return t.lastIndex=0,t.test(d)?'"'+d.replace(t,function(h){var m=o[h];return typeof m=="string"?m:"\\u"+("0000"+h.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+d+'"'}function f(d,h){var m,g,E,w,C=r,R,P=h[d],z=P!=null&&(P instanceof jy||jy.isBigNumber(P));switch(P&&typeof P=="object"&&typeof P.toJSON=="function"&&(P=P.toJSON(d)),typeof s=="function"&&(P=s.call(h,d,P)),typeof P){case"string":return z?P:l(P);case"number":return isFinite(P)?String(P):"null";case"boolean":case"null":case"bigint":return String(P);case"object":if(!P)return"null";if(r+=i,R=[],Object.prototype.toString.apply(P)==="[object Array]"){for(w=P.length,m=0;m<w;m+=1)R[m]=f(m,P)||"null";return E=R.length===0?"[]":r?`[
`+r+R.join(`,
`+r)+`
`+C+"]":"["+R.join(",")+"]",r=C,E}if(s&&typeof s=="object")for(w=s.length,m=0;m<w;m+=1)typeof s[m]=="string"&&(g=s[m],E=f(g,P),E&&R.push(l(g)+(r?": ":":")+E));else Object.keys(P).forEach(function($){var W=f($,P);W&&R.push(l($)+(r?": ":":")+W)});return E=R.length===0?"{}":r?`{
`+r+R.join(`,
`+r)+`
`+C+"}":"{"+R.join(",")+"}",r=C,E}}typeof e_.stringify!="function"&&(e_.stringify=function(d,h,m){var g;if(r="",i="",typeof m=="number")for(g=0;g<m;g+=1)i+=" ";else typeof m=="string"&&(i=m);if(s=h,h&&typeof h!="function"&&(typeof h!="object"||typeof h.length!="number"))throw new Error("JSON.stringify");return f("",{"":d})})})()});var i_=K((D1,r_)=>{var el=null,bb=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,Rb=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/,Ib=function(n){"use strict";var e={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(n!=null){if(n.strict===!0&&(e.strict=!0),n.storeAsString===!0&&(e.storeAsString=!0),e.alwaysParseAsBig=n.alwaysParseAsBig===!0?n.alwaysParseAsBig:!1,e.useNativeBigInt=n.useNativeBigInt===!0?n.useNativeBigInt:!1,typeof n.constructorAction!="undefined")if(n.constructorAction==="error"||n.constructorAction==="ignore"||n.constructorAction==="preserve")e.constructorAction=n.constructorAction;else throw new Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${n.constructorAction}`);if(typeof n.protoAction!="undefined")if(n.protoAction==="error"||n.protoAction==="ignore"||n.protoAction==="preserve")e.protoAction=n.protoAction;else throw new Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${n.protoAction}`)}var t,r,i={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},o,s=function(C){throw{name:"SyntaxError",message:C,at:t,text:o}},l=function(C){return C&&C!==r&&s("Expected '"+C+"' instead of '"+r+"'"),r=o.charAt(t),t+=1,r},f=function(){var C,R="";for(r==="-"&&(R="-",l("-"));r>="0"&&r<="9";)R+=r,l();if(r===".")for(R+=".";l()&&r>="0"&&r<="9";)R+=r;if(r==="e"||r==="E")for(R+=r,l(),(r==="-"||r==="+")&&(R+=r,l());r>="0"&&r<="9";)R+=r,l();if(C=+R,!isFinite(C))s("Bad number");else return el==null&&(el=hf()),R.length>15?e.storeAsString?R:e.useNativeBigInt?BigInt(R):new el(R):e.alwaysParseAsBig?e.useNativeBigInt?BigInt(C):new el(C):C},d=function(){var C,R,P="",z;if(r==='"')for(var $=t;l();){if(r==='"')return t-1>$&&(P+=o.substring($,t-1)),l(),P;if(r==="\\"){if(t-1>$&&(P+=o.substring($,t-1)),l(),r==="u"){for(z=0,R=0;R<4&&(C=parseInt(l(),16),!!isFinite(C));R+=1)z=z*16+C;P+=String.fromCharCode(z)}else if(typeof i[r]=="string")P+=i[r];else break;$=t}}s("Bad string")},h=function(){for(;r&&r<=" ";)l()},m=function(){switch(r){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}s("Unexpected '"+r+"'")},g,E=function(){var C=[];if(r==="["){if(l("["),h(),r==="]")return l("]"),C;for(;r;){if(C.push(g()),h(),r==="]")return l("]"),C;l(","),h()}}s("Bad array")},w=function(){var C,R=Object.create(null);if(r==="{"){if(l("{"),h(),r==="}")return l("}"),R;for(;r;){if(C=d(),h(),l(":"),e.strict===!0&&Object.hasOwnProperty.call(R,C)&&s('Duplicate key "'+C+'"'),bb.test(C)===!0?e.protoAction==="error"?s("Object contains forbidden prototype property"):e.protoAction==="ignore"?g():R[C]=g():Rb.test(C)===!0?e.constructorAction==="error"?s("Object contains forbidden constructor property"):e.constructorAction==="ignore"?g():R[C]=g():R[C]=g(),h(),r==="}")return l("}"),R;l(","),h()}}s("Bad object")};return g=function(){switch(h(),r){case"{":return w();case"[":return E();case'"':return d();case"-":return f();default:return r>="0"&&r<="9"?f():m()}},function(C,R){var P;return o=C+"",t=0,r=" ",P=g(),h(),r&&s("Syntax error"),typeof R=="function"?(function z($,W){var H,G,Y=$[W];return Y&&typeof Y=="object"&&Object.keys(Y).forEach(function(j){G=z(Y,j),G!==void 0?Y[j]=G:delete Y[j]}),R.call($,W,Y)})({"":P},""):P}};r_.exports=Ib});var a_=K((O1,tl)=>{var o_=n_().stringify,s_=i_();tl.exports=function(n){return{parse:s_(n),stringify:o_}};tl.exports.parse=s_();tl.exports.stringify=o_});var pf=K(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});cn.GCE_LINUX_BIOS_PATHS=void 0;cn.isGoogleCloudServerless=c_;cn.isGoogleComputeEngineLinux=f_;cn.isGoogleComputeEngineMACAddress=d_;cn.isGoogleComputeEngine=h_;cn.detectGCPResidency=xb;var l_=require("fs"),u_=require("os");cn.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};var Pb=/^42:01/;function c_(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function f_(){if((0,u_.platform)()!=="linux")return!1;try{(0,l_.statSync)(cn.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let n=(0,l_.readFileSync)(cn.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(n)}catch(n){return!1}}function d_(){let n=(0,u_.networkInterfaces)();for(let e of Object.values(n))if(e){for(let{mac:t}of e)if(Pb.test(t))return!0}return!1}function h_(){return f_()||d_()}function xb(){return c_()||h_()}});var p_=K(nl=>{"use strict";Object.defineProperty(nl,"__esModule",{value:!0});nl.Colours=void 0;var rt=class n{static isEnabled(e){return e&&e.isTTY&&(typeof e.getColorDepth=="function"?e.getColorDepth()>2:!0)}static refresh(){n.enabled=n.isEnabled(process==null?void 0:process.stderr),this.enabled?(n.reset="\x1B[0m",n.bright="\x1B[1m",n.dim="\x1B[2m",n.red="\x1B[31m",n.green="\x1B[32m",n.yellow="\x1B[33m",n.blue="\x1B[34m",n.magenta="\x1B[35m",n.cyan="\x1B[36m",n.white="\x1B[37m",n.grey="\x1B[90m"):(n.reset="",n.bright="",n.dim="",n.red="",n.green="",n.yellow="",n.blue="",n.magenta="",n.cyan="",n.white="",n.grey="")}};nl.Colours=rt;rt.enabled=!1;rt.reset="";rt.bright="";rt.dim="";rt.red="";rt.green="";rt.yellow="";rt.blue="";rt.magenta="";rt.cyan="";rt.white="";rt.grey="";rt.refresh()});var __=K(Pe=>{"use strict";var kb=Pe&&Pe.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),Nb=Pe&&Pe.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),m_=Pe&&Pe.__importStar||(function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&kb(t,e,r[i]);return Nb(t,e),t}})();Object.defineProperty(Pe,"__esModule",{value:!0});Pe.env=Pe.DebugLogBackendBase=Pe.placeholder=Pe.AdhocDebugLogger=Pe.LogSeverity=void 0;Pe.getNodeBackend=gf;Pe.getDebugBackend=Db;Pe.getStructuredBackend=Ob;Pe.setBackend=Ub;Pe.log=y_;var Mb=require("events"),ms=m_(require("process")),g_=m_(require("util")),kt=p_(),fn;(function(n){n.DEFAULT="DEFAULT",n.DEBUG="DEBUG",n.INFO="INFO",n.WARNING="WARNING",n.ERROR="ERROR"})(fn||(Pe.LogSeverity=fn={}));var gs=class extends Mb.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(r,i)=>this.on(r,i)}),this.func.debug=(...r)=>this.invokeSeverity(fn.DEBUG,...r),this.func.info=(...r)=>this.invokeSeverity(fn.INFO,...r),this.func.warn=(...r)=>this.invokeSeverity(fn.WARNING,...r),this.func.error=(...r)=>this.invokeSeverity(fn.ERROR,...r),this.func.sublog=r=>y_(r,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch(r){}try{this.emit("log",e,t)}catch(r){}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}};Pe.AdhocDebugLogger=gs;Pe.placeholder=new gs("",()=>{}).func;var Zi=class{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let t=(e=ms.env[Pe.env.nodeEnables])!==null&&e!==void 0?e:"*";t==="all"&&(t="*"),this.filters=t.split(",")}log(e,t,...r){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let i=this.cached.get(e);i||(i=this.makeLogger(e),this.cached.set(e,i)),i(t,...r)}catch(i){console.error(i)}}};Pe.DebugLogBackendBase=Zi;var mf=class extends Zi{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...r)=>{var i;let o=`${kt.Colours.green}${e}${kt.Colours.reset}`,s=`${kt.Colours.yellow}${ms.pid}${kt.Colours.reset}`,l;switch(t.severity){case fn.ERROR:l=`${kt.Colours.red}${t.severity}${kt.Colours.reset}`;break;case fn.INFO:l=`${kt.Colours.magenta}${t.severity}${kt.Colours.reset}`;break;case fn.WARNING:l=`${kt.Colours.yellow}${t.severity}${kt.Colours.reset}`;break;default:l=(i=t.severity)!==null&&i!==void 0?i:fn.DEFAULT;break}let f=g_.formatWithOptions({colors:kt.Colours.enabled},...r),d=Object.assign({},t);delete d.severity;let h=Object.getOwnPropertyNames(d).length?JSON.stringify(d):"",m=h?`${kt.Colours.grey}${h}${kt.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",s,o,l,f,h?` ${m}`:"")}:()=>{}}setFilters(){let t=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=new RegExp(`^${t}$`,"i")}};function gf(){return new mf}var yf=class extends Zi{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(r,...i)=>{t(i[0],...i.slice(1))}}setFilters(){var e;let t=(e=ms.env.NODE_DEBUG)!==null&&e!==void 0?e:"";ms.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}};function Db(n){return new yf(n)}var _f=class extends Zi{constructor(e){var t;super(),this.upstream=(t=e)!==null&&t!==void 0?t:void 0}makeLogger(e){var t;let r=(t=this.upstream)===null||t===void 0?void 0:t.makeLogger(e);return(i,...o)=>{var s;let l=(s=i.severity)!==null&&s!==void 0?s:fn.INFO,f=Object.assign({severity:l,message:g_.format(...o)},i),d=JSON.stringify(f);r?r(i,d):console.log("%s",d)}}setFilters(){var e;(e=this.upstream)===null||e===void 0||e.setFilters()}};function Ob(n){return new _f(n)}Pe.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};var Ef=new Map,Nt;function Ub(n){Nt=n,Ef.clear()}function y_(n,e){if(!Nt&&!ms.env[Pe.env.nodeEnables]||!n)return Pe.placeholder;e&&(n=`${e.instance.namespace}:${n}`);let t=Ef.get(n);if(t)return t.func;if(Nt===null)return Pe.placeholder;Nt===void 0&&(Nt=gf());let r=(()=>{let i;return new gs(n,(s,...l)=>{if(i!==Nt){if(Nt===null)return;Nt===void 0&&(Nt=gf()),i=Nt}Nt==null||Nt.log(n,s,...l)})})();return Ef.set(n,r),r.func}});var Sf=K(ti=>{"use strict";var Fb=ti&&ti.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),Lb=ti&&ti.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Fb(e,n,t)};Object.defineProperty(ti,"__esModule",{value:!0});Lb(__(),ti)});var _s=K(me=>{"use strict";var S_=me&&me.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),qb=me&&me.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),Bb=me&&me.__importStar||(function(){var n=function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&S_(t,e,r[i]);return qb(t,e),t}})(),Gb=me&&me.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&S_(e,n,t)};Object.defineProperty(me,"__esModule",{value:!0});me.gcpResidencyCache=me.METADATA_SERVER_DETECTION=me.HEADERS=me.HEADER_VALUE=me.HEADER_NAME=me.SECONDARY_HOST_ADDRESS=me.HOST_ADDRESS=me.BASE_PATH=void 0;me.instance=Jb;me.project=Yb;me.universe=Kb;me.bulk=Xb;me.isAvailable=Zb;me.resetIsAvailableCache=jb;me.getGCPResidency=wf;me.setGCPResidency=T_;me.requestTimeout=v_;var Tf=Ze(),Hb=a_(),Vb=pf(),$b=Bb(Sf());me.BASE_PATH="/computeMetadata/v1";me.HOST_ADDRESS="http://169.254.169.254";me.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.";me.HEADER_NAME="Metadata-Flavor";me.HEADER_VALUE="Google";me.HEADERS=Object.freeze({[me.HEADER_NAME]:me.HEADER_VALUE});var E_=$b.log("gcp-metadata");me.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"});function vf(n){return n||(n=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||me.HOST_ADDRESS),/^https?:\/\//.test(n)||(n=`http://${n}`),new URL(me.BASE_PATH,n).href}function Wb(n){Object.keys(n).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw new Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw new Error(`'${e}' is not a valid configuration option.`)}})}async function ys(n,e={},t=3,r=!1){let i=new Headers(me.HEADERS),o="",s={};if(typeof n=="object"){let m=n;new Headers(m.headers).forEach((g,E)=>i.set(E,g)),o=m.metadataKey,s=m.params||s,t=m.noResponseRetries||t,r=m.fastFail||r}else o=n;typeof e=="string"?o+=`/${e}`:(Wb(e),e.property&&(o+=`/${e.property}`),new Headers(e.headers).forEach((m,g)=>i.set(g,m)),s=e.params||s);let l=r?zb:Tf.request,f={url:`${vf()}/${o}`,headers:i,retryConfig:{noResponseRetries:t},params:s,responseType:"text",timeout:v_()};E_.info("instance request %j",f);let d=await l(f);E_.info("instance metadata is %s",d.data);let h=d.headers.get(me.HEADER_NAME);if(h!==me.HEADER_VALUE)throw new RangeError(`Invalid response from metadata service: incorrect ${me.HEADER_NAME} header. Expected '${me.HEADER_VALUE}', got ${h?`'${h}'`:"no header"}`);if(typeof d.data=="string")try{return Hb.parse(d.data)}catch(m){}return d.data}async function zb(n){var i;let e={...n,url:(i=n.url)==null?void 0:i.toString().replace(vf(),vf(me.SECONDARY_HOST_ADDRESS))},t=(0,Tf.request)(n),r=(0,Tf.request)(e);return Promise.any([t,r])}function Jb(n){return ys("instance",n)}function Yb(n){return ys("project",n)}function Kb(n){return ys("universe",n)}async function Xb(n){let e={};return await Promise.all(n.map(t=>(async()=>{let r=await ys(t),i=t.metadataKey;e[i]=r})())),e}function Qb(){return process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0}var rl;async function Zb(){if(process.env.METADATA_SERVER_DETECTION){let n=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(n in me.METADATA_SERVER_DETECTION))throw new RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${n}\`, but it should be \`${Object.keys(me.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(n){case"assume-present":return!0;case"none":return!1;case"bios-only":return wf();case"ping-only":}}try{return rl===void 0&&(rl=ys("instance",void 0,Qb(),!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await rl,!0}catch(n){let e=n;if(process.env.DEBUG_AUTH&&console.info(e),e.type==="request-timeout"||e.response&&e.response.status===404)return!1;if(!(e.response&&e.response.status===404)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function jb(){rl=void 0}me.gcpResidencyCache=null;function wf(){return me.gcpResidencyCache===null&&T_(),me.gcpResidencyCache}function T_(n=null){me.gcpResidencyCache=n!==null?n:(0,Vb.detectGCPResidency)()}function v_(){return wf()?0:3e3}Gb(pf(),me)});var A_=K(il=>{"use strict";il.byteLength=tR;il.toByteArray=rR;il.fromByteArray=sR;var In=[],Yt=[],eR=typeof Uint8Array!="undefined"?Uint8Array:Array,Cf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ni=0,w_=Cf.length;ni<w_;++ni)In[ni]=Cf[ni],Yt[Cf.charCodeAt(ni)]=ni;var ni,w_;Yt[45]=62;Yt[95]=63;function C_(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function tR(n){var e=C_(n),t=e[0],r=e[1];return(t+r)*3/4-r}function nR(n,e,t){return(e+t)*3/4-t}function rR(n){var e,t=C_(n),r=t[0],i=t[1],o=new eR(nR(n,r,i)),s=0,l=i>0?r-4:r,f;for(f=0;f<l;f+=4)e=Yt[n.charCodeAt(f)]<<18|Yt[n.charCodeAt(f+1)]<<12|Yt[n.charCodeAt(f+2)]<<6|Yt[n.charCodeAt(f+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=e&255;return i===2&&(e=Yt[n.charCodeAt(f)]<<2|Yt[n.charCodeAt(f+1)]>>4,o[s++]=e&255),i===1&&(e=Yt[n.charCodeAt(f)]<<10|Yt[n.charCodeAt(f+1)]<<4|Yt[n.charCodeAt(f+2)]>>2,o[s++]=e>>8&255,o[s++]=e&255),o}function iR(n){return In[n>>18&63]+In[n>>12&63]+In[n>>6&63]+In[n&63]}function oR(n,e,t){for(var r,i=[],o=e;o<t;o+=3)r=(n[o]<<16&16711680)+(n[o+1]<<8&65280)+(n[o+2]&255),i.push(iR(r));return i.join("")}function sR(n){for(var e,t=n.length,r=t%3,i=[],o=16383,s=0,l=t-r;s<l;s+=o)i.push(oR(n,s,s+o>l?l:s+o));return r===1?(e=n[t-1],i.push(In[e>>2]+In[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(In[e>>10]+In[e>>4&63]+In[e<<2&63]+"=")),i.join("")}});var bf=K(Af=>{"use strict";Object.defineProperty(Af,"__esModule",{value:!0});Af.fromArrayBufferToHex=aR;function aR(n){return Array.from(new Uint8Array(n)).map(t=>t.toString(16).padStart(2,"0")).join("")}});var b_=K(ol=>{"use strict";Object.defineProperty(ol,"__esModule",{value:!0});ol.BrowserCrypto=void 0;var ji=A_(),lR=bf(),Rf=class n{constructor(){if(typeof window=="undefined"||window.crypto===void 0||window.crypto.subtle===void 0)throw new Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return ji.fromByteArray(new Uint8Array(r))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),ji.fromByteArray(t)}static padBase64(e){for(;e.length%4!==0;)e+="=";return e}async verify(e,t,r){let i={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},o=new TextEncoder().encode(t),s=ji.toByteArray(n.padBase64(r)),l=await window.crypto.subtle.importKey("jwk",e,i,!0,["verify"]);return await window.crypto.subtle.verify(i,l,s,o)}async sign(e,t){let r={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(t),o=await window.crypto.subtle.importKey("jwk",e,r,!0,["sign"]),s=await window.crypto.subtle.sign(r,o,i);return ji.fromByteArray(new Uint8Array(s))}decodeBase64StringUtf8(e){let t=ji.toByteArray(n.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return ji.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t);return(0,lR.fromArrayBufferToHex)(r)}async signWithHmacSha256(e,t){let r=typeof e=="string"?e:String.fromCharCode(...new Uint16Array(e)),i=new TextEncoder,o=await window.crypto.subtle.importKey("raw",i.encode(r),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",o,i.encode(t))}};ol.BrowserCrypto=Rf});var R_=K(sl=>{"use strict";Object.defineProperty(sl,"__esModule",{value:!0});sl.NodeCrypto=void 0;var eo=require("crypto"),If=class{async sha256DigestBase64(e){return eo.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return eo.randomBytes(e).toString("base64")}async verify(e,t,r){let i=eo.createVerify("RSA-SHA256");return i.update(t),i.end(),i.verify(e,r,"base64")}async sign(e,t){let r=eo.createSign("RSA-SHA256");return r.update(t),r.end(),r.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return eo.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){let r=typeof e=="string"?e:cR(e);return uR(eo.createHmac("sha256",r).update(t).digest())}};sl.NodeCrypto=If;function uR(n){return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}function cR(n){return Buffer.from(n)}});var Es=K(Zn=>{"use strict";var fR=Zn&&Zn.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),dR=Zn&&Zn.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&fR(e,n,t)};Object.defineProperty(Zn,"__esModule",{value:!0});Zn.createCrypto=mR;Zn.hasBrowserCrypto=I_;var hR=b_(),pR=R_();dR(bf(),Zn);function mR(){return I_()?new hR.BrowserCrypto:new pR.NodeCrypto}function I_(){return typeof window!="undefined"&&typeof window.crypto!="undefined"&&typeof window.crypto.subtle!="undefined"}});var to=K((Pf,x_)=>{var al=require("buffer"),Pn=al.Buffer;function P_(n,e){for(var t in n)e[t]=n[t]}Pn.from&&Pn.alloc&&Pn.allocUnsafe&&Pn.allocUnsafeSlow?x_.exports=al:(P_(al,Pf),Pf.Buffer=ri);function ri(n,e,t){return Pn(n,e,t)}ri.prototype=Object.create(Pn.prototype);P_(Pn,ri);ri.from=function(n,e,t){if(typeof n=="number")throw new TypeError("Argument must not be a number");return Pn(n,e,t)};ri.alloc=function(n,e,t){if(typeof n!="number")throw new TypeError("Argument must be a number");var r=Pn(n);return e!==void 0?typeof t=="string"?r.fill(e,t):r.fill(e):r.fill(0),r};ri.allocUnsafe=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return Pn(n)};ri.allocUnsafeSlow=function(n){if(typeof n!="number")throw new TypeError("Argument must be a number");return al.SlowBuffer(n)}});var N_=K((z1,k_)=>{"use strict";function xf(n){var e=(n/8|0)+(n%8===0?0:1);return e}var gR={ES256:xf(256),ES384:xf(384),ES512:xf(521)};function yR(n){var e=gR[n];if(e)return e;throw new Error('Unknown algorithm "'+n+'"')}k_.exports=yR});var kf=K((J1,L_)=>{"use strict";var ll=to().Buffer,D_=N_(),ul=128,O_=0,_R=32,ER=16,SR=2,U_=ER|_R|O_<<6,cl=SR|O_<<6;function TR(n){return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function F_(n){if(ll.isBuffer(n))return n;if(typeof n=="string")return ll.from(n,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function vR(n,e){n=F_(n);var t=D_(e),r=t+1,i=n.length,o=0;if(n[o++]!==U_)throw new Error('Could not find expected "seq"');var s=n[o++];if(s===(ul|1)&&(s=n[o++]),i-o<s)throw new Error('"seq" specified length of "'+s+'", only "'+(i-o)+'" remaining');if(n[o++]!==cl)throw new Error('Could not find expected "int" for "r"');var l=n[o++];if(i-o-2<l)throw new Error('"r" specified length of "'+l+'", only "'+(i-o-2)+'" available');if(r<l)throw new Error('"r" specified length of "'+l+'", max of "'+r+'" is acceptable');var f=o;if(o+=l,n[o++]!==cl)throw new Error('Could not find expected "int" for "s"');var d=n[o++];if(i-o!==d)throw new Error('"s" specified length of "'+d+'", expected "'+(i-o)+'"');if(r<d)throw new Error('"s" specified length of "'+d+'", max of "'+r+'" is acceptable');var h=o;if(o+=d,o!==i)throw new Error('Expected to consume entire buffer, but "'+(i-o)+'" bytes remain');var m=t-l,g=t-d,E=ll.allocUnsafe(m+l+g+d);for(o=0;o<m;++o)E[o]=0;n.copy(E,o,f+Math.max(-m,0),f+l),o=t;for(var w=o;o<w+g;++o)E[o]=0;return n.copy(E,o,h+Math.max(-g,0),h+d),E=E.toString("base64"),E=TR(E),E}function M_(n,e,t){for(var r=0;e+r<t&&n[e+r]===0;)++r;var i=n[e+r]>=ul;return i&&--r,r}function wR(n,e){n=F_(n);var t=D_(e),r=n.length;if(r!==t*2)throw new TypeError('"'+e+'" signatures must be "'+t*2+'" bytes, saw "'+r+'"');var i=M_(n,0,t),o=M_(n,t,n.length),s=t-i,l=t-o,f=2+s+1+1+l,d=f<ul,h=ll.allocUnsafe((d?2:3)+f),m=0;return h[m++]=U_,d?h[m++]=f:(h[m++]=ul|1,h[m++]=f&255),h[m++]=cl,h[m++]=s,i<0?(h[m++]=0,m+=n.copy(h,m,0,t)):m+=n.copy(h,m,i,t),h[m++]=cl,h[m++]=l,o<0?(h[m++]=0,n.copy(h,m,t)):n.copy(h,m,t+o),h}L_.exports={derToJose:vR,joseToDer:wR}});var dn=K(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.LRUCache=void 0;jn.snakeToCamel=B_;jn.originalOrCamelOptions=RR;jn.removeUndefinedValuesInObject=IR;jn.isValidFile=PR;jn.getWellKnownCertificateConfigFileLocation=xR;var CR=require("fs"),AR=require("os"),Nf=require("path"),bR="certificate_config.json",q_="gcloud";function B_(n){return n.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}function RR(n){function e(t){var i;let r=n||{};return(i=r[t])!=null?i:r[B_(t)]}return{get:e}}var xn,Cr,Df,Of,Mf=class{constructor(e){se(this,Cr);x(this,"capacity");se(this,xn,new Map);x(this,"maxAge");this.capacity=e.capacity,this.maxAge=e.maxAge}set(e,t){re(this,Cr,Df).call(this,e,t),re(this,Cr,Of).call(this)}get(e){let t=D(this,xn).get(e);if(t)return re(this,Cr,Df).call(this,e,t.value),re(this,Cr,Of).call(this),t.value}};xn=new WeakMap,Cr=new WeakSet,Df=function(e,t){D(this,xn).delete(e),D(this,xn).set(e,{value:t,lastAccessed:Date.now()})},Of=function(){let e=this.maxAge?Date.now()-this.maxAge:0,t=D(this,xn).entries().next();for(;!t.done&&(D(this,xn).size>this.capacity||t.value[1].lastAccessed<e);)D(this,xn).delete(t.value[0]),t=D(this,xn).entries().next()};jn.LRUCache=Mf;function IR(n){return Object.entries(n).forEach(([e,t])=>{(t===void 0||t==="undefined")&&delete n[e]}),n}async function PR(n){try{return(await CR.promises.lstat(n)).isFile()}catch(e){return!1}}function xR(){let n=process.env.CLOUDSDK_CONFIG||(kR()?Nf.join(process.env.APPDATA||"",q_):Nf.join(process.env.HOME||"",".config",q_));return Nf.join(n,bR)}function kR(){return AR.platform().startsWith("win")}});var G_=K((X1,NR)=>{NR.exports={name:"google-auth-library",version:"10.5.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.5","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"5.8.2",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"echo 'disabled until linkinator is fixed'","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"}});var Uf=K(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.USER_AGENT=Ar.PRODUCT_NAME=Ar.pkg=void 0;var H_=G_();Ar.pkg=H_;var V_="google-api-nodejs-client";Ar.PRODUCT_NAME=V_;var MR=`${V_}/${H_.version}`;Ar.USER_AGENT=MR});var Mt=K(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.AuthClient=hn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=hn.DEFAULT_UNIVERSE=void 0;var DR=require("events"),Ff=Ze(),OR=dn(),UR=Sf(),Lf=Uf();hn.DEFAULT_UNIVERSE="googleapis.com";hn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=300*1e3;var qe=class qe extends DR.EventEmitter{constructor(t={}){var i,o,s,l,f;super();x(this,"apiKey");x(this,"projectId");x(this,"quotaProjectId");x(this,"transporter");x(this,"credentials",{});x(this,"eagerRefreshThresholdMillis",hn.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS);x(this,"forceRefreshOnFailure",!1);x(this,"universeDomain",hn.DEFAULT_UNIVERSE);let r=(0,OR.originalOrCamelOptions)(t);this.apiKey=t.apiKey,this.projectId=(i=r.get("project_id"))!=null?i:null,this.quotaProjectId=r.get("quota_project_id"),this.credentials=(o=r.get("credentials"))!=null?o:{},this.universeDomain=(s=r.get("universe_domain"))!=null?s:hn.DEFAULT_UNIVERSE,this.transporter=(l=t.transporter)!=null?l:new Ff.Gaxios(t.transporterOptions),r.get("useAuthRequestParameters")!==!1&&(this.transporter.interceptors.request.add(qe.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(qe.DEFAULT_RESPONSE_INTERCEPTOR)),t.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=t.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=(f=t.forceRefreshOnFailure)!=null?f:!1}fetch(...t){let r=t[0],i=t[1],o,s=new Headers;return typeof r=="string"?o=new URL(r):r instanceof URL?o=r:r&&r.url&&(o=new URL(r.url)),r&&typeof r=="object"&&"headers"in r&&Ff.Gaxios.mergeHeaders(s,r.headers),i&&Ff.Gaxios.mergeHeaders(s,new Headers(i.headers)),typeof r=="object"&&!(r instanceof URL)?this.request({...i,...r,headers:s,url:o}):this.request({...i,headers:s,url:o})}setCredentials(t){this.credentials=t}addSharedMetadataHeaders(t){return!t.has("x-goog-user-project")&&this.quotaProjectId&&t.set("x-goog-user-project",this.quotaProjectId),t}addUserProjectAndAuthHeaders(t,r){let i=r.get("x-goog-user-project"),o=r.get("authorization");return i&&t.set("x-goog-user-project",i),o&&t.set("authorization",o),t}static setMethodName(t,r){try{let i=t;i[qe.RequestMethodNameSymbol]=r}catch(i){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};x(qe,"RequestMethodNameSymbol",Symbol("request method name")),x(qe,"RequestLogIdSymbol",Symbol("request log id")),x(qe,"log",(0,UR.log)("auth")),x(qe,"DEFAULT_REQUEST_INTERCEPTOR",{resolved:async t=>{if(!t.headers.has("x-goog-api-client")){let i=process.version.replace(/^v/,"");t.headers.set("x-goog-api-client",`gl-node/${i}`)}let r=t.headers.get("User-Agent");r?r.includes(`${Lf.PRODUCT_NAME}/`)||t.headers.set("User-Agent",`${r} ${Lf.USER_AGENT}`):t.headers.set("User-Agent",Lf.USER_AGENT);try{let i=t,o=i[qe.RequestMethodNameSymbol],s=`${Math.floor(Math.random()*1e3)}`;i[qe.RequestLogIdSymbol]=s;let l={url:t.url,headers:t.headers};o?qe.log.info("%s [%s] request %j",o,s,l):qe.log.info("[%s] request %j",s,l)}catch(i){}return t}}),x(qe,"DEFAULT_RESPONSE_INTERCEPTOR",{resolved:async t=>{try{let r=t.config,i=r[qe.RequestMethodNameSymbol],o=r[qe.RequestLogIdSymbol];i?qe.log.info("%s [%s] response %j",i,o,t.data):qe.log.info("[%s] response %j",o,t.data)}catch(r){}return t},rejected:async t=>{var r,i;try{let o=t.config,s=o[qe.RequestMethodNameSymbol],l=o[qe.RequestLogIdSymbol];s?qe.log.info("%s [%s] error %j",s,l,(r=t.response)==null?void 0:r.data):qe.log.error("[%s] error %j",l,(i=t.response)==null?void 0:i.data)}catch(o){}throw t}});var qf=qe;hn.AuthClient=qf});var Gf=K(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.LoginTicket=void 0;var Bf=class{constructor(e,t){x(this,"envelope");x(this,"payload");this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}};fl.LoginTicket=Bf});var ii=K(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.OAuth2Client=kn.ClientAuthentication=kn.CertificateFormat=kn.CodeChallengeMethod=void 0;var $_=Ze(),FR=require("querystring"),LR=require("stream"),qR=kf(),W_=dn(),Hf=Es(),no=Mt(),BR=Gf(),z_;(function(n){n.Plain="plain",n.S256="S256"})(z_||(kn.CodeChallengeMethod=z_={}));var er;(function(n){n.PEM="PEM",n.JWK="JWK"})(er||(kn.CertificateFormat=er={}));var Ss;(function(n){n.ClientSecretPost="ClientSecretPost",n.ClientSecretBasic="ClientSecretBasic",n.None="None"})(Ss||(kn.ClientAuthentication=Ss={}));var mt=class mt extends no.AuthClient{constructor(t={},r,i){var o;super(typeof t=="object"?t:{});x(this,"redirectUri");x(this,"certificateCache",{});x(this,"certificateExpiry",null);x(this,"certificateCacheFormat",er.PEM);x(this,"refreshTokenPromises",new Map);x(this,"endpoints");x(this,"issuers");x(this,"clientAuthentication");x(this,"_clientId");x(this,"_clientSecret");x(this,"refreshHandler");typeof t!="object"&&(t={clientId:t,clientSecret:r,redirectUri:i}),this._clientId=t.clientId||t.client_id,this._clientSecret=t.clientSecret||t.client_secret,this.redirectUri=t.redirectUri||((o=t.redirect_uris)==null?void 0:o[0]),this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...t.endpoints},this.clientAuthentication=t.clientAuthentication||Ss.ClientSecretPost,this.issuers=t.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}generateAuthUrl(t={}){if(t.code_challenge_method&&!t.code_challenge)throw new Error("If a code_challenge_method is provided, code_challenge must be included.");return t.response_type=t.response_type||"code",t.client_id=t.client_id||this._clientId,t.redirect_uri=t.redirect_uri||this.redirectUri,Array.isArray(t.scope)&&(t.scope=t.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+FR.stringify(t)}generateCodeVerifier(){throw new Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let t=(0,Hf.createCrypto)(),i=t.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),s=(await t.sha256DigestBase64(i)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:i,codeChallenge:s}}getToken(t,r){let i=typeof t=="string"?{code:t}:t;if(r)this.getTokenAsync(i).then(o=>r(null,o.tokens,o.res),o=>r(o,null,o.response));else return this.getTokenAsync(i)}async getTokenAsync(t){let r=this.endpoints.oauth2TokenUrl.toString(),i=new Headers,o={client_id:t.client_id||this._clientId,code_verifier:t.codeVerifier,code:t.code,grant_type:"authorization_code",redirect_uri:t.redirect_uri||this.redirectUri};if(this.clientAuthentication===Ss.ClientSecretBasic){let d=Buffer.from(`${this._clientId}:${this._clientSecret}`);i.set("authorization",`Basic ${d.toString("base64")}`)}this.clientAuthentication===Ss.ClientSecretPost&&(o.client_secret=this._clientSecret);let s={...mt.RETRY_CONFIG,method:"POST",url:r,data:new URLSearchParams((0,W_.removeUndefinedValuesInObject)(o)),headers:i};no.AuthClient.setMethodName(s,"getTokenAsync");let l=await this.transporter.request(s),f=l.data;return l.data&&l.data.expires_in&&(f.expiry_date=new Date().getTime()+l.data.expires_in*1e3,delete f.expires_in),this.emit("tokens",f),{tokens:f,res:l}}async refreshToken(t){if(!t)return this.refreshTokenNoCache(t);if(this.refreshTokenPromises.has(t))return this.refreshTokenPromises.get(t);let r=this.refreshTokenNoCache(t).then(i=>(this.refreshTokenPromises.delete(t),i),i=>{throw this.refreshTokenPromises.delete(t),i});return this.refreshTokenPromises.set(t,r),r}async refreshTokenNoCache(t){var l;if(!t)throw new Error("No refresh token is set.");let r=this.endpoints.oauth2TokenUrl.toString(),i={refresh_token:t,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"},o;try{let f={...mt.RETRY_CONFIG,method:"POST",url:r,data:new URLSearchParams((0,W_.removeUndefinedValuesInObject)(i))};no.AuthClient.setMethodName(f,"refreshTokenNoCache"),o=await this.transporter.request(f)}catch(f){throw f instanceof $_.GaxiosError&&f.message==="invalid_grant"&&((l=f.response)!=null&&l.data)&&/ReAuth/i.test(f.response.data.error_description)&&(f.message=JSON.stringify(f.response.data)),f}let s=o.data;return o.data&&o.data.expires_in&&(s.expiry_date=new Date().getTime()+o.data.expires_in*1e3,delete s.expires_in),this.emit("tokens",s),{tokens:s,res:o}}refreshAccessToken(t){if(t)this.refreshAccessTokenAsync().then(r=>t(null,r.credentials,r.res),t);else return this.refreshAccessTokenAsync()}async refreshAccessTokenAsync(){let t=await this.refreshToken(this.credentials.refresh_token),r=t.tokens;return r.refresh_token=this.credentials.refresh_token,this.credentials=r,{credentials:this.credentials,res:t.res}}getAccessToken(t){if(t)this.getAccessTokenAsync().then(r=>t(null,r.token,r.res),t);else return this.getAccessTokenAsync()}async getAccessTokenAsync(){if(!this.credentials.access_token||this.isTokenExpiring()){if(!this.credentials.refresh_token)if(this.refreshHandler){let i=await this.processAndValidateRefreshHandler();if(i!=null&&i.access_token)return this.setCredentials(i),{token:this.credentials.access_token}}else throw new Error("No refresh token or refresh handler callback is set.");let r=await this.refreshAccessTokenAsync();if(!r.credentials||r.credentials&&!r.credentials.access_token)throw new Error("Could not refresh access token.");return{token:r.credentials.access_token,res:r.res}}else return{token:this.credentials.access_token}}async getRequestHeaders(t){return(await this.getRequestMetadataAsync(t)).headers}async getRequestMetadataAsync(t){let r=this.credentials;if(!r.access_token&&!r.refresh_token&&!this.apiKey&&!this.refreshHandler)throw new Error("No access, refresh token, API key or refresh handler callback is set.");if(r.access_token&&!this.isTokenExpiring()){r.token_type=r.token_type||"Bearer";let f=new Headers({authorization:r.token_type+" "+r.access_token});return{headers:this.addSharedMetadataHeaders(f)}}if(this.refreshHandler){let f=await this.processAndValidateRefreshHandler();if(f!=null&&f.access_token){this.setCredentials(f);let d=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(d)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let i=null,o=null;try{i=await this.refreshToken(r.refresh_token),o=i.tokens}catch(f){let d=f;throw d.response&&(d.response.status===403||d.response.status===404)&&(d.message=`Could not refresh access token: ${d.message}`),d}let s=this.credentials;s.token_type=s.token_type||"Bearer",o.refresh_token=s.refresh_token,this.credentials=o;let l=new Headers({authorization:s.token_type+" "+o.access_token});return{headers:this.addSharedMetadataHeaders(l),res:i.res}}static getRevokeTokenUrl(t){return new mt().getRevokeTokenURL(t).toString()}getRevokeTokenURL(t){let r=new URL(this.endpoints.oauth2RevokeUrl);return r.searchParams.append("token",t),r}revokeToken(t,r){let i={...mt.RETRY_CONFIG,url:this.getRevokeTokenURL(t).toString(),method:"POST"};if(no.AuthClient.setMethodName(i,"revokeToken"),r)this.transporter.request(i).then(o=>r(null,o),r);else return this.transporter.request(i)}revokeCredentials(t){if(t)this.revokeCredentialsAsync().then(r=>t(null,r),t);else return this.revokeCredentialsAsync()}async revokeCredentialsAsync(){let t=this.credentials.access_token;if(this.credentials={},t)return this.revokeToken(t);throw new Error("No access token to revoke.")}request(t,r){if(r)this.requestAsync(t).then(i=>r(null,i),i=>r(i,i.response));else return this.requestAsync(t)}async requestAsync(t,r=!1){try{let i=await this.getRequestMetadataAsync();return t.headers=$_.Gaxios.mergeHeaders(t.headers),this.addUserProjectAndAuthHeaders(t.headers,i.headers),this.apiKey&&t.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(t)}catch(i){let o=i.response;if(o){let s=o.status,l=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),f=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,d=o.config.data instanceof LR.Readable,h=s===401||s===403;if(!r&&h&&!d&&l)return await this.refreshAccessTokenAsync(),this.requestAsync(t,!0);if(!r&&h&&!d&&f){let m=await this.processAndValidateRefreshHandler();return m!=null&&m.access_token&&this.setCredentials(m),this.requestAsync(t,!0)}}throw i}}verifyIdToken(t,r){if(r&&typeof r!="function")throw new Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(r)this.verifyIdTokenAsync(t).then(i=>r(null,i),r);else return this.verifyIdTokenAsync(t)}async verifyIdTokenAsync(t){if(!t.idToken)throw new Error("The verifyIdToken method requires an ID Token");let r=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(t.idToken,r.certs,t.audience,this.issuers,t.maxExpiry)}async getTokenInfo(t){let{data:r}=await this.transporter.request({...mt.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${t}`},url:this.endpoints.tokenInfoUrl.toString()}),i=Object.assign({expiry_date:new Date().getTime()+r.expires_in*1e3,scopes:r.scope.split(" ")},r);return delete i.expires_in,delete i.scope,i}getFederatedSignonCerts(t){if(t)this.getFederatedSignonCertsAsync().then(r=>t(null,r.certs,r.res),t);else return this.getFederatedSignonCertsAsync()}async getFederatedSignonCertsAsync(){var h,m;let t=new Date().getTime(),r=(0,Hf.hasBrowserCrypto)()?er.JWK:er.PEM;if(this.certificateExpiry&&t<this.certificateExpiry.getTime()&&this.certificateCacheFormat===r)return{certs:this.certificateCache,format:r};let i,o;switch(r){case er.PEM:o=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case er.JWK:o=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw new Error(`Unsupported certificate format ${r}`)}try{let g={...mt.RETRY_CONFIG,url:o};no.AuthClient.setMethodName(g,"getFederatedSignonCertsAsync"),i=await this.transporter.request(g)}catch(g){throw g instanceof Error&&(g.message=`Failed to retrieve verification certificates: ${g.message}`),g}let s=i==null?void 0:i.headers.get("cache-control"),l=-1;if(s){let g=(m=(h=/max-age=(?<maxAge>[0-9]+)/.exec(s))==null?void 0:h.groups)==null?void 0:m.maxAge;g&&(l=Number(g)*1e3)}let f={};switch(r){case er.PEM:f=i.data;break;case er.JWK:for(let g of i.data.keys)f[g.kid]=g;break;default:throw new Error(`Unsupported certificate format ${r}`)}let d=new Date;return this.certificateExpiry=l===-1?null:new Date(d.getTime()+l),this.certificateCache=f,this.certificateCacheFormat=r,{certs:f,format:r,res:i}}getIapPublicKeys(t){if(t)this.getIapPublicKeysAsync().then(r=>t(null,r.pubkeys,r.res),t);else return this.getIapPublicKeysAsync()}async getIapPublicKeysAsync(){let t,r=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let i={...mt.RETRY_CONFIG,url:r};no.AuthClient.setMethodName(i,"getIapPublicKeysAsync"),t=await this.transporter.request(i)}catch(i){throw i instanceof Error&&(i.message=`Failed to retrieve verification certificates: ${i.message}`),i}return{pubkeys:t.data,res:t}}verifySignedJwtWithCerts(){throw new Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(t,r,i,o,s){let l=(0,Hf.createCrypto)();s||(s=mt.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let f=t.split(".");if(f.length!==3)throw new Error("Wrong number of segments in token: "+t);let d=f[0]+"."+f[1],h=f[2],m,g;try{m=JSON.parse(l.decodeBase64StringUtf8(f[0]))}catch(W){throw W instanceof Error&&(W.message=`Can't parse token envelope: ${f[0]}': ${W.message}`),W}if(!m)throw new Error("Can't parse token envelope: "+f[0]);try{g=JSON.parse(l.decodeBase64StringUtf8(f[1]))}catch(W){throw W instanceof Error&&(W.message=`Can't parse token payload '${f[0]}`),W}if(!g)throw new Error("Can't parse token payload: "+f[1]);if(!Object.prototype.hasOwnProperty.call(r,m.kid))throw new Error("No pem found for envelope: "+JSON.stringify(m));let E=r[m.kid];if(m.alg==="ES256"&&(h=qR.joseToDer(h,"ES256").toString("base64")),!await l.verify(E,d,h))throw new Error("Invalid token signature: "+t);if(!g.iat)throw new Error("No issue time in token: "+JSON.stringify(g));if(!g.exp)throw new Error("No expiration time in token: "+JSON.stringify(g));let C=Number(g.iat);if(isNaN(C))throw new Error("iat field using invalid format");let R=Number(g.exp);if(isNaN(R))throw new Error("exp field using invalid format");let P=new Date().getTime()/1e3;if(R>=P+s)throw new Error("Expiration time too far in future: "+JSON.stringify(g));let z=C-mt.CLOCK_SKEW_SECS_,$=R+mt.CLOCK_SKEW_SECS_;if(P<z)throw new Error("Token used too early, "+P+" < "+z+": "+JSON.stringify(g));if(P>$)throw new Error("Token used too late, "+P+" > "+$+": "+JSON.stringify(g));if(o&&o.indexOf(g.iss)<0)throw new Error("Invalid issuer, expected one of ["+o+"], but got "+g.iss);if(typeof i!="undefined"&&i!==null){let W=g.aud,H=!1;if(i.constructor===Array?H=i.indexOf(W)>-1:H=W===i,!H)throw new Error("Wrong recipient, payload audience != requiredAudience")}return new BR.LoginTicket(m,g)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let t=await this.refreshHandler();if(!t.access_token)throw new Error("No access token is returned by the refreshHandler callback.");return t}}isTokenExpiring(){let t=this.credentials.expiry_date;return t?t<=new Date().getTime()+this.eagerRefreshThresholdMillis:!1}};x(mt,"GOOGLE_TOKEN_INFO_URL","https://oauth2.googleapis.com/tokeninfo"),x(mt,"CLOCK_SKEW_SECS_",300),x(mt,"DEFAULT_MAX_TOKEN_LIFETIME_SECS_",86400);var Vf=mt;kn.OAuth2Client=Vf});var Wf=K(dl=>{"use strict";Object.defineProperty(dl,"__esModule",{value:!0});dl.Compute=void 0;var GR=Ze(),J_=_s(),HR=ii(),$f=class extends HR.OAuth2Client{constructor(t={}){super(t);x(this,"serviceAccountEmail");x(this,"scopes");this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=t.serviceAccountEmail||"default",this.scopes=Array.isArray(t.scopes)?t.scopes:t.scopes?[t.scopes]:[]}async refreshTokenNoCache(){let t=`service-accounts/${this.serviceAccountEmail}/token`,r;try{let o={property:t};this.scopes.length>0&&(o.params={scopes:this.scopes.join(",")}),r=await J_.instance(o)}catch(o){throw o instanceof GR.GaxiosError&&(o.message=`Could not refresh access token: ${o.message}`,this.wrapError(o)),o}let i=r;return r&&r.expires_in&&(i.expiry_date=new Date().getTime()+r.expires_in*1e3,delete i.expires_in),this.emit("tokens",i),{tokens:i,res:null}}async fetchIdToken(t){let r=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${t}`,i;try{let o={property:r};i=await J_.instance(o)}catch(o){throw o instanceof Error&&(o.message=`Could not fetch ID token: ${o.message}`),o}return i}wrapError(t){let r=t.response;r&&r.status&&(t.status=r.status,r.status===403?t.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+t.message:r.status===404&&(t.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+t.message))}};dl.Compute=$f});var Jf=K(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.IdTokenClient=void 0;var VR=ii(),zf=class extends VR.OAuth2Client{constructor(t){super(t);x(this,"targetAudience");x(this,"idTokenProvider");this.targetAudience=t.targetAudience,this.idTokenProvider=t.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let r=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:r,expiry_date:this.getIdTokenExpiryDate(r)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(t){let r=t.split(".")[1];if(r)return JSON.parse(Buffer.from(r,"base64").toString("ascii")).exp*1e3}};hl.IdTokenClient=zf});var Yf=K(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.GCPEnv=void 0;ro.clear=$R;ro.getEnv=WR;var Y_=_s(),Nn;(function(n){n.APP_ENGINE="APP_ENGINE",n.KUBERNETES_ENGINE="KUBERNETES_ENGINE",n.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",n.COMPUTE_ENGINE="COMPUTE_ENGINE",n.CLOUD_RUN="CLOUD_RUN",n.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",n.NONE="NONE"})(Nn||(ro.GCPEnv=Nn={}));var Ts;function $R(){Ts=void 0}async function WR(){return Ts||(Ts=zR(),Ts)}async function zR(){let n=Nn.NONE;return JR()?n=Nn.APP_ENGINE:YR()?n=Nn.CLOUD_FUNCTIONS:await ZR()?await QR()?n=Nn.KUBERNETES_ENGINE:KR()?n=Nn.CLOUD_RUN:XR()?n=Nn.CLOUD_RUN_JOBS:n=Nn.COMPUTE_ENGINE:n=Nn.NONE,n}function JR(){return!!(process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME)}function YR(){return!!(process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET)}function KR(){return!!process.env.K_CONFIGURATION}function XR(){return!!process.env.CLOUD_RUN_JOB}async function QR(){try{return await Y_.instance("attributes/cluster-name"),!0}catch(n){return!1}}async function ZR(){return Y_.isAvailable()}});var Kf=K((uq,K_)=>{var pl=to().Buffer,jR=require("stream"),eI=require("util");function ml(n){if(this.buffer=null,this.writable=!0,this.readable=!0,!n)return this.buffer=pl.alloc(0),this;if(typeof n.pipe=="function")return this.buffer=pl.alloc(0),n.pipe(this),this;if(n.length||typeof n=="object")return this.buffer=n,this.writable=!1,process.nextTick(function(){this.emit("end",n),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof n+")")}eI.inherits(ml,jR);ml.prototype.write=function(e){this.buffer=pl.concat([this.buffer,pl.from(e)]),this.emit("data",e)};ml.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};K_.exports=ml});var Q_=K((cq,X_)=>{"use strict";var vs=require("buffer").Buffer,Xf=require("buffer").SlowBuffer;X_.exports=gl;function gl(n,e){if(!vs.isBuffer(n)||!vs.isBuffer(e)||n.length!==e.length)return!1;for(var t=0,r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}gl.install=function(){vs.prototype.equal=Xf.prototype.equal=function(e){return gl(this,e)}};var tI=vs.prototype.equal,nI=Xf.prototype.equal;gl.restore=function(){vs.prototype.equal=tI,Xf.prototype.equal=nI}});var ed=K((fq,sE)=>{var oo=to().Buffer,Kt=require("crypto"),j_=kf(),Z_=require("util"),rI=`"%s" is not a valid algorithm.
  Supported algorithms are:
  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".`,ws="secret must be a string or buffer",io="key must be a string or a buffer",iI="key must be a string, a buffer or an object",Zf=typeof Kt.createPublicKey=="function";Zf&&(io+=" or a KeyObject",ws+="or a KeyObject");function eE(n){if(!oo.isBuffer(n)&&typeof n!="string"&&(!Zf||typeof n!="object"||typeof n.type!="string"||typeof n.asymmetricKeyType!="string"||typeof n.export!="function"))throw pn(io)}function tE(n){if(!oo.isBuffer(n)&&typeof n!="string"&&typeof n!="object")throw pn(iI)}function oI(n){if(!oo.isBuffer(n)){if(typeof n=="string")return n;if(!Zf||typeof n!="object"||n.type!=="secret"||typeof n.export!="function")throw pn(ws)}}function jf(n){return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function nE(n){n=n.toString();var e=4-n.length%4;if(e!==4)for(var t=0;t<e;++t)n+="=";return n.replace(/\-/g,"+").replace(/_/g,"/")}function pn(n){var e=[].slice.call(arguments,1),t=Z_.format.bind(Z_,n).apply(null,e);return new TypeError(t)}function sI(n){return oo.isBuffer(n)||typeof n=="string"}function Cs(n){return sI(n)||(n=JSON.stringify(n)),n}function rE(n){return function(t,r){oI(r),t=Cs(t);var i=Kt.createHmac("sha"+n,r),o=(i.update(t),i.digest("base64"));return jf(o)}}var Qf,aI="timingSafeEqual"in Kt?function(e,t){return e.byteLength!==t.byteLength?!1:Kt.timingSafeEqual(e,t)}:function(e,t){return Qf||(Qf=Q_()),Qf(e,t)};function lI(n){return function(t,r,i){var o=rE(n)(t,i);return aI(oo.from(r),oo.from(o))}}function iE(n){return function(t,r){tE(r),t=Cs(t);var i=Kt.createSign("RSA-SHA"+n),o=(i.update(t),i.sign(r,"base64"));return jf(o)}}function oE(n){return function(t,r,i){eE(i),t=Cs(t),r=nE(r);var o=Kt.createVerify("RSA-SHA"+n);return o.update(t),o.verify(i,r,"base64")}}function uI(n){return function(t,r){tE(r),t=Cs(t);var i=Kt.createSign("RSA-SHA"+n),o=(i.update(t),i.sign({key:r,padding:Kt.constants.RSA_PKCS1_PSS_PADDING,saltLength:Kt.constants.RSA_PSS_SALTLEN_DIGEST},"base64"));return jf(o)}}function cI(n){return function(t,r,i){eE(i),t=Cs(t),r=nE(r);var o=Kt.createVerify("RSA-SHA"+n);return o.update(t),o.verify({key:i,padding:Kt.constants.RSA_PKCS1_PSS_PADDING,saltLength:Kt.constants.RSA_PSS_SALTLEN_DIGEST},r,"base64")}}function fI(n){var e=iE(n);return function(){var r=e.apply(null,arguments);return r=j_.derToJose(r,"ES"+n),r}}function dI(n){var e=oE(n);return function(r,i,o){i=j_.joseToDer(i,"ES"+n).toString("base64");var s=e(r,i,o);return s}}function hI(){return function(){return""}}function pI(){return function(e,t){return t===""}}sE.exports=function(e){var t={hs:rE,rs:iE,ps:uI,es:fI,none:hI},r={hs:lI,rs:oE,ps:cI,es:dI,none:pI},i=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!i)throw pn(rI,e);var o=(i[1]||i[3]).toLowerCase(),s=i[2];return{sign:t[o](s),verify:r[o](s)}}});var td=K((dq,aE)=>{var mI=require("buffer").Buffer;aE.exports=function(e){return typeof e=="string"?e:typeof e=="number"||mI.isBuffer(e)?e.toString():JSON.stringify(e)}});var hE=K((hq,dE)=>{var gI=to().Buffer,lE=Kf(),yI=ed(),_I=require("stream"),uE=td(),nd=require("util");function cE(n,e){return gI.from(n,e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function EI(n,e,t){t=t||"utf8";var r=cE(uE(n),"binary"),i=cE(uE(e),t);return nd.format("%s.%s",r,i)}function fE(n){var e=n.header,t=n.payload,r=n.secret||n.privateKey,i=n.encoding,o=yI(e.alg),s=EI(e,t,i),l=o.sign(s,r);return nd.format("%s.%s",s,l)}function yl(n){var e=n.secret||n.privateKey||n.key,t=new lE(e);this.readable=!0,this.header=n.header,this.encoding=n.encoding,this.secret=this.privateKey=this.key=t,this.payload=new lE(n.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}nd.inherits(yl,_I);yl.prototype.sign=function(){try{var e=fE({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(t){this.readable=!1,this.emit("error",t),this.emit("close")}};yl.sign=fE;dE.exports=yl});var wE=K((pq,vE)=>{var mE=to().Buffer,pE=Kf(),SI=ed(),TI=require("stream"),gE=td(),vI=require("util"),wI=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function CI(n){return Object.prototype.toString.call(n)==="[object Object]"}function AI(n){if(CI(n))return n;try{return JSON.parse(n)}catch(e){return}}function yE(n){var e=n.split(".",1)[0];return AI(mE.from(e,"base64").toString("binary"))}function bI(n){return n.split(".",2).join(".")}function _E(n){return n.split(".")[2]}function RI(n,e){e=e||"utf8";var t=n.split(".")[1];return mE.from(t,"base64").toString(e)}function EE(n){return wI.test(n)&&!!yE(n)}function SE(n,e,t){if(!e){var r=new Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}n=gE(n);var i=_E(n),o=bI(n),s=SI(e);return s.verify(o,i,t)}function TE(n,e){if(e=e||{},n=gE(n),!EE(n))return null;var t=yE(n);if(!t)return null;var r=RI(n);return(t.typ==="JWT"||e.json)&&(r=JSON.parse(r,e.encoding)),{header:t,payload:r,signature:_E(n)}}function so(n){n=n||{};var e=n.secret||n.publicKey||n.key,t=new pE(e);this.readable=!0,this.algorithm=n.algorithm,this.encoding=n.encoding,this.secret=this.publicKey=this.key=t,this.signature=new pE(n.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}vI.inherits(so,TI);so.prototype.verify=function(){try{var e=SE(this.signature.buffer,this.algorithm,this.key.buffer),t=TE(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(r){this.readable=!1,this.emit("error",r),this.emit("close")}};so.decode=TE;so.isValid=EE;so.verify=SE;vE.exports=so});var rd=K(br=>{var CE=hE(),_l=wE(),II=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"];br.ALGORITHMS=II;br.sign=CE.sign;br.verify=_l.verify;br.decode=_l.decode;br.isValid=_l.isValid;br.createSign=function(e){return new CE(e)};br.createVerify=function(e){return new _l(e)}});var qE=K(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});Sl.GoogleToken=void 0;var AE=El(require("fs")),PI=Ze(),xI=El(rd()),kI=El(require("path")),NI=require("util");function El(n,e){if(typeof WeakMap=="function")var t=new WeakMap,r=new WeakMap;return(El=function(o,s){if(!s&&o&&o.__esModule)return o;var l,f,d={__proto__:null,default:o};if(o===null||tr(o)!="object"&&typeof o!="function")return d;if(l=s?r:t){if(l.has(o))return l.get(o);l.set(o,d)}for(var h in o)h!=="default"&&{}.hasOwnProperty.call(o,h)&&((f=(l=Object.defineProperty)&&Object.getOwnPropertyDescriptor(o,h))&&(f.get||f.set)?l(d,h,f):d[h]=o[h]);return d})(n,e)}function tr(n){"@babel/helpers - typeof";return tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tr(n)}function MI(n,e){DE(n,e),e.add(n)}function DI(n,e,t){DE(n,e),e.set(n,t)}function DE(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function bE(n,e,t){return n.set(mn(n,e),t),t}function RE(n,e){return n.get(mn(n,e))}function mn(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function IE(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,FE(r.key),r)}}function OE(n,e,t){return e&&IE(n.prototype,e),t&&IE(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function UE(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function OI(n,e,t){return e=Is(e),UI(n,ud()?Reflect.construct(e,t||[],Is(n).constructor):e.apply(n,t))}function UI(n,e){if(e&&(tr(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return FI(n)}function FI(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function LI(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Rs(n,e)}function id(n){var e=typeof Map=="function"?new Map:void 0;return id=function(r){if(r===null||!BI(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return qI(r,arguments,Is(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Rs(i,r)},id(n)}function qI(n,e,t){if(ud())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var i=new(n.bind.apply(n,r));return t&&Rs(i,t.prototype),i}function ud(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(ud=function(){return!!n})()}function BI(n){try{return Function.toString.call(n).indexOf("[native code]")!==-1}catch(e){return typeof n=="function"}}function Rs(n,e){return Rs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Rs(n,e)}function Is(n){return Is=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Is(n)}function Dt(n,e,t){return(e=FE(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function FE(n){var e=GI(n,"string");return tr(e)=="symbol"?e:e+""}function GI(n,e){if(tr(n)!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(tr(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Ut(){var n,e,t=typeof Symbol=="function"?Symbol:{},r=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function o(E,w,C,R){var P=w&&w.prototype instanceof l?w:l,z=Object.create(P.prototype);return Ot(z,"_invoke",(function($,W,H){var G,Y,j,T=0,L=H||[],X=!1,Q={p:0,n:0,v:n,a:ie,f:ie.bind(n,4),d:function(we,_e){return G=we,Y=0,j=n,Q.n=_e,s}};function ie(ne,we){for(Y=ne,j=we,e=0;!X&&T&&!_e&&e<L.length;e++){var _e,Re=L[e],Ae=Q.p,Fe=Re[2];ne>3?(_e=Fe===we)&&(j=Re[(Y=Re[4])?5:(Y=3,3)],Re[4]=Re[5]=n):Re[0]<=Ae&&((_e=ne<2&&Ae<Re[1])?(Y=0,Q.v=we,Q.n=Re[1]):Ae<Fe&&(_e=ne<3||Re[0]>we||we>Fe)&&(Re[4]=ne,Re[5]=we,Q.n=Fe,Y=0))}if(_e||ne>1)return s;throw X=!0,we}return function(ne,we,_e){if(T>1)throw TypeError("Generator is already running");for(X&&we===1&&ie(we,_e),Y=we,j=_e;(e=Y<2?n:j)||!X;){G||(Y?Y<3?(Y>1&&(Q.n=-1),ie(Y,j)):Q.n=j:Q.v=j);try{if(T=2,G){if(Y||(ne="next"),e=G[ne]){if(!(e=e.call(G,j)))throw TypeError("iterator result is not an object");if(!e.done)return e;j=e.value,Y<2&&(Y=0)}else Y===1&&(e=G.return)&&e.call(G),Y<2&&(j=TypeError("The iterator does not provide a '"+ne+"' method"),Y=1);G=n}else if((e=(X=Q.n<0)?j:$.call(W,Q))!==s)break}catch(Re){G=n,Y=1,j=Re}finally{T=1}}return{value:e,done:X}}})(E,C,R),!0),z}var s={};function l(){}function f(){}function d(){}e=Object.getPrototypeOf;var h=[][r]?e(e([][r]())):(Ot(e={},r,function(){return this}),e),m=d.prototype=l.prototype=Object.create(h);function g(E){return Object.setPrototypeOf?Object.setPrototypeOf(E,d):(E.__proto__=d,Ot(E,i,"GeneratorFunction")),E.prototype=Object.create(m),E}return f.prototype=d,Ot(m,"constructor",d),Ot(d,"constructor",f),f.displayName="GeneratorFunction",Ot(d,i,"GeneratorFunction"),Ot(m),Ot(m,i,"Generator"),Ot(m,r,function(){return this}),Ot(m,"toString",function(){return"[object Generator]"}),(Ut=function(){return{w:o,m:g}})()}function Ot(n,e,t,r){var i=Object.defineProperty;try{i({},"",{})}catch(o){i=0}Ot=function(s,l,f,d){if(l)i?i(s,l,{value:f,enumerable:!d,configurable:!d,writable:!d}):s[l]=f;else{var h=function(g,E){Ot(s,g,function(w){return this._invoke(g,E,w)})};h("next",0),h("throw",1),h("return",2)}},Ot(n,e,t,r)}function PE(n,e,t,r,i,o,s){try{var l=n[o](s),f=l.value}catch(d){return void t(d)}l.done?e(f):Promise.resolve(f).then(r,i)}function ao(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var o=n.apply(e,t);function s(f){PE(o,r,i,s,l,"next",f)}function l(f){PE(o,r,i,s,l,"throw",f)}s(void 0)})}}var xE=AE.readFile?(0,NI.promisify)(AE.readFile):ao(Ut().m(function n(){return Ut().w(function(e){for(;;)switch(e.n){case 0:throw new bs("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},n)})),kE="https://oauth2.googleapis.com/token",HI="https://oauth2.googleapis.com/revoke?token=",bs=(function(n){function e(t,r){var i;return UE(this,e),i=OI(this,e,[t]),Dt(i,"code",void 0),i.code=r,i}return LI(e,n),OE(e)})(id(Error)),As=new WeakMap,Mn=new WeakSet,gq=Sl.GoogleToken=(function(){function n(e){UE(this,n),MI(this,Mn),Dt(this,"expiresAt",void 0),Dt(this,"key",void 0),Dt(this,"keyFile",void 0),Dt(this,"iss",void 0),Dt(this,"sub",void 0),Dt(this,"scope",void 0),Dt(this,"rawToken",void 0),Dt(this,"tokenExpires",void 0),Dt(this,"email",void 0),Dt(this,"additionalClaims",void 0),Dt(this,"eagerRefreshThresholdMillis",void 0),Dt(this,"transporter",{request:function(r){return(0,PI.request)(r)}}),DI(this,As,void 0),mn(Mn,this,LE).call(this,e)}return OE(n,[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var t=new Date().getTime();return this.rawToken&&this.expiresAt?t>=this.expiresAt:!0}},{key:"isTokenExpiring",value:function(){var t,r=new Date().getTime(),i=(t=this.eagerRefreshThresholdMillis)!==null&&t!==void 0?t:0;return this.rawToken&&this.expiresAt?this.expiresAt<=r+i:!0}},{key:"getToken",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(tr(t)==="object"&&(r=t,t=void 0),r=Object.assign({forceRefresh:!1},r),t){var i=t;mn(Mn,this,NE).call(this,r).then(function(o){return i(null,o)},t);return}return mn(Mn,this,NE).call(this,r)}},{key:"getCredentials",value:(function(){var e=ao(Ut().m(function r(i){var o,s,l,f,d,h,m;return Ut().w(function(g){for(;;)switch(g.n){case 0:o=kI.extname(i),m=o,g.n=m===".json"?1:m===".der"||m===".crt"||m===".pem"?4:m===".p12"||m===".pfx"?6:7;break;case 1:return g.n=2,xE(i,"utf8");case 2:if(s=g.v,l=JSON.parse(s),f=l.private_key,d=l.client_email,!(!f||!d)){g.n=3;break}throw new bs("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return g.a(2,{privateKey:f,clientEmail:d});case 4:return g.n=5,xE(i,"utf8");case 5:return h=g.v,g.a(2,{privateKey:h});case 6:throw new bs("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new bs("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return g.a(2)}},r)}));function t(r){return e.apply(this,arguments)}return t})()},{key:"revokeToken",value:function(t){if(t){mn(Mn,this,ME).call(this).then(function(){return t()},t);return}return mn(Mn,this,ME).call(this)}}])})();function NE(n){return od.apply(this,arguments)}function od(){return od=ao(Ut().m(function n(e){return Ut().w(function(t){for(;;)switch(t.n){case 0:if(!(RE(As,this)&&!e.forceRefresh)){t.n=1;break}return t.a(2,RE(As,this));case 1:return t.p=1,t.n=2,bE(As,this,mn(Mn,this,VI).call(this,e));case 2:return t.a(2,t.v);case 3:return t.p=3,bE(As,this,void 0),t.f(3);case 4:return t.a(2)}},n,this,[[1,,3,4]])})),od.apply(this,arguments)}function VI(n){return sd.apply(this,arguments)}function sd(){return sd=ao(Ut().m(function n(e){var t;return Ut().w(function(r){for(;;)switch(r.n){case 0:if(!(this.isTokenExpiring()===!1&&e.forceRefresh===!1)){r.n=1;break}return r.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){r.n=2;break}throw new Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){r.n=4;break}return r.n=3,this.getCredentials(this.keyFile);case 3:t=r.v,this.key=t.privateKey,this.iss=t.clientEmail||this.iss,t.clientEmail||mn(Mn,this,$I).call(this);case 4:return r.a(2,mn(Mn,this,WI).call(this))}},n,this)})),sd.apply(this,arguments)}function $I(){if(!this.iss)throw new bs("email is required.","MISSING_CREDENTIALS")}function ME(){return ad.apply(this,arguments)}function ad(){return ad=ao(Ut().m(function n(){var e;return Ut().w(function(t){for(;;)switch(t.n){case 0:if(this.accessToken){t.n=1;break}throw new Error("No token to revoke.");case 1:return e=HI+this.accessToken,t.n=2,this.transporter.request({url:e,retry:!0});case 2:mn(Mn,this,LE).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return t.a(2)}},n,this)})),ad.apply(this,arguments)}function LE(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.keyFile=n.keyFile,this.key=n.key,this.rawToken=void 0,this.iss=n.email||n.iss,this.sub=n.sub,this.additionalClaims=n.additionalClaims,tr(n.scope)==="object"?this.scope=n.scope.join(" "):this.scope=n.scope,this.eagerRefreshThresholdMillis=n.eagerRefreshThresholdMillis,n.transporter&&(this.transporter=n.transporter)}function WI(){return ld.apply(this,arguments)}function ld(){return ld=ao(Ut().m(function n(){var e,t,r,i,o,s,l,f,d,h;return Ut().w(function(m){for(;;)switch(m.n){case 0:return e=Math.floor(new Date().getTime()/1e3),t=this.additionalClaims||{},r=Object.assign({iss:this.iss,scope:this.scope,aud:kE,exp:e+3600,iat:e,sub:this.sub},t),i=xI.sign({header:{alg:"RS256"},payload:r,secret:this.key}),m.p=1,m.n=2,this.transporter.request({method:"POST",url:kE,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return o=m.v,this.rawToken=o.data,this.expiresAt=o.data.expires_in===null||o.data.expires_in===void 0?void 0:(e+o.data.expires_in)*1e3,m.a(2,this.rawToken);case 3:throw m.p=3,h=m.v,this.rawToken=void 0,this.tokenExpires=void 0,f=h.response&&(s=h.response)!==null&&s!==void 0&&s.data?(l=h.response)===null||l===void 0?void 0:l.data:{},f.error&&(d=f.error_description?": ".concat(f.error_description):"",h.message="".concat(f.error).concat(d)),h;case 4:return m.a(2)}},n,this,[[1,3]])})),ld.apply(this,arguments)}});var fd=K(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});Tl.JWTAccess=void 0;var zI=rd(),JI=dn(),BE={alg:"RS256",typ:"JWT"},cd=class n{constructor(e,t,r,i){x(this,"email");x(this,"key");x(this,"keyId");x(this,"projectId");x(this,"eagerRefreshThresholdMillis");x(this,"cache",new JI.LRUCache({capacity:500,maxAge:3600*1e3}));this.email=e,this.key=t,this.keyId=r,this.eagerRefreshThresholdMillis=i!=null?i:300*1e3}getCachedKey(e,t){let r=e;if(t&&Array.isArray(t)&&t.length?r=e?`${e}_${t.join("_")}`:`${t.join("_")}`:typeof t=="string"&&(r=e?`${e}_${t}`:t),!r)throw Error("Scopes or url must be provided");return r}getRequestHeaders(e,t,r){let i=this.getCachedKey(e,r),o=this.cache.get(i),s=Date.now();if(o&&o.expiration-s>this.eagerRefreshThresholdMillis)return new Headers(o.headers);let l=Math.floor(Date.now()/1e3),f=n.getExpirationTime(l),d;if(Array.isArray(r)&&(r=r.join(" ")),r?d={iss:this.email,sub:this.email,scope:r,exp:f,iat:l}:d={iss:this.email,sub:this.email,aud:e,exp:f,iat:l},t){for(let w in d)if(t[w])throw new Error(`The '${w}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...BE,kid:this.keyId}:BE,m=Object.assign(d,t),g=zI.sign({header:h,payload:m,secret:this.key}),E=new Headers({authorization:`Bearer ${g}`});return this.cache.set(i,{expiration:f*1e3,headers:E}),E}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(t)this.fromStreamAsync(e).then(()=>t(),t);else return this.fromStreamAsync(e)}fromStreamAsync(e){return new Promise((t,r)=>{e||r(new Error("Must pass in a stream containing the service account auth settings."));let i="";e.setEncoding("utf8").on("data",o=>i+=o).on("error",r).on("end",()=>{try{let o=JSON.parse(i);this.fromJSON(o),t()}catch(o){r(o)}})})}};Tl.JWTAccess=cd});var hd=K(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});wl.JWT=void 0;var GE=qE(),YI=fd(),KI=ii(),vl=Mt(),dd=class n extends KI.OAuth2Client{constructor(t={}){super(t);x(this,"email");x(this,"keyFile");x(this,"key");x(this,"keyId");x(this,"defaultScopes");x(this,"scopes");x(this,"scope");x(this,"subject");x(this,"gtoken");x(this,"additionalClaims");x(this,"useJWTAccessWithScope");x(this,"defaultServicePath");x(this,"access");this.email=t.email,this.keyFile=t.keyFile,this.key=t.key,this.keyId=t.keyId,this.scopes=t.scopes,this.subject=t.subject,this.additionalClaims=t.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(t){let r=new n(this);return r.scopes=t,r}async getRequestMetadataAsync(t){t=this.defaultServicePath?`https://${this.defaultServicePath}/`:t;let r=!this.hasUserScopes()&&t||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==vl.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==vl.DEFAULT_UNIVERSE)throw new RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${vl.DEFAULT_UNIVERSE}`);if(!this.apiKey&&r)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:i}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${i.id_token}`}))}}else{this.access||(this.access=new YI.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis));let i;this.hasUserScopes()?i=this.scopes:t||(i=this.defaultScopes);let o=this.useJWTAccessWithScope||this.universeDomain!==vl.DEFAULT_UNIVERSE,s=await this.access.getRequestHeaders(t!=null?t:void 0,this.additionalClaims,o?i:void 0);return{headers:this.addSharedMetadataHeaders(s)}}else return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(t):{headers:new Headers}}async fetchIdToken(t){let r=new GE.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:t},transporter:this.transporter});if(await r.getToken({forceRefresh:!0}),!r.idToken)throw new Error("Unknown error: Failed to fetch ID token");return r.idToken}hasUserScopes(){return this.scopes?this.scopes.length>0:!1}hasAnyScopes(){return!!(this.scopes&&this.scopes.length>0||this.defaultScopes&&this.defaultScopes.length>0)}authorize(t){if(t)this.authorizeAsync().then(r=>t(null,r),t);else return this.authorizeAsync()}async authorizeAsync(){let t=await this.refreshToken();if(!t)throw new Error("No result returned");return this.credentials=t.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,t.tokens}async refreshTokenNoCache(){let t=this.createGToken(),i={access_token:(await t.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:t.expiresAt,id_token:t.idToken};return this.emit("tokens",i),{res:null,tokens:i}}createGToken(){return this.gtoken||(this.gtoken=new GE.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(t){if(!t)throw new Error("Must pass in a JSON object containing the service account auth settings.");if(!t.client_email)throw new Error("The incoming JSON object does not contain a client_email field");if(!t.private_key)throw new Error("The incoming JSON object does not contain a private_key field");this.email=t.client_email,this.key=t.private_key,this.keyId=t.private_key_id,this.projectId=t.project_id,this.quotaProjectId=t.quota_project_id,this.universeDomain=t.universe_domain||this.universeDomain}fromStream(t,r){if(r)this.fromStreamAsync(t).then(()=>r(),r);else return this.fromStreamAsync(t)}fromStreamAsync(t){return new Promise((r,i)=>{if(!t)throw new Error("Must pass in a stream containing the service account auth settings.");let o="";t.setEncoding("utf8").on("error",i).on("data",s=>o+=s).on("end",()=>{try{let s=JSON.parse(o);this.fromJSON(s),r()}catch(s){i(s)}})})}fromAPIKey(t){if(typeof t!="string")throw new Error("Must provide an API Key string.");this.apiKey=t}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let r=await this.createGToken().getCredentials(this.keyFile);return{private_key:r.privateKey,client_email:r.clientEmail}}throw new Error("A key or a keyFile must be provided to getCredentials.")}};wl.JWT=dd});var md=K(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.UserRefreshClient=lo.USER_REFRESH_ACCOUNT_TYPE=void 0;var XI=ii(),QI=Mt();lo.USER_REFRESH_ACCOUNT_TYPE="authorized_user";var pd=class n extends XI.OAuth2Client{constructor(t,r,i,o,s){let l=t&&typeof t=="object"?t:{clientId:t,clientSecret:r,refreshToken:i,eagerRefreshThresholdMillis:o,forceRefreshOnFailure:s};super(l);x(this,"_refreshToken");this._refreshToken=l.refreshToken,this.credentials.refresh_token=l.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(t){let r={...n.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:t})};return QI.AuthClient.setMethodName(r,"fetchIdToken"),(await this.transporter.request(r)).data.id_token}fromJSON(t){if(!t)throw new Error("Must pass in a JSON object containing the user refresh token");if(t.type!=="authorized_user")throw new Error('The incoming JSON object does not have the "authorized_user" type');if(!t.client_id)throw new Error("The incoming JSON object does not contain a client_id field");if(!t.client_secret)throw new Error("The incoming JSON object does not contain a client_secret field");if(!t.refresh_token)throw new Error("The incoming JSON object does not contain a refresh_token field");this._clientId=t.client_id,this._clientSecret=t.client_secret,this._refreshToken=t.refresh_token,this.credentials.refresh_token=t.refresh_token,this.quotaProjectId=t.quota_project_id,this.universeDomain=t.universe_domain||this.universeDomain}fromStream(t,r){if(r)this.fromStreamAsync(t).then(()=>r(),r);else return this.fromStreamAsync(t)}async fromStreamAsync(t){return new Promise((r,i)=>{if(!t)return i(new Error("Must pass in a stream containing the user refresh token."));let o="";t.setEncoding("utf8").on("error",i).on("data",s=>o+=s).on("end",()=>{try{let s=JSON.parse(o);return this.fromJSON(s),r()}catch(s){return i(s)}})})}static fromJSON(t){let r=new n;return r.fromJSON(t),r}};lo.UserRefreshClient=pd});var yd=K(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.Impersonated=uo.IMPERSONATED_ACCOUNT_TYPE=void 0;var HE=ii(),ZI=Ze(),jI=dn();uo.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";var gd=class n extends HE.OAuth2Client{constructor(t={}){var i,o,s,l,f,d;super(t);x(this,"sourceClient");x(this,"targetPrincipal");x(this,"targetScopes");x(this,"delegates");x(this,"lifetime");x(this,"endpoint");if(this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=(i=t.sourceClient)!=null?i:new HE.OAuth2Client,this.targetPrincipal=(o=t.targetPrincipal)!=null?o:"",this.delegates=(s=t.delegates)!=null?s:[],this.targetScopes=(l=t.targetScopes)!=null?l:[],this.lifetime=(f=t.lifetime)!=null?f:3600,!!!(0,jI.originalOrCamelOptions)(t).get("universe_domain"))this.universeDomain=this.sourceClient.universeDomain;else if(this.sourceClient.universeDomain!==this.universeDomain)throw new RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`);this.endpoint=(d=t.endpoint)!=null?d:`https://iamcredentials.${this.universeDomain}`}async sign(t){await this.sourceClient.getAccessToken();let r=`projects/-/serviceAccounts/${this.targetPrincipal}`,i=`${this.endpoint}/v1/${r}:signBlob`,o={delegates:this.delegates,payload:Buffer.from(t).toString("base64")};return(await this.sourceClient.request({...n.RETRY_CONFIG,url:i,data:o,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){var t,r,i,o,s,l;try{await this.sourceClient.getAccessToken();let f="projects/-/serviceAccounts/"+this.targetPrincipal,d=`${this.endpoint}/v1/${f}:generateAccessToken`,h={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},m=await this.sourceClient.request({...n.RETRY_CONFIG,url:d,data:h,method:"POST"}),g=m.data;return this.credentials.access_token=g.accessToken,this.credentials.expiry_date=Date.parse(g.expireTime),{tokens:this.credentials,res:m}}catch(f){if(!(f instanceof Error))throw f;let d=0,h="";throw f instanceof ZI.GaxiosError&&(d=(i=(r=(t=f==null?void 0:f.response)==null?void 0:t.data)==null?void 0:r.error)==null?void 0:i.status,h=(l=(s=(o=f==null?void 0:f.response)==null?void 0:o.data)==null?void 0:s.error)==null?void 0:l.message),d&&h?(f.message=`${d}: unable to impersonate: ${h}`,f):(f.message=`unable to impersonate: ${f}`,f)}}async fetchIdToken(t,r){var f,d;await this.sourceClient.getAccessToken();let i=`projects/-/serviceAccounts/${this.targetPrincipal}`,o=`${this.endpoint}/v1/${i}:generateIdToken`,s={delegates:this.delegates,audience:t,includeEmail:(f=r==null?void 0:r.includeEmail)!=null?f:!0,useEmailAzp:(d=r==null?void 0:r.includeEmail)!=null?d:!0};return(await this.sourceClient.request({...n.RETRY_CONFIG,url:o,data:s,method:"POST"})).data.token}};uo.Impersonated=gd});var Ed=K(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});Ps.OAuthClientAuthHandler=void 0;Ps.getErrorFromOAuthErrorResponse=nP;var co=Ze(),eP=Es(),tP=["PUT","POST","PATCH"],Cl,gt,_d=class{constructor(e){se(this,Cl,(0,eP.createCrypto)());se(this,gt);x(this,"transporter");e&&"clientId"in e?(ce(this,gt,e),this.transporter=new co.Gaxios):(ce(this,gt,e==null?void 0:e.clientAuthentication),this.transporter=(e==null?void 0:e.transporter)||new co.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=co.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){var r;if(t)e.headers=co.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(((r=D(this,gt))==null?void 0:r.confidentialClientType)==="basic"){e.headers=co.Gaxios.mergeHeaders(e.headers);let i=D(this,gt).clientId,o=D(this,gt).clientSecret||"",s=D(this,Cl).encodeBase64StringUtf8(`${i}:${o}`);co.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${s}`})}}injectAuthenticatedRequestBody(e){var t,r;if(((t=D(this,gt))==null?void 0:t.confidentialClientType)==="request-body"){let i=(e.method||"GET").toUpperCase();if(!tP.includes(i))throw new Error(`${i} HTTP method does not support ${D(this,gt).confidentialClientType} client authentication`);let s=new Headers(e.headers).get("content-type");if(s!=null&&s.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let l=new URLSearchParams((r=e.data)!=null?r:"");l.append("client_id",D(this,gt).clientId),l.append("client_secret",D(this,gt).clientSecret||""),e.data=l}else if(s!=null&&s.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:D(this,gt).clientId,client_secret:D(this,gt).clientSecret||""});else throw new Error(`${s} content-types are not supported with ${D(this,gt).confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}};Cl=new WeakMap,gt=new WeakMap;Ps.OAuthClientAuthHandler=_d;function nP(n,e){let t=n.error,r=n.error_description,i=n.error_uri,o=`Error code ${t}`;typeof r!="undefined"&&(o+=`: ${r}`),typeof i!="undefined"&&(o+=` - ${i}`);let s=new Error(o);if(e){let l=Object.keys(e);e.stack&&l.push("stack"),l.forEach(f=>{f!=="message"&&Object.defineProperty(s,f,{value:e[f],writable:!1,enumerable:!0})})}return s}});var bl=K(Al=>{"use strict";Object.defineProperty(Al,"__esModule",{value:!0});Al.StsCredentials=void 0;var rP=Ze(),iP=Mt(),VE=Ed(),oP=dn(),xs,Td=class Td extends VE.OAuthClientAuthHandler{constructor(t={tokenExchangeEndpoint:""},r){(typeof t!="object"||t instanceof URL)&&(t={tokenExchangeEndpoint:t,clientAuthentication:r});super(t);se(this,xs);ce(this,xs,t.tokenExchangeEndpoint)}async exchangeToken(t,r,i){var l,f,d;let o={grant_type:t.grantType,resource:t.resource,audience:t.audience,scope:(l=t.scope)==null?void 0:l.join(" "),requested_token_type:t.requestedTokenType,subject_token:t.subjectToken,subject_token_type:t.subjectTokenType,actor_token:(f=t.actingParty)==null?void 0:f.actorToken,actor_token_type:(d=t.actingParty)==null?void 0:d.actorTokenType,options:i&&JSON.stringify(i)},s={...Td.RETRY_CONFIG,url:D(this,xs).toString(),method:"POST",headers:r,data:new URLSearchParams((0,oP.removeUndefinedValuesInObject)(o))};iP.AuthClient.setMethodName(s,"exchangeToken"),this.applyClientAuthenticationOptions(s);try{let h=await this.transporter.request(s),m=h.data;return m.res=h,m}catch(h){throw h instanceof rP.GaxiosError&&h.response?(0,VE.getErrorFromOAuthErrorResponse)(h.response.data,h):h}}};xs=new WeakMap;var Sd=Td;Al.StsCredentials=Sd});var Rr=K(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.BaseExternalAccountClient=Xt.CLOUD_RESOURCE_MANAGER=Xt.EXTERNAL_ACCOUNT_TYPE=Xt.EXPIRATION_TIME_OFFSET=void 0;var sP=Ze(),aP=require("stream"),vd=Mt(),lP=bl(),$E=dn(),uP=Uf(),cP="urn:ietf:params:oauth:grant-type:token-exchange",fP="urn:ietf:params:oauth:token-type:access_token",wd="https://www.googleapis.com/auth/cloud-platform",dP=3600;Xt.EXPIRATION_TIME_OFFSET=300*1e3;Xt.EXTERNAL_ACCOUNT_TYPE="external_account";Xt.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";var hP="//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+",pP="https://sts.{universeDomain}/v1/token",oi,Rl,WE,Il=class Il extends vd.AuthClient{constructor(t){var E;super(t);se(this,Rl);x(this,"scopes");x(this,"projectNumber");x(this,"audience");x(this,"subjectTokenType");x(this,"stsCredential");x(this,"clientAuth");x(this,"credentialSourceType");x(this,"cachedAccessToken");x(this,"serviceAccountImpersonationUrl");x(this,"serviceAccountImpersonationLifetime");x(this,"workforcePoolUserProject");x(this,"configLifetimeRequested");x(this,"tokenUrl");x(this,"cloudResourceManagerURL");x(this,"supplierContext");se(this,oi,null);let r=(0,$E.originalOrCamelOptions)(t),i=r.get("type");if(i&&i!==Xt.EXTERNAL_ACCOUNT_TYPE)throw new Error(`Expected "${Xt.EXTERNAL_ACCOUNT_TYPE}" type but received "${t.type}"`);let o=r.get("client_id"),s=r.get("client_secret");this.tokenUrl=(E=r.get("token_url"))!=null?E:pP.replace("{universeDomain}",this.universeDomain);let l=r.get("subject_token_type"),f=r.get("workforce_pool_user_project"),d=r.get("service_account_impersonation_url"),h=r.get("service_account_impersonation"),m=(0,$E.originalOrCamelOptions)(h).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(r.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),o&&(this.clientAuth={confidentialClientType:"basic",clientId:o,clientSecret:s}),this.stsCredential=new lP.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=r.get("scopes")||[wd],this.cachedAccessToken=null,this.audience=r.get("audience"),this.subjectTokenType=l,this.workforcePoolUserProject=f;let g=new RegExp(hP);if(this.workforcePoolUserProject&&!this.audience.match(g))throw new Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=d,this.serviceAccountImpersonationLifetime=m,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=dP),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){var t;if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw new RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let i=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return((t=i==null?void 0:i.groups)==null?void 0:t.email)||null}return null}setCredentials(t){super.setCredentials(t),this.cachedAccessToken=t}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let t=await this.getAccessToken(),r=new Headers({authorization:`Bearer ${t.token}`});return this.addSharedMetadataHeaders(r)}request(t,r){if(r)this.requestAsync(t).then(i=>r(null,i),i=>r(i,i.response));else return this.requestAsync(t)}async getProjectId(){let t=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(t){let r=await this.getRequestHeaders(),i={...Il.RETRY_CONFIG,headers:r,url:`${this.cloudResourceManagerURL.toString()}${t}`};vd.AuthClient.setMethodName(i,"getProjectId");let o=await this.transporter.request(i);return this.projectId=o.data.projectId,this.projectId}return null}async requestAsync(t,r=!1){let i;try{let o=await this.getRequestHeaders();t.headers=sP.Gaxios.mergeHeaders(t.headers),this.addUserProjectAndAuthHeaders(t.headers,o),i=await this.transporter.request(t)}catch(o){let s=o.response;if(s){let l=s.status,f=s.config.data instanceof aP.Readable;if(!r&&(l===401||l===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(t,!0)}throw o}return i}async refreshAccessTokenAsync(){ce(this,oi,D(this,oi)||re(this,Rl,WE).call(this));try{return await D(this,oi)}finally{ce(this,oi,null)}}getProjectNumber(t){let r=t.match(/\/projects\/([^/]+)/);return r?r[1]:null}async getImpersonatedAccessToken(t){let r={...Il.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${t}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};vd.AuthClient.setMethodName(r,"getImpersonatedAccessToken");let i=await this.transporter.request(r),o=i.data;return{access_token:o.accessToken,expiry_date:new Date(o.expireTime).getTime(),res:i}}isExpired(t){let r=new Date().getTime();return t.expiry_date?r>=t.expiry_date-this.eagerRefreshThresholdMillis:!1}getScopesArray(){return typeof this.scopes=="string"?[this.scopes]:this.scopes||[wd]}getMetricsHeaderValue(){let t=process.version.replace(/^v/,""),r=this.serviceAccountImpersonationUrl!==void 0,i=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${t} auth/${uP.pkg.version} google-byoid-sdk source/${i} sa-impersonation/${r} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}};oi=new WeakMap,Rl=new WeakSet,WE=async function(){let t=await this.retrieveSubjectToken(),r={grantType:cP,audience:this.audience,requestedTokenType:fP,subjectToken:t,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[wd]:this.getScopesArray()},i=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,o=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),s=await this.stsCredential.exchangeToken(r,o,i);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(s.access_token):s.expires_in?this.cachedAccessToken={access_token:s.access_token,expiry_date:new Date().getTime()+s.expires_in*1e3,res:s.res}:this.cachedAccessToken={access_token:s.access_token,res:s.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken};var Cd=Il;Xt.BaseExternalAccountClient=Cd});var KE=K(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.FileSubjectTokenSupplier=void 0;var bd=require("util"),Rd=require("fs"),zE,mP=(0,bd.promisify)((zE=Rd.readFile)!=null?zE:(()=>{})),JE,gP=(0,bd.promisify)((JE=Rd.realpath)!=null?JE:(()=>{})),YE,yP=(0,bd.promisify)((YE=Rd.lstat)!=null?YE:(()=>{})),Ad=class{constructor(e){x(this,"filePath");x(this,"formatType");x(this,"subjectTokenFieldName");this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e=this.filePath;try{if(e=await gP(e),!(await yP(e)).isFile())throw new Error}catch(i){throw i instanceof Error&&(i.message=`The file at ${e} does not exist, or it is not a file. ${i.message}`),i}let t,r=await mP(e,{encoding:"utf8"});if(this.formatType==="text"?t=r:this.formatType==="json"&&this.subjectTokenFieldName&&(t=JSON.parse(r)[this.subjectTokenFieldName]),!t)throw new Error("Unable to parse the subject_token from the credential_source file");return t}};Pl.FileSubjectTokenSupplier=Ad});var XE=K(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});xl.UrlSubjectTokenSupplier=void 0;var _P=Mt(),Id=class{constructor(e){x(this,"url");x(this,"headers");x(this,"formatType");x(this,"subjectTokenFieldName");x(this,"additionalGaxiosOptions");this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};_P.AuthClient.setMethodName(t,"getSubjectToken");let r;if(this.formatType==="text"?r=(await e.transporter.request(t)).data:this.formatType==="json"&&this.subjectTokenFieldName&&(r=(await e.transporter.request(t)).data[this.subjectTokenFieldName]),!r)throw new Error("Unable to parse the subject_token from the credential_source URL");return r}};xl.UrlSubjectTokenSupplier=Id});var tS=K(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.CertificateSubjectTokenSupplier=Ft.InvalidConfigurationError=Ft.CertificateSourceUnavailableError=Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;var kl=dn(),Nl=require("fs"),Ml=require("crypto"),EP=require("https");Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";var Dn=class extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}};Ft.CertificateSourceUnavailableError=Dn;var Qt=class extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}};Ft.InvalidConfigurationError=Qt;var On,QE,ZE,jE,eS,Pd=class{constructor(e){se(this,On);x(this,"certificateConfigPath");x(this,"trustChainPath");x(this,"cert");x(this,"key");var t;if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new Qt("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new Qt("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=(t=e.certificateConfigLocation)!=null?t:""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new Qt("Cannot create mTLS Agent with missing certificate or key");return new EP.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await re(this,On,QE).call(this);let{certPath:e,keyPath:t}=await re(this,On,ZE).call(this);return{cert:this.cert,key:this.key}=await re(this,On,jE).call(this,e,t),await re(this,On,eS).call(this,this.cert)}};On=new WeakSet,QE=async function(){let e=this.certificateConfigPath;if(e){if(await(0,kl.isValidFile)(e))return e;throw new Dn(`Provided certificate config path is invalid: ${e}`)}let t=process.env[Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(t){if(await(0,kl.isValidFile)(t))return t;throw new Dn(`Path from environment variable "${Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${t}`)}let r=(0,kl.getWellKnownCertificateConfigFileLocation)();if(await(0,kl.isValidFile)(r))return r;throw new Dn(`Could not find certificate configuration file. Searched override path, the "${Ft.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${r}).`)},ZE=async function(){var r,i,o,s;let e=this.certificateConfigPath,t;try{t=await Nl.promises.readFile(e,"utf8")}catch(l){throw new Dn(`Failed to read certificate config file at: ${e}`)}try{let l=JSON.parse(t),f=(i=(r=l==null?void 0:l.cert_configs)==null?void 0:r.workload)==null?void 0:i.cert_path,d=(s=(o=l==null?void 0:l.cert_configs)==null?void 0:o.workload)==null?void 0:s.key_path;if(!f||!d)throw new Qt(`Certificate config file (${e}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:f,keyPath:d}}catch(l){throw l instanceof Qt?l:new Qt(`Failed to parse certificate config from ${e}: ${l.message}`)}},jE=async function(e,t){let r,i;try{r=await Nl.promises.readFile(e),new Ml.X509Certificate(r)}catch(o){let s=o instanceof Error?o.message:String(o);throw new Dn(`Failed to read certificate file at ${e}: ${s}`)}try{i=await Nl.promises.readFile(t),(0,Ml.createPrivateKey)(i)}catch(o){let s=o instanceof Error?o.message:String(o);throw new Dn(`Failed to read private key file at ${t}: ${s}`)}return{cert:r,key:i}},eS=async function(e){var r;let t=new Ml.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let s=((r=(await Nl.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g))!=null?r:[]).map((d,h)=>{try{return new Ml.X509Certificate(d)}catch(m){let g=m instanceof Error?m.message:String(m);throw new Qt(`Failed to parse certificate at index ${h} in trust chain file ${this.trustChainPath}: ${g}`)}}),l=s.findIndex(d=>t.raw.equals(d.raw)),f;if(l===-1)f=[t,...s];else if(l===0)f=s;else throw new Qt(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${l}).`);return JSON.stringify(f.map(d=>d.raw.toString("base64")))}catch(i){if(i instanceof Qt)throw i;let o=i instanceof Error?i.message:String(i);throw new Dn(`Failed to process certificate chain from ${this.trustChainPath}: ${o}`)}};Ft.CertificateSubjectTokenSupplier=Pd});var Nd=K(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});Dl.IdentityPoolClient=void 0;var SP=Rr(),xd=dn(),TP=KE(),vP=XE(),nS=tS(),wP=bl(),rS=Ze(),kd=class n extends SP.BaseExternalAccountClient{constructor(t){super(t);x(this,"subjectTokenSupplier");let r=(0,xd.originalOrCamelOptions)(t),i=r.get("credential_source"),o=r.get("subject_token_supplier");if(!i&&!o)throw new Error("A credential source or subject token supplier must be specified.");if(i&&o)throw new Error("Only one of credential source or subject token supplier can be specified.");if(o)this.subjectTokenSupplier=o,this.credentialSourceType="programmatic";else{let s=(0,xd.originalOrCamelOptions)(i),l=(0,xd.originalOrCamelOptions)(s.get("format")),f=l.get("type")||"text",d=l.get("subject_token_field_name");if(f!=="json"&&f!=="text")throw new Error(`Invalid credential_source format "${f}"`);if(f==="json"&&!d)throw new Error("Missing subject_token_field_name for JSON credential_source format");let h=s.get("file"),m=s.get("url"),g=s.get("certificate"),E=s.get("headers");if(h&&m||m&&g||h&&g)throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(h)this.credentialSourceType="file",this.subjectTokenSupplier=new TP.FileSubjectTokenSupplier({filePath:h,formatType:f,subjectTokenFieldName:d});else if(m)this.credentialSourceType="url",this.subjectTokenSupplier=new vP.UrlSubjectTokenSupplier({url:m,formatType:f,subjectTokenFieldName:d,headers:E,additionalGaxiosOptions:n.RETRY_CONFIG});else if(g){this.credentialSourceType="certificate";let w=new nS.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:g.use_default_certificate_config,certificateConfigLocation:g.certificate_config_location,trustChainPath:g.trust_chain_path});this.subjectTokenSupplier=w}else throw new Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let t=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof nS.CertificateSubjectTokenSupplier){let r=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new wP.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new rS.Gaxios({agent:r})}),this.transporter=new rS.Gaxios({...this.transporter.defaults||{},agent:r})}return t}};Dl.IdentityPoolClient=kd});var Dd=K(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});Ul.AwsRequestSigner=void 0;var Ol=Ze(),oS=Es(),iS="AWS4-HMAC-SHA256",CP="aws4_request",Md=class{constructor(e,t){x(this,"getCredentials");x(this,"region");x(this,"crypto");this.getCredentials=e,this.region=t,this.crypto=(0,oS.createCrypto)()}async getRequestOptions(e){if(!e.url)throw new RangeError('"url" is required in "amzOptions"');let t=typeof e.data=="object"?JSON.stringify(e.data):e.data,r=e.url,i=e.method||"GET",o=e.body||t,s=e.headers,l=await this.getCredentials(),f=new URL(r);if(typeof o!="string"&&o!==void 0)throw new TypeError(`'requestPayload' is expected to be a string if provided. Got: ${o}`);let d=await bP({crypto:this.crypto,host:f.host,canonicalUri:f.pathname,canonicalQuerystring:f.search.slice(1),method:i,region:this.region,securityCredentials:l,requestPayload:o,additionalAmzHeaders:s}),h=Ol.Gaxios.mergeHeaders(d.amzDate?{"x-amz-date":d.amzDate}:{},{authorization:d.authorizationHeader,host:f.host},s||{});l.token&&Ol.Gaxios.mergeHeaders(h,{"x-amz-security-token":l.token});let m={url:r,method:i,headers:h};return o!==void 0&&(m.body=o),m}};Ul.AwsRequestSigner=Md;async function ks(n,e,t){return await n.signWithHmacSha256(e,t)}async function AP(n,e,t,r,i){let o=await ks(n,`AWS4${e}`,t),s=await ks(n,o,r),l=await ks(n,s,i);return await ks(n,l,"aws4_request")}async function bP(n){let e=Ol.Gaxios.mergeHeaders(n.additionalAmzHeaders),t=n.requestPayload||"",r=n.host.split(".")[0],i=new Date,o=i.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),s=i.toISOString().replace(/[-]/g,"").replace(/T.*/,"");n.securityCredentials.token&&e.set("x-amz-security-token",n.securityCredentials.token);let l=Ol.Gaxios.mergeHeaders({host:n.host},e.has("date")?{}:{"x-amz-date":o},e),f="",d=[...l.keys()].sort();d.forEach(z=>{f+=`${z}:${l.get(z)}
`});let h=d.join(";"),m=await n.crypto.sha256DigestHex(t),g=`${n.method.toUpperCase()}
${n.canonicalUri}
${n.canonicalQuerystring}
${f}
${h}
${m}`,E=`${s}/${n.region}/${r}/${CP}`,w=`${iS}
${o}
${E}
`+await n.crypto.sha256DigestHex(g),C=await AP(n.crypto,n.securityCredentials.secretAccessKey,s,n.region,r),R=await ks(n.crypto,C,w),P=`${iS} Credential=${n.securityCredentials.accessKeyId}/${E}, SignedHeaders=${h}, Signature=${(0,oS.fromArrayBufferToHex)(R)}`;return{amzDate:e.has("date")?void 0:o,authorizationHeader:P,canonicalQuerystring:n.canonicalQuerystring}}});var lS=K(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});ql.DefaultAwsSecurityCredentialsSupplier=void 0;var Fl=Mt(),it,Ud,sS,aS,Ll,Fd,Od=class{constructor(e){se(this,it);x(this,"regionUrl");x(this,"securityCredentialsUrl");x(this,"imdsV2SessionTokenUrl");x(this,"additionalGaxiosOptions");this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(D(this,it,Ll))return D(this,it,Ll);let t=new Headers;if(!D(this,it,Ll)&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await re(this,it,Ud).call(this,e.transporter)),!this.regionUrl)throw new RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let r={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};Fl.AuthClient.setMethodName(r,"getAwsRegion");let i=await e.transporter.request(r);return i.data.substr(0,i.data.length-1)}async getAwsSecurityCredentials(e){if(D(this,it,Fd))return D(this,it,Fd);let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await re(this,it,Ud).call(this,e.transporter));let r=await re(this,it,sS).call(this,t,e.transporter),i=await re(this,it,aS).call(this,r,t,e.transporter);return{accessKeyId:i.AccessKeyId,secretAccessKey:i.SecretAccessKey,token:i.Token}}};it=new WeakSet,Ud=async function(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return Fl.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data},sS=async function(e,t){if(!this.securityCredentialsUrl)throw new Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let r={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return Fl.AuthClient.setMethodName(r,"#getAwsRoleName"),(await t.request(r)).data},aS=async function(e,t,r){let i={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return Fl.AuthClient.setMethodName(i,"#retrieveAwsSecurityCredentials"),(await r.request(i)).data},Ll=function(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null},Fd=function(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null};ql.DefaultAwsSecurityCredentialsSupplier=Od});var qd=K(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});Gl.AwsClient=void 0;var RP=Dd(),IP=Rr(),PP=lS(),uS=dn(),xP=Ze(),Bl,si=class si extends IP.BaseExternalAccountClient{constructor(t){super(t);x(this,"environmentId");x(this,"awsSecurityCredentialsSupplier");x(this,"regionalCredVerificationUrl");x(this,"awsRequestSigner");x(this,"region");let r=(0,uS.originalOrCamelOptions)(t),i=r.get("credential_source"),o=r.get("aws_security_credentials_supplier");if(!i&&!o)throw new Error("A credential source or AWS security credentials supplier must be specified.");if(i&&o)throw new Error("Only one of credential source or AWS security credentials supplier can be specified.");if(o)this.awsSecurityCredentialsSupplier=o,this.regionalCredVerificationUrl=D(si,Bl),this.credentialSourceType="programmatic";else{let s=(0,uS.originalOrCamelOptions)(i);this.environmentId=s.get("environment_id");let l=s.get("region_url"),f=s.get("url"),d=s.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new PP.DefaultAwsSecurityCredentialsSupplier({regionUrl:l,securityCredentialsUrl:f,imdsV2SessionTokenUrl:d}),this.regionalCredVerificationUrl=s.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){var r;let t=(r=this.environmentId)==null?void 0:r.match(/^(aws)(\d+)$/);if(!t||!this.regionalCredVerificationUrl)throw new Error('No valid AWS "credential_source" provided');if(parseInt(t[2],10)!==1)throw new Error(`aws version "${t[2]}" is not supported in the current build.`)}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new RP.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let t=await this.awsRequestSigner.getRequestOptions({...si.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),r=[];return xP.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},t.headers).forEach((o,s)=>r.push({key:s,value:o})),encodeURIComponent(JSON.stringify({url:t.url,method:t.method,headers:r}))}};Bl=new WeakMap,se(si,Bl,"https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15"),x(si,"AWS_EC2_METADATA_IPV4_ADDRESS","169.254.169.254"),x(si,"AWS_EC2_METADATA_IPV6_ADDRESS","fd00:ec2::254");var Ld=si;Gl.AwsClient=Ld});var $d=K(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});Ve.InvalidSubjectTokenError=Ve.InvalidMessageFieldError=Ve.InvalidCodeFieldError=Ve.InvalidTokenTypeFieldError=Ve.InvalidExpirationTimeFieldError=Ve.InvalidSuccessFieldError=Ve.InvalidVersionFieldError=Ve.ExecutableResponseError=Ve.ExecutableResponse=void 0;var Hl="urn:ietf:params:oauth:token-type:saml2",Bd="urn:ietf:params:oauth:token-type:id_token",Gd="urn:ietf:params:oauth:token-type:jwt",Hd=class{constructor(e){x(this,"version");x(this,"success");x(this,"expirationTime");x(this,"tokenType");x(this,"errorCode");x(this,"errorMessage");x(this,"subjectToken");if(!e.version)throw new Vl("Executable response must contain a 'version' field.");if(e.success===void 0)throw new $l("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==Hl&&this.tokenType!==Bd&&this.tokenType!==Gd)throw new Wl(`Executable response must contain a 'token_type' field when successful and it must be one of ${Bd}, ${Gd}, or ${Hl}.`);if(this.tokenType===Hl){if(!e.saml_response)throw new Ns(`Executable response must contain a 'saml_response' field when token_type=${Hl}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new Ns(`Executable response must contain a 'id_token' field when token_type=${Bd} or ${Gd}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new zl("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new Jl("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return this.expirationTime!==void 0&&this.expirationTime<Math.round(Date.now()/1e3)}};Ve.ExecutableResponse=Hd;var Un=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}};Ve.ExecutableResponseError=Un;var Vl=class extends Un{};Ve.InvalidVersionFieldError=Vl;var $l=class extends Un{};Ve.InvalidSuccessFieldError=$l;var Vd=class extends Un{};Ve.InvalidExpirationTimeFieldError=Vd;var Wl=class extends Un{};Ve.InvalidTokenTypeFieldError=Wl;var zl=class extends Un{};Ve.InvalidCodeFieldError=zl;var Jl=class extends Un{};Ve.InvalidMessageFieldError=Jl;var Ns=class extends Un{};Ve.InvalidSubjectTokenError=Ns});var Jd=K(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.PluggableAuthHandler=fo.ExecutableError=void 0;var ai=$d(),kP=require("child_process"),Wd=require("fs"),Yl=class extends Error{constructor(t,r){super(`The executable failed with exit code: ${r} and error message: ${t}.`);x(this,"code");this.code=r,Object.setPrototypeOf(this,new.target.prototype)}};fo.ExecutableError=Yl;var zd=class n{constructor(e){x(this,"commandComponents");x(this,"timeoutMillis");x(this,"outputFile");if(!e.command)throw new Error("No command provided.");if(this.commandComponents=n.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw new Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,r)=>{let i=kP.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),o="";i.stdout.on("data",l=>{o+=l}),i.stderr.on("data",l=>{o+=l});let s=setTimeout(()=>(i.removeAllListeners(),i.kill(),r(new Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);i.on("close",l=>{if(clearTimeout(s),l===0)try{let f=JSON.parse(o),d=new ai.ExecutableResponse(f);return t(d)}catch(f){return f instanceof ai.ExecutableResponseError?r(f):r(new ai.ExecutableResponseError(`The executable returned an invalid response: ${o}`))}else return r(new Yl(o,l.toString()))})})}async retrieveCachedResponse(){if(!this.outputFile||this.outputFile.length===0)return;let e;try{e=await Wd.promises.realpath(this.outputFile)}catch(r){return}if(!(await Wd.promises.lstat(e)).isFile())return;let t=await Wd.promises.readFile(e,{encoding:"utf8"});if(t!=="")try{let r=JSON.parse(t);return new ai.ExecutableResponse(r).isValid()?new ai.ExecutableResponse(r):void 0}catch(r){throw r instanceof ai.ExecutableResponseError?r:new ai.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw new Error(`Provided command: "${e}" could not be parsed.`);for(let r=0;r<t.length;r++)t[r][0]==='"'&&t[r].slice(-1)==='"'&&(t[r]=t[r].slice(1,-1));return t}};fo.PluggableAuthHandler=zd});var Kd=K(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.PluggableAuthClient=ho.ExecutableError=void 0;var NP=Rr(),MP=$d(),cS=Jd(),DP=Jd();Object.defineProperty(ho,"ExecutableError",{enumerable:!0,get:function(){return DP.ExecutableError}});var OP=30*1e3,fS=5*1e3,dS=120*1e3,UP="GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES",hS=1,Yd=class extends NP.BaseExternalAccountClient{constructor(t){super(t);x(this,"command");x(this,"timeoutMillis");x(this,"outputFile");x(this,"handler");if(!t.credential_source.executable)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(this.command=t.credential_source.executable.command,!this.command)throw new Error('No valid Pluggable Auth "credential_source" provided.');if(t.credential_source.executable.timeout_millis===void 0)this.timeoutMillis=OP;else if(this.timeoutMillis=t.credential_source.executable.timeout_millis,this.timeoutMillis<fS||this.timeoutMillis>dS)throw new Error(`Timeout must be between ${fS} and ${dS} milliseconds.`);this.outputFile=t.credential_source.executable.output_file,this.handler=new cS.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){if(process.env[UP]!=="1")throw new Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");let t;if(this.outputFile&&(t=await this.handler.retrieveCachedResponse()),!t){let r=new Map;r.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),r.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),r.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&r.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let i=this.getServiceAccountEmail();i&&r.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",i),t=await this.handler.retrieveResponseFromExecutable(r)}if(t.version>hS)throw new Error(`Version of executable is not currently supported, maximum supported version is ${hS}.`);if(!t.success)throw new cS.ExecutableError(t.errorMessage,t.errorCode);if(this.outputFile&&!t.expirationTime)throw new MP.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(t.isExpired())throw new Error("Executable response is expired.");return t.subjectToken}};ho.PluggableAuthClient=Yd});var Qd=K(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});Kl.ExternalAccountClient=void 0;var FP=Rr(),LP=Nd(),qP=qd(),BP=Kd(),Xd=class{constructor(){throw new Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){var t,r;return e&&e.type===FP.EXTERNAL_ACCOUNT_TYPE?(t=e.credential_source)!=null&&t.environment_id?new qP.AwsClient(e):(r=e.credential_source)!=null&&r.executable?new BP.PluggableAuthClient(e):new LP.IdentityPoolClient(e):null}};Kl.ExternalAccountClient=Xd});var th=K(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.ExternalAccountAuthorizedUserClient=po.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;var mS=Mt(),pS=Ed(),gS=Ze(),GP=require("stream"),HP=Rr();po.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";var VP="https://sts.{universeDomain}/v1/oauthtoken",Ms,eh=class eh extends pS.OAuthClientAuthHandler{constructor(t){super(t);se(this,Ms);ce(this,Ms,t.tokenRefreshEndpoint)}async refreshToken(t,r){let i={...eh.RETRY_CONFIG,url:D(this,Ms),method:"POST",headers:r,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:t})};mS.AuthClient.setMethodName(i,"refreshToken"),this.applyClientAuthenticationOptions(i);try{let o=await this.transporter.request(i),s=o.data;return s.res=o,s}catch(o){throw o instanceof gS.GaxiosError&&o.response?(0,pS.getErrorFromOAuthErrorResponse)(o.response.data,o):o}}};Ms=new WeakMap;var Zd=eh,jd=class extends mS.AuthClient{constructor(t){var i;super(t);x(this,"cachedAccessToken");x(this,"externalAccountAuthorizedUserHandler");x(this,"refreshToken");t.universe_domain&&(this.universeDomain=t.universe_domain),this.refreshToken=t.refresh_token;let r={confidentialClientType:"basic",clientId:t.client_id,clientSecret:t.client_secret};this.externalAccountAuthorizedUserHandler=new Zd({tokenRefreshEndpoint:(i=t.token_url)!=null?i:VP.replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:r}),this.cachedAccessToken=null,this.quotaProjectId=t.quota_project_id,typeof(t==null?void 0:t.eagerRefreshThresholdMillis)!="number"?this.eagerRefreshThresholdMillis=HP.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=t.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!(t!=null&&t.forceRefreshOnFailure)}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let t=await this.getAccessToken(),r=new Headers({authorization:`Bearer ${t.token}`});return this.addSharedMetadataHeaders(r)}request(t,r){if(r)this.requestAsync(t).then(i=>r(null,i),i=>r(i,i.response));else return this.requestAsync(t)}async requestAsync(t,r=!1){let i;try{let o=await this.getRequestHeaders();t.headers=gS.Gaxios.mergeHeaders(t.headers),this.addUserProjectAndAuthHeaders(t.headers,o),i=await this.transporter.request(t)}catch(o){let s=o.response;if(s){let l=s.status,f=s.config.data instanceof GP.Readable;if(!r&&(l===401||l===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(t,!0)}throw o}return i}async refreshAccessTokenAsync(){let t=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:t.access_token,expiry_date:new Date().getTime()+t.expires_in*1e3,res:t.res},t.refresh_token!==void 0&&(this.refreshToken=t.refresh_token),this.cachedAccessToken}isExpired(t){let r=new Date().getTime();return t.expiry_date?r>=t.expiry_date-this.eagerRefreshThresholdMillis:!1}};po.ExternalAccountAuthorizedUserClient=jd});var TS=K(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.GoogleAuth=gn.GoogleAuthExceptionMessages=void 0;var $P=require("child_process"),Ds=require("fs"),WP=Ze(),Os=_s(),zP=require("os"),nh=require("path"),JP=Es(),YP=Wf(),KP=Jf(),XP=Yf(),mo=hd(),yS=md(),go=yd(),QP=Qd(),Us=Rr(),rh=Mt(),_S=th(),ES=dn();gn.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:`Unable to detect a Project Id in the current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_CREDENTIALS_FOUND:`Unable to find credentials in current environment. 
To learn more about authentication and Google APIs, visit: 
https://cloud.google.com/docs/authentication/getting-started`,NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:`Unable to detect a Universe Domain in the current environment.
To learn more about Universe Domain retrieval, visit: 
https://cloud.google.com/compute/docs/metadata/predefined-metadata-keys`};var li,Fn,yo,SS,ih=class{constructor(e={}){se(this,Fn);x(this,"checkIsGCE");x(this,"useJWTAccessWithScope");x(this,"defaultServicePath");x(this,"_findProjectIdPromise");x(this,"_cachedProjectId");x(this,"jsonContent",null);x(this,"apiKey");x(this,"cachedCredential",null);se(this,li,null);x(this,"defaultScopes");x(this,"keyFilename");x(this,"scopes");x(this,"clientOptions",{});if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw new RangeError(gn.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}get isGCE(){return this.checkIsGCE}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(e)this.getProjectIdAsync().then(t=>e(null,t),e);else return this.getProjectIdAsync()}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===gn.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||(e=await this.getProductionProjectId()),e||(e=await this.getFileProjectId()),e||(e=await this.getDefaultServiceProjectId()),e||(e=await this.getGCEProjectId()),e||(e=await this.getExternalAccountClientProjectId()),e)return this._cachedProjectId=e,e;throw new Error(gn.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){var t;let e;try{e=await Os.universe("universe-domain"),e||(e=rh.DEFAULT_UNIVERSE)}catch(r){if(r&&((t=r==null?void 0:r.response)==null?void 0:t.status)===404)e=rh.DEFAULT_UNIVERSE;else throw r}return e}async getUniverseDomain(){let e=(0,ES.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e!=null||(e=(await this.getClient()).universeDomain)}catch(t){e!=null||(e=rh.DEFAULT_UNIVERSE)}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let r;if(typeof e=="function"?t=e:r=e,t)this.getApplicationDefaultAsync(r).then(i=>t(null,i.credential,i.projectId),t);else return this.getApplicationDefaultAsync(r)}async getApplicationDefaultAsync(e={}){if(this.cachedCredential)return await re(this,Fn,yo).call(this,this.cachedCredential,null);let t;if(t=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e),t)return t instanceof mo.JWT?t.scopes=this.scopes:t instanceof Us.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await re(this,Fn,yo).call(this,t);if(t=await this._tryGetApplicationCredentialsFromWellKnownFile(e),t)return t instanceof mo.JWT?t.scopes=this.scopes:t instanceof Us.BaseExternalAccountClient&&(t.scopes=this.getAnyScopes()),await re(this,Fn,yo).call(this,t);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await re(this,Fn,yo).call(this,new YP.Compute(e));throw new Error(gn.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async _checkIsGCE(){return this.checkIsGCE===void 0&&(this.checkIsGCE=Os.getGCPResidency()||await Os.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||t.length===0)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(r){throw r instanceof Error&&(r.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${r.message}`),r}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let i=process.env.HOME;i&&(t=nh.join(i,".config"))}return t&&(t=nh.join(t,"gcloud","application_default_credentials.json"),Ds.existsSync(t)||(t=null)),t?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||e.length===0)throw new Error("The file path is invalid.");try{if(e=Ds.realpathSync(e),!Ds.lstatSync(e).isFile())throw new Error}catch(i){throw i instanceof Error&&(i.message=`The file at ${e} does not exist, or it is not a file. ${i.message}`),i}let r=Ds.createReadStream(e);return this.fromStream(r,t)}fromImpersonatedJSON(e){var o,s,l,f;if(!e)throw new Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==go.IMPERSONATED_ACCOUNT_TYPE)throw new Error(`The incoming JSON object does not have the "${go.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw new Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw new Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(((o=e.service_account_impersonation_url)==null?void 0:o.length)>256)throw new RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let r=(l=(s=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url))==null?void 0:s.groups)==null?void 0:l.target;if(!r)throw new RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let i=(f=this.scopes||e.scopes||this.defaultScopes)!=null?f:[];return new go.Impersonated({...e,sourceClient:t,targetPrincipal:r,targetScopes:Array.isArray(i)?i:[i]})}fromJSON(e,t={}){let r,i=(0,ES.originalOrCamelOptions)(t).get("universe_domain");return e.type===yS.USER_REFRESH_ACCOUNT_TYPE?(r=new yS.UserRefreshClient(t),r.fromJSON(e)):e.type===go.IMPERSONATED_ACCOUNT_TYPE?r=this.fromImpersonatedJSON(e):e.type===Us.EXTERNAL_ACCOUNT_TYPE?(r=QP.ExternalAccountClient.fromJSON({...e,...t}),r.scopes=this.getAnyScopes()):e.type===_S.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?r=new _S.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,r=new mo.JWT(t),this.setGapicJWTValues(r),r.fromJSON(e)),i&&(r.universeDomain=i),r}_cacheClientFromJSON(e,t){let r=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=r,r}fromStream(e,t={},r){let i={};if(typeof t=="function"?r=t:i=t,r)this.fromStreamAsync(e,i).then(o=>r(null,o),r);else return this.fromStreamAsync(e,i)}fromStreamAsync(e,t){return new Promise((r,i)=>{if(!e)throw new Error("Must pass in a stream containing the Google auth settings.");let o=[];e.setEncoding("utf8").on("error",i).on("data",s=>o.push(s)).on("end",()=>{try{try{let s=JSON.parse(o.join("")),l=this._cacheClientFromJSON(s,t);return r(l)}catch(s){if(!this.keyFilename)throw s;let l=new mo.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=l,this.setGapicJWTValues(l),r(l)}}catch(s){return i(s)}})})}fromAPIKey(e,t={}){return new mo.JWT({...t,apiKey:e})}_isWindows(){let e=zP.platform();return!!(e&&e.length>=3&&e.substring(0,3).toLowerCase()==="win")}async getDefaultServiceProjectId(){return new Promise(e=>{(0,$P.exec)("gcloud config config-helper --format json",(t,r)=>{if(!t&&r)try{let i=JSON.parse(r).configuration.properties.core.project;e(i);return}catch(i){}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let t=await this.getClient();if(t&&t.projectId)return t.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){return!this.jsonContent||this.jsonContent.type!==Us.EXTERNAL_ACCOUNT_TYPE?null:await(await this.getClient()).getProjectId()}async getGCEProjectId(){try{return await Os.project("project-id")}catch(e){return null}}getCredentials(e){if(e)this.getCredentialsAsync().then(t=>e(null,t),e);else return this.getCredentialsAsync()}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof go.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof Us.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[t,r]=await Promise.all([Os.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:t,universe_domain:r}}throw new Error(gn.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;ce(this,li,D(this,li)||re(this,Fn,SS).call(this));try{return await D(this,li)}finally{ce(this,li,null)}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw new Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new KP.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){return(await(await this.getClient()).getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,i=await(await this.getClient()).getRequestHeaders(t);return e.headers=WP.Gaxios.mergeHeaders(e.headers,i),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,XP.getEnv)()}async sign(e,t){let r=await this.getClient(),i=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${i}/v1/projects/-/serviceAccounts/`,r instanceof go.Impersonated)return(await r.sign(e)).signedBlob;let o=(0,JP.createCrypto)();if(r instanceof mo.JWT&&r.key)return await o.sign(r.key,e);let s=await this.getCredentials();if(!s.client_email)throw new Error("Cannot sign data without `client_email`.");return this.signBlob(o,s.client_email,e,t)}async signBlob(e,t,r,i){let o=new URL(i+`${t}:signBlob`);return(await this.request({method:"POST",url:o.href,data:{payload:e.encodeBase64StringUtf8(r)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}};li=new WeakMap,Fn=new WeakSet,yo=async function(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let r=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:r}},SS=async function(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=nh.resolve(this.keyFilename),t=Ds.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}else if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await re(this,Fn,yo).call(this,e);return t}else{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}};gn.GoogleAuth=ih});var vS=K(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});Xl.IAMAuth=void 0;var oh=class{constructor(e,t){x(this,"selector");x(this,"token");this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}};Xl.IAMAuth=oh});var wS=K(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.DownscopedClient=Ln.EXPIRATION_TIME_OFFSET=Ln.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;var ZP=Ze(),jP=require("stream"),sh=Mt(),ex=bl(),tx="urn:ietf:params:oauth:grant-type:token-exchange",nx="urn:ietf:params:oauth:token-type:access_token",rx="urn:ietf:params:oauth:token-type:access_token";Ln.MAX_ACCESS_BOUNDARY_RULES_COUNT=10;Ln.EXPIRATION_TIME_OFFSET=300*1e3;var ah=class extends sh.AuthClient{constructor(t,r={accessBoundary:{accessBoundaryRules:[]}}){super(t instanceof sh.AuthClient?{}:t);x(this,"authClient");x(this,"credentialAccessBoundary");x(this,"cachedDownscopedAccessToken");x(this,"stsCredential");if(t instanceof sh.AuthClient?(this.authClient=t,this.credentialAccessBoundary=r):(this.authClient=t.authClient,this.credentialAccessBoundary=t.credentialAccessBoundary),this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length===0)throw new Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>Ln.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw new Error(`The provided access boundary has more than ${Ln.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let i of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(i.availablePermissions.length===0)throw new Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new ex.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(t){if(!t.expiry_date)throw new Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(t),this.cachedDownscopedAccessToken=t}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let t=await this.getAccessToken(),r=new Headers({authorization:`Bearer ${t.token}`});return this.addSharedMetadataHeaders(r)}request(t,r){if(r)this.requestAsync(t).then(i=>r(null,i),i=>r(i,i.response));else return this.requestAsync(t)}async requestAsync(t,r=!1){let i;try{let o=await this.getRequestHeaders();t.headers=ZP.Gaxios.mergeHeaders(t.headers),this.addUserProjectAndAuthHeaders(t.headers,o),i=await this.transporter.request(t)}catch(o){let s=o.response;if(s){let l=s.status,f=s.config.data instanceof jP.Readable;if(!r&&(l===401||l===403)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(t,!0)}throw o}return i}async refreshAccessTokenAsync(){var l;let t=(await this.authClient.getAccessToken()).token,r={grantType:tx,requestedTokenType:nx,subjectToken:t,subjectTokenType:rx},i=await this.stsCredential.exchangeToken(r,void 0,this.credentialAccessBoundary),o=((l=this.authClient.credentials)==null?void 0:l.expiry_date)||null,s=i.expires_in?new Date().getTime()+i.expires_in*1e3:o;return this.cachedDownscopedAccessToken={access_token:i.access_token,expiry_date:s,res:i.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(t){let r=new Date().getTime();return t.expiry_date?r>=t.expiry_date-this.eagerRefreshThresholdMillis:!1}};Ln.DownscopedClient=ah});var CS=K(Ql=>{"use strict";Object.defineProperty(Ql,"__esModule",{value:!0});Ql.PassThroughClient=void 0;var ix=Mt(),lh=class extends ix.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}};Ql.PassThroughClient=lh});var PS=K(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.GoogleAuth=ae.auth=ae.PassThroughClient=ae.ExternalAccountAuthorizedUserClient=ae.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=ae.ExecutableError=ae.PluggableAuthClient=ae.DownscopedClient=ae.BaseExternalAccountClient=ae.ExternalAccountClient=ae.IdentityPoolClient=ae.AwsRequestSigner=ae.AwsClient=ae.UserRefreshClient=ae.LoginTicket=ae.ClientAuthentication=ae.OAuth2Client=ae.CodeChallengeMethod=ae.Impersonated=ae.JWT=ae.JWTAccess=ae.IdTokenClient=ae.IAMAuth=ae.GCPEnv=ae.Compute=ae.DEFAULT_UNIVERSE=ae.AuthClient=ae.gaxios=ae.gcpMetadata=void 0;var AS=TS();Object.defineProperty(ae,"GoogleAuth",{enumerable:!0,get:function(){return AS.GoogleAuth}});ae.gcpMetadata=_s();ae.gaxios=Ze();var bS=Mt();Object.defineProperty(ae,"AuthClient",{enumerable:!0,get:function(){return bS.AuthClient}});Object.defineProperty(ae,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return bS.DEFAULT_UNIVERSE}});var ox=Wf();Object.defineProperty(ae,"Compute",{enumerable:!0,get:function(){return ox.Compute}});var sx=Yf();Object.defineProperty(ae,"GCPEnv",{enumerable:!0,get:function(){return sx.GCPEnv}});var ax=vS();Object.defineProperty(ae,"IAMAuth",{enumerable:!0,get:function(){return ax.IAMAuth}});var lx=Jf();Object.defineProperty(ae,"IdTokenClient",{enumerable:!0,get:function(){return lx.IdTokenClient}});var ux=fd();Object.defineProperty(ae,"JWTAccess",{enumerable:!0,get:function(){return ux.JWTAccess}});var cx=hd();Object.defineProperty(ae,"JWT",{enumerable:!0,get:function(){return cx.JWT}});var fx=yd();Object.defineProperty(ae,"Impersonated",{enumerable:!0,get:function(){return fx.Impersonated}});var uh=ii();Object.defineProperty(ae,"CodeChallengeMethod",{enumerable:!0,get:function(){return uh.CodeChallengeMethod}});Object.defineProperty(ae,"OAuth2Client",{enumerable:!0,get:function(){return uh.OAuth2Client}});Object.defineProperty(ae,"ClientAuthentication",{enumerable:!0,get:function(){return uh.ClientAuthentication}});var dx=Gf();Object.defineProperty(ae,"LoginTicket",{enumerable:!0,get:function(){return dx.LoginTicket}});var hx=md();Object.defineProperty(ae,"UserRefreshClient",{enumerable:!0,get:function(){return hx.UserRefreshClient}});var px=qd();Object.defineProperty(ae,"AwsClient",{enumerable:!0,get:function(){return px.AwsClient}});var mx=Dd();Object.defineProperty(ae,"AwsRequestSigner",{enumerable:!0,get:function(){return mx.AwsRequestSigner}});var gx=Nd();Object.defineProperty(ae,"IdentityPoolClient",{enumerable:!0,get:function(){return gx.IdentityPoolClient}});var yx=Qd();Object.defineProperty(ae,"ExternalAccountClient",{enumerable:!0,get:function(){return yx.ExternalAccountClient}});var _x=Rr();Object.defineProperty(ae,"BaseExternalAccountClient",{enumerable:!0,get:function(){return _x.BaseExternalAccountClient}});var Ex=wS();Object.defineProperty(ae,"DownscopedClient",{enumerable:!0,get:function(){return Ex.DownscopedClient}});var RS=Kd();Object.defineProperty(ae,"PluggableAuthClient",{enumerable:!0,get:function(){return RS.PluggableAuthClient}});Object.defineProperty(ae,"ExecutableError",{enumerable:!0,get:function(){return RS.ExecutableError}});var IS=th();Object.defineProperty(ae,"EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE",{enumerable:!0,get:function(){return IS.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE}});Object.defineProperty(ae,"ExternalAccountAuthorizedUserClient",{enumerable:!0,get:function(){return IS.ExternalAccountAuthorizedUserClient}});var Sx=CS();Object.defineProperty(ae,"PassThroughClient",{enumerable:!0,get:function(){return Sx.PassThroughClient}});var Tx=new AS.GoogleAuth;ae.auth=Tx});var nr=K((uB,NS)=>{"use strict";var xS=["nodebuffer","arraybuffer","fragments"],kS=typeof Blob!="undefined";kS&&xS.push("blob");NS.exports={BINARY_TYPES:xS,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:kS,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Fs=K((cB,Zl)=>{"use strict";var{EMPTY_BUFFER:vx}=nr(),ch=Buffer[Symbol.species];function wx(n,e){if(n.length===0)return vx;if(n.length===1)return n[0];let t=Buffer.allocUnsafe(e),r=0;for(let i=0;i<n.length;i++){let o=n[i];t.set(o,r),r+=o.length}return r<e?new ch(t.buffer,t.byteOffset,r):t}function MS(n,e,t,r,i){for(let o=0;o<i;o++)t[r+o]=n[o]^e[o&3]}function DS(n,e){for(let t=0;t<n.length;t++)n[t]^=e[t&3]}function Cx(n){return n.length===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.length)}function fh(n){if(fh.readOnly=!0,Buffer.isBuffer(n))return n;let e;return n instanceof ArrayBuffer?e=new ch(n):ArrayBuffer.isView(n)?e=new ch(n.buffer,n.byteOffset,n.byteLength):(e=Buffer.from(n),fh.readOnly=!1),e}Zl.exports={concat:wx,mask:MS,toArrayBuffer:Cx,toBuffer:fh,unmask:DS};if(!process.env.WS_NO_BUFFER_UTIL)try{let n=require("bufferutil");Zl.exports.mask=function(e,t,r,i,o){o<48?MS(e,t,r,i,o):n.mask(e,t,r,i,o)},Zl.exports.unmask=function(e,t){e.length<32?DS(e,t):n.unmask(e,t)}}catch(n){}});var FS=K((fB,US)=>{"use strict";var OS=Symbol("kDone"),dh=Symbol("kRun"),hh=class{constructor(e){this[OS]=()=>{this.pending--,this[dh]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[dh]()}[dh](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[OS])}}};US.exports=hh});var qs=K((dB,GS)=>{"use strict";var Ls=require("zlib"),LS=Fs(),Ax=FS(),{kStatusCode:qS}=nr(),bx=Buffer[Symbol.species],Rx=Buffer.from([0,0,255,255]),eu=Symbol("permessage-deflate"),rr=Symbol("total-length"),_o=Symbol("callback"),Ir=Symbol("buffers"),Eo=Symbol("error"),jl,ph=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!jl){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;jl=new Ax(i)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[_o];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let i=t[r];if(i.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(i=i[0],r==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else if(r==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=i})}),e}decompress(e,t,r){jl.add(i=>{this._decompress(e,t,(o,s)=>{i(),r(o,s)})})}compress(e,t,r){jl.add(i=>{this._compress(e,t,(o,s)=>{i(),r(o,s)})})}_decompress(e,t,r){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Ls.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=Ls.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[eu]=this,this._inflate[rr]=0,this._inflate[Ir]=[],this._inflate.on("error",Px),this._inflate.on("data",BS)}this._inflate[_o]=r,this._inflate.write(e),t&&this._inflate.write(Rx),this._inflate.flush(()=>{let o=this._inflate[Eo];if(o){this._inflate.close(),this._inflate=null,r(o);return}let s=LS.concat(this._inflate[Ir],this._inflate[rr]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[rr]=0,this._inflate[Ir]=[],t&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),r(null,s)})}_compress(e,t,r){let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Ls.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=Ls.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[rr]=0,this._deflate[Ir]=[],this._deflate.on("data",Ix)}this._deflate[_o]=r,this._deflate.write(e),this._deflate.flush(Ls.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let o=LS.concat(this._deflate[Ir],this._deflate[rr]);t&&(o=new bx(o.buffer,o.byteOffset,o.length-4)),this._deflate[_o]=null,this._deflate[rr]=0,this._deflate[Ir]=[],t&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),r(null,o)})}};GS.exports=ph;function Ix(n){this[Ir].push(n),this[rr]+=n.length}function BS(n){if(this[rr]+=n.length,this[eu]._maxPayload<1||this[rr]<=this[eu]._maxPayload){this[Ir].push(n);return}this[Eo]=new RangeError("Max payload size exceeded"),this[Eo].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Eo][qS]=1009,this.removeListener("data",BS),this.reset()}function Px(n){if(this[eu]._inflate=null,this[Eo]){this[_o](this[Eo]);return}n[qS]=1007,this[_o](n)}});var So=K((hB,tu)=>{"use strict";var{isUtf8:HS}=require("buffer"),{hasBlob:xx}=nr(),kx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Nx(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function mh(n){let e=n.length,t=0;for(;t<e;)if((n[t]&128)===0)t++;else if((n[t]&224)===192){if(t+1===e||(n[t+1]&192)!==128||(n[t]&254)===192)return!1;t+=2}else if((n[t]&240)===224){if(t+2>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||n[t]===224&&(n[t+1]&224)===128||n[t]===237&&(n[t+1]&224)===160)return!1;t+=3}else if((n[t]&248)===240){if(t+3>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||(n[t+3]&192)!==128||n[t]===240&&(n[t+1]&240)===128||n[t]===244&&n[t+1]>143||n[t]>244)return!1;t+=4}else return!1;return!0}function Mx(n){return xx&&typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&(n[Symbol.toStringTag]==="Blob"||n[Symbol.toStringTag]==="File")}tu.exports={isBlob:Mx,isValidStatusCode:Nx,isValidUTF8:mh,tokenChars:kx};if(HS)tu.exports.isValidUTF8=function(n){return n.length<24?mh(n):HS(n)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let n=require("utf-8-validate");tu.exports.isValidUTF8=function(e){return e.length<32?mh(e):n(e)}}catch(n){}});var Sh=K((pB,KS)=>{"use strict";var{Writable:Dx}=require("stream"),VS=qs(),{BINARY_TYPES:Ox,EMPTY_BUFFER:$S,kStatusCode:Ux,kWebSocket:Fx}=nr(),{concat:gh,toArrayBuffer:Lx,unmask:qx}=Fs(),{isValidStatusCode:Bx,isValidUTF8:WS}=So(),nu=Buffer[Symbol.species],Zt=0,zS=1,JS=2,YS=3,yh=4,_h=5,ru=6,Eh=class extends Dx{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||Ox[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Fx]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=Zt}_write(e,t,r){if(this._opcode===8&&this._state==Zt)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=new nu(r.buffer,r.byteOffset+e,r.length-e),new nu(r.buffer,r.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],i=t.length-e;e>=r.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),i),this._buffers[0]=new nu(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case Zt:this.getInfo(e);break;case zS:this.getPayloadLength16(e);break;case JS:this.getPayloadLength64(e);break;case YS:this.getMask();break;case yh:this.getData(e);break;case _h:case ru:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((t[0]&48)!==0){let i=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(i);return}let r=(t[0]&64)===64;if(r&&!this._extensions[VS.extensionName]){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(r){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(!this._fragmented){let i=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let i=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(i);return}if(r){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let i=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(i);return}}else{let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let i=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(i);return}}else if(this._masked){let i=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(i);return}this._payloadLength===126?this._state=zS:this._payloadLength===127?this._state=JS:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);if(r>Math.pow(2,21)-1){let i=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(i);return}this._payloadLength=r*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=YS:this._state=yh}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=yh}getData(e){let t=$S;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&qx(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=_h,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[VS.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let s=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(s);return}this._fragments.push(o)}this.dataMessage(t),this._state===Zt&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=Zt;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=gh(r,t):this._binaryType==="arraybuffer"?i=Lx(gh(r,t)):this._binaryType==="blob"?i=new Blob(r):i=r,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=Zt):(this._state=ru,setImmediate(()=>{this.emit("message",i,!0),this._state=Zt,this.startLoop(e)}))}else{let i=gh(r,t);if(!this._skipUTF8Validation&&!WS(i)){let o=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(o);return}this._state===_h||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=Zt):(this._state=ru,setImmediate(()=>{this.emit("message",i,!1),this._state=Zt,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,$S),this.end();else{let r=e.readUInt16BE(0);if(!Bx(r)){let o=this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(o);return}let i=new nu(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!WS(i)){let o=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(o);return}this._loop=!1,this.emit("conclude",r,i),this.end()}this._state=Zt;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=Zt):(this._state=ru,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=Zt,this.startLoop(t)}))}createError(e,t,r,i,o){this._loop=!1,this._errored=!0;let s=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,this.createError),s.code=o,s[Ux]=i,s}};KS.exports=Eh});var wh=K((gB,ZS)=>{"use strict";var{Duplex:mB}=require("stream"),{randomFillSync:Gx}=require("crypto"),XS=qs(),{EMPTY_BUFFER:Hx,kWebSocket:Vx,NOOP:$x}=nr(),{isBlob:To,isValidStatusCode:Wx}=So(),{mask:QS,toBuffer:ui}=Fs(),jt=Symbol("kByteLength"),zx=Buffer.alloc(4),iu=8*1024,ci,vo=iu,yn=0,Jx=1,Yx=2,Th=class n{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=yn,this.onerror=$x,this[Vx]=void 0}static frame(e,t){let r,i=!1,o=2,s=!1;t.mask&&(r=t.maskBuffer||zx,t.generateMask?t.generateMask(r):(vo===iu&&(ci===void 0&&(ci=Buffer.alloc(iu)),Gx(ci,0,iu),vo=0),r[0]=ci[vo++],r[1]=ci[vo++],r[2]=ci[vo++],r[3]=ci[vo++]),s=(r[0]|r[1]|r[2]|r[3])===0,o=6);let l;typeof e=="string"?(!t.mask||s)&&t[jt]!==void 0?l=t[jt]:(e=Buffer.from(e),l=e.length):(l=e.length,i=t.mask&&t.readOnly&&!s);let f=l;l>=65536?(o+=8,f=127):l>125&&(o+=2,f=126);let d=Buffer.allocUnsafe(i?l+o:o);return d[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(d[0]|=64),d[1]=f,f===126?d.writeUInt16BE(l,2):f===127&&(d[2]=d[3]=0,d.writeUIntBE(l,4,6)),t.mask?(d[1]|=128,d[o-4]=r[0],d[o-3]=r[1],d[o-2]=r[2],d[o-1]=r[3],s?[d,e]:i?(QS(e,r,d,o,l),[d]):(QS(e,r,e,0,l),[d,e])):[d,e]}close(e,t,r,i){let o;if(e===void 0)o=Hx;else{if(typeof e!="number"||!Wx(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0);else{let l=Buffer.byteLength(t);if(l>123)throw new RangeError("The message must not be greater than 123 bytes");o=Buffer.allocUnsafe(2+l),o.writeUInt16BE(e,0),typeof t=="string"?o.write(t,2):o.set(t,2)}}let s={[jt]:o.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==yn?this.enqueue([this.dispatch,o,!1,s,i]):this.sendFrame(n.frame(o,s),i)}ping(e,t,r){let i,o;if(typeof e=="string"?(i=Buffer.byteLength(e),o=!1):To(e)?(i=e.size,o=!1):(e=ui(e),i=e.length,o=ui.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[jt]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:o,rsv1:!1};To(e)?this._state!==yn?this.enqueue([this.getBlobData,e,!1,s,r]):this.getBlobData(e,!1,s,r):this._state!==yn?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(n.frame(e,s),r)}pong(e,t,r){let i,o;if(typeof e=="string"?(i=Buffer.byteLength(e),o=!1):To(e)?(i=e.size,o=!1):(e=ui(e),i=e.length,o=ui.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let s={[jt]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:o,rsv1:!1};To(e)?this._state!==yn?this.enqueue([this.getBlobData,e,!1,s,r]):this.getBlobData(e,!1,s,r):this._state!==yn?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(n.frame(e,s),r)}send(e,t,r){let i=this._extensions[XS.extensionName],o=t.binary?2:1,s=t.compress,l,f;typeof e=="string"?(l=Buffer.byteLength(e),f=!1):To(e)?(l=e.size,f=!1):(e=ui(e),l=e.length,f=ui.readOnly),this._firstFragment?(this._firstFragment=!1,s&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(s=l>=i._threshold),this._compress=s):(s=!1,o=0),t.fin&&(this._firstFragment=!0);let d={[jt]:l,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:f,rsv1:s};To(e)?this._state!==yn?this.enqueue([this.getBlobData,e,this._compress,d,r]):this.getBlobData(e,this._compress,d,r):this._state!==yn?this.enqueue([this.dispatch,e,this._compress,d,r]):this.dispatch(e,this._compress,d,r)}getBlobData(e,t,r,i){this._bufferedBytes+=r[jt],this._state=Yx,e.arrayBuffer().then(o=>{if(this._socket.destroyed){let l=new Error("The socket was closed while the blob was being read");process.nextTick(vh,this,l,i);return}this._bufferedBytes-=r[jt];let s=ui(o);t?this.dispatch(s,t,r,i):(this._state=yn,this.sendFrame(n.frame(s,r),i),this.dequeue())}).catch(o=>{process.nextTick(Kx,this,o,i)})}dispatch(e,t,r,i){if(!t){this.sendFrame(n.frame(e,r),i);return}let o=this._extensions[XS.extensionName];this._bufferedBytes+=r[jt],this._state=Jx,o.compress(e,r.fin,(s,l)=>{if(this._socket.destroyed){let f=new Error("The socket was closed while data was being compressed");vh(this,f,i);return}this._bufferedBytes-=r[jt],this._state=yn,r.readOnly=!1,this.sendFrame(n.frame(l,r),i),this.dequeue()})}dequeue(){for(;this._state===yn&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][jt],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][jt],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};ZS.exports=Th;function vh(n,e,t){typeof t=="function"&&t(e);for(let r=0;r<n._queue.length;r++){let i=n._queue[r],o=i[i.length-1];typeof o=="function"&&o(e)}}function Kx(n,e,t){vh(n,e,t),n.onerror(e)}});var aT=K((yB,sT)=>{"use strict";var{kForOnEventAttribute:Bs,kListener:Ch}=nr(),jS=Symbol("kCode"),eT=Symbol("kData"),tT=Symbol("kError"),nT=Symbol("kMessage"),rT=Symbol("kReason"),wo=Symbol("kTarget"),iT=Symbol("kType"),oT=Symbol("kWasClean"),ir=class{constructor(e){this[wo]=null,this[iT]=e}get target(){return this[wo]}get type(){return this[iT]}};Object.defineProperty(ir.prototype,"target",{enumerable:!0});Object.defineProperty(ir.prototype,"type",{enumerable:!0});var fi=class extends ir{constructor(e,t={}){super(e),this[jS]=t.code===void 0?0:t.code,this[rT]=t.reason===void 0?"":t.reason,this[oT]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[jS]}get reason(){return this[rT]}get wasClean(){return this[oT]}};Object.defineProperty(fi.prototype,"code",{enumerable:!0});Object.defineProperty(fi.prototype,"reason",{enumerable:!0});Object.defineProperty(fi.prototype,"wasClean",{enumerable:!0});var Co=class extends ir{constructor(e,t={}){super(e),this[tT]=t.error===void 0?null:t.error,this[nT]=t.message===void 0?"":t.message}get error(){return this[tT]}get message(){return this[nT]}};Object.defineProperty(Co.prototype,"error",{enumerable:!0});Object.defineProperty(Co.prototype,"message",{enumerable:!0});var Gs=class extends ir{constructor(e,t={}){super(e),this[eT]=t.data===void 0?null:t.data}get data(){return this[eT]}};Object.defineProperty(Gs.prototype,"data",{enumerable:!0});var Xx={addEventListener(n,e,t={}){for(let i of this.listeners(n))if(!t[Bs]&&i[Ch]===e&&!i[Bs])return;let r;if(n==="message")r=function(o,s){let l=new Gs("message",{data:s?o:o.toString()});l[wo]=this,ou(e,this,l)};else if(n==="close")r=function(o,s){let l=new fi("close",{code:o,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});l[wo]=this,ou(e,this,l)};else if(n==="error")r=function(o){let s=new Co("error",{error:o,message:o.message});s[wo]=this,ou(e,this,s)};else if(n==="open")r=function(){let o=new ir("open");o[wo]=this,ou(e,this,o)};else return;r[Bs]=!!t[Bs],r[Ch]=e,t.once?this.once(n,r):this.on(n,r)},removeEventListener(n,e){for(let t of this.listeners(n))if(t[Ch]===e&&!t[Bs]){this.removeListener(n,t);break}}};sT.exports={CloseEvent:fi,ErrorEvent:Co,Event:ir,EventTarget:Xx,MessageEvent:Gs};function ou(n,e,t){typeof n=="object"&&n.handleEvent?n.handleEvent.call(n,t):n.call(e,t)}});var Ah=K((_B,lT)=>{"use strict";var{tokenChars:Hs}=So();function qn(n,e,t){n[e]===void 0?n[e]=[t]:n[e].push(t)}function Qx(n){let e=Object.create(null),t=Object.create(null),r=!1,i=!1,o=!1,s,l,f=-1,d=-1,h=-1,m=0;for(;m<n.length;m++)if(d=n.charCodeAt(m),s===void 0)if(h===-1&&Hs[d]===1)f===-1&&(f=m);else if(m!==0&&(d===32||d===9))h===-1&&f!==-1&&(h=m);else if(d===59||d===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m);let E=n.slice(f,h);d===44?(qn(e,E,t),t=Object.create(null)):s=E,f=h=-1}else throw new SyntaxError(`Unexpected character at index ${m}`);else if(l===void 0)if(h===-1&&Hs[d]===1)f===-1&&(f=m);else if(d===32||d===9)h===-1&&f!==-1&&(h=m);else if(d===59||d===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m),qn(t,n.slice(f,h),!0),d===44&&(qn(e,s,t),t=Object.create(null),s=void 0),f=h=-1}else if(d===61&&f!==-1&&h===-1)l=n.slice(f,m),f=h=-1;else throw new SyntaxError(`Unexpected character at index ${m}`);else if(i){if(Hs[d]!==1)throw new SyntaxError(`Unexpected character at index ${m}`);f===-1?f=m:r||(r=!0),i=!1}else if(o)if(Hs[d]===1)f===-1&&(f=m);else if(d===34&&f!==-1)o=!1,h=m;else if(d===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${m}`);else if(d===34&&n.charCodeAt(m-1)===61)o=!0;else if(h===-1&&Hs[d]===1)f===-1&&(f=m);else if(f!==-1&&(d===32||d===9))h===-1&&(h=m);else if(d===59||d===44){if(f===-1)throw new SyntaxError(`Unexpected character at index ${m}`);h===-1&&(h=m);let E=n.slice(f,h);r&&(E=E.replace(/\\/g,""),r=!1),qn(t,l,E),d===44&&(qn(e,s,t),t=Object.create(null),s=void 0),l=void 0,f=h=-1}else throw new SyntaxError(`Unexpected character at index ${m}`);if(f===-1||o||d===32||d===9)throw new SyntaxError("Unexpected end of input");h===-1&&(h=m);let g=n.slice(f,h);return s===void 0?qn(e,g,t):(l===void 0?qn(t,g,!0):r?qn(t,l,g.replace(/\\/g,"")):qn(t,l,g),qn(e,s,t)),e}function Zx(n){return Object.keys(n).map(e=>{let t=n[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(i=>{let o=r[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}lT.exports={format:Zx,parse:Qx}});var uu=K((TB,ST)=>{"use strict";var jx=require("events"),ek=require("https"),tk=require("http"),fT=require("net"),nk=require("tls"),{randomBytes:rk,createHash:ik}=require("crypto"),{Duplex:EB,Readable:SB}=require("stream"),{URL:bh}=require("url"),Pr=qs(),ok=Sh(),sk=wh(),{isBlob:ak}=So(),{BINARY_TYPES:uT,EMPTY_BUFFER:su,GUID:lk,kForOnEventAttribute:Rh,kListener:uk,kStatusCode:ck,kWebSocket:Qe,NOOP:dT}=nr(),{EventTarget:{addEventListener:fk,removeEventListener:dk}}=aT(),{format:hk,parse:pk}=Ah(),{toBuffer:mk}=Fs(),gk=30*1e3,hT=Symbol("kAborted"),Ih=[8,13],or=["CONNECTING","OPEN","CLOSING","CLOSED"],yk=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,Ue=class n extends jx{constructor(e,t,r){super(),this._binaryType=uT[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=su,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=n.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),pT(this,e,t,r)):(this._autoPong=r.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){uT.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let i=new ok({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),o=new sk(e,this._extensions,r.generateMask);this._receiver=i,this._sender=o,this._socket=e,i[Qe]=this,o[Qe]=this,e[Qe]=this,i.on("conclude",Sk),i.on("drain",Tk),i.on("error",vk),i.on("message",wk),i.on("ping",Ck),i.on("pong",Ak),o.onerror=bk,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",yT),e.on("data",lu),e.on("end",_T),e.on("error",ET),this._readyState=n.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=n.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Pr.extensionName]&&this._extensions[Pr.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=n.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){Lt(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===n.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=n.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),gT(this)}}pause(){this.readyState===n.CONNECTING||this.readyState===n.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Ph(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||su,t,r)}pong(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Ph(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||su,t,r)}resume(){this.readyState===n.CONNECTING||this.readyState===n.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===n.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==n.OPEN){Ph(this,e,r);return}let i={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[Pr.extensionName]||(i.compress=!1),this._sender.send(e||su,i,r)}terminate(){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING){Lt(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=n.CLOSING,this._socket.destroy())}}};Object.defineProperty(Ue,"CONNECTING",{enumerable:!0,value:or.indexOf("CONNECTING")});Object.defineProperty(Ue.prototype,"CONNECTING",{enumerable:!0,value:or.indexOf("CONNECTING")});Object.defineProperty(Ue,"OPEN",{enumerable:!0,value:or.indexOf("OPEN")});Object.defineProperty(Ue.prototype,"OPEN",{enumerable:!0,value:or.indexOf("OPEN")});Object.defineProperty(Ue,"CLOSING",{enumerable:!0,value:or.indexOf("CLOSING")});Object.defineProperty(Ue.prototype,"CLOSING",{enumerable:!0,value:or.indexOf("CLOSING")});Object.defineProperty(Ue,"CLOSED",{enumerable:!0,value:or.indexOf("CLOSED")});Object.defineProperty(Ue.prototype,"CLOSED",{enumerable:!0,value:or.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(n=>{Object.defineProperty(Ue.prototype,n,{enumerable:!0})});["open","error","close","message"].forEach(n=>{Object.defineProperty(Ue.prototype,`on${n}`,{enumerable:!0,get(){for(let e of this.listeners(n))if(e[Rh])return e[uk];return null},set(e){for(let t of this.listeners(n))if(t[Rh]){this.removeListener(n,t);break}typeof e=="function"&&this.addEventListener(n,e,{[Rh]:!0})}})});Ue.prototype.addEventListener=fk;Ue.prototype.removeEventListener=dk;ST.exports=Ue;function pT(n,e,t,r){let i={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:Ih[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(n._autoPong=i.autoPong,!Ih.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${Ih.join(", ")})`);let o;if(e instanceof bh)o=e;else try{o=new bh(e)}catch(C){throw new SyntaxError(`Invalid URL: ${e}`)}o.protocol==="http:"?o.protocol="ws:":o.protocol==="https:"&&(o.protocol="wss:"),n._url=o.href;let s=o.protocol==="wss:",l=o.protocol==="ws+unix:",f;if(o.protocol!=="ws:"&&!s&&!l?f=`The URL's protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"`:l&&!o.pathname?f="The URL's pathname is empty":o.hash&&(f="The URL contains a fragment identifier"),f){let C=new SyntaxError(f);if(n._redirects===0)throw C;au(n,C);return}let d=s?443:80,h=rk(16).toString("base64"),m=s?ek.request:tk.request,g=new Set,E;if(i.createConnection=i.createConnection||(s?Ek:_k),i.defaultPort=i.defaultPort||d,i.port=o.port||d,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},i.path=o.pathname+o.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(E=new Pr(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=hk({[Pr.extensionName]:E.offer()})),t.length){for(let C of t){if(typeof C!="string"||!yk.test(C)||g.has(C))throw new SyntaxError("An invalid or duplicated subprotocol was specified");g.add(C)}i.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),l){let C=i.path.split(":");i.socketPath=C[0],i.path=C[1]}let w;if(i.followRedirects){if(n._redirects===0){n._originalIpc=l,n._originalSecure=s,n._originalHostOrSocketPath=l?i.socketPath:o.host;let C=r&&r.headers;if(r={...r,headers:{}},C)for(let[R,P]of Object.entries(C))r.headers[R.toLowerCase()]=P}else if(n.listenerCount("redirect")===0){let C=l?n._originalIpc?i.socketPath===n._originalHostOrSocketPath:!1:n._originalIpc?!1:o.host===n._originalHostOrSocketPath;(!C||n._originalSecure&&!s)&&(delete i.headers.authorization,delete i.headers.cookie,C||delete i.headers.host,i.auth=void 0)}i.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),w=n._req=m(i),n._redirects&&n.emit("redirect",n.url,w)}else w=n._req=m(i);i.timeout&&w.on("timeout",()=>{Lt(n,w,"Opening handshake has timed out")}),w.on("error",C=>{w===null||w[hT]||(w=n._req=null,au(n,C))}),w.on("response",C=>{let R=C.headers.location,P=C.statusCode;if(R&&i.followRedirects&&P>=300&&P<400){if(++n._redirects>i.maxRedirects){Lt(n,w,"Maximum redirects exceeded");return}w.abort();let z;try{z=new bh(R,e)}catch($){let W=new SyntaxError(`Invalid URL: ${R}`);au(n,W);return}pT(n,z,t,r)}else n.emit("unexpected-response",w,C)||Lt(n,w,`Unexpected server response: ${C.statusCode}`)}),w.on("upgrade",(C,R,P)=>{if(n.emit("upgrade",C),n.readyState!==Ue.CONNECTING)return;w=n._req=null;let z=C.headers.upgrade;if(z===void 0||z.toLowerCase()!=="websocket"){Lt(n,R,"Invalid Upgrade header");return}let $=ik("sha1").update(h+lk).digest("base64");if(C.headers["sec-websocket-accept"]!==$){Lt(n,R,"Invalid Sec-WebSocket-Accept header");return}let W=C.headers["sec-websocket-protocol"],H;if(W!==void 0?g.size?g.has(W)||(H="Server sent an invalid subprotocol"):H="Server sent a subprotocol but none was requested":g.size&&(H="Server sent no subprotocol"),H){Lt(n,R,H);return}W&&(n._protocol=W);let G=C.headers["sec-websocket-extensions"];if(G!==void 0){if(!E){Lt(n,R,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Y;try{Y=pk(G)}catch(T){Lt(n,R,"Invalid Sec-WebSocket-Extensions header");return}let j=Object.keys(Y);if(j.length!==1||j[0]!==Pr.extensionName){Lt(n,R,"Server indicated an extension that was not requested");return}try{E.accept(Y[Pr.extensionName])}catch(T){Lt(n,R,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[Pr.extensionName]=E}n.setSocket(R,P,{allowSynchronousEvents:i.allowSynchronousEvents,generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(w,n):w.end()}function au(n,e){n._readyState=Ue.CLOSING,n._errorEmitted=!0,n.emit("error",e),n.emitClose()}function _k(n){return n.path=n.socketPath,fT.connect(n)}function Ek(n){return n.path=void 0,!n.servername&&n.servername!==""&&(n.servername=fT.isIP(n.host)?"":n.host),nk.connect(n)}function Lt(n,e,t){n._readyState=Ue.CLOSING;let r=new Error(t);Error.captureStackTrace(r,Lt),e.setHeader?(e[hT]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(au,n,r)):(e.destroy(r),e.once("error",n.emit.bind(n,"error")),e.once("close",n.emitClose.bind(n)))}function Ph(n,e,t){if(e){let r=ak(e)?e.size:mk(e).length;n._socket?n._sender._bufferedBytes+=r:n._bufferedAmount+=r}if(t){let r=new Error(`WebSocket is not open: readyState ${n.readyState} (${or[n.readyState]})`);process.nextTick(t,r)}}function Sk(n,e){let t=this[Qe];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=n,t._socket[Qe]!==void 0&&(t._socket.removeListener("data",lu),process.nextTick(mT,t._socket),n===1005?t.close():t.close(n,e))}function Tk(){let n=this[Qe];n.isPaused||n._socket.resume()}function vk(n){let e=this[Qe];e._socket[Qe]!==void 0&&(e._socket.removeListener("data",lu),process.nextTick(mT,e._socket),e.close(n[ck])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",n))}function cT(){this[Qe].emitClose()}function wk(n,e){this[Qe].emit("message",n,e)}function Ck(n){let e=this[Qe];e._autoPong&&e.pong(n,!this._isServer,dT),e.emit("ping",n)}function Ak(n){this[Qe].emit("pong",n)}function mT(n){n.resume()}function bk(n){let e=this[Qe];e.readyState!==Ue.CLOSED&&(e.readyState===Ue.OPEN&&(e._readyState=Ue.CLOSING,gT(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",n)))}function gT(n){n._closeTimer=setTimeout(n._socket.destroy.bind(n._socket),gk)}function yT(){let n=this[Qe];this.removeListener("close",yT),this.removeListener("data",lu),this.removeListener("end",_T),n._readyState=Ue.CLOSING;let e;!this._readableState.endEmitted&&!n._closeFrameReceived&&!n._receiver._writableState.errorEmitted&&(e=n._socket.read())!==null&&n._receiver.write(e),n._receiver.end(),this[Qe]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",cT),n._receiver.on("finish",cT))}function lu(n){this[Qe]._receiver.write(n)||this.pause()}function _T(){let n=this[Qe];n._readyState=Ue.CLOSING,n._receiver.end(),this.end()}function ET(){let n=this[Qe];this.removeListener("error",ET),this.on("error",dT),n&&(n._readyState=Ue.CLOSING,this.destroy())}});var CT=K((wB,wT)=>{"use strict";var vB=uu(),{Duplex:Rk}=require("stream");function TT(n){n.emit("close")}function Ik(){!this.destroyed&&this._writableState.finished&&this.destroy()}function vT(n){this.removeListener("error",vT),this.destroy(),this.listenerCount("error")===0&&this.emit("error",n)}function Pk(n,e){let t=!0,r=new Rk({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return n.on("message",function(o,s){let l=!s&&r._readableState.objectMode?o.toString():o;r.push(l)||n.pause()}),n.once("error",function(o){r.destroyed||(t=!1,r.destroy(o))}),n.once("close",function(){r.destroyed||r.push(null)}),r._destroy=function(i,o){if(n.readyState===n.CLOSED){o(i),process.nextTick(TT,r);return}let s=!1;n.once("error",function(f){s=!0,o(f)}),n.once("close",function(){s||o(i),process.nextTick(TT,r)}),t&&n.terminate()},r._final=function(i){if(n.readyState===n.CONNECTING){n.once("open",function(){r._final(i)});return}n._socket!==null&&(n._socket._writableState.finished?(i(),r._readableState.endEmitted&&r.destroy()):(n._socket.once("finish",function(){i()}),n.close()))},r._read=function(){n.isPaused&&n.resume()},r._write=function(i,o,s){if(n.readyState===n.CONNECTING){n.once("open",function(){r._write(i,o,s)});return}n.send(i,s)},r.on("end",Ik),r.on("error",vT),r}wT.exports=Pk});var bT=K((CB,AT)=>{"use strict";var{tokenChars:xk}=So();function kk(n){let e=new Set,t=-1,r=-1,i=0;for(i;i<n.length;i++){let s=n.charCodeAt(i);if(r===-1&&xk[s]===1)t===-1&&(t=i);else if(i!==0&&(s===32||s===9))r===-1&&t!==-1&&(r=i);else if(s===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${i}`);r===-1&&(r=i);let l=n.slice(t,r);if(e.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);e.add(l),t=r=-1}else throw new SyntaxError(`Unexpected character at index ${i}`)}if(t===-1||r!==-1)throw new SyntaxError("Unexpected end of input");let o=n.slice(t,i);if(e.has(o))throw new SyntaxError(`The "${o}" subprotocol is duplicated`);return e.add(o),e}AT.exports={parse:kk}});var MT=K((bB,NT)=>{"use strict";var Nk=require("events"),cu=require("http"),{Duplex:AB}=require("stream"),{createHash:Mk}=require("crypto"),RT=Ah(),di=qs(),Dk=bT(),Ok=uu(),{GUID:Uk,kWebSocket:Fk}=nr(),Lk=/^[+/0-9A-Za-z]{22}==$/,IT=0,PT=1,kT=2,xh=class extends Nk{constructor(e,t){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Ok,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=cu.createServer((r,i)=>{let o=cu.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let r=this.emit.bind(this,"connection");this._removeListeners=qk(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(i,o,s)=>{this.handleUpgrade(i,o,s,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=IT}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===kT){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Vs,this);return}if(e&&this.once("close",e),this._state!==PT)if(this._state=PT,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Vs,this):process.nextTick(Vs,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{Vs(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,i){t.on("error",xT);let o=e.headers["sec-websocket-key"],s=e.headers.upgrade,l=+e.headers["sec-websocket-version"];if(e.method!=="GET"){hi(this,e,t,405,"Invalid HTTP method");return}if(s===void 0||s.toLowerCase()!=="websocket"){hi(this,e,t,400,"Invalid Upgrade header");return}if(o===void 0||!Lk.test(o)){hi(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(l!==13&&l!==8){hi(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){$s(t,400);return}let f=e.headers["sec-websocket-protocol"],d=new Set;if(f!==void 0)try{d=Dk.parse(f)}catch(g){hi(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],m={};if(this.options.perMessageDeflate&&h!==void 0){let g=new di(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let E=RT.parse(h);E[di.extensionName]&&(g.accept(E[di.extensionName]),m[di.extensionName]=g)}catch(E){hi(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let g={origin:e.headers[`${l===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(g,(E,w,C,R)=>{if(!E)return $s(t,w||401,C,R);this.completeUpgrade(m,o,d,e,t,r,i)});return}if(!this.options.verifyClient(g))return $s(t,401)}this.completeUpgrade(m,o,d,e,t,r,i)}completeUpgrade(e,t,r,i,o,s,l){if(!o.readable||!o.writable)return o.destroy();if(o[Fk])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>IT)return $s(o,503);let d=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Mk("sha1").update(t+Uk).digest("base64")}`],h=new this.options.WebSocket(null,void 0,this.options);if(r.size){let m=this.options.handleProtocols?this.options.handleProtocols(r,i):r.values().next().value;m&&(d.push(`Sec-WebSocket-Protocol: ${m}`),h._protocol=m)}if(e[di.extensionName]){let m=e[di.extensionName].params,g=RT.format({[di.extensionName]:[m]});d.push(`Sec-WebSocket-Extensions: ${g}`),h._extensions=e}this.emit("headers",d,i),o.write(d.concat(`\r
`).join(`\r
`)),o.removeListener("error",xT),h.setSocket(o,s,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(h),h.on("close",()=>{this.clients.delete(h),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Vs,this)})),l(h,i)}};NT.exports=xh;function qk(n,e){for(let t of Object.keys(e))n.on(t,e[t]);return function(){for(let r of Object.keys(e))n.removeListener(r,e[r])}}function Vs(n){n._state=kT,n.emit("close")}function xT(){this.destroy()}function $s(n,e,t,r){t=t||cu.STATUS_CODES[e],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...r},n.once("finish",n.destroy),n.end(`HTTP/1.1 ${e} ${cu.STATUS_CODES[e]}\r
`+Object.keys(r).map(i=>`${i}: ${r[i]}`).join(`\r
`)+`\r
\r
`+t)}function hi(n,e,t,r,i,o){if(n.listenerCount("wsClientError")){let s=new Error(i);Error.captureStackTrace(s,hi),n.emit("wsClientError",s,t,e)}else $s(t,r,i,o)}});var RF={};pc(RF,{default:()=>Bu});module.exports=FA(RF);var _i=require("obsidian");var Gw=require("crypto");var Lm="1.2.0";var yc=Le(Bm(),1);var _c=class n extends Error{constructor(t,r){var i;super(t,r);x(this,"name","TimeoutError");(i=Error.captureStackTrace)==null||i.call(Error,this,n)}},Gm=n=>{var e;return(e=n.reason)!=null?e:new DOMException("This operation was aborted.","AbortError")};function Ec(n,e){let{milliseconds:t,fallback:r,message:i,customTimers:o={setTimeout,clearTimeout},signal:s}=e,l,f,h=new Promise((m,g)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(s!=null&&s.aborted){g(Gm(s));return}if(s&&(f=()=>{g(Gm(s))},s.addEventListener("abort",f,{once:!0})),n.then(m,g),t===Number.POSITIVE_INFINITY)return;let E=new _c;l=o.setTimeout.call(void 0,()=>{if(r){try{m(r())}catch(w){g(w)}return}typeof n.cancel=="function"&&n.cancel(),i===!1?m():i instanceof Error?g(i):(E.message=i!=null?i:`Promise timed out after ${t} milliseconds`,g(E))},t)}).finally(()=>{h.clear(),f&&s&&s.removeEventListener("abort",f)});return h.clear=()=>{o.clearTimeout.call(void 0,l),l=void 0},h}function Sc(n,e,t){let r=0,i=n.length;for(;i>0;){let o=Math.trunc(i/2),s=r+o;t(n[s],e)<=0?(r=++s,i-=o+1):i=o}return r}var Gt,Jo=class{constructor(){se(this,Gt,[])}enqueue(e,t){let{priority:r=0,id:i}=t!=null?t:{},o={priority:r,id:i,run:e};if(this.size===0||D(this,Gt)[this.size-1].priority>=r){D(this,Gt).push(o);return}let s=Sc(D(this,Gt),o,(l,f)=>f.priority-l.priority);D(this,Gt).splice(s,0,o)}setPriority(e,t){let r=D(this,Gt).findIndex(o=>o.id===e);if(r===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);let[i]=D(this,Gt).splice(r,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){let e=D(this,Gt).shift();return e==null?void 0:e.run}filter(e){return D(this,Gt).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return D(this,Gt).length}};Gt=new WeakMap;var Oi,sn,vn,Ui,Fi,Li,yr,Xo,qi,wn,Jn,He,Qo,nt,Vr,Yn,Aa,$r,he,Hm,Vm,$m,Wm,zm,Tc,vc,Jm,wa,wc,Cc,Ca,Ym,Hr,Km,Yo,Ac,Ko=class extends yc.default{constructor(t){var r,i,o,s,l,f;super();se(this,he);se(this,Oi);se(this,sn);se(this,vn,0);se(this,Ui);se(this,Fi,!1);se(this,Li,!1);se(this,yr);se(this,Xo,0);se(this,qi,0);se(this,wn);se(this,Jn);se(this,He);se(this,Qo);se(this,nt,0);se(this,Vr);se(this,Yn);se(this,Aa,BigInt(1));se(this,$r,new Map);x(this,"timeout");if(t={carryoverIntervalCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Jo,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(i=(r=t.intervalCap)==null?void 0:r.toString())!=null?i:""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(o=t.interval)==null?void 0:o.toString())!=null?s:""}\` (${typeof t.interval})`);if(ce(this,Oi,(f=(l=t.carryoverIntervalCount)!=null?l:t.carryoverConcurrencyCount)!=null?f:!1),ce(this,sn,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),ce(this,Ui,t.intervalCap),ce(this,yr,t.interval),ce(this,He,new t.queueClass),ce(this,Qo,t.queueClass),this.concurrency=t.concurrency,t.timeout!==void 0&&!(Number.isFinite(t.timeout)&&t.timeout>0))throw new TypeError(`Expected \`timeout\` to be a positive finite number, got \`${t.timeout}\` (${typeof t.timeout})`);this.timeout=t.timeout,ce(this,Yn,t.autoStart===!1),re(this,he,Km).call(this)}get concurrency(){return D(this,Vr)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);ce(this,Vr,t),re(this,he,Ca).call(this)}setPriority(t,r){if(typeof r!="number"||!Number.isFinite(r))throw new TypeError(`Expected \`priority\` to be a finite number, got \`${r}\` (${typeof r})`);D(this,He).setPriority(t,r)}async add(t,r={}){var i;return(i=r.id)!=null||(r.id=(Di(this,Aa)._++).toString()),r={timeout:this.timeout,...r},new Promise((o,s)=>{let l=Symbol(`task-${r.id}`);D(this,He).enqueue(async()=>{var f,d;Di(this,nt)._++,D(this,$r).set(l,{id:r.id,priority:(f=r.priority)!=null?f:0,startTime:Date.now(),timeout:r.timeout});try{try{(d=r.signal)==null||d.throwIfAborted()}catch(g){throw D(this,sn)||Di(this,vn)._--,D(this,$r).delete(l),g}let h=t({signal:r.signal});r.timeout&&(h=Ec(Promise.resolve(h),{milliseconds:r.timeout,message:`Task timed out after ${r.timeout}ms (queue has ${D(this,nt)} running, ${D(this,He).size} waiting)`})),r.signal&&(h=Promise.race([h,re(this,he,Ym).call(this,r.signal)]));let m=await h;o(m),this.emit("completed",m)}catch(h){s(h),this.emit("error",h)}finally{D(this,$r).delete(l),queueMicrotask(()=>{re(this,he,$m).call(this)})}},r),this.emit("add"),re(this,he,wa).call(this)})}async addAll(t,r){return Promise.all(t.map(async i=>this.add(i,r)))}start(){return D(this,Yn)?(ce(this,Yn,!1),re(this,he,Ca).call(this),this):this}pause(){ce(this,Yn,!0)}clear(){ce(this,He,new(D(this,Qo))),re(this,he,Ac).call(this)}async onEmpty(){D(this,He).size!==0&&await re(this,he,Hr).call(this,"empty")}async onSizeLessThan(t){D(this,He).size<t||await re(this,he,Hr).call(this,"next",()=>D(this,He).size<t)}async onIdle(){D(this,nt)===0&&D(this,He).size===0||await re(this,he,Hr).call(this,"idle")}async onPendingZero(){D(this,nt)!==0&&await re(this,he,Hr).call(this,"pendingZero")}async onRateLimit(){this.isRateLimited||await re(this,he,Hr).call(this,"rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await re(this,he,Hr).call(this,"rateLimitCleared")}async onError(){return new Promise((t,r)=>{let i=o=>{this.off("error",i),r(o)};this.on("error",i)})}get size(){return D(this,He).size}sizeBy(t){return D(this,He).filter(t).length}get pending(){return D(this,nt)}get isPaused(){return D(this,Yn)}get isRateLimited(){return D(this,Fi)}get isSaturated(){return D(this,nt)===D(this,Vr)&&D(this,He).size>0||this.isRateLimited&&D(this,He).size>0}get runningTasks(){return[...D(this,$r).values()].map(t=>({...t}))}};Oi=new WeakMap,sn=new WeakMap,vn=new WeakMap,Ui=new WeakMap,Fi=new WeakMap,Li=new WeakMap,yr=new WeakMap,Xo=new WeakMap,qi=new WeakMap,wn=new WeakMap,Jn=new WeakMap,He=new WeakMap,Qo=new WeakMap,nt=new WeakMap,Vr=new WeakMap,Yn=new WeakMap,Aa=new WeakMap,$r=new WeakMap,he=new WeakSet,Hm=function(){return D(this,sn)||D(this,vn)<D(this,Ui)},Vm=function(){return D(this,nt)<D(this,Vr)},$m=function(){Di(this,nt)._--,D(this,nt)===0&&this.emit("pendingZero"),re(this,he,wa).call(this),this.emit("next")},Wm=function(){re(this,he,Cc).call(this),re(this,he,wc).call(this),ce(this,Jn,void 0)},zm=function(){let t=Date.now();if(D(this,wn)===void 0){let r=D(this,Xo)-t;if(r<0){if(D(this,qi)>0){let i=t-D(this,qi);if(i<D(this,yr))return re(this,he,Tc).call(this,D(this,yr)-i),!0}ce(this,vn,D(this,Oi)?D(this,nt):0)}else return re(this,he,Tc).call(this,r),!0}return!1},Tc=function(t){D(this,Jn)===void 0&&ce(this,Jn,setTimeout(()=>{re(this,he,Wm).call(this)},t))},vc=function(){D(this,wn)&&(clearInterval(D(this,wn)),ce(this,wn,void 0))},Jm=function(){D(this,Jn)&&(clearTimeout(D(this,Jn)),ce(this,Jn,void 0))},wa=function(){if(D(this,He).size===0)return re(this,he,vc).call(this),this.emit("empty"),D(this,nt)===0&&(re(this,he,Jm).call(this),this.emit("idle")),!1;let t=!1;if(!D(this,Yn)){let r=!D(this,he,zm);if(D(this,he,Hm)&&D(this,he,Vm)){let i=D(this,He).dequeue();D(this,sn)||(Di(this,vn)._++,re(this,he,Yo).call(this)),this.emit("active"),ce(this,qi,Date.now()),i(),r&&re(this,he,wc).call(this),t=!0}}return t},wc=function(){D(this,sn)||D(this,wn)!==void 0||(ce(this,wn,setInterval(()=>{re(this,he,Cc).call(this)},D(this,yr))),ce(this,Xo,Date.now()+D(this,yr)))},Cc=function(){D(this,vn)===0&&D(this,nt)===0&&D(this,wn)&&re(this,he,vc).call(this),ce(this,vn,D(this,Oi)?D(this,nt):0),re(this,he,Ca).call(this),re(this,he,Yo).call(this)},Ca=function(){for(;re(this,he,wa).call(this););},Ym=async function(t){return new Promise((r,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},Hr=async function(t,r){return new Promise(i=>{let o=()=>{r&&!r()||(this.off(t,o),i())};this.on(t,o)})},Km=function(){D(this,sn)||(this.on("add",()=>{D(this,He).size>0&&re(this,he,Yo).call(this)}),this.on("next",()=>{re(this,he,Yo).call(this)}))},Yo=function(){D(this,sn)||D(this,Li)||(ce(this,Li,!0),queueMicrotask(()=>{ce(this,Li,!1),re(this,he,Ac).call(this)}))},Ac=function(){let t=D(this,Fi),r=!D(this,sn)&&D(this,vn)>=D(this,Ui)&&D(this,He).size>0;r!==t&&(ce(this,Fi,r),this.emit(r?"rateLimit":"rateLimitCleared"))};var Xm=Lm,ba=new Ko({concurrency:1,timeout:3e5});function bc(n,e){return Promise.race([n,new Promise((t,r)=>setTimeout(()=>r(new Error(`timeout after ${e}ms`)),e))])}var qw=require("obsidian");var tn=require("obsidian");var Pp=require("obsidian");var Qm=["ollama","gemini"];var Bi=class{shutdown(){}setLastModel(e){this.lastModel=e}setLastImageModel(e){this.lastImageModel=e}};var dt=require("obsidian");var Zo=Le(require("node:fs"),1),Oc=require("node:path");var zF=Le(Rc(),1),eg="11434",tg=`http://127.0.0.1:${eg}`,HA="0.6.2",VA=Object.defineProperty,$A=(n,e,t)=>e in n?VA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ic=(n,e,t)=>($A(n,typeof e!="symbol"?e+"":e,t),t),xc=class n extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,n)}},kc=class{constructor(e,t,r){Ic(this,"abortController"),Ic(this,"itr"),Ic(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},Nc=async n=>{var r;if(n.ok)return;let e=`Error ${n.status}: ${n.statusText}`,t=null;if((r=n.headers.get("content-type"))!=null&&r.includes("application/json"))try{t=await n.json(),e=t.error||e}catch(i){console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await n.text()||e}catch(i){console.log("Failed to get text from error response")}throw new xc(e,n.status)};function WA(){var n;if(typeof window!="undefined"&&window.navigator){let e=navigator;return"userAgentData"in e&&((n=e.userAgentData)!=null&&n.platform)?`${e.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}else if(typeof process!="undefined")return`${process.arch} ${process.platform} Node.js/${process.version}`;return""}function zA(n){if(n instanceof Headers){let e={};return n.forEach((t,r)=>{e[r]=t}),e}else return Array.isArray(n)?Object.fromEntries(n):n||{}}var JA=(n,e)=>n[e],Mc=async(n,e,t={})=>{let r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${HA} (${WA()})`};t.headers=zA(t.headers);try{let o=new URL(e);if(o.protocol==="https:"&&o.hostname==="ollama.com"){let s=typeof process=="object"&&process!==null&&typeof process.env=="object"&&process.env!==null?JA(process.env,"OLLAMA_API_KEY"):void 0;!(t.headers.authorization||t.headers.Authorization)&&s&&(t.headers.Authorization=`Bearer ${s}`)}}catch(o){console.error("error parsing url",o)}let i=Object.fromEntries(Object.entries(t.headers).filter(([o])=>!Object.keys(r).some(s=>s.toLowerCase()===o.toLowerCase())));return t.headers={...r,...i},n(e,t)},jm=async(n,e,t)=>{let r=await Mc(n,e,{headers:t==null?void 0:t.headers});return await Nc(r),r},_r=async(n,e,t,r)=>{let o=(l=>l!==null&&typeof l=="object"&&!Array.isArray(l))(t)?JSON.stringify(t):t,s=await Mc(n,e,{method:"POST",body:o,signal:r==null?void 0:r.signal,headers:r==null?void 0:r.headers});return await Nc(s),s},YA=async(n,e,t,r)=>{let i=await Mc(n,e,{method:"DELETE",body:JSON.stringify(t),headers:r==null?void 0:r.headers});return await Nc(i),i},KA=async function*(n){var i;let e=new TextDecoder("utf-8"),t="",r=n.getReader();for(;;){let{done:o,value:s}=await r.read();if(o)break;t+=e.decode(s,{stream:!0});let l=t.split(`
`);t=(i=l.pop())!=null?i:"";for(let f of l)try{yield JSON.parse(f)}catch(d){console.warn("invalid json: ",f)}}t+=e.decode();for(let o of t.split(`
`).filter(s=>s!==""))try{yield JSON.parse(o)}catch(s){console.warn("invalid json: ",o)}},XA=n=>{if(!n)return tg;let e=n.includes("://");n.startsWith(":")&&(n=`http://127.0.0.1${n}`,e=!0),e||(n=`http://${n}`);let t=new URL(n),r=t.port;r||(e?r=t.protocol==="https:"?"443":"80":r=eg);let i="";t.username&&(i=t.username,t.password&&(i+=`:${t.password}`),i+="@");let o=`${t.protocol}//${i}${t.hostname}:${r}${t.pathname}`;return o.endsWith("/")&&(o=o.slice(0,-1)),o},QA=Object.defineProperty,ZA=(n,e,t)=>e in n?QA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Pc=(n,e,t)=>(ZA(n,typeof e!="symbol"?e+"":e,t),t),Dc=class{constructor(e){var t,r;Pc(this,"config"),Pc(this,"fetch"),Pc(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e==null?void 0:e.headers},e!=null&&e.proxy||(this.config.host=XA((t=e==null?void 0:e.host)!=null?t:tg)),this.fetch=(r=e==null?void 0:e.fetch)!=null?r:fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){var o;t.stream=(o=t.stream)!=null?o:!1;let r=`${this.config.host}/api/${e}`;if(t.stream){let s=new AbortController,l=await _r(this.fetch,r,t,{signal:s.signal,headers:this.config.headers});if(!l.body)throw new Error("Missing body");let f=KA(l.body),d=new kc(s,f,()=>{let h=this.ongoingStreamedRequests.indexOf(d);h>-1&&this.ongoingStreamedRequests.splice(h,1)});return this.ongoingStreamedRequests.push(d),d}return await(await _r(this.fetch,r,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){let t=new Uint8Array(e),r="",i=t.byteLength;for(let o=0;o<i;o++)r+=String.fromCharCode(t[o]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await YA(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await _r(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await jm(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await _r(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await _r(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await _r(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await jm(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}async webSearch(e){if(!e.query||e.query.length===0)throw new Error("Query is required");return await(await _r(this.fetch,"https://ollama.com/api/web_search",{...e},{headers:this.config.headers})).json()}async webFetch(e){if(!e.url||e.url.length===0)throw new Error("URL is required");return await(await _r(this.fetch,"https://ollama.com/api/web_fetch",{...e},{headers:this.config.headers})).json()}},YF=new Dc;var QF=Le(Rc(),1),jo=class extends Dc{async encodeImage(e){if(typeof e!="string")return Buffer.from(e).toString("base64");try{if(Zo.default.existsSync(e)){let t=await Zo.promises.readFile((0,Oc.resolve)(e));return Buffer.from(t).toString("base64")}}catch(t){}return e}async fileExists(e){try{return await Zo.promises.access(e),!0}catch(t){return!1}}async create(e){if(e.from&&await this.fileExists((0,Oc.resolve)(e.from)))throw Error("Creating with a local path is not currently supported from ollama-js");return e.stream?super.create(e):super.create(e)}},ZF=new jo;function Pa(n){ft=n}var ft,Be=[{name:"llava-llama3 (8B) [default]",model:"llava-llama3:latest",imageReady:!0,provider:"ollama"},{name:"llama3.2-vision (11B)",model:"llama3.2-vision:11b",imageReady:!0,provider:"ollama"},{name:"llama3.2-vision (90B)",model:"llama3.2-vision:90b",imageReady:!0,provider:"ollama"},{name:"llava (7B)",model:"llava:latest",imageReady:!0,provider:"ollama"},{name:"llava (13B)",model:"llava:13b",imageReady:!0,provider:"ollama"},{name:"llava (34B)",model:"llava:34b",imageReady:!0,provider:"ollama"},{name:"llama3.3 (70B)",model:"llama3.3",imageReady:!1,provider:"ollama"},{name:"deepseek-r1 (7B)",model:"deepseek-r1",imageReady:!1,provider:"ollama"},{name:"llama3.2 (3B)",model:"llama3.2",imageReady:!1,provider:"ollama"},{name:"llama3.2 (1B)",model:"llama3.2:1b",imageReady:!1,provider:"ollama"},{name:"llama3.1 (8B)",model:"llama3.1",imageReady:!1,provider:"ollama"},{name:"llama3.1 (70B)",model:"llama3.1:70b",imageReady:!1,provider:"ollama"},{name:"gemma3 (1B)",model:"gemma3:1b",imageReady:!1,provider:"ollama"},{name:"gemma3 (4B)",model:"gemma3:4b",imageReady:!0,provider:"ollama"},{name:"gemma3 (12B)",model:"gemma3:12b",imageReady:!0,provider:"ollama"},{name:"gemma3 (27B)",model:"gemma3:27b",imageReady:!0,provider:"ollama"}],xa=null;function ng(n){xa=n}var Ia=[];function rg(n){return Ia.push(n),()=>{let e=Ia.indexOf(n);e>-1&&Ia.splice(e,1)}}function Gi(){Ia.forEach(n=>n())}var Et="ai-adapter/providers/ollamaProvider",Cn,Uc={lastModel:Be[8],lastImageModel:Be[0],url:"http://127.0.0.1:11434",fallbackUrl:"",token:""},Ge=class Ge extends Bi{constructor(){super(),this.lastModel=fe.aiAdapterSettings.ollamaSettings.lastModel,this.lastImageModel=fe.aiAdapterSettings.ollamaSettings.lastImageModel,Ge.refreshInstance(),this.checkOllama().then(e=>{ue(Et,"Ollama check success: "+e)})}generateSettings(e,t){new dt.Setting(e).setName("Ollama").setHeading(),new dt.Setting(e).setName("Pull models").setDesc("Pull the selected models").addButton(r=>r.setButtonText("Pull model").onClick(async()=>{await Ge.pullImage(fe.aiAdapterSettings.selectedImageModel)})),new dt.Setting(e).setName("Ollama URL").setDesc("Set the URL for the ollama server").addText(r=>r.setPlaceholder("Enter the host (http://127.0.0.1:11434)").setValue(fe.aiAdapterSettings.ollamaSettings.url).onChange(async i=>{i.length===0&&(i=Uc.url),fe.aiAdapterSettings.ollamaSettings.url=i,Ge.refreshInstance(),this.checkOllama().then(o=>{ue(Et,"Ollama check success: "+o)}),await Ht(t)})),new dt.Setting(e).setName("Fallback URL (optional)").setDesc("Set a fallback URL for the ollama server").addText(r=>r.setPlaceholder("Enter the host (http://127.0.0.1:11434)").setValue(fe.aiAdapterSettings.ollamaSettings.fallbackUrl).onChange(async i=>{fe.aiAdapterSettings.ollamaSettings.fallbackUrl=i,Ge.refreshInstance(),this.checkOllama().then(o=>{ue(Et,"Ollama check success: "+o)}),await Ht(t)})),new dt.Setting(e).setName("Ollama token (optional)").setDesc("Set the token used to authenticate with the ollama server").addText(r=>r.setValue(fe.aiAdapterSettings.ollamaSettings.token!==""?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async i=>{i.contains("\u2022")||(fe.aiAdapterSettings.ollamaSettings.token=i,Ge.refreshInstance(),await Ht(t))}))}async queryHandling(e){return(await Cn.chat({model:fe.aiAdapterSettings.selectedModel.model,messages:[{role:"user",content:e}]})).message.content}async queryWithImageHandling(e,t){return(await Cn.chat({model:fe.aiAdapterSettings.selectedImageModel.model,messages:[{role:"user",content:e,images:[t]}]})).message.content}async checkOllama(){var e;try{let t=await Cn.list();ue(Et,t);let r=!1;for(let i of t.models){let o=(await Cn.show({model:i.name})).capabilities,s=o.includes("vision"),l=o.includes("completion"),f=i.name.split(":")[0]+" ["+i.details.parameter_size+"] (custom)";l&&!Be.some(d=>d.model===i.name&&!d.imageReady)&&(Be.push({name:f,model:i.name,provider:"ollama",imageReady:!1}),ue(Et,"Added model: "+f),r=!0),s&&!Be.some(d=>d.model===i.name&&d.imageReady)&&(Be.push({name:f,model:i.name,provider:"ollama",imageReady:!0}),ue(Et,"Added image model: "+f),r=!0)}return r&&(ue(Et,"Models updated, notifying settings tab"),Gi()),t.models.some(i=>i.name===fe.aiAdapterSettings.selectedModel.model)||ue(Et,"No text model found (currently not used)"),t.models.some(i=>i.name===fe.aiAdapterSettings.selectedImageModel.model)||new dt.Notice(`No ${fe.aiAdapterSettings.selectedImageModel.name} model found, please make sure you have pulled it (you can pull it over the settings tab or choose another model)`),!0}catch(t){return ue(Et,t),!Ge.fallback&&((e=fe.aiAdapterSettings.ollamaSettings.fallbackUrl)==null?void 0:e.length)>0?(Ge.fallback=!0,ue(Et,"Falling back to fallback URL"),Ge.refreshInstance(),await this.checkOllama()):(new dt.Notice("Error connecting to ollama."),new dt.Notice(t.toString()),!1)}}static async pullImage(e){let t;try{new dt.Notice(`Pulling ${e.name} model started, this may take a while...`);let r=await Cn.pull({model:e.model,stream:!0});t=new dt.Notice(`Pulling ${e.name} model 0%`,0);for await(let i of r)if(ue(Et,i),i.total!==null&&i.completed!==null){let o=i.completed/i.total*100;if(!isNaN(o)&&o!==1/0&&o!==-1/0){let s=o.toFixed(2),l=(i.completed/1e9).toFixed(2),f=(i.total/1e9).toFixed(2);t.setMessage(`Pulling ${e.name} model ${s}% (${l}GB/${f}GB)`)}}t.hide(),new dt.Notice(`${e.name} model pulled successfully`)}catch(r){ue(Et,r),t==null||t.hide(),new dt.Notice(`Failed to pull ${e.name} model`),new dt.Notice(r.toString())}}static refreshInstance(){ue(Et,"Refreshing Ollama instance (fallback: "+Ge.fallback+")"),Cn!==void 0&&Cn.abort(),Ge.abortCurrentOllamaRequest(),Cn=new jo({host:this.fallback?fe.aiAdapterSettings.ollamaSettings.fallbackUrl:fe.aiAdapterSettings.ollamaSettings.url,headers:{Authorization:`Bearer ${fe.aiAdapterSettings.ollamaSettings.token}`},fetch:Ge.ollamaFetch})}setLastModel(e){super.setLastModel(e),fe.aiAdapterSettings.ollamaSettings.lastModel=e}setLastImageModel(e){super.setLastImageModel(e),fe.aiAdapterSettings.ollamaSettings.lastImageModel=e}shutdown(){ue(Et,"Shutting down Ollama instance"),Ge.abortCurrentOllamaRequest(),Cn!==void 0&&Cn.abort()}static ollamaFetch(e,t){let r=new AbortController;if(t!=null&&t.signal){let s=t.signal;if(s.aborted)r.abort();else{let l=()=>r.abort();s.addEventListener("abort",l,{once:!0})}}Ge.currentOllamaController=r;let i={...t||{},signal:r.signal},o=fetch(e,i);return o.finally(()=>{Ge.currentOllamaController===r&&(Ge.currentOllamaController=void 0)}).catch(()=>{}),o}static abortCurrentOllamaRequest(){if(Ge.currentOllamaController)try{Ge.currentOllamaController.abort()}catch(e){}finally{Ge.currentOllamaController=void 0}}};Ge.fallback=!1;var an=Ge;var Mo=require("obsidian");var Yv=Le(PS(),1),Kv=require("fs"),Iu=Le(require("fs/promises"),1),Xv=require("fs/promises"),Qv=require("node:stream"),Zv=require("node:stream/promises");var Bk=Le(CT(),1),Gk=Le(Sh(),1),Hk=Le(wh(),1),kh=Le(uu(),1),Vk=Le(MT(),1);var jv=Le(require("path"),1);var Wk,zk;function Jk(){return{geminiUrl:Wk,vertexUrl:zk}}function Yk(n,e,t,r){var i,o;if(!(n!=null&&n.baseUrl)){let s=Jk();return e?(i=s.vertexUrl)!==null&&i!==void 0?i:t:(o=s.geminiUrl)!==null&&o!==void 0?o:r}return n.baseUrl}var _n=class{};function ee(n,e){let t=/\{([^}]+)\}/g;return n.replace(t,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){let o=e[i];return o!=null?String(o):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function c(n,e,t){for(let o=0;o<e.length-1;o++){let s=e[o];if(s.endsWith("[]")){let l=s.slice(0,-2);if(!(l in n))if(Array.isArray(t))n[l]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(n[l])){let f=n[l];if(Array.isArray(t))for(let d=0;d<f.length;d++){let h=f[d];c(h,e.slice(o+1),t[d])}else for(let d of f)c(d,e.slice(o+1),t)}return}else if(s.endsWith("[0]")){let l=s.slice(0,-3);l in n||(n[l]=[{}]);let f=n[l];c(f[0],e.slice(o+1),t);return}(!n[s]||typeof n[s]!="object")&&(n[s]={}),n=n[s]}let r=e[e.length-1],i=n[r];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[r]=t}function a(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let r=0;r<e.length;r++){if(typeof n!="object"||n===null)return t;let i=e[r];if(i.endsWith("[]")){let o=i.slice(0,-2);if(o in n){let s=n[o];return Array.isArray(s)?s.map(l=>a(l,e.slice(r+1),t)):t}else return t}else n=n[i]}return n}catch(r){if(r instanceof TypeError)return t;throw r}}function Kk(n,e){for(let[t,r]of Object.entries(e)){let i=t.split("."),o=r.split("."),s=new Set,l=-1;for(let f=0;f<i.length;f++)if(i[f]==="*"){l=f;break}if(l!==-1&&o.length>l)for(let f=l;f<o.length;f++){let d=o[f];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&s.add(d)}Nh(n,i,o,0,s)}}function Nh(n,e,t,r,i){if(r>=e.length||typeof n!="object"||n===null)return;let o=e[r];if(o.endsWith("[]")){let s=o.slice(0,-2),l=n;if(s in l&&Array.isArray(l[s]))for(let f of l[s])Nh(f,e,t,r+1,i)}else if(o==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){let s=n,l=Object.keys(s).filter(d=>!d.startsWith("_")&&!i.has(d)),f={};for(let d of l)f[d]=s[d];for(let[d,h]of Object.entries(f)){let m=[];for(let g of t.slice(r))g==="*"?m.push(d):m.push(g);c(s,m,h)}for(let d of l)delete s[d]}}else{let s=n;o in s&&Nh(s[o],e,t,r+1,i)}}function vp(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function Xk(n){let e={},t=a(n,["operationName"]);t!=null&&c(e,["operationName"],t);let r=a(n,["resourceName"]);return r!=null&&c(e,["_url","resourceName"],r),e}function Qk(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["metadata"]);r!=null&&c(e,["metadata"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);o!=null&&c(e,["error"],o);let s=a(n,["response","generateVideoResponse"]);return s!=null&&c(e,["response"],jk(s)),e}function Zk(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["metadata"]);r!=null&&c(e,["metadata"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);o!=null&&c(e,["error"],o);let s=a(n,["response"]);return s!=null&&c(e,["response"],eN(s)),e}function jk(n){let e={},t=a(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>tN(s))),c(e,["generatedVideos"],o)}let r=a(n,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);let i=a(n,["raiMediaFilteredReasons"]);return i!=null&&c(e,["raiMediaFilteredReasons"],i),e}function eN(n){let e={},t=a(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>nN(s))),c(e,["generatedVideos"],o)}let r=a(n,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);let i=a(n,["raiMediaFilteredReasons"]);return i!=null&&c(e,["raiMediaFilteredReasons"],i),e}function tN(n){let e={},t=a(n,["video"]);return t!=null&&c(e,["video"],lN(t)),e}function nN(n){let e={},t=a(n,["_self"]);return t!=null&&c(e,["video"],uN(t)),e}function rN(n){let e={},t=a(n,["operationName"]);return t!=null&&c(e,["_url","operationName"],t),e}function iN(n){let e={},t=a(n,["operationName"]);return t!=null&&c(e,["_url","operationName"],t),e}function oN(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["metadata"]);r!=null&&c(e,["metadata"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);o!=null&&c(e,["error"],o);let s=a(n,["response"]);return s!=null&&c(e,["response"],sN(s)),e}function sN(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["parent"]);r!=null&&c(e,["parent"],r);let i=a(n,["documentName"]);return i!=null&&c(e,["documentName"],i),e}function wp(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["metadata"]);r!=null&&c(e,["metadata"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);o!=null&&c(e,["error"],o);let s=a(n,["response"]);return s!=null&&c(e,["response"],aN(s)),e}function aN(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["parent"]);r!=null&&c(e,["parent"],r);let i=a(n,["documentName"]);return i!=null&&c(e,["documentName"],i),e}function lN(n){let e={},t=a(n,["uri"]);t!=null&&c(e,["uri"],t);let r=a(n,["encodedVideo"]);r!=null&&c(e,["videoBytes"],vp(r));let i=a(n,["encoding"]);return i!=null&&c(e,["mimeType"],i),e}function uN(n){let e={},t=a(n,["gcsUri"]);t!=null&&c(e,["uri"],t);let r=a(n,["bytesBase64Encoded"]);r!=null&&c(e,["videoBytes"],vp(r));let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}var DT;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(DT||(DT={}));var OT;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(OT||(OT={}));var UT;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(UT||(UT={}));var xr;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(xr||(xr={}));var FT;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(FT||(FT={}));var LT;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(LT||(LT={}));var qT;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(qT||(qT={}));var BT;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(BT||(BT={}));var GT;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(GT||(GT={}));var HT;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(HT||(HT={}));var VT;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(VT||(VT={}));var $T;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})($T||($T={}));var WT;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE"})(WT||(WT={}));var zT;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(zT||(zT={}));var JT;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(JT||(JT={}));var YT;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(YT||(YT={}));var KT;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(KT||(KT={}));var XT;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(XT||(XT={}));var hu;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(hu||(hu={}));var QT;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(QT||(QT={}));var ZT;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(ZT||(ZT={}));var jT;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(jT||(jT={}));var Mh;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Mh||(Mh={}));var ev;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(ev||(ev={}));var tv;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(tv||(tv={}));var nv;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(nv||(nv={}));var rv;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(rv||(rv={}));var iv;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(iv||(iv={}));var ov;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(ov||(ov={}));var sv;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(sv||(sv={}));var av;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(av||(av={}));var lv;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(lv||(lv={}));var uv;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(uv||(uv={}));var cv;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(cv||(cv={}));var fv;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(fv||(fv={}));var dv;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(dv||(dv={}));var hv;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(hv||(hv={}));var pv;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(pv||(pv={}));var mv;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(mv||(mv={}));var gv;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(gv||(gv={}));var yv;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(yv||(yv={}));var _v;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(_v||(_v={}));var Ev;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(Ev||(Ev={}));var Sv;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(Sv||(Sv={}));var Tv;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Tv||(Tv={}));var vv;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(vv||(vv={}));var wv;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(wv||(wv={}));var Cv;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Cv||(Cv={}));var Av;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(Av||(Av={}));var bv;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(bv||(bv={}));var Rv;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Rv||(Rv={}));var Iv;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(Iv||(Iv={}));var Ao;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(Ao||(Ao={}));var gi=class{constructor(e){let t={};for(let r of e.headers.entries())t[r[0]]=r[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}};var pi=class{get text(){var e,t,r,i,o,s,l,f;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",h=!1,m=[];for(let g of(f=(l=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&f!==void 0?f:[]){for(let[E,w]of Object.entries(g))E!=="text"&&E!=="thought"&&(w!==null||w!==void 0)&&m.push(E);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;h=!0,d+=g.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),h?d:void 0}get data(){var e,t,r,i,o,s,l,f;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="",h=[];for(let m of(f=(l=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)!==null&&f!==void 0?f:[]){for(let[g,E]of Object.entries(m))g!=="inlineData"&&(E!==null||E!==void 0)&&h.push(g);m.inlineData&&typeof m.inlineData.data=="string"&&(d+=atob(m.inlineData.data))}return h.length>0&&console.warn(`there are non-data parts ${h} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,r,i,o,s,l,f;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let d=(f=(l=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||f===void 0?void 0:f.filter(h=>h.functionCall).map(h=>h.functionCall).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,r,i,o,s,l,f,d;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let h=(f=(l=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||f===void 0?void 0:f.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,r,i,o,s,l,f,d;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let h=(f=(l=(s=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content)===null||l===void 0?void 0:l.parts)===null||f===void 0?void 0:f.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((h==null?void 0:h.length)!==0)return(d=h==null?void 0:h[0])===null||d===void 0?void 0:d.output}},pu=class{},mu=class{},Dh=class{},Oh=class{},Uh=class{},Fh=class{},gu=class{},yu=class{},_u=class{},Lh=class{};var Eu=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new n,i,o=e;return t?i=Zk(o):i=Qk(o),Object.assign(r,i),r}},Su=class{},Tu=class{},vu=class{},qh=class{},Bh=class{},Gh=class{};var Hh=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new n,o=oN(e);return Object.assign(r,o),r}},Vh=class{},$h=class{},Wh=class{};var wu=class{};var zh=class{get text(){var e,t,r;let i="",o=!1,s=[];for(let l of(r=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(let[f,d]of Object.entries(l))f!=="text"&&f!=="thought"&&d!==null&&s.push(f);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;o=!0,i+=l.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?i:void 0}get data(){var e,t,r;let i="",o=[];for(let s of(r=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(let[l,f]of Object.entries(s))l!=="inlineData"&&f!==null&&o.push(l);s.inlineData&&typeof s.inlineData.data=="string"&&(i+=atob(s.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}};var Jh=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};var Cu=class n{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let r=new n,o=wp(e);return Object.assign(r,o),r}};function Ce(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function ew(n,e){let t=Ce(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function tw(n){return Array.isArray(n)?n.map(e=>Au(e)):[Au(n)]}function Au(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function nw(n){let e=Au(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function rw(n){let e=Au(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Pv(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function iw(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>Pv(e)):[Pv(n)]}function Yh(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function xv(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function kv(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function ot(n){if(n==null)throw new Error("ContentUnion is required");return Yh(n)?n:{role:"user",parts:iw(n)}}function Cp(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{let r=ot(t);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(n.isVertexAI()){let t=ot(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>ot(t)):[ot(e)]}function en(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(xv(n)||kv(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ot(n)]}let e=[],t=[],r=Yh(n[0]);for(let i of n){let o=Yh(i);if(o!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(i);else{if(xv(i)||kv(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return r||e.push({role:"user",parts:iw(t)}),e}function cN(n,e){n.includes("null")&&(e.nullable=!0);let t=n.filter(r=>r!=="null");if(t.length===1)e.type=Object.values(xr).includes(t[0].toUpperCase())?t[0].toUpperCase():xr.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let r of t)e.anyOf.push({type:Object.values(xr).includes(r.toUpperCase())?r.toUpperCase():xr.TYPE_UNSPECIFIED})}}function bo(n){let e={},t=["items"],r=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");let o=n.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,n=o[1]):o[1].type==="null"&&(e.nullable=!0,n=o[0])),n.type instanceof Array&&cN(n.type,e);for(let[s,l]of Object.entries(n))if(l!=null)if(s=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;e.type=Object.values(xr).includes(l.toUpperCase())?l.toUpperCase():xr.TYPE_UNSPECIFIED}else if(t.includes(s))e[s]=bo(l);else if(r.includes(s)){let f=[];for(let d of l){if(d.type=="null"){e.nullable=!0;continue}f.push(bo(d))}e[s]=f}else if(i.includes(s)){let f={};for(let[d,h]of Object.entries(l))f[d]=bo(h);e[s]=f}else{if(s==="additionalProperties")continue;e[s]=l}return e}function Ap(n){return bo(n)}function bp(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Rp(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Po(n){if(n.functionDeclarations)for(let e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=bo(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=bo(e.response));return n}function xo(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");let e=[];for(let t of n)e.push(t);return e}function fN(n,e,t,r=1){let i=!e.startsWith(`${t}/`)&&e.split("/").length===r;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function lr(n,e){if(typeof e!="string")throw new Error("name must be a string");return fN(n,e,"cachedContents")}function ow(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Nr(n){return vp(n)}function dN(n){return n!=null&&typeof n=="object"&&"name"in n}function sw(n){return n!=null&&typeof n=="object"&&"video"in n}function aw(n){return n!=null&&typeof n=="object"&&"uri"in n}function Ip(n){var e;let t;if(dN(n)&&(t=n.name),!(aw(n)&&(t=n.uri,t===void 0))&&!(sw(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){let i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function lw(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function uw(n){for(let e of["models","tunedModels","publisherModels"])if(hN(n,e))return n[e];return[]}function hN(n,e){return n!==null&&typeof n=="object"&&e in n}function pN(n,e={}){let t=n,r={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(r.responseJsonSchema=t.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function mN(n,e={}){let t=[],r=new Set;for(let i of n){let o=i.name;if(r.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);r.add(o);let s=pN(i,e);s.functionDeclarations&&t.push(...s.functionDeclarations)}return{functionDeclarations:t}}function cw(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;let r=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,i=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(i>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function gN(n){if(typeof n!="string")return n;let e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function fw(n){if(typeof n!="object"||n===null)return{};let e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;let i=t.inlinedResponses;if(!Array.isArray(i)||i.length===0)return n;let o=!1;for(let s of i){if(typeof s!="object"||s===null)continue;let f=s.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function ko(n,e){let t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function dw(n){let e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function yN(n){let e={},t=a(n,["responsesFile"]);t!=null&&c(e,["fileName"],t);let r=a(n,["inlinedResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>YN(s))),c(e,["inlinedResponses"],o)}let i=a(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["inlinedEmbedContentResponses"],o)}return e}function _N(n){let e={},t=a(n,["predictionsFormat"]);t!=null&&c(e,["format"],t);let r=a(n,["gcsDestination","outputUriPrefix"]);r!=null&&c(e,["gcsUri"],r);let i=a(n,["bigqueryDestination","outputUri"]);return i!=null&&c(e,["bigqueryUri"],i),e}function EN(n){let e={},t=a(n,["format"]);t!=null&&c(e,["predictionsFormat"],t);let r=a(n,["gcsUri"]);r!=null&&c(e,["gcsDestination","outputUriPrefix"],r);let i=a(n,["bigqueryUri"]);if(i!=null&&c(e,["bigqueryDestination","outputUri"],i),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(a(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function fu(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["metadata","displayName"]);r!=null&&c(e,["displayName"],r);let i=a(n,["metadata","state"]);i!=null&&c(e,["state"],dw(i));let o=a(n,["metadata","createTime"]);o!=null&&c(e,["createTime"],o);let s=a(n,["metadata","endTime"]);s!=null&&c(e,["endTime"],s);let l=a(n,["metadata","updateTime"]);l!=null&&c(e,["updateTime"],l);let f=a(n,["metadata","model"]);f!=null&&c(e,["model"],f);let d=a(n,["metadata","output"]);return d!=null&&c(e,["dest"],yN(fw(d))),e}function Kh(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["displayName"]);r!=null&&c(e,["displayName"],r);let i=a(n,["state"]);i!=null&&c(e,["state"],dw(i));let o=a(n,["error"]);o!=null&&c(e,["error"],o);let s=a(n,["createTime"]);s!=null&&c(e,["createTime"],s);let l=a(n,["startTime"]);l!=null&&c(e,["startTime"],l);let f=a(n,["endTime"]);f!=null&&c(e,["endTime"],f);let d=a(n,["updateTime"]);d!=null&&c(e,["updateTime"],d);let h=a(n,["model"]);h!=null&&c(e,["model"],h);let m=a(n,["inputConfig"]);m!=null&&c(e,["src"],SN(m));let g=a(n,["outputConfig"]);g!=null&&c(e,["dest"],_N(fw(g)));let E=a(n,["completionStats"]);return E!=null&&c(e,["completionStats"],E),e}function SN(n){let e={},t=a(n,["instancesFormat"]);t!=null&&c(e,["format"],t);let r=a(n,["gcsSource","uris"]);r!=null&&c(e,["gcsUri"],r);let i=a(n,["bigquerySource","inputUri"]);return i!=null&&c(e,["bigqueryUri"],i),e}function TN(n,e){let t={};if(a(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let r=a(e,["fileName"]);r!=null&&c(t,["fileName"],r);let i=a(e,["inlinedRequests"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>JN(n,s))),c(t,["requests","requests"],o)}return t}function vN(n){let e={},t=a(n,["format"]);t!=null&&c(e,["instancesFormat"],t);let r=a(n,["gcsUri"]);r!=null&&c(e,["gcsSource","uris"],r);let i=a(n,["bigqueryUri"]);if(i!=null&&c(e,["bigquerySource","inputUri"],i),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function wN(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function CN(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],ko(n,r)),t}function AN(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],ko(n,r)),t}function bN(n){let e={},t=a(n,["content"]);t!=null&&c(e,["content"],t);let r=a(n,["citationMetadata"]);r!=null&&c(e,["citationMetadata"],RN(r));let i=a(n,["tokenCount"]);i!=null&&c(e,["tokenCount"],i);let o=a(n,["finishReason"]);o!=null&&c(e,["finishReason"],o);let s=a(n,["avgLogprobs"]);s!=null&&c(e,["avgLogprobs"],s);let l=a(n,["groundingMetadata"]);l!=null&&c(e,["groundingMetadata"],l);let f=a(n,["index"]);f!=null&&c(e,["index"],f);let d=a(n,["logprobsResult"]);d!=null&&c(e,["logprobsResult"],d);let h=a(n,["safetyRatings"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(E=>E)),c(e,["safetyRatings"],g)}let m=a(n,["urlContextMetadata"]);return m!=null&&c(e,["urlContextMetadata"],m),e}function RN(n){let e={},t=a(n,["citationSources"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>i)),c(e,["citations"],r)}return e}function hw(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>tM(o))),c(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&c(e,["role"],r),e}function IN(n,e){let t={},r=a(n,["displayName"]);if(e!==void 0&&r!=null&&c(e,["batch","displayName"],r),a(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function PN(n,e){let t={},r=a(n,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);let i=a(n,["dest"]);return e!==void 0&&i!=null&&c(e,["outputConfig"],EN(gN(i))),t}function Nv(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["src"]);i!=null&&c(t,["batch","inputConfig"],TN(n,cw(n,i)));let o=a(e,["config"]);return o!=null&&IN(o,t),t}function xN(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["model"],Ce(n,r));let i=a(e,["src"]);i!=null&&c(t,["inputConfig"],vN(cw(n,i)));let o=a(e,["config"]);return o!=null&&PN(o,t),t}function kN(n,e){let t={},r=a(n,["displayName"]);return e!==void 0&&r!=null&&c(e,["batch","displayName"],r),t}function NN(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["src"]);i!=null&&c(t,["batch","inputConfig"],qN(n,i));let o=a(e,["config"]);return o!=null&&kN(o,t),t}function MN(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],ko(n,r)),t}function DN(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],ko(n,r)),t}function ON(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["name"]);r!=null&&c(e,["name"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);return o!=null&&c(e,["error"],o),e}function UN(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["name"]);r!=null&&c(e,["name"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);return o!=null&&c(e,["error"],o),e}function FN(n,e){let t={},r=a(e,["contents"]);if(r!=null){let o=Cp(n,r);Array.isArray(o)&&(o=o.map(s=>s)),c(t,["requests[]","request","content"],o)}let i=a(e,["config"]);return i!=null&&(c(t,["_self"],LN(i,t)),Kk(t,{"requests[].*":"requests[].request.*"})),t}function LN(n,e){let t={},r=a(n,["taskType"]);e!==void 0&&r!=null&&c(e,["requests[]","taskType"],r);let i=a(n,["title"]);e!==void 0&&i!=null&&c(e,["requests[]","title"],i);let o=a(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&c(e,["requests[]","outputDimensionality"],o),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function qN(n,e){let t={},r=a(e,["fileName"]);r!=null&&c(t,["file_name"],r);let i=a(e,["inlinedRequests"]);return i!=null&&c(t,["requests"],FN(n,i)),t}function BN(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function GN(n,e,t){let r={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&c(t,["systemInstruction"],hw(ot(i)));let o=a(e,["temperature"]);o!=null&&c(r,["temperature"],o);let s=a(e,["topP"]);s!=null&&c(r,["topP"],s);let l=a(e,["topK"]);l!=null&&c(r,["topK"],l);let f=a(e,["candidateCount"]);f!=null&&c(r,["candidateCount"],f);let d=a(e,["maxOutputTokens"]);d!=null&&c(r,["maxOutputTokens"],d);let h=a(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);let m=a(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);let g=a(e,["logprobs"]);g!=null&&c(r,["logprobs"],g);let E=a(e,["presencePenalty"]);E!=null&&c(r,["presencePenalty"],E);let w=a(e,["frequencyPenalty"]);w!=null&&c(r,["frequencyPenalty"],w);let C=a(e,["seed"]);C!=null&&c(r,["seed"],C);let R=a(e,["responseMimeType"]);R!=null&&c(r,["responseMimeType"],R);let P=a(e,["responseSchema"]);P!=null&&c(r,["responseSchema"],Ap(P));let z=a(e,["responseJsonSchema"]);if(z!=null&&c(r,["responseJsonSchema"],z),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let $=a(e,["safetySettings"]);if(t!==void 0&&$!=null){let Q=$;Array.isArray(Q)&&(Q=Q.map(ie=>nM(ie))),c(t,["safetySettings"],Q)}let W=a(e,["tools"]);if(t!==void 0&&W!=null){let Q=xo(W);Array.isArray(Q)&&(Q=Q.map(ie=>rM(Po(ie)))),c(t,["tools"],Q)}let H=a(e,["toolConfig"]);if(t!==void 0&&H!=null&&c(t,["toolConfig"],H),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let G=a(e,["cachedContent"]);t!==void 0&&G!=null&&c(t,["cachedContent"],lr(n,G));let Y=a(e,["responseModalities"]);Y!=null&&c(r,["responseModalities"],Y);let j=a(e,["mediaResolution"]);j!=null&&c(r,["mediaResolution"],j);let T=a(e,["speechConfig"]);if(T!=null&&c(r,["speechConfig"],bp(T)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let L=a(e,["thinkingConfig"]);L!=null&&c(r,["thinkingConfig"],L);let X=a(e,["imageConfig"]);return X!=null&&c(r,["imageConfig"],X),r}function HN(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["candidates"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(d=>bN(d))),c(e,["candidates"],f)}let i=a(n,["modelVersion"]);i!=null&&c(e,["modelVersion"],i);let o=a(n,["promptFeedback"]);o!=null&&c(e,["promptFeedback"],o);let s=a(n,["responseId"]);s!=null&&c(e,["responseId"],s);let l=a(n,["usageMetadata"]);return l!=null&&c(e,["usageMetadata"],l),e}function VN(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],ko(n,r)),t}function $N(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],ko(n,r)),t}function WN(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function zN(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function JN(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["request","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let l=en(i);Array.isArray(l)&&(l=l.map(f=>hw(f))),c(t,["request","contents"],l)}let o=a(e,["metadata"]);o!=null&&c(t,["metadata"],o);let s=a(e,["config"]);return s!=null&&c(t,["request","generationConfig"],GN(n,s,a(t,["request"],{}))),t}function YN(n){let e={},t=a(n,["response"]);t!=null&&c(e,["response"],HN(t));let r=a(n,["error"]);return r!=null&&c(e,["error"],r),e}function KN(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);if(e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),a(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function XN(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);e!==void 0&&i!=null&&c(e,["_query","pageToken"],i);let o=a(n,["filter"]);return e!==void 0&&o!=null&&c(e,["_query","filter"],o),t}function QN(n){let e={},t=a(n,["config"]);return t!=null&&KN(t,e),e}function ZN(n){let e={},t=a(n,["config"]);return t!=null&&XN(t,e),e}function jN(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>fu(s))),c(e,["batchJobs"],o)}return e}function eM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>Kh(s))),c(e,["batchJobs"],o)}return e}function tM(n){let e={},t=a(n,["functionCall"]);t!=null&&c(e,["functionCall"],t);let r=a(n,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&c(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&c(e,["fileData"],BN(o));let s=a(n,["functionResponse"]);s!=null&&c(e,["functionResponse"],s);let l=a(n,["inlineData"]);l!=null&&c(e,["inlineData"],wN(l));let f=a(n,["text"]);f!=null&&c(e,["text"],f);let d=a(n,["thought"]);d!=null&&c(e,["thought"],d);let h=a(n,["thoughtSignature"]);h!=null&&c(e,["thoughtSignature"],h);let m=a(n,["videoMetadata"]);return m!=null&&c(e,["videoMetadata"],m),e}function nM(n){let e={},t=a(n,["category"]);if(t!=null&&c(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let r=a(n,["threshold"]);return r!=null&&c(e,["threshold"],r),e}function rM(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&c(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],WN(l));let f=a(n,["googleSearch"]);f!=null&&c(e,["googleSearch"],zN(f));let d=a(n,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}var sr;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(sr||(sr={}));var ar=class{constructor(e,t,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,r,i)}init(e,t,r){var i,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let s={config:{}};!r||Object.keys(r).length===0?s={config:{}}:typeof r=="object"?s=Object.assign({},r):s=r,s.config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(o=(i=s.config)===null||i===void 0?void 0:i.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};var Xh=class extends _n{constructor(e){super(),this.apiClient=e,this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)},this.list=async(t={})=>new ar(sr.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(t),t)}createInlinedGenerateContentRequest(e){let t=Nv(this.apiClient,e),r=t._url,i=ee("{model}:batchGenerateContent",r),l=t.batch.inputConfig.requests,f=l.requests,d=[];for(let h of f){let m=Object.assign({},h);if(m.systemInstruction){let g=m.systemInstruction;delete m.systemInstruction;let E=m.request;E.systemInstruction=g,m.request=E}d.push(m)}return l.requests=d,delete t.config,delete t._url,delete t._query,{path:i,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){let r=t?Object.assign({},t):{},i=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${i}`),r.dest===void 0){let o=this.getGcsUri(e),s=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?r.dest=`${o.slice(0,-6)}/dest`:r.dest=`${o}_dest_${i}`;else if(s)r.dest=`${s}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=xN(this.apiClient,e);return l=ee("batchPredictionJobs",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Kh(h))}else{let d=Nv(this.apiClient,e);return l=ee("{model}:batchGenerateContent",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>fu(h))}}async createEmbeddingsInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=NN(this.apiClient,e);return o=ee("{model}:asyncBatchEmbedContent",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>fu(f))}}async get(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=$N(this.apiClient,e);return l=ee("batchPredictionJobs/{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>Kh(h))}else{let d=VN(this.apiClient,e);return l=ee("batches/{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>fu(h))}}async cancel(e){var t,r,i,o;let s="",l={};if(this.apiClient.isVertexAI()){let f=AN(this.apiClient,e);s=ee("batchPredictionJobs/{name}:cancel",f._url),l=f._query,delete f._url,delete f._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{let f=CN(this.apiClient,e);s=ee("batches/{name}:cancel",f._url),l=f._query,delete f._url,delete f._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=ZN(e);return l=ee("batchPredictionJobs",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=eM(h),g=new wu;return Object.assign(g,m),g})}else{let d=QN(e);return l=ee("batches",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=jN(h),g=new wu;return Object.assign(g,m),g})}}async delete(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=DN(this.apiClient,e);return l=ee("batchPredictionJobs/{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>UN(h))}else{let d=MN(this.apiClient,e);return l=ee("batches/{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>ON(h))}}};function iM(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Mv(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>AM(o))),c(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&c(e,["role"],r),e}function oM(n,e){let t={},r=a(n,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);let i=a(n,["expireTime"]);e!==void 0&&i!=null&&c(e,["expireTime"],i);let o=a(n,["displayName"]);e!==void 0&&o!=null&&c(e,["displayName"],o);let s=a(n,["contents"]);if(e!==void 0&&s!=null){let h=en(s);Array.isArray(h)&&(h=h.map(m=>Mv(m))),c(e,["contents"],h)}let l=a(n,["systemInstruction"]);e!==void 0&&l!=null&&c(e,["systemInstruction"],Mv(ot(l)));let f=a(n,["tools"]);if(e!==void 0&&f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>bM(m))),c(e,["tools"],h)}let d=a(n,["toolConfig"]);if(e!==void 0&&d!=null&&c(e,["toolConfig"],d),a(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function sM(n,e){let t={},r=a(n,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);let i=a(n,["expireTime"]);e!==void 0&&i!=null&&c(e,["expireTime"],i);let o=a(n,["displayName"]);e!==void 0&&o!=null&&c(e,["displayName"],o);let s=a(n,["contents"]);if(e!==void 0&&s!=null){let m=en(s);Array.isArray(m)&&(m=m.map(g=>g)),c(e,["contents"],m)}let l=a(n,["systemInstruction"]);e!==void 0&&l!=null&&c(e,["systemInstruction"],ot(l));let f=a(n,["tools"]);if(e!==void 0&&f!=null){let m=f;Array.isArray(m)&&(m=m.map(g=>RM(g))),c(e,["tools"],m)}let d=a(n,["toolConfig"]);e!==void 0&&d!=null&&c(e,["toolConfig"],d);let h=a(n,["kmsKeyName"]);return e!==void 0&&h!=null&&c(e,["encryption_spec","kmsKeyName"],h),t}function aM(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["model"],ew(n,r));let i=a(e,["config"]);return i!=null&&oM(i,t),t}function lM(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["model"],ew(n,r));let i=a(e,["config"]);return i!=null&&sM(i,t),t}function uM(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],lr(n,r)),t}function cM(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],lr(n,r)),t}function fM(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function dM(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function hM(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function pM(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&c(e,["description"],t);let r=a(n,["name"]);r!=null&&c(e,["name"],r);let i=a(n,["parameters"]);i!=null&&c(e,["parameters"],i);let o=a(n,["parametersJsonSchema"]);o!=null&&c(e,["parametersJsonSchema"],o);let s=a(n,["response"]);s!=null&&c(e,["response"],s);let l=a(n,["responseJsonSchema"]);return l!=null&&c(e,["responseJsonSchema"],l),e}function mM(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],lr(n,r)),t}function gM(n,e){let t={},r=a(e,["name"]);return r!=null&&c(t,["_url","name"],lr(n,r)),t}function yM(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function _M(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function EM(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),t}function SM(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),t}function TM(n){let e={},t=a(n,["config"]);return t!=null&&EM(t,e),e}function vM(n){let e={},t=a(n,["config"]);return t!=null&&SM(t,e),e}function wM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["cachedContents"],o)}return e}function CM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["cachedContents"],o)}return e}function AM(n){let e={},t=a(n,["functionCall"]);t!=null&&c(e,["functionCall"],t);let r=a(n,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&c(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&c(e,["fileData"],hM(o));let s=a(n,["functionResponse"]);s!=null&&c(e,["functionResponse"],s);let l=a(n,["inlineData"]);l!=null&&c(e,["inlineData"],iM(l));let f=a(n,["text"]);f!=null&&c(e,["text"],f);let d=a(n,["thought"]);d!=null&&c(e,["thought"],d);let h=a(n,["thoughtSignature"]);h!=null&&c(e,["thoughtSignature"],h);let m=a(n,["videoMetadata"]);return m!=null&&c(e,["videoMetadata"],m),e}function bM(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&c(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],yM(l));let f=a(n,["googleSearch"]);f!=null&&c(e,["googleSearch"],_M(f));let d=a(n,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}function RM(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>pM(g))),c(e,["functionDeclarations"],m)}let r=a(n,["retrieval"]);r!=null&&c(e,["retrieval"],r);let i=a(n,["googleSearchRetrieval"]);i!=null&&c(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);if(o!=null&&c(e,["computerUse"],o),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=a(n,["codeExecution"]);s!=null&&c(e,["codeExecution"],s);let l=a(n,["enterpriseWebSearch"]);l!=null&&c(e,["enterpriseWebSearch"],l);let f=a(n,["googleMaps"]);f!=null&&c(e,["googleMaps"],f);let d=a(n,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);let h=a(n,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function IM(n,e){let t={},r=a(n,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);let i=a(n,["expireTime"]);return e!==void 0&&i!=null&&c(e,["expireTime"],i),t}function PM(n,e){let t={},r=a(n,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);let i=a(n,["expireTime"]);return e!==void 0&&i!=null&&c(e,["expireTime"],i),t}function xM(n,e){let t={},r=a(e,["name"]);r!=null&&c(t,["_url","name"],lr(n,r));let i=a(e,["config"]);return i!=null&&IM(i,t),t}function kM(n,e){let t={},r=a(e,["name"]);r!=null&&c(t,["_url","name"],lr(n,r));let i=a(e,["config"]);return i!=null&&PM(i,t),t}var Qh=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ar(sr.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(t),t)}async create(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=lM(this.apiClient,e);return l=ee("cachedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{let d=aM(this.apiClient,e);return l=ee("cachedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async get(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=gM(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{let d=mM(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async delete(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=cM(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=dM(h),g=new Tu;return Object.assign(g,m),g})}else{let d=uM(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=fM(h),g=new Tu;return Object.assign(g,m),g})}}async update(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=kM(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>h)}else{let d=xM(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>h)}}async listInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=vM(e);return l=ee("cachedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=CM(h),g=new vu;return Object.assign(g,m),g})}else{let d=TM(e);return l=ee("cachedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=wM(h),g=new vu;return Object.assign(g,m),g})}}};function Dv(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function De(n){return this instanceof De?(this.v=n,this):new De(n)}function Ro(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(E){return function(w){return Promise.resolve(w).then(E,m)}}function l(E,w){r[E]&&(i[E]=function(C){return new Promise(function(R,P){o.push([E,C,R,P])>1||f(E,C)})},w&&(i[E]=w(i[E])))}function f(E,w){try{d(r[E](w))}catch(C){g(o[0][3],C)}}function d(E){E.value instanceof De?Promise.resolve(E.value.v).then(h,m):g(o[0][2],E)}function h(E){f("next",E)}function m(E){f("throw",E)}function g(E,w){E(w),o.shift(),o.length&&f(o[0][0],o[0][1])}}function zs(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Dv=="function"?Dv(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(s){return new Promise(function(l,f){s=n[o](s),i(l,f,s.done,s.value)})}}function i(o,s,l,f){Promise.resolve(f).then(function(d){o({value:d,done:l})},s)}}function NM(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;let t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:pw(t)}function pw(n){if(n.parts===void 0||n.parts.length===0)return!1;for(let e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function MM(n){if(n.length!==0){for(let e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Ov(n){if(n===void 0||n.length===0)return[];let e=[],t=n.length,r=0;for(;r<t;)if(n[r].role==="user")e.push(n[r]),r++;else{let i=[],o=!0;for(;r<t&&n[r].role==="model";)i.push(n[r]),o&&!pw(n[r])&&(o=!1),r++;o?e.push(...i):e.pop()}return e}var Zh=class{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new jh(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},jh=class{constructor(e,t,r,i={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=r,this.config=i,this.history=o,this.sendPromise=Promise.resolve(),MM(o)}async sendMessage(e){var t;await this.sendPromise;let r=ot(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,s,l;let f=await i,d=(s=(o=f.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content,h=f.automaticFunctionCallingHistory,m=this.getHistory(!0).length,g=[];h!=null&&(g=(l=h.slice(m))!==null&&l!==void 0?l:[]);let E=d?[d]:[];this.recordHistory(r,E,g)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;let r=ot(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});let o=await i;return this.processStreamResponse(o,r)}getHistory(e=!1){let t=e?Ov(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var r,i;return Ro(this,arguments,function*(){var s,l,f,d;let h=[];try{for(var m=!0,g=zs(e),E;E=yield De(g.next()),s=E.done,!s;m=!0){d=E.value,m=!1;let w=d;if(NM(w)){let C=(i=(r=w.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content;C!==void 0&&h.push(C)}yield yield De(w)}}catch(w){l={error:w}}finally{try{!m&&!s&&(f=g.return)&&(yield De(f.call(g)))}finally{if(l)throw l.error}}this.recordHistory(t,h)})}recordHistory(e,t,r){let i=[];t.length>0&&t.every(o=>o.role!==void 0)?i=t:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Ov(r)):this.history.push(e),this.history.push(...i)}};var bu=class n extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,n.prototype)}};function DM(n){let e={},t=a(n,["file"]);return t!=null&&c(e,["file"],t),e}function OM(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function UM(n){let e={},t=a(n,["name"]);return t!=null&&c(e,["_url","file"],Ip(t)),e}function FM(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function LM(n){let e={},t=a(n,["name"]);return t!=null&&c(e,["_url","file"],Ip(t)),e}function qM(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),t}function BM(n){let e={},t=a(n,["config"]);return t!=null&&qM(t,e),e}function GM(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["files"],o)}return e}var ep=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ar(sr.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=BM(e);return o=ee("files",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=GM(f),h=new Vh;return Object.assign(h,d),h})}}async createInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=DM(e);return o=ee("upload/v1beta/files",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=OM(f),h=new $h;return Object.assign(h,d),h})}}async get(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=LM(e);return o=ee("files/{file}",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=UM(e);return o=ee("files/{file}",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=FM(f),h=new Wh;return Object.assign(h,d),h})}}};function du(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function HM(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>rD(o))),c(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&c(e,["role"],r),e}function VM(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function $M(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&c(e,["description"],t);let r=a(n,["name"]);r!=null&&c(e,["name"],r);let i=a(n,["parameters"]);i!=null&&c(e,["parameters"],i);let o=a(n,["parametersJsonSchema"]);o!=null&&c(e,["parametersJsonSchema"],o);let s=a(n,["response"]);s!=null&&c(e,["response"],s);let l=a(n,["responseJsonSchema"]);return l!=null&&c(e,["responseJsonSchema"],l),e}function WM(n){let e={},t=a(n,["modelSelectionConfig"]);t!=null&&c(e,["modelConfig"],t);let r=a(n,["responseJsonSchema"]);r!=null&&c(e,["responseJsonSchema"],r);let i=a(n,["audioTimestamp"]);i!=null&&c(e,["audioTimestamp"],i);let o=a(n,["candidateCount"]);o!=null&&c(e,["candidateCount"],o);let s=a(n,["enableAffectiveDialog"]);s!=null&&c(e,["enableAffectiveDialog"],s);let l=a(n,["frequencyPenalty"]);l!=null&&c(e,["frequencyPenalty"],l);let f=a(n,["logprobs"]);f!=null&&c(e,["logprobs"],f);let d=a(n,["maxOutputTokens"]);d!=null&&c(e,["maxOutputTokens"],d);let h=a(n,["mediaResolution"]);h!=null&&c(e,["mediaResolution"],h);let m=a(n,["presencePenalty"]);m!=null&&c(e,["presencePenalty"],m);let g=a(n,["responseLogprobs"]);g!=null&&c(e,["responseLogprobs"],g);let E=a(n,["responseMimeType"]);E!=null&&c(e,["responseMimeType"],E);let w=a(n,["responseModalities"]);w!=null&&c(e,["responseModalities"],w);let C=a(n,["responseSchema"]);C!=null&&c(e,["responseSchema"],C);let R=a(n,["routingConfig"]);R!=null&&c(e,["routingConfig"],R);let P=a(n,["seed"]);P!=null&&c(e,["seed"],P);let z=a(n,["speechConfig"]);z!=null&&c(e,["speechConfig"],mw(z));let $=a(n,["stopSequences"]);$!=null&&c(e,["stopSequences"],$);let W=a(n,["temperature"]);W!=null&&c(e,["temperature"],W);let H=a(n,["thinkingConfig"]);H!=null&&c(e,["thinkingConfig"],H);let G=a(n,["topK"]);G!=null&&c(e,["topK"],G);let Y=a(n,["topP"]);if(Y!=null&&c(e,["topP"],Y),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function zM(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function JM(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function YM(n,e){let t={},r=a(n,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],r);let i=a(n,["responseModalities"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","responseModalities"],i);let o=a(n,["temperature"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","temperature"],o);let s=a(n,["topP"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","topP"],s);let l=a(n,["topK"]);e!==void 0&&l!=null&&c(e,["setup","generationConfig","topK"],l);let f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","maxOutputTokens"],f);let d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","mediaResolution"],d);let h=a(n,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);let m=a(n,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],Rp(m));let g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","thinkingConfig"],g);let E=a(n,["enableAffectiveDialog"]);e!==void 0&&E!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],E);let w=a(n,["systemInstruction"]);e!==void 0&&w!=null&&c(e,["setup","systemInstruction"],HM(ot(w)));let C=a(n,["tools"]);if(e!==void 0&&C!=null){let G=xo(C);Array.isArray(G)&&(G=G.map(Y=>oD(Po(Y)))),c(e,["setup","tools"],G)}let R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&c(e,["setup","sessionResumption"],iD(R));let P=a(n,["inputAudioTranscription"]);e!==void 0&&P!=null&&c(e,["setup","inputAudioTranscription"],P);let z=a(n,["outputAudioTranscription"]);e!==void 0&&z!=null&&c(e,["setup","outputAudioTranscription"],z);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&c(e,["setup","realtimeInputConfig"],$);let W=a(n,["contextWindowCompression"]);e!==void 0&&W!=null&&c(e,["setup","contextWindowCompression"],W);let H=a(n,["proactivity"]);return e!==void 0&&H!=null&&c(e,["setup","proactivity"],H),t}function KM(n,e){let t={},r=a(n,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],WM(r));let i=a(n,["responseModalities"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","responseModalities"],i);let o=a(n,["temperature"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","temperature"],o);let s=a(n,["topP"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","topP"],s);let l=a(n,["topK"]);e!==void 0&&l!=null&&c(e,["setup","generationConfig","topK"],l);let f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","maxOutputTokens"],f);let d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","mediaResolution"],d);let h=a(n,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);let m=a(n,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],mw(Rp(m)));let g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","thinkingConfig"],g);let E=a(n,["enableAffectiveDialog"]);e!==void 0&&E!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],E);let w=a(n,["systemInstruction"]);e!==void 0&&w!=null&&c(e,["setup","systemInstruction"],ot(w));let C=a(n,["tools"]);if(e!==void 0&&C!=null){let G=xo(C);Array.isArray(G)&&(G=G.map(Y=>sD(Po(Y)))),c(e,["setup","tools"],G)}let R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&c(e,["setup","sessionResumption"],R);let P=a(n,["inputAudioTranscription"]);e!==void 0&&P!=null&&c(e,["setup","inputAudioTranscription"],P);let z=a(n,["outputAudioTranscription"]);e!==void 0&&z!=null&&c(e,["setup","outputAudioTranscription"],z);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&c(e,["setup","realtimeInputConfig"],$);let W=a(n,["contextWindowCompression"]);e!==void 0&&W!=null&&c(e,["setup","contextWindowCompression"],W);let H=a(n,["proactivity"]);return e!==void 0&&H!=null&&c(e,["setup","proactivity"],H),t}function XM(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["setup","model"],Ce(n,r));let i=a(e,["config"]);return i!=null&&c(t,["config"],YM(i,t)),t}function QM(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["setup","model"],Ce(n,r));let i=a(e,["config"]);return i!=null&&c(t,["config"],KM(i,t)),t}function ZM(n){let e={},t=a(n,["musicGenerationConfig"]);return t!=null&&c(e,["musicGenerationConfig"],t),e}function jM(n){let e={},t=a(n,["weightedPrompts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>i)),c(e,["weightedPrompts"],r)}return e}function eD(n){let e={},t=a(n,["media"]);if(t!=null){let d=tw(t);Array.isArray(d)&&(d=d.map(h=>du(h))),c(e,["mediaChunks"],d)}let r=a(n,["audio"]);r!=null&&c(e,["audio"],du(rw(r)));let i=a(n,["audioStreamEnd"]);i!=null&&c(e,["audioStreamEnd"],i);let o=a(n,["video"]);o!=null&&c(e,["video"],du(nw(o)));let s=a(n,["text"]);s!=null&&c(e,["text"],s);let l=a(n,["activityStart"]);l!=null&&c(e,["activityStart"],l);let f=a(n,["activityEnd"]);return f!=null&&c(e,["activityEnd"],f),e}function tD(n){let e={},t=a(n,["media"]);if(t!=null){let d=tw(t);Array.isArray(d)&&(d=d.map(h=>h)),c(e,["mediaChunks"],d)}let r=a(n,["audio"]);r!=null&&c(e,["audio"],rw(r));let i=a(n,["audioStreamEnd"]);i!=null&&c(e,["audioStreamEnd"],i);let o=a(n,["video"]);o!=null&&c(e,["video"],nw(o));let s=a(n,["text"]);s!=null&&c(e,["text"],s);let l=a(n,["activityStart"]);l!=null&&c(e,["activityStart"],l);let f=a(n,["activityEnd"]);return f!=null&&c(e,["activityEnd"],f),e}function nD(n){let e={},t=a(n,["setupComplete"]);t!=null&&c(e,["setupComplete"],t);let r=a(n,["serverContent"]);r!=null&&c(e,["serverContent"],r);let i=a(n,["toolCall"]);i!=null&&c(e,["toolCall"],i);let o=a(n,["toolCallCancellation"]);o!=null&&c(e,["toolCallCancellation"],o);let s=a(n,["usageMetadata"]);s!=null&&c(e,["usageMetadata"],aD(s));let l=a(n,["goAway"]);l!=null&&c(e,["goAway"],l);let f=a(n,["sessionResumptionUpdate"]);return f!=null&&c(e,["sessionResumptionUpdate"],f),e}function rD(n){let e={},t=a(n,["functionCall"]);t!=null&&c(e,["functionCall"],t);let r=a(n,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&c(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&c(e,["fileData"],VM(o));let s=a(n,["functionResponse"]);s!=null&&c(e,["functionResponse"],s);let l=a(n,["inlineData"]);l!=null&&c(e,["inlineData"],du(l));let f=a(n,["text"]);f!=null&&c(e,["text"],f);let d=a(n,["thought"]);d!=null&&c(e,["thought"],d);let h=a(n,["thoughtSignature"]);h!=null&&c(e,["thoughtSignature"],h);let m=a(n,["videoMetadata"]);return m!=null&&c(e,["videoMetadata"],m),e}function iD(n){let e={},t=a(n,["handle"]);if(t!=null&&c(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function mw(n){let e={},t=a(n,["languageCode"]);t!=null&&c(e,["languageCode"],t);let r=a(n,["voiceConfig"]);if(r!=null&&c(e,["voiceConfig"],r),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function oD(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&c(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],zM(l));let f=a(n,["googleSearch"]);f!=null&&c(e,["googleSearch"],JM(f));let d=a(n,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}function sD(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>$M(g))),c(e,["functionDeclarations"],m)}let r=a(n,["retrieval"]);r!=null&&c(e,["retrieval"],r);let i=a(n,["googleSearchRetrieval"]);i!=null&&c(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);if(o!=null&&c(e,["computerUse"],o),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=a(n,["codeExecution"]);s!=null&&c(e,["codeExecution"],s);let l=a(n,["enterpriseWebSearch"]);l!=null&&c(e,["enterpriseWebSearch"],l);let f=a(n,["googleMaps"]);f!=null&&c(e,["googleMaps"],f);let d=a(n,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);let h=a(n,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function aD(n){let e={},t=a(n,["promptTokenCount"]);t!=null&&c(e,["promptTokenCount"],t);let r=a(n,["cachedContentTokenCount"]);r!=null&&c(e,["cachedContentTokenCount"],r);let i=a(n,["candidatesTokenCount"]);i!=null&&c(e,["responseTokenCount"],i);let o=a(n,["toolUsePromptTokenCount"]);o!=null&&c(e,["toolUsePromptTokenCount"],o);let s=a(n,["thoughtsTokenCount"]);s!=null&&c(e,["thoughtsTokenCount"],s);let l=a(n,["totalTokenCount"]);l!=null&&c(e,["totalTokenCount"],l);let f=a(n,["promptTokensDetails"]);if(f!=null){let E=f;Array.isArray(E)&&(E=E.map(w=>w)),c(e,["promptTokensDetails"],E)}let d=a(n,["cacheTokensDetails"]);if(d!=null){let E=d;Array.isArray(E)&&(E=E.map(w=>w)),c(e,["cacheTokensDetails"],E)}let h=a(n,["candidatesTokensDetails"]);if(h!=null){let E=h;Array.isArray(E)&&(E=E.map(w=>w)),c(e,["responseTokensDetails"],E)}let m=a(n,["toolUsePromptTokensDetails"]);if(m!=null){let E=m;Array.isArray(E)&&(E=E.map(w=>w)),c(e,["toolUsePromptTokensDetails"],E)}let g=a(n,["trafficType"]);return g!=null&&c(e,["trafficType"],g),e}function lD(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function uD(n){let e={},t=a(n,["content"]);t!=null&&c(e,["content"],t);let r=a(n,["citationMetadata"]);r!=null&&c(e,["citationMetadata"],cD(r));let i=a(n,["tokenCount"]);i!=null&&c(e,["tokenCount"],i);let o=a(n,["finishReason"]);o!=null&&c(e,["finishReason"],o);let s=a(n,["avgLogprobs"]);s!=null&&c(e,["avgLogprobs"],s);let l=a(n,["groundingMetadata"]);l!=null&&c(e,["groundingMetadata"],l);let f=a(n,["index"]);f!=null&&c(e,["index"],f);let d=a(n,["logprobsResult"]);d!=null&&c(e,["logprobsResult"],d);let h=a(n,["safetyRatings"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(E=>E)),c(e,["safetyRatings"],g)}let m=a(n,["urlContextMetadata"]);return m!=null&&c(e,["urlContextMetadata"],m),e}function cD(n){let e={},t=a(n,["citationSources"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>i)),c(e,["citations"],r)}return e}function fD(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let o=en(i);Array.isArray(o)&&(o=o.map(s=>s)),c(t,["contents"],o)}return t}function dD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["tokensInfo"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),c(e,["tokensInfo"],i)}return e}function hD(n){let e={},t=a(n,["values"]);t!=null&&c(e,["values"],t);let r=a(n,["statistics"]);return r!=null&&c(e,["statistics"],pD(r)),e}function pD(n){let e={},t=a(n,["truncated"]);t!=null&&c(e,["truncated"],t);let r=a(n,["token_count"]);return r!=null&&c(e,["tokenCount"],r),e}function Pu(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>EO(o))),c(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&c(e,["role"],r),e}function mD(n){let e={},t=a(n,["controlType"]);t!=null&&c(e,["controlType"],t);let r=a(n,["enableControlImageComputation"]);return r!=null&&c(e,["computeControl"],r),e}function gD(n){let e={};if(a(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function yD(n,e){let t={},r=a(n,["systemInstruction"]);e!==void 0&&r!=null&&c(e,["systemInstruction"],ot(r));let i=a(n,["tools"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(l=>Sw(l))),c(e,["tools"],s)}let o=a(n,["generationConfig"]);return e!==void 0&&o!=null&&c(e,["generationConfig"],sO(o)),t}function _D(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=en(i);Array.isArray(s)&&(s=s.map(l=>Pu(l))),c(t,["contents"],s)}let o=a(e,["config"]);return o!=null&&gD(o),t}function ED(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=en(i);Array.isArray(s)&&(s=s.map(l=>l)),c(t,["contents"],s)}let o=a(e,["config"]);return o!=null&&yD(o,t),t}function SD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["totalTokens"]);r!=null&&c(e,["totalTokens"],r);let i=a(n,["cachedContentTokenCount"]);return i!=null&&c(e,["cachedContentTokenCount"],i),e}function TD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["totalTokens"]);return r!=null&&c(e,["totalTokens"],r),e}function vD(n,e){let t={},r=a(e,["model"]);return r!=null&&c(t,["_url","name"],Ce(n,r)),t}function wD(n,e){let t={},r=a(e,["model"]);return r!=null&&c(t,["_url","name"],Ce(n,r)),t}function CD(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function AD(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function bD(n,e){let t={},r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);let i=a(n,["negativePrompt"]);e!==void 0&&i!=null&&c(e,["parameters","negativePrompt"],i);let o=a(n,["numberOfImages"]);e!==void 0&&o!=null&&c(e,["parameters","sampleCount"],o);let s=a(n,["aspectRatio"]);e!==void 0&&s!=null&&c(e,["parameters","aspectRatio"],s);let l=a(n,["guidanceScale"]);e!==void 0&&l!=null&&c(e,["parameters","guidanceScale"],l);let f=a(n,["seed"]);e!==void 0&&f!=null&&c(e,["parameters","seed"],f);let d=a(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&c(e,["parameters","safetySetting"],d);let h=a(n,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);let m=a(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&c(e,["parameters","includeSafetyAttributes"],m);let g=a(n,["includeRaiReason"]);e!==void 0&&g!=null&&c(e,["parameters","includeRaiReason"],g);let E=a(n,["language"]);e!==void 0&&E!=null&&c(e,["parameters","language"],E);let w=a(n,["outputMimeType"]);e!==void 0&&w!=null&&c(e,["parameters","outputOptions","mimeType"],w);let C=a(n,["outputCompressionQuality"]);e!==void 0&&C!=null&&c(e,["parameters","outputOptions","compressionQuality"],C);let R=a(n,["addWatermark"]);e!==void 0&&R!=null&&c(e,["parameters","addWatermark"],R);let P=a(n,["labels"]);e!==void 0&&P!=null&&c(e,["labels"],P);let z=a(n,["editMode"]);e!==void 0&&z!=null&&c(e,["parameters","editMode"],z);let $=a(n,["baseSteps"]);return e!==void 0&&$!=null&&c(e,["parameters","editConfig","baseSteps"],$),t}function RD(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&c(t,["instances[0]","prompt"],i);let o=a(e,["referenceImages"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(f=>AO(f))),c(t,["instances[0]","referenceImages"],l)}let s=a(e,["config"]);return s!=null&&bD(s,t),t}function ID(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>xu(o))),c(e,["generatedImages"],i)}return e}function PD(n,e){let t={},r=a(n,["taskType"]);e!==void 0&&r!=null&&c(e,["requests[]","taskType"],r);let i=a(n,["title"]);e!==void 0&&i!=null&&c(e,["requests[]","title"],i);let o=a(n,["outputDimensionality"]);if(e!==void 0&&o!=null&&c(e,["requests[]","outputDimensionality"],o),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function xD(n,e){let t={},r=a(n,["taskType"]);e!==void 0&&r!=null&&c(e,["instances[]","task_type"],r);let i=a(n,["title"]);e!==void 0&&i!=null&&c(e,["instances[]","title"],i);let o=a(n,["outputDimensionality"]);e!==void 0&&o!=null&&c(e,["parameters","outputDimensionality"],o);let s=a(n,["mimeType"]);e!==void 0&&s!=null&&c(e,["instances[]","mimeType"],s);let l=a(n,["autoTruncate"]);return e!==void 0&&l!=null&&c(e,["parameters","autoTruncate"],l),t}function kD(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let l=Cp(n,i);Array.isArray(l)&&(l=l.map(f=>f)),c(t,["requests[]","content"],l)}let o=a(e,["config"]);o!=null&&PD(o,t);let s=a(e,["model"]);return s!==void 0&&c(t,["requests[]","model"],Ce(n,s)),t}function ND(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=Cp(n,i);Array.isArray(s)&&(s=s.map(l=>l)),c(t,["instances[]","content"],s)}let o=a(e,["config"]);return o!=null&&xD(o,t),t}function MD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["embeddings"],o)}let i=a(n,["metadata"]);return i!=null&&c(e,["metadata"],i),e}function DD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["predictions[]","embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>hD(s))),c(e,["embeddings"],o)}let i=a(n,["metadata"]);return i!=null&&c(e,["metadata"],i),e}function OD(n){let e={},t=a(n,["endpoint"]);t!=null&&c(e,["name"],t);let r=a(n,["deployedModelId"]);return r!=null&&c(e,["deployedModelId"],r),e}function UD(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function FD(n){let e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let t=a(n,["description"]);t!=null&&c(e,["description"],t);let r=a(n,["name"]);r!=null&&c(e,["name"],r);let i=a(n,["parameters"]);i!=null&&c(e,["parameters"],i);let o=a(n,["parametersJsonSchema"]);o!=null&&c(e,["parametersJsonSchema"],o);let s=a(n,["response"]);s!=null&&c(e,["response"],s);let l=a(n,["responseJsonSchema"]);return l!=null&&c(e,["responseJsonSchema"],l),e}function LD(n,e,t){let r={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&c(t,["systemInstruction"],Pu(ot(i)));let o=a(e,["temperature"]);o!=null&&c(r,["temperature"],o);let s=a(e,["topP"]);s!=null&&c(r,["topP"],s);let l=a(e,["topK"]);l!=null&&c(r,["topK"],l);let f=a(e,["candidateCount"]);f!=null&&c(r,["candidateCount"],f);let d=a(e,["maxOutputTokens"]);d!=null&&c(r,["maxOutputTokens"],d);let h=a(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);let m=a(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);let g=a(e,["logprobs"]);g!=null&&c(r,["logprobs"],g);let E=a(e,["presencePenalty"]);E!=null&&c(r,["presencePenalty"],E);let w=a(e,["frequencyPenalty"]);w!=null&&c(r,["frequencyPenalty"],w);let C=a(e,["seed"]);C!=null&&c(r,["seed"],C);let R=a(e,["responseMimeType"]);R!=null&&c(r,["responseMimeType"],R);let P=a(e,["responseSchema"]);P!=null&&c(r,["responseSchema"],Ap(P));let z=a(e,["responseJsonSchema"]);if(z!=null&&c(r,["responseJsonSchema"],z),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let $=a(e,["safetySettings"]);if(t!==void 0&&$!=null){let Q=$;Array.isArray(Q)&&(Q=Q.map(ie=>bO(ie))),c(t,["safetySettings"],Q)}let W=a(e,["tools"]);if(t!==void 0&&W!=null){let Q=xo(W);Array.isArray(Q)&&(Q=Q.map(ie=>NO(Po(ie)))),c(t,["tools"],Q)}let H=a(e,["toolConfig"]);if(t!==void 0&&H!=null&&c(t,["toolConfig"],H),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let G=a(e,["cachedContent"]);t!==void 0&&G!=null&&c(t,["cachedContent"],lr(n,G));let Y=a(e,["responseModalities"]);Y!=null&&c(r,["responseModalities"],Y);let j=a(e,["mediaResolution"]);j!=null&&c(r,["mediaResolution"],j);let T=a(e,["speechConfig"]);if(T!=null&&c(r,["speechConfig"],bp(T)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let L=a(e,["thinkingConfig"]);L!=null&&c(r,["thinkingConfig"],L);let X=a(e,["imageConfig"]);return X!=null&&c(r,["imageConfig"],X),r}function qD(n,e,t){let r={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&c(t,["systemInstruction"],ot(i));let o=a(e,["temperature"]);o!=null&&c(r,["temperature"],o);let s=a(e,["topP"]);s!=null&&c(r,["topP"],s);let l=a(e,["topK"]);l!=null&&c(r,["topK"],l);let f=a(e,["candidateCount"]);f!=null&&c(r,["candidateCount"],f);let d=a(e,["maxOutputTokens"]);d!=null&&c(r,["maxOutputTokens"],d);let h=a(e,["stopSequences"]);h!=null&&c(r,["stopSequences"],h);let m=a(e,["responseLogprobs"]);m!=null&&c(r,["responseLogprobs"],m);let g=a(e,["logprobs"]);g!=null&&c(r,["logprobs"],g);let E=a(e,["presencePenalty"]);E!=null&&c(r,["presencePenalty"],E);let w=a(e,["frequencyPenalty"]);w!=null&&c(r,["frequencyPenalty"],w);let C=a(e,["seed"]);C!=null&&c(r,["seed"],C);let R=a(e,["responseMimeType"]);R!=null&&c(r,["responseMimeType"],R);let P=a(e,["responseSchema"]);P!=null&&c(r,["responseSchema"],Ap(P));let z=a(e,["responseJsonSchema"]);z!=null&&c(r,["responseJsonSchema"],z);let $=a(e,["routingConfig"]);$!=null&&c(r,["routingConfig"],$);let W=a(e,["modelSelectionConfig"]);W!=null&&c(r,["modelConfig"],W);let H=a(e,["safetySettings"]);if(t!==void 0&&H!=null){let _e=H;Array.isArray(_e)&&(_e=_e.map(Re=>Re)),c(t,["safetySettings"],_e)}let G=a(e,["tools"]);if(t!==void 0&&G!=null){let _e=xo(G);Array.isArray(_e)&&(_e=_e.map(Re=>Sw(Po(Re)))),c(t,["tools"],_e)}let Y=a(e,["toolConfig"]);t!==void 0&&Y!=null&&c(t,["toolConfig"],Y);let j=a(e,["labels"]);t!==void 0&&j!=null&&c(t,["labels"],j);let T=a(e,["cachedContent"]);t!==void 0&&T!=null&&c(t,["cachedContent"],lr(n,T));let L=a(e,["responseModalities"]);L!=null&&c(r,["responseModalities"],L);let X=a(e,["mediaResolution"]);X!=null&&c(r,["mediaResolution"],X);let Q=a(e,["speechConfig"]);Q!=null&&c(r,["speechConfig"],Ew(bp(Q)));let ie=a(e,["audioTimestamp"]);ie!=null&&c(r,["audioTimestamp"],ie);let ne=a(e,["thinkingConfig"]);ne!=null&&c(r,["thinkingConfig"],ne);let we=a(e,["imageConfig"]);return we!=null&&c(r,["imageConfig"],we),r}function Uv(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=en(i);Array.isArray(s)&&(s=s.map(l=>Pu(l))),c(t,["contents"],s)}let o=a(e,["config"]);return o!=null&&c(t,["generationConfig"],LD(n,o,t)),t}function Fv(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["contents"]);if(i!=null){let s=en(i);Array.isArray(s)&&(s=s.map(l=>l)),c(t,["contents"],s)}let o=a(e,["config"]);return o!=null&&c(t,["generationConfig"],qD(n,o,t)),t}function Lv(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["candidates"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(d=>uD(d))),c(e,["candidates"],f)}let i=a(n,["modelVersion"]);i!=null&&c(e,["modelVersion"],i);let o=a(n,["promptFeedback"]);o!=null&&c(e,["promptFeedback"],o);let s=a(n,["responseId"]);s!=null&&c(e,["responseId"],s);let l=a(n,["usageMetadata"]);return l!=null&&c(e,["usageMetadata"],l),e}function qv(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["candidates"]);if(r!=null){let d=r;Array.isArray(d)&&(d=d.map(h=>h)),c(e,["candidates"],d)}let i=a(n,["createTime"]);i!=null&&c(e,["createTime"],i);let o=a(n,["modelVersion"]);o!=null&&c(e,["modelVersion"],o);let s=a(n,["promptFeedback"]);s!=null&&c(e,["promptFeedback"],s);let l=a(n,["responseId"]);l!=null&&c(e,["responseId"],l);let f=a(n,["usageMetadata"]);return f!=null&&c(e,["usageMetadata"],f),e}function BD(n,e){let t={};if(a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let r=a(n,["numberOfImages"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);let i=a(n,["aspectRatio"]);e!==void 0&&i!=null&&c(e,["parameters","aspectRatio"],i);let o=a(n,["guidanceScale"]);if(e!==void 0&&o!=null&&c(e,["parameters","guidanceScale"],o),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let s=a(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&c(e,["parameters","safetySetting"],s);let l=a(n,["personGeneration"]);e!==void 0&&l!=null&&c(e,["parameters","personGeneration"],l);let f=a(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&c(e,["parameters","includeSafetyAttributes"],f);let d=a(n,["includeRaiReason"]);e!==void 0&&d!=null&&c(e,["parameters","includeRaiReason"],d);let h=a(n,["language"]);e!==void 0&&h!=null&&c(e,["parameters","language"],h);let m=a(n,["outputMimeType"]);e!==void 0&&m!=null&&c(e,["parameters","outputOptions","mimeType"],m);let g=a(n,["outputCompressionQuality"]);if(e!==void 0&&g!=null&&c(e,["parameters","outputOptions","compressionQuality"],g),a(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let E=a(n,["imageSize"]);if(e!==void 0&&E!=null&&c(e,["parameters","sampleImageSize"],E),a(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function GD(n,e){let t={},r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);let i=a(n,["negativePrompt"]);e!==void 0&&i!=null&&c(e,["parameters","negativePrompt"],i);let o=a(n,["numberOfImages"]);e!==void 0&&o!=null&&c(e,["parameters","sampleCount"],o);let s=a(n,["aspectRatio"]);e!==void 0&&s!=null&&c(e,["parameters","aspectRatio"],s);let l=a(n,["guidanceScale"]);e!==void 0&&l!=null&&c(e,["parameters","guidanceScale"],l);let f=a(n,["seed"]);e!==void 0&&f!=null&&c(e,["parameters","seed"],f);let d=a(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&c(e,["parameters","safetySetting"],d);let h=a(n,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);let m=a(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&c(e,["parameters","includeSafetyAttributes"],m);let g=a(n,["includeRaiReason"]);e!==void 0&&g!=null&&c(e,["parameters","includeRaiReason"],g);let E=a(n,["language"]);e!==void 0&&E!=null&&c(e,["parameters","language"],E);let w=a(n,["outputMimeType"]);e!==void 0&&w!=null&&c(e,["parameters","outputOptions","mimeType"],w);let C=a(n,["outputCompressionQuality"]);e!==void 0&&C!=null&&c(e,["parameters","outputOptions","compressionQuality"],C);let R=a(n,["addWatermark"]);e!==void 0&&R!=null&&c(e,["parameters","addWatermark"],R);let P=a(n,["labels"]);e!==void 0&&P!=null&&c(e,["labels"],P);let z=a(n,["imageSize"]);e!==void 0&&z!=null&&c(e,["parameters","sampleImageSize"],z);let $=a(n,["enhancePrompt"]);return e!==void 0&&$!=null&&c(e,["parameters","enhancePrompt"],$),t}function HD(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&c(t,["instances[0]","prompt"],i);let o=a(e,["config"]);return o!=null&&BD(o,t),t}function VD(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&c(t,["instances[0]","prompt"],i);let o=a(e,["config"]);return o!=null&&GD(o,t),t}function $D(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>nO(s))),c(e,["generatedImages"],o)}let i=a(n,["positivePromptSafetyAttributes"]);return i!=null&&c(e,["positivePromptSafetyAttributes"],yw(i)),e}function WD(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>xu(s))),c(e,["generatedImages"],o)}let i=a(n,["positivePromptSafetyAttributes"]);return i!=null&&c(e,["positivePromptSafetyAttributes"],_w(i)),e}function zD(n,e){let t={},r=a(n,["numberOfVideos"]);if(e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r),a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let i=a(n,["durationSeconds"]);if(e!==void 0&&i!=null&&c(e,["parameters","durationSeconds"],i),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let o=a(n,["aspectRatio"]);e!==void 0&&o!=null&&c(e,["parameters","aspectRatio"],o);let s=a(n,["resolution"]);e!==void 0&&s!=null&&c(e,["parameters","resolution"],s);let l=a(n,["personGeneration"]);if(e!==void 0&&l!=null&&c(e,["parameters","personGeneration"],l),a(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let f=a(n,["negativePrompt"]);e!==void 0&&f!=null&&c(e,["parameters","negativePrompt"],f);let d=a(n,["enhancePrompt"]);if(e!==void 0&&d!=null&&c(e,["parameters","enhancePrompt"],d),a(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");let h=a(n,["lastFrame"]);e!==void 0&&h!=null&&c(e,["instances[0]","lastFrame"],ku(h));let m=a(n,["referenceImages"]);if(e!==void 0&&m!=null){let g=m;Array.isArray(g)&&(g=g.map(E=>WO(E))),c(e,["instances[0]","referenceImages"],g)}if(a(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(a(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function JD(n,e){let t={},r=a(n,["numberOfVideos"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);let i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&c(e,["parameters","storageUri"],i);let o=a(n,["fps"]);e!==void 0&&o!=null&&c(e,["parameters","fps"],o);let s=a(n,["durationSeconds"]);e!==void 0&&s!=null&&c(e,["parameters","durationSeconds"],s);let l=a(n,["seed"]);e!==void 0&&l!=null&&c(e,["parameters","seed"],l);let f=a(n,["aspectRatio"]);e!==void 0&&f!=null&&c(e,["parameters","aspectRatio"],f);let d=a(n,["resolution"]);e!==void 0&&d!=null&&c(e,["parameters","resolution"],d);let h=a(n,["personGeneration"]);e!==void 0&&h!=null&&c(e,["parameters","personGeneration"],h);let m=a(n,["pubsubTopic"]);e!==void 0&&m!=null&&c(e,["parameters","pubsubTopic"],m);let g=a(n,["negativePrompt"]);e!==void 0&&g!=null&&c(e,["parameters","negativePrompt"],g);let E=a(n,["enhancePrompt"]);e!==void 0&&E!=null&&c(e,["parameters","enhancePrompt"],E);let w=a(n,["generateAudio"]);e!==void 0&&w!=null&&c(e,["parameters","generateAudio"],w);let C=a(n,["lastFrame"]);e!==void 0&&C!=null&&c(e,["instances[0]","lastFrame"],En(C));let R=a(n,["referenceImages"]);if(e!==void 0&&R!=null){let $=R;Array.isArray($)&&($=$.map(W=>zO(W))),c(e,["instances[0]","referenceImages"],$)}let P=a(n,["mask"]);e!==void 0&&P!=null&&c(e,["instances[0]","mask"],$O(P));let z=a(n,["compressionQuality"]);return e!==void 0&&z!=null&&c(e,["parameters","compressionQuality"],z),t}function YD(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["metadata"]);r!=null&&c(e,["metadata"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);o!=null&&c(e,["error"],o);let s=a(n,["response","generateVideoResponse"]);return s!=null&&c(e,["response"],ZD(s)),e}function KD(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["metadata"]);r!=null&&c(e,["metadata"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);o!=null&&c(e,["error"],o);let s=a(n,["response"]);return s!=null&&c(e,["response"],jD(s)),e}function XD(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&c(t,["instances[0]","prompt"],i);let o=a(e,["image"]);o!=null&&c(t,["instances[0]","image"],ku(o));let s=a(e,["video"]);s!=null&&c(t,["instances[0]","video"],Tw(s));let l=a(e,["source"]);l!=null&&eO(l,t);let f=a(e,["config"]);return f!=null&&zD(f,t),t}function QD(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["prompt"]);i!=null&&c(t,["instances[0]","prompt"],i);let o=a(e,["image"]);o!=null&&c(t,["instances[0]","image"],En(o));let s=a(e,["video"]);s!=null&&c(t,["instances[0]","video"],vw(s));let l=a(e,["source"]);l!=null&&tO(l,t);let f=a(e,["config"]);return f!=null&&JD(f,t),t}function ZD(n){let e={},t=a(n,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>iO(s))),c(e,["generatedVideos"],o)}let r=a(n,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);let i=a(n,["raiMediaFilteredReasons"]);return i!=null&&c(e,["raiMediaFilteredReasons"],i),e}function jD(n){let e={},t=a(n,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>oO(s))),c(e,["generatedVideos"],o)}let r=a(n,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);let i=a(n,["raiMediaFilteredReasons"]);return i!=null&&c(e,["raiMediaFilteredReasons"],i),e}function eO(n,e){let t={},r=a(n,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);let i=a(n,["image"]);e!==void 0&&i!=null&&c(e,["instances[0]","image"],ku(i));let o=a(n,["video"]);return e!==void 0&&o!=null&&c(e,["instances[0]","video"],Tw(o)),t}function tO(n,e){let t={},r=a(n,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);let i=a(n,["image"]);e!==void 0&&i!=null&&c(e,["instances[0]","image"],En(i));let o=a(n,["video"]);return e!==void 0&&o!=null&&c(e,["instances[0]","video"],vw(o)),t}function nO(n){let e={},t=a(n,["_self"]);t!=null&&c(e,["image"],fO(t));let r=a(n,["raiFilteredReason"]);r!=null&&c(e,["raiFilteredReason"],r);let i=a(n,["_self"]);return i!=null&&c(e,["safetyAttributes"],yw(i)),e}function xu(n){let e={},t=a(n,["_self"]);t!=null&&c(e,["image"],gw(t));let r=a(n,["raiFilteredReason"]);r!=null&&c(e,["raiFilteredReason"],r);let i=a(n,["_self"]);i!=null&&c(e,["safetyAttributes"],_w(i));let o=a(n,["prompt"]);return o!=null&&c(e,["enhancedPrompt"],o),e}function rO(n){let e={},t=a(n,["_self"]);t!=null&&c(e,["mask"],gw(t));let r=a(n,["labels"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),c(e,["labels"],i)}return e}function iO(n){let e={},t=a(n,["video"]);return t!=null&&c(e,["video"],HO(t)),e}function oO(n){let e={},t=a(n,["_self"]);return t!=null&&c(e,["video"],VO(t)),e}function sO(n){let e={},t=a(n,["modelSelectionConfig"]);t!=null&&c(e,["modelConfig"],t);let r=a(n,["responseJsonSchema"]);r!=null&&c(e,["responseJsonSchema"],r);let i=a(n,["audioTimestamp"]);i!=null&&c(e,["audioTimestamp"],i);let o=a(n,["candidateCount"]);o!=null&&c(e,["candidateCount"],o);let s=a(n,["enableAffectiveDialog"]);s!=null&&c(e,["enableAffectiveDialog"],s);let l=a(n,["frequencyPenalty"]);l!=null&&c(e,["frequencyPenalty"],l);let f=a(n,["logprobs"]);f!=null&&c(e,["logprobs"],f);let d=a(n,["maxOutputTokens"]);d!=null&&c(e,["maxOutputTokens"],d);let h=a(n,["mediaResolution"]);h!=null&&c(e,["mediaResolution"],h);let m=a(n,["presencePenalty"]);m!=null&&c(e,["presencePenalty"],m);let g=a(n,["responseLogprobs"]);g!=null&&c(e,["responseLogprobs"],g);let E=a(n,["responseMimeType"]);E!=null&&c(e,["responseMimeType"],E);let w=a(n,["responseModalities"]);w!=null&&c(e,["responseModalities"],w);let C=a(n,["responseSchema"]);C!=null&&c(e,["responseSchema"],C);let R=a(n,["routingConfig"]);R!=null&&c(e,["routingConfig"],R);let P=a(n,["seed"]);P!=null&&c(e,["seed"],P);let z=a(n,["speechConfig"]);z!=null&&c(e,["speechConfig"],Ew(z));let $=a(n,["stopSequences"]);$!=null&&c(e,["stopSequences"],$);let W=a(n,["temperature"]);W!=null&&c(e,["temperature"],W);let H=a(n,["thinkingConfig"]);H!=null&&c(e,["thinkingConfig"],H);let G=a(n,["topK"]);G!=null&&c(e,["topK"],G);let Y=a(n,["topP"]);if(Y!=null&&c(e,["topP"],Y),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function aO(n,e){let t={},r=a(e,["model"]);return r!=null&&c(t,["_url","name"],Ce(n,r)),t}function lO(n,e){let t={},r=a(e,["model"]);return r!=null&&c(t,["_url","name"],Ce(n,r)),t}function uO(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function cO(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function fO(n){let e={},t=a(n,["bytesBase64Encoded"]);t!=null&&c(e,["imageBytes"],Nr(t));let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function gw(n){let e={},t=a(n,["gcsUri"]);t!=null&&c(e,["gcsUri"],t);let r=a(n,["bytesBase64Encoded"]);r!=null&&c(e,["imageBytes"],Nr(r));let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function ku(n){let e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let t=a(n,["imageBytes"]);t!=null&&c(e,["bytesBase64Encoded"],Nr(t));let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function En(n){let e={},t=a(n,["gcsUri"]);t!=null&&c(e,["gcsUri"],t);let r=a(n,["imageBytes"]);r!=null&&c(e,["bytesBase64Encoded"],Nr(r));let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function dO(n,e,t){let r={},i=a(e,["pageSize"]);t!==void 0&&i!=null&&c(t,["_query","pageSize"],i);let o=a(e,["pageToken"]);t!==void 0&&o!=null&&c(t,["_query","pageToken"],o);let s=a(e,["filter"]);t!==void 0&&s!=null&&c(t,["_query","filter"],s);let l=a(e,["queryBase"]);return t!==void 0&&l!=null&&c(t,["_url","models_url"],lw(n,l)),r}function hO(n,e,t){let r={},i=a(e,["pageSize"]);t!==void 0&&i!=null&&c(t,["_query","pageSize"],i);let o=a(e,["pageToken"]);t!==void 0&&o!=null&&c(t,["_query","pageToken"],o);let s=a(e,["filter"]);t!==void 0&&s!=null&&c(t,["_query","filter"],s);let l=a(e,["queryBase"]);return t!==void 0&&l!=null&&c(t,["_url","models_url"],lw(n,l)),r}function pO(n,e){let t={},r=a(e,["config"]);return r!=null&&dO(n,r,t),t}function mO(n,e){let t={},r=a(e,["config"]);return r!=null&&hO(n,r,t),t}function gO(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["_self"]);if(i!=null){let o=uw(i);Array.isArray(o)&&(o=o.map(s=>tp(s))),c(e,["models"],o)}return e}function yO(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["_self"]);if(i!=null){let o=uw(i);Array.isArray(o)&&(o=o.map(s=>np(s))),c(e,["models"],o)}return e}function _O(n){let e={},t=a(n,["maskMode"]);t!=null&&c(e,["maskMode"],t);let r=a(n,["segmentationClasses"]);r!=null&&c(e,["maskClasses"],r);let i=a(n,["maskDilation"]);return i!=null&&c(e,["dilation"],i),e}function tp(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["displayName"]);r!=null&&c(e,["displayName"],r);let i=a(n,["description"]);i!=null&&c(e,["description"],i);let o=a(n,["version"]);o!=null&&c(e,["version"],o);let s=a(n,["_self"]);s!=null&&c(e,["tunedModelInfo"],MO(s));let l=a(n,["inputTokenLimit"]);l!=null&&c(e,["inputTokenLimit"],l);let f=a(n,["outputTokenLimit"]);f!=null&&c(e,["outputTokenLimit"],f);let d=a(n,["supportedGenerationMethods"]);return d!=null&&c(e,["supportedActions"],d),e}function np(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["displayName"]);r!=null&&c(e,["displayName"],r);let i=a(n,["description"]);i!=null&&c(e,["description"],i);let o=a(n,["versionId"]);o!=null&&c(e,["version"],o);let s=a(n,["deployedModels"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(g=>OD(g))),c(e,["endpoints"],m)}let l=a(n,["labels"]);l!=null&&c(e,["labels"],l);let f=a(n,["_self"]);f!=null&&c(e,["tunedModelInfo"],DO(f));let d=a(n,["defaultCheckpointId"]);d!=null&&c(e,["defaultCheckpointId"],d);let h=a(n,["checkpoints"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>g)),c(e,["checkpoints"],m)}return e}function EO(n){let e={},t=a(n,["functionCall"]);t!=null&&c(e,["functionCall"],t);let r=a(n,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&c(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&c(e,["fileData"],UD(o));let s=a(n,["functionResponse"]);s!=null&&c(e,["functionResponse"],s);let l=a(n,["inlineData"]);l!=null&&c(e,["inlineData"],lD(l));let f=a(n,["text"]);f!=null&&c(e,["text"],f);let d=a(n,["thought"]);d!=null&&c(e,["thought"],d);let h=a(n,["thoughtSignature"]);h!=null&&c(e,["thoughtSignature"],h);let m=a(n,["videoMetadata"]);return m!=null&&c(e,["videoMetadata"],m),e}function SO(n){let e={},t=a(n,["productImage"]);return t!=null&&c(e,["image"],En(t)),e}function TO(n,e){let t={},r=a(n,["numberOfImages"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);let i=a(n,["baseSteps"]);e!==void 0&&i!=null&&c(e,["parameters","editConfig","baseSteps"],i);let o=a(n,["outputGcsUri"]);e!==void 0&&o!=null&&c(e,["parameters","storageUri"],o);let s=a(n,["seed"]);e!==void 0&&s!=null&&c(e,["parameters","seed"],s);let l=a(n,["safetyFilterLevel"]);e!==void 0&&l!=null&&c(e,["parameters","safetySetting"],l);let f=a(n,["personGeneration"]);e!==void 0&&f!=null&&c(e,["parameters","personGeneration"],f);let d=a(n,["addWatermark"]);e!==void 0&&d!=null&&c(e,["parameters","addWatermark"],d);let h=a(n,["outputMimeType"]);e!==void 0&&h!=null&&c(e,["parameters","outputOptions","mimeType"],h);let m=a(n,["outputCompressionQuality"]);e!==void 0&&m!=null&&c(e,["parameters","outputOptions","compressionQuality"],m);let g=a(n,["enhancePrompt"]);e!==void 0&&g!=null&&c(e,["parameters","enhancePrompt"],g);let E=a(n,["labels"]);return e!==void 0&&E!=null&&c(e,["labels"],E),t}function vO(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["source"]);i!=null&&CO(i,t);let o=a(e,["config"]);return o!=null&&TO(o,t),t}function wO(n){let e={},t=a(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>xu(i))),c(e,["generatedImages"],r)}return e}function CO(n,e){let t={},r=a(n,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);let i=a(n,["personImage"]);e!==void 0&&i!=null&&c(e,["instances[0]","personImage","image"],En(i));let o=a(n,["productImages"]);if(e!==void 0&&o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>SO(l))),c(e,["instances[0]","productImages"],s)}return t}function AO(n){let e={},t=a(n,["referenceImage"]);t!=null&&c(e,["referenceImage"],En(t));let r=a(n,["referenceId"]);r!=null&&c(e,["referenceId"],r);let i=a(n,["referenceType"]);i!=null&&c(e,["referenceType"],i);let o=a(n,["maskImageConfig"]);o!=null&&c(e,["maskImageConfig"],_O(o));let s=a(n,["controlImageConfig"]);s!=null&&c(e,["controlImageConfig"],mD(s));let l=a(n,["styleImageConfig"]);l!=null&&c(e,["styleImageConfig"],l);let f=a(n,["subjectImageConfig"]);return f!=null&&c(e,["subjectImageConfig"],f),e}function yw(n){let e={},t=a(n,["safetyAttributes","categories"]);t!=null&&c(e,["categories"],t);let r=a(n,["safetyAttributes","scores"]);r!=null&&c(e,["scores"],r);let i=a(n,["contentType"]);return i!=null&&c(e,["contentType"],i),e}function _w(n){let e={},t=a(n,["safetyAttributes","categories"]);t!=null&&c(e,["categories"],t);let r=a(n,["safetyAttributes","scores"]);r!=null&&c(e,["scores"],r);let i=a(n,["contentType"]);return i!=null&&c(e,["contentType"],i),e}function bO(n){let e={},t=a(n,["category"]);if(t!=null&&c(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let r=a(n,["threshold"]);return r!=null&&c(e,["threshold"],r),e}function RO(n){let e={},t=a(n,["image"]);return t!=null&&c(e,["image"],En(t)),e}function IO(n,e){let t={},r=a(n,["mode"]);e!==void 0&&r!=null&&c(e,["parameters","mode"],r);let i=a(n,["maxPredictions"]);e!==void 0&&i!=null&&c(e,["parameters","maxPredictions"],i);let o=a(n,["confidenceThreshold"]);e!==void 0&&o!=null&&c(e,["parameters","confidenceThreshold"],o);let s=a(n,["maskDilation"]);e!==void 0&&s!=null&&c(e,["parameters","maskDilation"],s);let l=a(n,["binaryColorThreshold"]);e!==void 0&&l!=null&&c(e,["parameters","binaryColorThreshold"],l);let f=a(n,["labels"]);return e!==void 0&&f!=null&&c(e,["labels"],f),t}function PO(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["source"]);i!=null&&kO(i,t);let o=a(e,["config"]);return o!=null&&IO(o,t),t}function xO(n){let e={},t=a(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>rO(i))),c(e,["generatedMasks"],r)}return e}function kO(n,e){let t={},r=a(n,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);let i=a(n,["image"]);e!==void 0&&i!=null&&c(e,["instances[0]","image"],En(i));let o=a(n,["scribbleImage"]);return e!==void 0&&o!=null&&c(e,["instances[0]","scribble"],RO(o)),t}function Ew(n){let e={},t=a(n,["languageCode"]);t!=null&&c(e,["languageCode"],t);let r=a(n,["voiceConfig"]);if(r!=null&&c(e,["voiceConfig"],r),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function NO(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&c(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],uO(l));let f=a(n,["googleSearch"]);f!=null&&c(e,["googleSearch"],cO(f));let d=a(n,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}function Sw(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(g=>FD(g))),c(e,["functionDeclarations"],m)}let r=a(n,["retrieval"]);r!=null&&c(e,["retrieval"],r);let i=a(n,["googleSearchRetrieval"]);i!=null&&c(e,["googleSearchRetrieval"],i);let o=a(n,["computerUse"]);if(o!=null&&c(e,["computerUse"],o),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");let s=a(n,["codeExecution"]);s!=null&&c(e,["codeExecution"],s);let l=a(n,["enterpriseWebSearch"]);l!=null&&c(e,["enterpriseWebSearch"],l);let f=a(n,["googleMaps"]);f!=null&&c(e,["googleMaps"],f);let d=a(n,["googleSearch"]);d!=null&&c(e,["googleSearch"],d);let h=a(n,["urlContext"]);return h!=null&&c(e,["urlContext"],h),e}function MO(n){let e={},t=a(n,["baseModel"]);t!=null&&c(e,["baseModel"],t);let r=a(n,["createTime"]);r!=null&&c(e,["createTime"],r);let i=a(n,["updateTime"]);return i!=null&&c(e,["updateTime"],i),e}function DO(n){let e={},t=a(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&c(e,["baseModel"],t);let r=a(n,["createTime"]);r!=null&&c(e,["createTime"],r);let i=a(n,["updateTime"]);return i!=null&&c(e,["updateTime"],i),e}function OO(n,e){let t={},r=a(n,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);let i=a(n,["description"]);e!==void 0&&i!=null&&c(e,["description"],i);let o=a(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&c(e,["defaultCheckpointId"],o),t}function UO(n,e){let t={},r=a(n,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);let i=a(n,["description"]);e!==void 0&&i!=null&&c(e,["description"],i);let o=a(n,["defaultCheckpointId"]);return e!==void 0&&o!=null&&c(e,["defaultCheckpointId"],o),t}function FO(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","name"],Ce(n,r));let i=a(e,["config"]);return i!=null&&OO(i,t),t}function LO(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["config"]);return i!=null&&UO(i,t),t}function qO(n,e){let t={},r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);let i=a(n,["safetyFilterLevel"]);e!==void 0&&i!=null&&c(e,["parameters","safetySetting"],i);let o=a(n,["personGeneration"]);e!==void 0&&o!=null&&c(e,["parameters","personGeneration"],o);let s=a(n,["includeRaiReason"]);e!==void 0&&s!=null&&c(e,["parameters","includeRaiReason"],s);let l=a(n,["outputMimeType"]);e!==void 0&&l!=null&&c(e,["parameters","outputOptions","mimeType"],l);let f=a(n,["outputCompressionQuality"]);e!==void 0&&f!=null&&c(e,["parameters","outputOptions","compressionQuality"],f);let d=a(n,["enhanceInputImage"]);e!==void 0&&d!=null&&c(e,["parameters","upscaleConfig","enhanceInputImage"],d);let h=a(n,["imagePreservationFactor"]);e!==void 0&&h!=null&&c(e,["parameters","upscaleConfig","imagePreservationFactor"],h);let m=a(n,["labels"]);e!==void 0&&m!=null&&c(e,["labels"],m);let g=a(n,["numberOfImages"]);e!==void 0&&g!=null&&c(e,["parameters","sampleCount"],g);let E=a(n,["mode"]);return e!==void 0&&E!=null&&c(e,["parameters","mode"],E),t}function BO(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["_url","model"],Ce(n,r));let i=a(e,["image"]);i!=null&&c(t,["instances[0]","image"],En(i));let o=a(e,["upscaleFactor"]);o!=null&&c(t,["parameters","upscaleConfig","upscaleFactor"],o);let s=a(e,["config"]);return s!=null&&qO(s,t),t}function GO(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["predictions"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>xu(o))),c(e,["generatedImages"],i)}return e}function HO(n){let e={},t=a(n,["uri"]);t!=null&&c(e,["uri"],t);let r=a(n,["encodedVideo"]);r!=null&&c(e,["videoBytes"],Nr(r));let i=a(n,["encoding"]);return i!=null&&c(e,["mimeType"],i),e}function VO(n){let e={},t=a(n,["gcsUri"]);t!=null&&c(e,["uri"],t);let r=a(n,["bytesBase64Encoded"]);r!=null&&c(e,["videoBytes"],Nr(r));let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}function $O(n){let e={},t=a(n,["image"]);t!=null&&c(e,["_self"],En(t));let r=a(n,["maskMode"]);return r!=null&&c(e,["maskMode"],r),e}function WO(n){let e={},t=a(n,["image"]);t!=null&&c(e,["image"],ku(t));let r=a(n,["referenceType"]);return r!=null&&c(e,["referenceType"],r),e}function zO(n){let e={},t=a(n,["image"]);t!=null&&c(e,["image"],En(t));let r=a(n,["referenceType"]);return r!=null&&c(e,["referenceType"],r),e}function Tw(n){let e={},t=a(n,["uri"]);t!=null&&c(e,["uri"],t);let r=a(n,["videoBytes"]);r!=null&&c(e,["encodedVideo"],Nr(r));let i=a(n,["mimeType"]);return i!=null&&c(e,["encoding"],i),e}function vw(n){let e={},t=a(n,["uri"]);t!=null&&c(e,["gcsUri"],t);let r=a(n,["videoBytes"]);r!=null&&c(e,["bytesBase64Encoded"],Nr(r));let i=a(n,["mimeType"]);return i!=null&&c(e,["mimeType"],i),e}var JO="Content-Type",YO="X-Server-Timeout",KO="User-Agent",rp="x-goog-api-client",XO="1.29.0",QO=`google-genai-sdk/${XO}`,ZO="v1beta1",jO="v1beta",Bv=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/,ip=class{constructor(e){var t,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:ZO,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:jO,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,r){let i=[this.getRequestUrlInternal(t)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,r);if(e.queryParams)for(let[s,l]of Object.entries(e.queryParams))i.searchParams.append(s,String(l));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,i.toString(),e.abortSignal),this.unaryApiCall(i,o,e.httpMethod)}patchHttpOptions(e,t){let r=JSON.parse(JSON.stringify(e));for(let[i,o]of Object.entries(t))typeof o=="object"?r[i]=Object.assign(Object.assign({},r[i]),o):o!==void 0&&(r[i]=o);return r}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,i.toString(),e.abortSignal),this.streamApiCall(i,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,r,i){if(t&&t.timeout||i){let o=new AbortController,s=o.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){let l=setTimeout(()=>o.abort(),t.timeout);l&&typeof l.unref=="function"&&l.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=s}return t&&t.extraBody!==null&&eU(e,t.extraBody),e.headers=await this.getHeadersInternal(t,r),e}async unaryApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async i=>(await Gv(i),new gi(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async i=>(await Gv(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var t;return Ro(this,arguments,function*(){let i=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),o=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let s="";for(;;){let{done:l,value:f}=yield De(i.read());if(l){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let d=o.decode(f,{stream:!0});try{let m=JSON.parse(d);if("error"in m){let g=JSON.parse(JSON.stringify(m.error)),E=g.status,w=g.code,C=`got status: ${E}. ${JSON.stringify(m)}`;if(w>=400&&w<600)throw new bu({message:C,status:w})}}catch(m){if(m.name==="ApiError")throw m}s+=d;let h=s.match(Bv);for(;h;){let m=h[1];try{let g=new Response(m,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield De(new gi(g)),s=s.slice(h[0].length),h=s.match(Bv)}catch(g){throw new Error(`exception parsing stream chunk ${m}. ${g}`)}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){let e={},t=QO+" "+this.clientOptions.userAgentExtra;return e[KO]=t,e[rp]=t,e[JO]="application/json",e}async getHeadersInternal(e,t){let r=new Headers;if(e&&e.headers){for(let[i,o]of Object.entries(e.headers))r.append(i,o);e.timeout&&e.timeout>0&&r.append(YO,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,t),r}getFileName(e){var t;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(t=r.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),r}async uploadFile(e,t){var r;let i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);let o=this.clientOptions.uploader,s=await o.stat(e);i.sizeBytes=String(s.size);let l=(r=t==null?void 0:t.mimeType)!==null&&r!==void 0?r:s.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=l;let f={file:i},d=this.getFileName(e),h=ee("upload/v1beta/files",f._url),m=await this.fetchUploadUrl(h,i.sizeBytes,i.mimeType,d,f,t==null?void 0:t.httpOptions);return o.upload(e,m,this)}async uploadFileToFileSearchStore(e,t,r){var i;let o=this.clientOptions.uploader,s=await o.stat(t),l=String(s.size),f=(i=r==null?void 0:r.mimeType)!==null&&i!==void 0?i:s.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");let d=`upload/v1beta/${e}:uploadToFileSearchStore`,h=this.getFileName(t),m={};r!=null&&r.customMetadata&&(m.customMetadata=r.customMetadata),r!=null&&r.chunkingConfig&&(m.chunkingConfig=r.chunkingConfig);let g=await this.fetchUploadUrl(d,l,f,h,m,r==null?void 0:r.httpOptions);return o.uploadToFileSearchStore(t,g,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,r,i,o,s){var l;let f={};s?f=s:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${r}`},i?{"X-Goog-Upload-File-Name":i}:{})};let d=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:f});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let h=(l=d==null?void 0:d.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}};async function Gv(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){let t=n.status,r;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await n.json():r={error:{message:await n.text(),code:n.status,status:n.statusText}};let i=JSON.stringify(r);throw t>=400&&t<600?new bu({message:i,status:t}):new Error(i)}}function eU(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{let o=JSON.parse(n.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(o){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(o,s){let l=Object.assign({},o);for(let f in s)if(Object.prototype.hasOwnProperty.call(s,f)){let d=s[f],h=l[f];d&&typeof d=="object"&&!Array.isArray(d)&&h&&typeof h=="object"&&!Array.isArray(h)?l[f]=r(h,d):(h&&d&&typeof h!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof h}, New type: ${typeof d}. Overwriting.`),l[f]=d)}return l}let i=r(t,e);n.body=JSON.stringify(i)}var tU="mcp_used/unknown",nU=!1;function ww(n){for(let e of n)if(rU(e)||typeof e=="object"&&"inputSchema"in e)return!0;return nU}function Cw(n){var e;let t=(e=n[rp])!==null&&e!==void 0?e:"";n[rp]=(t+` ${tU}`).trimStart()}function rU(n){return n!==null&&typeof n=="object"&&n instanceof op}function iU(n,e=100){return Ro(this,arguments,function*(){let r,i=0;for(;i<e;){let o=yield De(n.listTools({cursor:r}));for(let s of o.tools)yield yield De(s),i++;if(!o.nextCursor)break;r=o.nextCursor}})}var op=class n{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new n(e,t)}async initialize(){var e,t,r,i;if(this.mcpTools.length>0)return;let o={},s=[];for(let h of this.mcpClients)try{for(var l=!0,f=(t=void 0,zs(iU(h))),d;d=await f.next(),e=d.done,!e;l=!0){i=d.value,l=!1;let m=i;s.push(m);let g=m.name;if(o[g])throw new Error(`Duplicate function name ${g} found in MCP tools. Please ensure function names are unique.`);o[g]=h}}catch(m){t={error:m}}finally{try{!l&&!e&&(r=f.return)&&await r.call(f)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),mN(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let r of e)if(r.name in this.functionNameToMcpClient){let i=this.functionNameToMcpClient[r.name],o;this.config.timeout&&(o={timeout:this.config.timeout});let s=await i.callTool({name:r.name,arguments:r.args},void 0,o);t.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return t}};async function oU(n,e,t){let r=new Jh,i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),Object.assign(r,i),e(r)}var sp=class{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r}async connect(e){var t,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let i=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),s=aU(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),f=`${i}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${l}`,d=()=>{},h=new Promise($=>{d=$}),m=e.callbacks,g=function(){d({})},E=this.apiClient,w={onopen:g,onmessage:$=>{oU(E,m.onmessage,$)},onerror:(t=m==null?void 0:m.onerror)!==null&&t!==void 0?t:function($){},onclose:(r=m==null?void 0:m.onclose)!==null&&r!==void 0?r:function($){}},C=this.webSocketFactory.create(f,sU(s),w);C.connect(),await h;let z={setup:{model:Ce(this.apiClient,e.model)}};return C.send(JSON.stringify(z)),new ap(C,this.apiClient)}},ap=class{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let t=jM(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=ZM(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){let t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Ao.PLAY)}pause(){this.sendPlaybackControl(Ao.PAUSE)}stop(){this.sendPlaybackControl(Ao.STOP)}resetContext(){this.sendPlaybackControl(Ao.RESET_CONTEXT)}close(){this.conn.close()}};function sU(n){let e={};return n.forEach((t,r)=>{e[r]=t}),e}function aU(n){let e=new Headers;for(let[t,r]of Object.entries(n))e.append(t,r);return e}var lU="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function uU(n,e,t){let r=new zh,i;t.data instanceof Blob?i=await t.data.text():t.data instanceof ArrayBuffer?i=new TextDecoder().decode(t.data):i=t.data;let o=JSON.parse(i);if(n.isVertexAI()){let s=nD(o);Object.assign(r,s)}else Object.assign(r,o);e(r)}var lp=class{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r,this.music=new sp(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,r,i,o,s,l;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let f=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion(),h,m=this.apiClient.getHeaders();e.config&&e.config.tools&&ww(e.config.tools)&&Cw(m);let g=dU(m);if(this.apiClient.isVertexAI())h=`${f}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(g,h);else{let T=this.apiClient.getApiKey(),L="BidiGenerateContent",X="key";T!=null&&T.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),L="BidiGenerateContentConstrained",X="access_token"),h=`${f}/ws/google.ai.generativelanguage.${d}.GenerativeService.${L}?${X}=${T}`}let E=()=>{},w=new Promise(T=>{E=T}),C=e.callbacks,R=function(){var T;(T=C==null?void 0:C.onopen)===null||T===void 0||T.call(C),E({})},P=this.apiClient,z={onopen:R,onmessage:T=>{uU(P,C.onmessage,T)},onerror:(t=C==null?void 0:C.onerror)!==null&&t!==void 0?t:function(T){},onclose:(r=C==null?void 0:C.onclose)!==null&&r!==void 0?r:function(T){}},$=this.webSocketFactory.create(h,fU(g),z);$.connect(),await w;let W=Ce(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&W.startsWith("publishers/")){let T=this.apiClient.getProject(),L=this.apiClient.getLocation();W=`projects/${T}/locations/${L}/`+W}let H={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[hu.AUDIO]}:e.config.responseModalities=[hu.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let G=(l=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[],Y=[];for(let T of G)if(this.isCallableTool(T)){let L=T;Y.push(await L.tool())}else Y.push(T);Y.length>0&&(e.config.tools=Y);let j={model:W,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?H=QM(this.apiClient,j):H=XM(this.apiClient,j),delete H.config,$.send(JSON.stringify(H)),new up($,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},cU={turnComplete:!0},up=class{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let r=[];try{r=en(t.turns),e.isVertexAI()||(r=r.map(i=>Pu(i)))}catch(i){throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:r,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let r=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?r=t.functionResponses:r=[t.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(let o of r){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(lU)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},cU),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:tD(e)}:t={realtimeInput:eD(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}};function fU(n){let e={};return n.forEach((t,r)=>{e[r]=t}),e}function dU(n){let e=new Headers;for(let[t,r]of Object.entries(n))e.append(t,r);return e}var Hv=10;function Vv(n){var e,t,r;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(let s of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(Io(s)){i=!0;break}if(!i)return!0;let o=(r=n==null?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function Io(n){return"callTool"in n&&typeof n.callTool=="function"}function hU(n){var e,t,r;return(r=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>Io(i)))!==null&&r!==void 0?r:!1}function $v(n){var e;let t=[];return!((e=n==null?void 0:n.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((r,i)=>{if(Io(r))return;let o=r;o.functionDeclarations&&o.functionDeclarations.length>0&&t.push(i)}),t}function Wv(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}var cp=class extends _n{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var r,i,o,s,l;let f=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!hU(t)||Vv(t.config))return await this.generateContentInternal(f);let d=$v(t);if(d.length>0){let C=d.map(R=>`tools[${R}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${C}.`)}let h,m,g=en(f.contents),E=(o=(i=(r=f.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:Hv,w=0;for(;w<E&&(h=await this.generateContentInternal(f),!(!h.functionCalls||h.functionCalls.length===0));){let C=h.candidates[0].content,R=[];for(let P of(l=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&l!==void 0?l:[])if(Io(P)){let $=await P.callTool(h.functionCalls);R.push(...$)}w++,m={role:"user",parts:R},f.contents=en(f.contents),f.contents.push(C),f.contents.push(m),Wv(f.config)&&(g.push(C),g.push(m))}return Wv(f.config)&&(h.automaticFunctionCallingHistory=g),h},this.generateContentStream=async t=>{if(this.maybeMoveToResponseJsonSchem(t),Vv(t.config)){let i=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(i)}let r=$v(t);if(r.length>0){let i=r.map(o=>`tools[${o}]`).join(", ");throw new Error(`Incompatible tools found at ${i}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(r=>{var i;let o,s=[];if(r!=null&&r.generatedImages)for(let f of r.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((i=f==null?void 0:f.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?o=f==null?void 0:f.safetyAttributes:s.push(f);let l;return o?l={generatedImages:s,positivePromptSafetyAttributes:o,sdkHttpResponse:r.sdkHttpResponse}:l={generatedImages:s,sdkHttpResponse:r.sdkHttpResponse},l}),this.list=async t=>{var r;let s={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new ar(sr.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(s),s)},this.editImage=async t=>{let r={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(r.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async t=>{let r={numberOfImages:1,mode:"upscale"};t.config&&(r=Object.assign(Object.assign({},r),t.config));let i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:r};return await this.upscaleImageInternal(i)},this.generateVideos=async t=>{var r,i,o,s,l,f;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=t.video)===null||r===void 0)&&r.uri&&(!((i=t.video)===null||i===void 0)&&i.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((s=(o=t.source)===null||o===void 0?void 0:o.video)===null||s===void 0)&&s.uri&&(!((f=(l=t.source)===null||l===void 0?void 0:l.video)===null||f===void 0)&&f.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,r,i;let o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;let s=await Promise.all(o.map(async f=>Io(f)?await f.tool():f)),l={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(l.config.tools=s,e.config&&e.config.tools&&ww(e.config.tools)){let f=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{},d=Object.assign({},f);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),Cw(d),l.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return l}async initAfcToolsMap(e){var t,r,i;let o=new Map;for(let s of(r=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&r!==void 0?r:[])if(Io(s)){let l=s,f=await l.tool();for(let d of(i=f.functionDeclarations)!==null&&i!==void 0?i:[]){if(!d.name)throw new Error("Function declaration name is required.");if(o.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);o.set(d.name,l)}}return o}async processAfcStream(e){var t,r,i;let o=(i=(r=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:Hv,s=!1,l=0,f=await this.initAfcToolsMap(e);return(function(d,h,m){var g,E;return Ro(this,arguments,function*(){for(var w,C,R,P;l<o;){s&&(l++,s=!1);let H=yield De(d.processParamsMaybeAddMcpUsage(m)),G=yield De(d.generateContentStreamInternal(H)),Y=[],j=[];try{for(var z=!0,$=(C=void 0,zs(G)),W;W=yield De($.next()),w=W.done,!w;z=!0){P=W.value,z=!1;let T=P;if(yield yield De(T),T.candidates&&(!((g=T.candidates[0])===null||g===void 0)&&g.content)){j.push(T.candidates[0].content);for(let L of(E=T.candidates[0].content.parts)!==null&&E!==void 0?E:[])if(l<o&&L.functionCall){if(!L.functionCall.name)throw new Error("Function call name was not returned by the model.");if(h.has(L.functionCall.name)){let X=yield De(h.get(L.functionCall.name).callTool([L.functionCall]));Y.push(...X)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${h.keys()}, mising tool: ${L.functionCall.name}`)}}}}catch(T){C={error:T}}finally{try{!z&&!w&&(R=$.return)&&(yield De(R.call($)))}finally{if(C)throw C.error}}if(Y.length>0){s=!0;let T=new pi;T.candidates=[{content:{role:"user",parts:Y}}],yield yield De(T);let L=[];L.push(...j),L.push({role:"user",parts:Y});let X=en(m.contents).concat(L);m.contents=X}else break}})})(this,f,e)}async generateContentInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=Fv(this.apiClient,e);return l=ee("{model}:generateContent",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=qv(h),g=new pi;return Object.assign(g,m),g})}else{let d=Uv(this.apiClient,e);return l=ee("{model}:generateContent",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=Lv(h),g=new pi;return Object.assign(g,m),g})}}async generateContentStreamInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=Fv(this.apiClient,e);return l=ee("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(m){return Ro(this,arguments,function*(){var g,E,w,C;try{for(var R=!0,P=zs(m),z;z=yield De(P.next()),g=z.done,!g;R=!0){C=z.value,R=!1;let $=C,W=qv(yield De($.json()));W.sdkHttpResponse={headers:$.headers};let H=new pi;Object.assign(H,W),yield yield De(H)}}catch($){E={error:$}}finally{try{!R&&!g&&(w=P.return)&&(yield De(w.call(P)))}finally{if(E)throw E.error}}})})}else{let d=Uv(this.apiClient,e);return l=ee("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.requestStream({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),s.then(function(m){return Ro(this,arguments,function*(){var g,E,w,C;try{for(var R=!0,P=zs(m),z;z=yield De(P.next()),g=z.done,!g;R=!0){C=z.value,R=!1;let $=C,W=Lv(yield De($.json()));W.sdkHttpResponse={headers:$.headers};let H=new pi;Object.assign(H,W),yield yield De(H)}}catch($){E={error:$}}finally{try{!R&&!g&&(w=P.return)&&(yield De(w.call(P)))}finally{if(E)throw E.error}}})})}}async embedContent(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=ND(this.apiClient,e);return l=ee("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=DD(h),g=new pu;return Object.assign(g,m),g})}else{let d=kD(this.apiClient,e);return l=ee("{model}:batchEmbedContents",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=MD(h),g=new pu;return Object.assign(g,m),g})}}async generateImagesInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=VD(this.apiClient,e);return l=ee("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=WD(h),g=new mu;return Object.assign(g,m),g})}else{let d=HD(this.apiClient,e);return l=ee("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=$D(h),g=new mu;return Object.assign(g,m),g})}}async editImageInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let l=RD(this.apiClient,e);return o=ee("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=ID(f),h=new Dh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let l=BO(this.apiClient,e);return o=ee("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=GO(f),h=new Oh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let l=vO(this.apiClient,e);return o=ee("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=wO(f),h=new Uh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let l=PO(this.apiClient,e);return o=ee("{model}:predict",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=xO(f),h=new Fh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=lO(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>np(h))}else{let d=aO(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>tp(h))}}async listInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=mO(this.apiClient,e);return l=ee("{models_url}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=yO(h),g=new gu;return Object.assign(g,m),g})}else{let d=pO(this.apiClient,e);return l=ee("{models_url}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=gO(h),g=new gu;return Object.assign(g,m),g})}}async update(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=LO(this.apiClient,e);return l=ee("{model}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>np(h))}else{let d=FO(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>tp(h))}}async delete(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=wD(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=AD(h),g=new yu;return Object.assign(g,m),g})}else{let d=vD(this.apiClient,e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=CD(h),g=new yu;return Object.assign(g,m),g})}}async countTokens(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=ED(this.apiClient,e);return l=ee("{model}:countTokens",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=TD(h),g=new _u;return Object.assign(g,m),g})}else{let d=_D(this.apiClient,e);return l=ee("{model}:countTokens",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=SD(h),g=new _u;return Object.assign(g,m),g})}}async computeTokens(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let l=fD(this.apiClient,e);return o=ee("{model}:computeTokens",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>{let d=dD(f),h=new Lh;return Object.assign(h,d),h})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=QD(this.apiClient,e);return l=ee("{model}:predictLongRunning",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s.then(h=>{let m=KD(h),g=new Eu;return Object.assign(g,m),g})}else{let d=XD(this.apiClient,e);return l=ee("{model}:predictLongRunning",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{let m=YD(h),g=new Eu;return Object.assign(g,m),g})}}};var fp=class extends _n{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,r=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=t.name.split("/operations/")[0],o;r&&"httpOptions"in r&&(o=r.httpOptions);let s=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){let t=e.operation,r=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let i=t.name.split("/operations/")[0],o;r&&"httpOptions"in r&&(o=r.httpOptions);let s=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!0})}else{let i=await this.getVideosOperationInternal({operationName:t.name,config:r});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=iN(e);return l=ee("{operationName}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json()),s}else{let d=rN(e);return l=ee("{operationName}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s}}async fetchPredictVideosOperationInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let l=Xk(e);return o=ee("{resourceName}:fetchPredictOperation",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}};function pU(n){let e={},t=a(n,["data"]);if(t!=null&&c(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function mU(n){let e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>wU(o))),c(e,["parts"],i)}let r=a(n,["role"]);return r!=null&&c(e,["role"],r),e}function gU(n,e,t){let r={},i=a(e,["expireTime"]);t!==void 0&&i!=null&&c(t,["expireTime"],i);let o=a(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&c(t,["newSessionExpireTime"],o);let s=a(e,["uses"]);t!==void 0&&s!=null&&c(t,["uses"],s);let l=a(e,["liveConnectConstraints"]);t!==void 0&&l!=null&&c(t,["bidiGenerateContentSetup"],vU(n,l));let f=a(e,["lockAdditionalFields"]);return t!==void 0&&f!=null&&c(t,["fieldMask"],f),r}function yU(n,e){let t={},r=a(e,["config"]);return r!=null&&c(t,["config"],gU(n,r,t)),t}function _U(n){let e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let t=a(n,["fileUri"]);t!=null&&c(e,["fileUri"],t);let r=a(n,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function EU(n){let e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");let t=a(n,["enableWidget"]);return t!=null&&c(e,["enableWidget"],t),e}function SU(n){let e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");let t=a(n,["timeRangeFilter"]);return t!=null&&c(e,["timeRangeFilter"],t),e}function TU(n,e){let t={},r=a(n,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],r);let i=a(n,["responseModalities"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","responseModalities"],i);let o=a(n,["temperature"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","temperature"],o);let s=a(n,["topP"]);e!==void 0&&s!=null&&c(e,["setup","generationConfig","topP"],s);let l=a(n,["topK"]);e!==void 0&&l!=null&&c(e,["setup","generationConfig","topK"],l);let f=a(n,["maxOutputTokens"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","maxOutputTokens"],f);let d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","mediaResolution"],d);let h=a(n,["seed"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","seed"],h);let m=a(n,["speechConfig"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","speechConfig"],Rp(m));let g=a(n,["thinkingConfig"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","thinkingConfig"],g);let E=a(n,["enableAffectiveDialog"]);e!==void 0&&E!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],E);let w=a(n,["systemInstruction"]);e!==void 0&&w!=null&&c(e,["setup","systemInstruction"],mU(ot(w)));let C=a(n,["tools"]);if(e!==void 0&&C!=null){let G=xo(C);Array.isArray(G)&&(G=G.map(Y=>AU(Po(Y)))),c(e,["setup","tools"],G)}let R=a(n,["sessionResumption"]);e!==void 0&&R!=null&&c(e,["setup","sessionResumption"],CU(R));let P=a(n,["inputAudioTranscription"]);e!==void 0&&P!=null&&c(e,["setup","inputAudioTranscription"],P);let z=a(n,["outputAudioTranscription"]);e!==void 0&&z!=null&&c(e,["setup","outputAudioTranscription"],z);let $=a(n,["realtimeInputConfig"]);e!==void 0&&$!=null&&c(e,["setup","realtimeInputConfig"],$);let W=a(n,["contextWindowCompression"]);e!==void 0&&W!=null&&c(e,["setup","contextWindowCompression"],W);let H=a(n,["proactivity"]);return e!==void 0&&H!=null&&c(e,["setup","proactivity"],H),t}function vU(n,e){let t={},r=a(e,["model"]);r!=null&&c(t,["setup","model"],Ce(n,r));let i=a(e,["config"]);return i!=null&&c(t,["config"],TU(i,t)),t}function wU(n){let e={},t=a(n,["functionCall"]);t!=null&&c(e,["functionCall"],t);let r=a(n,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);let i=a(n,["executableCode"]);i!=null&&c(e,["executableCode"],i);let o=a(n,["fileData"]);o!=null&&c(e,["fileData"],_U(o));let s=a(n,["functionResponse"]);s!=null&&c(e,["functionResponse"],s);let l=a(n,["inlineData"]);l!=null&&c(e,["inlineData"],pU(l));let f=a(n,["text"]);f!=null&&c(e,["text"],f);let d=a(n,["thought"]);d!=null&&c(e,["thought"],d);let h=a(n,["thoughtSignature"]);h!=null&&c(e,["thoughtSignature"],h);let m=a(n,["videoMetadata"]);return m!=null&&c(e,["videoMetadata"],m),e}function CU(n){let e={},t=a(n,["handle"]);if(t!=null&&c(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function AU(n){let e={},t=a(n,["functionDeclarations"]);if(t!=null){let h=t;Array.isArray(h)&&(h=h.map(m=>m)),c(e,["functionDeclarations"],h)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let r=a(n,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);let i=a(n,["computerUse"]);i!=null&&c(e,["computerUse"],i);let o=a(n,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);let s=a(n,["codeExecution"]);if(s!=null&&c(e,["codeExecution"],s),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");let l=a(n,["googleMaps"]);l!=null&&c(e,["googleMaps"],EU(l));let f=a(n,["googleSearch"]);f!=null&&c(e,["googleSearch"],SU(f));let d=a(n,["urlContext"]);return d!=null&&c(e,["urlContext"],d),e}function bU(n){let e=[];for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){let i=Object.keys(r).map(o=>`${t}.${o}`);e.push(...i)}else e.push(t)}return e.join(",")}function RU(n,e){let t=null,r=n.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){let o=r.setup;typeof o=="object"&&o!==null?(n.bidiGenerateContentSetup=o,t=o):delete n.bidiGenerateContentSetup}else r!==void 0&&delete n.bidiGenerateContentSetup;let i=n.fieldMask;if(t){let o=bU(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?n.fieldMask=o:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){let s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],l=[];i.length>0&&(l=i.map(d=>s.includes(d)?`generationConfig.${d}`:d));let f=[];o&&f.push(o),l.length>0&&f.push(...l),f.length>0?n.fieldMask=f.join(","):delete n.fieldMask}else delete n.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?n.fieldMask=i.join(","):delete n.fieldMask;return n}var dp=class extends _n{constructor(e){super(),this.apiClient=e}async create(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let l=yU(this.apiClient,e);o=ee("auth_tokens",l._url),s=l._query,delete l.config,delete l._url,delete l._query;let f=RU(l,e.config);return i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),i.then(d=>d)}}};function IU(n,e){let t={},r=a(n,["displayName"]);return e!==void 0&&r!=null&&c(e,["displayName"],r),t}function PU(n){let e={},t=a(n,["config"]);return t!=null&&IU(t,e),e}function xU(n,e){let t={},r=a(n,["force"]);return e!==void 0&&r!=null&&c(e,["_query","force"],r),t}function kU(n){let e={},t=a(n,["name"]);t!=null&&c(e,["_url","name"],t);let r=a(n,["config"]);return r!=null&&xU(r,e),e}function NU(n){let e={},t=a(n,["name"]);return t!=null&&c(e,["_url","name"],t),e}function MU(n,e){let t={},r=a(n,["customMetadata"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["customMetadata"],o)}let i=a(n,["chunkingConfig"]);return e!==void 0&&i!=null&&c(e,["chunkingConfig"],i),t}function DU(n){let e={},t=a(n,["name"]);t!=null&&c(e,["name"],t);let r=a(n,["metadata"]);r!=null&&c(e,["metadata"],r);let i=a(n,["done"]);i!=null&&c(e,["done"],i);let o=a(n,["error"]);o!=null&&c(e,["error"],o);let s=a(n,["response"]);return s!=null&&c(e,["response"],UU(s)),e}function OU(n){let e={},t=a(n,["fileSearchStoreName"]);t!=null&&c(e,["_url","file_search_store_name"],t);let r=a(n,["fileName"]);r!=null&&c(e,["fileName"],r);let i=a(n,["config"]);return i!=null&&MU(i,e),e}function UU(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["parent"]);r!=null&&c(e,["parent"],r);let i=a(n,["documentName"]);return i!=null&&c(e,["documentName"],i),e}function FU(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),t}function LU(n){let e={},t=a(n,["config"]);return t!=null&&FU(t,e),e}function qU(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["fileSearchStores"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["fileSearchStores"],o)}return e}function BU(n,e){let t={},r=a(n,["mimeType"]);e!==void 0&&r!=null&&c(e,["mimeType"],r);let i=a(n,["displayName"]);e!==void 0&&i!=null&&c(e,["displayName"],i);let o=a(n,["customMetadata"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(f=>f)),c(e,["customMetadata"],l)}let s=a(n,["chunkingConfig"]);return e!==void 0&&s!=null&&c(e,["chunkingConfig"],s),t}function GU(n){let e={},t=a(n,["fileSearchStoreName"]);t!=null&&c(e,["_url","file_search_store_name"],t);let r=a(n,["config"]);return r!=null&&BU(r,e),e}function HU(n){let e={},t=a(n,["sdkHttpResponse"]);return t!=null&&c(e,["sdkHttpResponse"],t),e}function VU(n,e){let t={},r=a(n,["force"]);return e!==void 0&&r!=null&&c(e,["_query","force"],r),t}function $U(n){let e={},t=a(n,["name"]);t!=null&&c(e,["_url","name"],t);let r=a(n,["config"]);return r!=null&&VU(r,e),e}function WU(n){let e={},t=a(n,["name"]);return t!=null&&c(e,["_url","name"],t),e}function zU(n,e){let t={},r=a(n,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);let i=a(n,["pageToken"]);return e!==void 0&&i!=null&&c(e,["_query","pageToken"],i),t}function JU(n){let e={},t=a(n,["parent"]);t!=null&&c(e,["_url","parent"],t);let r=a(n,["config"]);return r!=null&&zU(r,e),e}function YU(n){let e={},t=a(n,["sdkHttpResponse"]);t!=null&&c(e,["sdkHttpResponse"],t);let r=a(n,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);let i=a(n,["documents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(s=>s)),c(e,["documents"],o)}return e}var hp=class extends _n{constructor(e){super(),this.apiClient=e,this.list=async t=>new ar(sr.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:t.parent,config:r.config}),await this.listInternal(t),t)}async get(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=WU(e);return o=ee("{name}",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var t,r;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let s=$U(e);i=ee("{name}",s._url),o=s._query,delete s._url,delete s._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=JU(e);return o=ee("{parent}/documents",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=YU(f),h=new qh;return Object.assign(h,d),h})}}};var pp=class extends _n{constructor(e,t=new hp(e)){super(),this.apiClient=e,this.documents=t,this.list=async(r={})=>new ar(sr.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=PU(e);return o=ee("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async get(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=NU(e);return o=ee("{name}",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>f)}}async delete(e){var t,r;let i="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let s=kU(e);i=ee("{name}",s._url),o=s._query,delete s._url,delete s._query,await this.apiClient.request({path:i,queryParams:o,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=LU(e);return o=ee("fileSearchStores",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=qU(f),h=new Bh;return Object.assign(h,d),h})}}async uploadToFileSearchStoreInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=GU(e);return o=ee("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=HU(f),h=new Gh;return Object.assign(h,d),h})}}async importFile(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=OU(e);return o=ee("{file_search_store_name}:importFile",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),i.then(f=>{let d=DU(f),h=new Hh;return Object.assign(h,d),h})}}};var zv="x-goog-api-key",Ws="https://www.googleapis.com/auth/cloud-platform",mp=class{constructor(e){if(e.apiKey!==void 0){this.apiKey=e.apiKey;return}let t=KU(e.googleAuthOptions);this.googleAuth=new Yv.GoogleAuth(t)}async addAuthHeaders(e,t){if(this.apiKey!==void 0){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(e.get(zv)===null){if(this.apiKey===void 0)throw new Error("Trying to set API key header but apiKey is not set");e.append(zv,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(this.googleAuth===void 0)throw new Error("Trying to set google-auth headers but googleAuth is unset");let r=await this.googleAuth.getRequestHeaders(t);for(let[i,o]of r)e.get(i)===null&&e.append(i,o)}};function KU(n){let e;if(n){if(e=n,e.scopes){if(typeof e.scopes=="string"&&e.scopes!==Ws||Array.isArray(e.scopes)&&e.scopes.indexOf(Ws)<0)throw new Error(`Invalid auth scopes. Scopes must include: ${Ws}`)}else return e.scopes=[Ws],e;return e}else return e={scopes:[Ws]},e}var gp=class{async download(e,t){if(e.downloadPath){let r=await XU(e,t);if(r instanceof gi){let i=(0,Kv.createWriteStream)(e.downloadPath);Qv.Readable.fromWeb(r.responseInternal.body).pipe(i),await(0,Zv.finished)(i)}else try{await(0,Xv.writeFile)(e.downloadPath,r,{encoding:"base64"})}catch(i){throw new Error(`Failed to write file to ${e.downloadPath}: ${i}`)}}}};async function XU(n,e){var t,r,i;let o=Ip(n.file);if(o!==void 0)return await e.request({path:`files/${o}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal});if(sw(n.file)){let s=(i=n.file.video)===null||i===void 0?void 0:i.videoBytes;if(typeof s=="string")return s;throw new Error("Failed to download generated video, Uri or videoBytes not found.")}else if(aw(n.file)){let s=n.file.videoBytes;if(typeof s=="string")return s;throw new Error("Failed to download video, Uri or videoBytes not found.")}else throw new Error("Unsupported file type")}var yp=class{create(e,t,r){return new _p(e,t,r)}},_p=class{constructor(e,t,r){this.url=e,this.headers=t,this.callbacks=r}connect(){this.ws=new kh.default(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};function QU(n,e){let t={},r=a(n,["name"]);return r!=null&&c(t,["_url","name"],r),t}function ZU(n,e){let t={},r=a(n,["name"]);return r!=null&&c(t,["_url","name"],r),t}function jU(n,e,t){let r={};if(a(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=a(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&c(e,["displayName"],i),a(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let o=a(n,["epochCount"]);e!==void 0&&o!=null&&c(e,["tuningTask","hyperparameters","epochCount"],o);let s=a(n,["learningRateMultiplier"]);if(s!=null&&c(r,["tuningTask","hyperparameters","learningRateMultiplier"],s),a(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(a(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let l=a(n,["batchSize"]);e!==void 0&&l!=null&&c(e,["tuningTask","hyperparameters","batchSize"],l);let f=a(n,["learningRate"]);if(e!==void 0&&f!=null&&c(e,["tuningTask","hyperparameters","learningRate"],f),a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(a(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function eF(n,e,t){let r={},i=a(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let E=a(n,["validationDataset"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec"],Jv(E))}else if(i==="PREFERENCE_TUNING"){let E=a(n,["validationDataset"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec"],Jv(E))}let o=a(n,["tunedModelDisplayName"]);e!==void 0&&o!=null&&c(e,["tunedModelDisplayName"],o);let s=a(n,["description"]);e!==void 0&&s!=null&&c(e,["description"],s);let l=a(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){let E=a(n,["epochCount"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec","hyperParameters","epochCount"],E)}else if(l==="PREFERENCE_TUNING"){let E=a(n,["epochCount"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],E)}let f=a(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){let E=a(n,["learningRateMultiplier"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],E)}else if(f==="PREFERENCE_TUNING"){let E=a(n,["learningRateMultiplier"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],E)}let d=a(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){let E=a(n,["exportLastCheckpointOnly"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec","exportLastCheckpointOnly"],E)}else if(d==="PREFERENCE_TUNING"){let E=a(n,["exportLastCheckpointOnly"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],E)}let h=a(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){let E=a(n,["adapterSize"]);e!==void 0&&E!=null&&c(e,["supervisedTuningSpec","hyperParameters","adapterSize"],E)}else if(h==="PREFERENCE_TUNING"){let E=a(n,["adapterSize"]);e!==void 0&&E!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],E)}if(a(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");let m=a(n,["labels"]);e!==void 0&&m!=null&&c(e,["labels"],m);let g=a(n,["beta"]);return e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","beta"],g),r}function tF(n,e){let t={},r=a(n,["baseModel"]);r!=null&&c(t,["baseModel"],r);let i=a(n,["preTunedModel"]);i!=null&&c(t,["preTunedModel"],i);let o=a(n,["trainingDataset"]);o!=null&&dF(o);let s=a(n,["config"]);return s!=null&&jU(s,t),t}function nF(n,e){let t={},r=a(n,["baseModel"]);r!=null&&c(t,["baseModel"],r);let i=a(n,["preTunedModel"]);i!=null&&c(t,["preTunedModel"],i);let o=a(n,["trainingDataset"]);o!=null&&hF(o,t,e);let s=a(n,["config"]);return s!=null&&eF(s,t,e),t}function rF(n,e){let t={},r=a(n,["name"]);return r!=null&&c(t,["_url","name"],r),t}function iF(n,e){let t={},r=a(n,["name"]);return r!=null&&c(t,["_url","name"],r),t}function oF(n,e,t){let r={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);e!==void 0&&o!=null&&c(e,["_query","pageToken"],o);let s=a(n,["filter"]);return e!==void 0&&s!=null&&c(e,["_query","filter"],s),r}function sF(n,e,t){let r={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&c(e,["_query","pageSize"],i);let o=a(n,["pageToken"]);e!==void 0&&o!=null&&c(e,["_query","pageToken"],o);let s=a(n,["filter"]);return e!==void 0&&s!=null&&c(e,["_query","filter"],s),r}function aF(n,e){let t={},r=a(n,["config"]);return r!=null&&oF(r,t),t}function lF(n,e){let t={},r=a(n,["config"]);return r!=null&&sF(r,t),t}function uF(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&c(t,["sdkHttpResponse"],r);let i=a(n,["nextPageToken"]);i!=null&&c(t,["nextPageToken"],i);let o=a(n,["tunedModels"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>Aw(l))),c(t,["tuningJobs"],s)}return t}function cF(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&c(t,["sdkHttpResponse"],r);let i=a(n,["nextPageToken"]);i!=null&&c(t,["nextPageToken"],i);let o=a(n,["tuningJobs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>Ep(l))),c(t,["tuningJobs"],s)}return t}function fF(n,e){let t={},r=a(n,["name"]);r!=null&&c(t,["model"],r);let i=a(n,["name"]);return i!=null&&c(t,["endpoint"],i),t}function dF(n,e){let t={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let r=a(n,["examples"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(o=>o)),c(t,["examples","examples"],i)}return t}function hF(n,e,t){let r={},i=a(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){let s=a(n,["gcsUri"]);e!==void 0&&s!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(i==="PREFERENCE_TUNING"){let s=a(n,["gcsUri"]);e!==void 0&&s!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}let o=a(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){let s=a(n,["vertexDatasetResource"]);e!==void 0&&s!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],s)}else if(o==="PREFERENCE_TUNING"){let s=a(n,["vertexDatasetResource"]);e!==void 0&&s!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],s)}if(a(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function Aw(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&c(t,["sdkHttpResponse"],r);let i=a(n,["name"]);i!=null&&c(t,["name"],i);let o=a(n,["state"]);o!=null&&c(t,["state"],ow(o));let s=a(n,["createTime"]);s!=null&&c(t,["createTime"],s);let l=a(n,["tuningTask","startTime"]);l!=null&&c(t,["startTime"],l);let f=a(n,["tuningTask","completeTime"]);f!=null&&c(t,["endTime"],f);let d=a(n,["updateTime"]);d!=null&&c(t,["updateTime"],d);let h=a(n,["description"]);h!=null&&c(t,["description"],h);let m=a(n,["baseModel"]);m!=null&&c(t,["baseModel"],m);let g=a(n,["_self"]);return g!=null&&c(t,["tunedModel"],fF(g)),t}function Ep(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&c(t,["sdkHttpResponse"],r);let i=a(n,["name"]);i!=null&&c(t,["name"],i);let o=a(n,["state"]);o!=null&&c(t,["state"],ow(o));let s=a(n,["createTime"]);s!=null&&c(t,["createTime"],s);let l=a(n,["startTime"]);l!=null&&c(t,["startTime"],l);let f=a(n,["endTime"]);f!=null&&c(t,["endTime"],f);let d=a(n,["updateTime"]);d!=null&&c(t,["updateTime"],d);let h=a(n,["error"]);h!=null&&c(t,["error"],h);let m=a(n,["description"]);m!=null&&c(t,["description"],m);let g=a(n,["baseModel"]);g!=null&&c(t,["baseModel"],g);let E=a(n,["tunedModel"]);E!=null&&c(t,["tunedModel"],E);let w=a(n,["preTunedModel"]);w!=null&&c(t,["preTunedModel"],w);let C=a(n,["supervisedTuningSpec"]);C!=null&&c(t,["supervisedTuningSpec"],C);let R=a(n,["preferenceOptimizationSpec"]);R!=null&&c(t,["preferenceOptimizationSpec"],R);let P=a(n,["tuningDataStats"]);P!=null&&c(t,["tuningDataStats"],P);let z=a(n,["encryptionSpec"]);z!=null&&c(t,["encryptionSpec"],z);let $=a(n,["partnerModelTuningSpec"]);$!=null&&c(t,["partnerModelTuningSpec"],$);let W=a(n,["customBaseModel"]);W!=null&&c(t,["customBaseModel"],W);let H=a(n,["experiment"]);H!=null&&c(t,["experiment"],H);let G=a(n,["labels"]);G!=null&&c(t,["labels"],G);let Y=a(n,["outputUri"]);Y!=null&&c(t,["outputUri"],Y);let j=a(n,["pipelineJob"]);j!=null&&c(t,["pipelineJob"],j);let T=a(n,["serviceAccount"]);T!=null&&c(t,["serviceAccount"],T);let L=a(n,["tunedModelDisplayName"]);L!=null&&c(t,["tunedModelDisplayName"],L);let X=a(n,["veoTuningSpec"]);return X!=null&&c(t,["veoTuningSpec"],X),t}function pF(n,e){let t={},r=a(n,["sdkHttpResponse"]);r!=null&&c(t,["sdkHttpResponse"],r);let i=a(n,["name"]);i!=null&&c(t,["name"],i);let o=a(n,["metadata"]);o!=null&&c(t,["metadata"],o);let s=a(n,["done"]);s!=null&&c(t,["done"],s);let l=a(n,["error"]);return l!=null&&c(t,["error"],l),t}function Jv(n,e){let t={},r=a(n,["gcsUri"]);r!=null&&c(t,["validationDatasetUri"],r);let i=a(n,["vertexDatasetResource"]);return i!=null&&c(t,["validationDatasetUri"],i),t}var Sp=class extends _n{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new ar(sr.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(t),t),this.tune=async t=>{var r;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){let i={tunedModelName:t.baseModel};!((r=t.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(i.checkpointId=t.config.preTunedModelCheckpointId);let o=Object.assign(Object.assign({},t),{preTunedModel:i});return o.baseModel=void 0,await this.tuneInternal(o)}else{let i=Object.assign({},t);return await this.tuneInternal(i)}else{let i=Object.assign({},t),o=await this.tuneMldevInternal(i),s="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?s=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(s=o.name.split("/operations/")[0]),{name:s,state:Mh.JOB_STATE_QUEUED}}}}async getInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=iF(e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>Ep(h))}else{let d=rF(e);return l=ee("{name}",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>Aw(h))}}async listInternal(e){var t,r,i,o;let s,l="",f={};if(this.apiClient.isVertexAI()){let d=lF(e);return l=ee("tuningJobs",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=cF(h),g=new Su;return Object.assign(g,m),g})}else{let d=aF(e);return l=ee("tunedModels",d._url),f=d._query,delete d._url,delete d._query,s=this.apiClient.request({path:l,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json().then(m=>{let g=m;return g.sdkHttpResponse={headers:h.headers},g})),s.then(h=>{let m=uF(h),g=new Su;return Object.assign(g,m),g})}}async cancel(e){var t,r,i,o;let s="",l={};if(this.apiClient.isVertexAI()){let f=ZU(e);s=ee("{name}:cancel",f._url),l=f._query,delete f._url,delete f._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{let f=QU(e);s=ee("{name}:cancel",f._url),l=f._query,delete f._url,delete f._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI()){let l=nF(e,e);return o=ee("tuningJobs",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>Ep(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,r;let i,o="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let l=tF(e);return o=ee("tunedModels",l._url),s=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(d=>{let h=d;return h.sdkHttpResponse={headers:f.headers},h})),i.then(f=>pF(f))}}},bw=1024*1024*8,Rw=3,Iw=1e3,Pw=2,kr="x-goog-upload-status";async function mF(n,e,t){var r;let i=await xw(n,e,t),o=await(i==null?void 0:i.json());if(((r=i==null?void 0:i.headers)===null||r===void 0?void 0:r[kr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function gF(n,e,t){var r;let i=await xw(n,e,t),o=await(i==null?void 0:i.json());if(((r=i==null?void 0:i.headers)===null||r===void 0?void 0:r[kr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let s=wp(o),l=new Cu;return Object.assign(l,s),l}async function xw(n,e,t){var r,i;let o=0,s=0,l=new gi(new Response),f="upload";for(o=n.size;s<o;){let d=Math.min(bw,o-s),h=n.slice(s,s+d);s+d>=o&&(f+=", finalize");let m=0,g=Iw;for(;m<Rw&&(l=await t.request({path:"",body:h,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(s),"Content-Length":String(d)}}}),!(!((r=l==null?void 0:l.headers)===null||r===void 0)&&r[kr]));)m++,await kw(g),g=g*Pw;if(s+=d,((i=l==null?void 0:l.headers)===null||i===void 0?void 0:i[kr])!=="active")break;if(o<=s)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function yF(n){return{size:n.size,type:n.type}}function kw(n){return new Promise(e=>setTimeout(e,n))}var Tp=class{async stat(e){let t={size:0,type:void 0};if(typeof e=="string"){let r=await Iu.stat(e);return t.size=r.size,t.type=this.inferMimeType(e),t}else return await yF(e)}async upload(e,t,r){return typeof e=="string"?await this.uploadFileFromPath(e,t,r):mF(e,t,r)}async uploadToFileSearchStore(e,t,r){return typeof e=="string"?await this.uploadFileToFileSearchStoreFromPath(e,t,r):gF(e,t,r)}inferMimeType(e){let t=e.slice(e.lastIndexOf(".")+1);return{aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"}[t.toLowerCase()]}async uploadFileFromPath(e,t,r){var i;let o=await this.uploadFileFromPathInternal(e,t,r),s=await(o==null?void 0:o.json());if(((i=o==null?void 0:o.headers)===null||i===void 0?void 0:i[kr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return s.file}async uploadFileToFileSearchStoreFromPath(e,t,r){var i;let o=await this.uploadFileFromPathInternal(e,t,r),s=await(o==null?void 0:o.json());if(((i=o==null?void 0:o.headers)===null||i===void 0?void 0:i[kr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");let l=wp(s),f=new Cu;return Object.assign(f,l),f}async uploadFileFromPathInternal(e,t,r){var i,o;let s=0,l=0,f=new gi(new Response),d="upload",h,m=jv.basename(e);try{if(h=await Iu.open(e,"r"),!h)throw new Error("Failed to open file");for(s=(await h.stat()).size;l<s;){let g=Math.min(bw,s-l);l+g>=s&&(d+=", finalize");let E=new Uint8Array(g),{bytesRead:w}=await h.read(E,0,g,l);if(w!==g)throw new Error(`Failed to read ${g} bytes from file at offset ${l}. bytes actually read: ${w}`);let C=new Blob([E]),R=0,P=Iw;for(;R<Rw&&(f=await r.request({path:"",body:C,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(l),"Content-Length":String(w),"X-Goog-Upload-File-Name":m}}}),!(!((i=f==null?void 0:f.headers)===null||i===void 0)&&i[kr]));)R++,await kw(P),P=P*Pw;if(l+=w,((o=f==null?void 0:f.headers)===null||o===void 0?void 0:o[kr])!=="active")break;if(s<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return f}finally{h&&await h.close()}}};var _F="gl-node/",Ru=class{constructor(e){var t,r,i,o,s,l;if((e.project||e.location)&&e.apiKey)throw new Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=(r=(t=e.vertexai)!==null&&t!==void 0?t:EF("GOOGLE_GENAI_USE_VERTEXAI"))!==null&&r!==void 0?r:!1;let f=TF(),d=mi("GOOGLE_CLOUD_PROJECT"),h=mi("GOOGLE_CLOUD_LOCATION");this.apiKey=(i=e.apiKey)!==null&&i!==void 0?i:f,this.project=(o=e.project)!==null&&o!==void 0?o:d,this.location=(s=e.location)!==null&&s!==void 0?s:h,e.vertexai&&(!((l=e.googleAuthOptions)===null||l===void 0)&&l.credentials&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(d||h)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&f?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(d||h)&&f&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),!this.location&&!this.apiKey&&(this.location="global"));let m=Yk(e.httpOptions,e.vertexai,mi("GOOGLE_VERTEX_BASE_URL"),mi("GOOGLE_GEMINI_BASE_URL"));m&&(e.httpOptions?e.httpOptions.baseUrl=m:e.httpOptions={baseUrl:m}),this.apiVersion=e.apiVersion;let g=new mp({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new ip({auth:g,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:_F+process.version,uploader:new Tp,downloader:new gp}),this.models=new cp(this.apiClient),this.live=new lp(this.apiClient,g,new yp),this.batches=new Xh(this.apiClient),this.chats=new Zh(this.models,this.apiClient),this.caches=new Qh(this.apiClient),this.files=new ep(this.apiClient),this.operations=new fp(this.apiClient),this.authTokens=new dp(this.apiClient),this.tunings=new Sp(this.apiClient),this.fileSearchStores=new pp(this.apiClient)}};function mi(n){var e,t,r;return(r=(t=(e=process==null?void 0:process.env)===null||e===void 0?void 0:e[n])===null||t===void 0?void 0:t.trim())!==null&&r!==void 0?r:void 0}function EF(n){return SF(mi(n))}function SF(n){return n===void 0?!1:n.toLowerCase()==="true"}function TF(){let n=mi("GOOGLE_API_KEY"),e=mi("GEMINI_API_KEY");return n&&e&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),n||e||void 0}var No="ai-adapter/providers/geminiProvider",Nu,Nw={lastModel:Be[13],lastImageModel:Be[12],apiKey:""},Mu=class n extends Bi{constructor(){super(),this.lastModel=fe.aiAdapterSettings.geminiSettings.lastModel,this.lastImageModel=fe.aiAdapterSettings.geminiSettings.lastImageModel,n.restartSession(),this.checkGemini().then(e=>{ue(No,"Gemini check success: "+e)})}generateSettings(e,t){new Mo.Setting(e).setName("Gemini").setHeading(),new Mo.Setting(e).setName("Gemini API key").setDesc("Set your gemini API token").addText(r=>r.setValue(fe.aiAdapterSettings.geminiSettings.apiKey!==""?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"").onChange(async i=>{i.contains("\u2022")||(fe.aiAdapterSettings.geminiSettings.apiKey=i,n.restartSession(),this.checkGemini().then(o=>{ue(No,"Gemini check success: "+o)}),await Ht(t))}))}async queryHandling(e){let t=await Nu.models.generateContent({model:fe.aiAdapterSettings.selectedModel.model,contents:[{role:"user",parts:[{text:e}]}]});return t.text===void 0?"[AI-ERROR] No response from Gemini API":t.text}async queryWithImageHandling(e,t){let r=await Nu.models.generateContent({model:fe.aiAdapterSettings.selectedImageModel.model,contents:[{role:"user",parts:[{text:e},{inlineData:{mimeType:"image/png",data:t}}]}]});return r.text===void 0?"[AI-ERROR] No response from Gemini API":r.text}setLastModel(e){super.setLastModel(e),fe.aiAdapterSettings.geminiSettings.lastModel=e}setLastImageModel(e){super.setLastImageModel(e),fe.aiAdapterSettings.geminiSettings.lastImageModel=e}static restartSession(){Nu=new Ru({apiKey:fe.aiAdapterSettings.geminiSettings.apiKey})}async checkGemini(){var e,t,r;try{let i=!1;for await(let o of await Nu.models.list())if((e=o.supportedActions)!=null&&e.includes("generateContent")){let s=(t=o.displayName)!=null?t:"unknown",l=(r=o.name)!=null?r:"unknown",f={name:s,model:l,imageReady:!0,provider:"gemini"};Be.some(h=>h.model===f.model&&h.imageReady)||(Be.push(f),ue(No,"Added model: "+f.name),i=!0);let d={name:s,model:l,imageReady:!1,provider:"gemini"};Be.some(h=>h.model===f.model&&!h.imageReady)||(Be.push(d),ue(No,"Added model: "+d.name),i=!0)}return i&&(ue(No,"Models updated, notifying settings tab"),Gi()),!0}catch(i){return ue(No,i),new Mo.Notice("Error connecting to gemini API. Please check your gemini API key."),new Mo.Notice(i.toString()),!1}}};var Mw=require("obsidian");var Dw="ai-adapter/util";function Du(){switch(ue(Dw,"Initializing provider: "+fe.aiAdapterSettings.provider),fe.aiAdapterSettings.provider){case"ollama":return new an;case"gemini":return new Mu}}function Ow(){if(!ft)throw ue(Dw,"Provider not initialized"),new Mw.Notice("Provider not initialized"),new Error("Provider not initialized")}var Uw={provider:"ollama",selectedModel:Be[8],selectedImageModel:Be[0],ollamaSettings:Uc,geminiSettings:Nw};function Fw(n,e){new Pp.Setting(n).setName("Provider").setDesc("Select the provider to use").addDropdown(t=>t.addOptions(Qm.reduce((r,i)=>(r[i]=i,r),{})).setValue(fe.aiAdapterSettings.provider).onChange(async r=>{var i,o;fe.aiAdapterSettings.provider=r,Pa(Du()),fe.aiAdapterSettings.selectedModel=(i=ft.lastModel)!=null?i:Be[0],fe.aiAdapterSettings.selectedImageModel=(o=ft.lastImageModel)!=null?o:Be[0],await Ht(e),Gi()})),new Pp.Setting(n).setName("Image model").setDesc("Select the image model to use").addDropdown(t=>t.addOptions(Be.filter(r=>r.provider==fe.aiAdapterSettings.provider&&r.imageReady).reduce((r,i)=>(r[i.name]=i.name,r),{})).setValue(fe.aiAdapterSettings.selectedImageModel.name).onChange(async r=>{fe.aiAdapterSettings.selectedImageModel=Be.find(i=>i.name===r),ft.setLastImageModel(fe.aiAdapterSettings.selectedImageModel),await Ht(e)})),ft.generateSettings(n,e)}var vF="settings",xp={debug:!1,prompt:"Describe the image. Just use Keywords. For example: cat, dog, tree. This must be Computer readable. The provided pictures are used in an notebook. Please provide at least 5 Keywords. It will be used to search for the image later.",autoClearCache:!0,aiAdapterSettings:Uw},fe=Object.assign({},xp);async function Lw(n){fe=Object.assign({},xp,await n.loadData())}async function Ht(n){await n.saveData(fe)}var Uu=class extends tn.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,ng(rg(()=>{ue(vF,"Models changed, updating settings tab"),this.display()}))}display(){let{containerEl:e}=this;e.empty(),new tn.Setting(e).setName("Clear cache").setDesc("Clear the cache, reanalyzing images could take a while").addButton(t=>t.setButtonText("Clear cache").onClick(async()=>{await Ou(),new tn.Notice("Cache cleared")})),new tn.Setting(e).setName("Debug mode").setDesc("Enable debug mode to see logs in the console").addToggle(t=>t.setValue(fe.debug).onChange(async r=>{fe.debug=r,await Ht(this.plugin)})),new tn.Setting(e).setName("AI configuration").setHeading(),Fw(e,this.plugin),new tn.Setting(e).setName("Advanced").setHeading(),new tn.Setting(e).setName("Prompt").setDesc("Set the prompt to use alongside the image").addTextArea(t=>(t.inputEl.rows=5,t.inputEl.cols=50,t.setPlaceholder("Enter the prompt").setValue(fe.prompt).onChange(async r=>{r.length===0&&(r=xp.prompt),fe.prompt=r,await Ht(this.plugin),fe.autoClearCache&&await Ou()}))),new tn.Setting(e).setName("Auto clear cache").setDesc("Clear the cache after changing the model or the prompt to reanalyze images (if toggled on the cache will be cleared)").addToggle(t=>t.setValue(fe.autoClearCache).onChange(async r=>{fe.autoClearCache=r,r&&(await Ou(),new tn.Notice("Cache cleared")),await Ht(this.plugin)}))}};var wF="util";function CF(n){let e=0;for(let r=0;r<n.length;r++)e=n.charCodeAt(r)+((e<<5)-e),e|=0;return`hsl(${(e%360+360)%360}, 70%, 50%)`}function ue(n,e){if(fe.debug){let t=CF(n);console.log(`[AIImageAnalyzer] %c[${n}]`,`color: ${t}; font-weight: bold;`,e)}}function Mr(n){let e=n.path;return e.endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".webp")||e.endsWith(".svg")}async function Bw(n){if(n.path.endsWith(".svg")){ue(wF,"Converting SVG to PNG");try{let e=await this.app.vault.adapter.read(n.path);return await new Promise((t,r)=>{let i=document.createElement("canvas");i.width=1e3,i.height=1e3;let o=i.getContext("2d");if(!o){r(new Error("Could not get canvas context"));return}let s=new Image;s.onload=()=>{try{o.drawImage(s,0,0,1e3,1e3);let l=i.toDataURL("image/png");t(l.split(",")[1])}catch(l){r(l)}},s.onerror=l=>{console.error("Error loading SVG image:",l),r(l)},s.src=`data:image/svg+xml;base64,${btoa(e)}`})}catch(e){throw console.error("Error converting SVG to PNG:",e),e}}else return(0,qw.arrayBufferToBase64)(await app.vault.readBinary(n))}var Js="cache";function Fu(){return`${app.vault.configDir}/plugins/ai-image-analyzer/cache`}function Lu(n){let e=(0,Gw.createHash)("md5").update(n.path).digest("hex"),t=`${Fu()}`,r=`${e}.json`;return`${t}/${r}`}async function Do(n){let e=Lu(n);return await app.vault.adapter.exists(e)}async function Hw(n,e){if(e.length===0)return;let t=Lu(n);await this.app.vault.adapter.exists(Fu())||await this.app.vault.adapter.mkdir(Fu());let r={path:n.path,text:e,libVersion:Xm};ue(Js,`Writing cache entry for ${n.path}`),await this.app.vault.adapter.write(t,JSON.stringify(r))}async function Vw(n){try{if(await Do(n)){let e=Lu(n),t=await this.app.vault.adapter.read(e),r=JSON.parse(t);return r.text.length===0?(ue(Js,"Cache entry is empty, removing"),await Ys(n),null):(ue(Js,`Read cache entry for ${n.path}`),r)}}catch(e){console.error(e)}return null}async function Ys(n){let e=Lu(n);if(await Do(n))return ue(Js,`Removing cache entry for ${n.path}`),await this.app.vault.adapter.remove(e)}async function Ou(){let n=Fu();if(await this.app.vault.adapter.exists(n))return ue(Js,"Clearing cache"),await this.app.vault.adapter.rmdir(n,!0)}var yi=require("obsidian");var AF=require("obsidian");var $w="ai-adapter/api";async function Ww(n,e){Ow();try{let t=await ft.queryWithImageHandling(n,e);return t.length===0?(ue($w,"Empty response from provider"),Promise.reject("Empty response from provider")):t}catch(t){return ft instanceof an&&an.refreshInstance(),ue($w,t),Promise.reject(t)}}var st="analyserManager",zw=new Set,Jw=12e4;async function kp(n){var e;try{return(e=await ba.add(()=>bF(n)))!=null?e:""}catch(t){return ue(st,t),""}}async function bF(n){let e=n.path;try{return await bc(Yw(n),Jw)}catch(t){if(ue(st,`analyzeImageHandling failed for ${e}:`),ue(st,t),!zw.has(e)){zw.add(e),ft instanceof an&&an.refreshInstance(),an.abortCurrentOllamaRequest(),ue(st,`Retrying image once: ${e}`);try{return await bc(Yw(n),Jw)}catch(r){throw ue(st,`Retry also failed for ${e}:`),ue(st,r),r}}throw t}}async function Yw(n){if(ue(st,`Analyzing image ${n.name}`),!Mr(n))return Promise.reject("File is not an image");if(await Do(n)){ue(st,"Cache hit");let e=await Vw(n);if(e&&e.text!=="")return ue(st,"Reading from cache"),ue(st,`Image analyzed ${n.name}`),Promise.resolve(e.text);ue(st,"Failed to read cache")}try{let e=await Bw(n),t=await Ww(fe.prompt,e);return ue(st,"Response: "+(t!=null?t:"null")),t?(await Hw(n,t),ue(st,`Image analyzed ${n.name}`),Promise.resolve(t)):Promise.reject("Failed to analyze image")}catch(e){return ue(st,e),Promise.reject("Failed to analyze image")}}async function qu(n){try{let e=new yi.Notice("Analyzing image",0),t=await kp(n);return e.hide(),t==""?(new yi.Notice("Failed to analyze image"),""):(new yi.Notice("Image analyzed"),t)}catch(e){return ue(st,e),new yi.Notice("Failed to analyze image"),new yi.Notice(e.toString()),""}}async function Np(n){try{let e=await qu(n);if(e=="")return;await activeWindow.navigator.clipboard.writeText(e),new yi.Notice("Text copied to clipboard")}catch(e){ue(st,e)}}var Kw="main",Bu=class extends _i.Plugin{constructor(){super(...arguments);this.api={analyzeImage:kp,canBeAnalyzed:Mr,isInCache:Do}}async onload(){ue(Kw,"loading ai image analyzer plugin"),await Lw(this),Pa(Du()),this.addCommand({id:"analyze-image-to-clipboard",name:"Analyze image to clipboard",checkCallback:t=>{let r=Mp();return r!=null&&Mr(r)?(t||Np(r),!0):!1}}),this.addCommand({id:"analyze-image",name:"Analyze image",checkCallback:t=>{let r=Mp();return r!=null&&Mr(r)?(t||qu(r),!0):!1}}),this.addCommand({id:"clear-cache-of-active-image",name:"Clear cache of active image",checkCallback:t=>{let r=Mp();return r!=null&&Mr(r)?(t||(Ys(r),new _i.Notice("Cache cleared")),!0):!1}}),this.registerEvent(this.app.workspace.on("file-menu",(t,r,i)=>{r instanceof _i.TFile&&Mr(r)&&t.addItem(o=>{o.setTitle("AI analyze image");let s=o.setSubmenu();s.addItem(l=>l.setTitle("Analyze image to clipboard").setIcon("clipboard").onClick(()=>{Np(r)})),s.addItem(l=>l.setTitle("Analyze image").setIcon("search").onClick(async()=>{await Ys(r),await qu(r)})),s.addItem(l=>l.setTitle("Clear cache").setIcon("trash").onClick(async()=>{await Ys(r),new _i.Notice("Cache cleared")}))})})),this.addSettingTab(new Uu(this.app,this))}onunload(){ba.clear(),ft.shutdown(),xa&&xa(),ue(Kw,"unloading ai image analyzer plugin")}};function Mp(){var n,e;return(e=(n=this.app.workspace.activeEditor)==null?void 0:n.file)!=null?e:this.app.workspace.getActiveFile()}
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

safe-buffer/index.js:
  (*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

gtoken/build/cjs/src/index.cjs:
  (*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE *)

@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
@google/genai/dist/node/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
