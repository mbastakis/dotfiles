# Development environment values for istiod
# Overrides values.yaml for development-specific configurations

istiod:
  # Development pilot configuration
  pilot:
    # Increased replica count for HA even in dev
    autoscaleMin: 3
    autoscaleMax: 5
    replicaCount: 3

    # Lower resource requirements for development
    resources:
      requests:
        cpu: 100m     # Reduced baseline for dev clusters
        memory: 256Mi
      limits:
        cpu: 1000m    # 10x burst still available
        memory: 512Mi # Reduced limit for development

    # Allow higher utilization in dev
    cpu:
      targetAverageUtilization: 80

    # Enhanced logging and tracing for development debugging
    traceSampling: 10.0  # Higher sampling rate for dev (10% sampling)

    env:
      PILOT_LOG_LEVEL: debug

    # Service annotations for topology-aware routing
    serviceAnnotations:
      service.kubernetes.io/topology-aware-hints: auto

    # Pod anti-affinity for high availability
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/instance
              operator: In
              values:
              - "istio-istiod"
          topologyKey: kubernetes.io/hostname
          namespaces:
          - "istio-system"
        preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                  - key: app.kubernetes.io/instance
                    operator: In
                    values:
                      - "istio-istiod"
              topologyKey: topology.kubernetes.io/zone
              namespaces:
                - "istio-system"

    # Topology spread constraints
    topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: DoNotSchedule