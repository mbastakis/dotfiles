#!/bin/sh
# This script allows runtime configuration of the frontend by replacing placeholders

# First, copy all files to a writable location
echo "Copying files from /app/html to /tmp/html..."
cp -r /app/html /tmp/

# Replace the placeholder with the actual backend URL
if [ -n "$VITE_BACKEND_URL" ]; then
    echo "Configuring backend URL: $VITE_BACKEND_URL"
    # Find and replace the placeholder in all JS files
    find /tmp/html -name "*.js" -type f -exec sed -i "s|__VITE_BACKEND_URL_PLACEHOLDER__|$VITE_BACKEND_URL|g" {} +
    find /tmp/html -name "*.html" -type f -exec sed -i "s|__VITE_BACKEND_URL_PLACEHOLDER__|$VITE_BACKEND_URL|g" {} +
    echo "Backend URL configuration complete"
else
    echo "WARNING: VITE_BACKEND_URL not set, using placeholder"
fi

# Start nginx with custom config
echo "Starting nginx..."
exec nginx -g 'daemon off;'