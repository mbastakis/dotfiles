#!/bin/bash
# One-time setup tasks after initial chezmoi apply

{{- if ne .chezmoi.os "darwin" }}
exit 0
{{- end }}

set -euo pipefail

echo "Running one-time setup tasks..."

if command -v bat &>/dev/null; then
    echo "Building bat theme cache..."
    bat cache --build || true
fi

if command -v ya &>/dev/null; then
    echo "Installing Yazi plugins..."
    ya pkg upgrade || ya pkg install 2>/dev/null || true
fi

if command -v carapace &>/dev/null && [[ -f "$HOME/.bin/carapace-sync" ]]; then
    echo "Syncing carapace completions..."
    "$HOME/.bin/carapace-sync" || true
fi

mkdir -p "$HOME/.cache"

echo "Setup complete!"
